<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<!-- saved from url=(0384)https://snort-org-site.s3.amazonaws.com/production/release_files/files/000/037/699/original/snort_user.html?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=AKIAU7AK5ITMJQBJPARJ%2F20240119%2Fus-east-1%2Fs3%2Faws4_request&X-Amz-Date=20240119T060321Z&X-Amz-Expires=3600&X-Amz-SignedHeaders=host&X-Amz-Signature=3f60940722326d7506860e0898ec8f9e23932274db70a3266524d1e0fe0f4143#_ids_mode -->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

<meta name="generator" content="AsciiDoc 8.6.10">
<title>Snort 3 User Manual</title>
<style type="text/css">
/* Shared CSS for AsciiDoc xhtml11 and html5 backends */

/* Default font. */
body {
  font-family: Georgia,serif;
}

/* Title font. */
h1, h2, h3, h4, h5, h6,
div.title, caption.title,
thead, p.table.header,
#toctitle,
#author, #revnumber, #revdate, #revremark,
#footer {
  font-family: Arial,Helvetica,sans-serif;
}

body {
  margin: 1em 5% 1em 5%;
}

a {
  color: blue;
  text-decoration: underline;
}
a:visited {
  color: fuchsia;
}

em {
  font-style: italic;
  color: navy;
}

strong {
  font-weight: bold;
  color: #083194;
}

h1, h2, h3, h4, h5, h6 {
  color: #527bbd;
  margin-top: 1.2em;
  margin-bottom: 0.5em;
  line-height: 1.3;
}

h1, h2, h3 {
  border-bottom: 2px solid silver;
}
h2 {
  padding-top: 0.5em;
}
h3 {
  float: left;
}
h3 + * {
  clear: left;
}
h5 {
  font-size: 1.0em;
}

div.sectionbody {
  margin-left: 0;
}

hr {
  border: 1px solid silver;
}

p {
  margin-top: 0.5em;
  margin-bottom: 0.5em;
}

ul, ol, li > p {
  margin-top: 0;
}
ul > li     { color: #aaa; }
ul > li > * { color: black; }

.monospaced, code, pre {
  font-family: "Courier New", Courier, monospace;
  font-size: inherit;
  color: navy;
  padding: 0;
  margin: 0;
}
pre {
  white-space: pre-wrap;
}

#author {
  color: #527bbd;
  font-weight: bold;
  font-size: 1.1em;
}
#email {
}
#revnumber, #revdate, #revremark {
}

#footer {
  font-size: small;
  border-top: 2px solid silver;
  padding-top: 0.5em;
  margin-top: 4.0em;
}
#footer-text {
  float: left;
  padding-bottom: 0.5em;
}
#footer-badges {
  float: right;
  padding-bottom: 0.5em;
}

#preamble {
  margin-top: 1.5em;
  margin-bottom: 1.5em;
}
div.imageblock, div.exampleblock, div.verseblock,
div.quoteblock, div.literalblock, div.listingblock, div.sidebarblock,
div.admonitionblock {
  margin-top: 1.0em;
  margin-bottom: 1.5em;
}
div.admonitionblock {
  margin-top: 2.0em;
  margin-bottom: 2.0em;
  margin-right: 10%;
  color: #606060;
}

div.content { /* Block element content. */
  padding: 0;
}

/* Block element titles. */
div.title, caption.title {
  color: #527bbd;
  font-weight: bold;
  text-align: left;
  margin-top: 1.0em;
  margin-bottom: 0.5em;
}
div.title + * {
  margin-top: 0;
}

td div.title:first-child {
  margin-top: 0.0em;
}
div.content div.title:first-child {
  margin-top: 0.0em;
}
div.content + div.title {
  margin-top: 0.0em;
}

div.sidebarblock > div.content {
  background: #ffffee;
  border: 1px solid #dddddd;
  border-left: 4px solid #f0f0f0;
  padding: 0.5em;
}

div.listingblock > div.content {
  border: 1px solid #dddddd;
  border-left: 5px solid #f0f0f0;
  background: #f8f8f8;
  padding: 0.5em;
}

div.quoteblock, div.verseblock {
  padding-left: 1.0em;
  margin-left: 1.0em;
  margin-right: 10%;
  border-left: 5px solid #f0f0f0;
  color: #888;
}

div.quoteblock > div.attribution {
  padding-top: 0.5em;
  text-align: right;
}

div.verseblock > pre.content {
  font-family: inherit;
  font-size: inherit;
}
div.verseblock > div.attribution {
  padding-top: 0.75em;
  text-align: left;
}
/* DEPRECATED: Pre version 8.2.7 verse style literal block. */
div.verseblock + div.attribution {
  text-align: left;
}

div.admonitionblock .icon {
  vertical-align: top;
  font-size: 1.1em;
  font-weight: bold;
  text-decoration: underline;
  color: #527bbd;
  padding-right: 0.5em;
}
div.admonitionblock td.content {
  padding-left: 0.5em;
  border-left: 3px solid #dddddd;
}

div.exampleblock > div.content {
  border-left: 3px solid #dddddd;
  padding-left: 0.5em;
}

div.imageblock div.content { padding-left: 0; }
span.image img { border-style: none; vertical-align: text-bottom; }
a.image:visited { color: white; }

dl {
  margin-top: 0.8em;
  margin-bottom: 0.8em;
}
dt {
  margin-top: 0.5em;
  margin-bottom: 0;
  font-style: normal;
  color: navy;
}
dd > *:first-child {
  margin-top: 0.1em;
}

ul, ol {
    list-style-position: outside;
}
ol.arabic {
  list-style-type: decimal;
}
ol.loweralpha {
  list-style-type: lower-alpha;
}
ol.upperalpha {
  list-style-type: upper-alpha;
}
ol.lowerroman {
  list-style-type: lower-roman;
}
ol.upperroman {
  list-style-type: upper-roman;
}

div.compact ul, div.compact ol,
div.compact p, div.compact p,
div.compact div, div.compact div {
  margin-top: 0.1em;
  margin-bottom: 0.1em;
}

tfoot {
  font-weight: bold;
}
td > div.verse {
  white-space: pre;
}

div.hdlist {
  margin-top: 0.8em;
  margin-bottom: 0.8em;
}
div.hdlist tr {
  padding-bottom: 15px;
}
dt.hdlist1.strong, td.hdlist1.strong {
  font-weight: bold;
}
td.hdlist1 {
  vertical-align: top;
  font-style: normal;
  padding-right: 0.8em;
  color: navy;
}
td.hdlist2 {
  vertical-align: top;
}
div.hdlist.compact tr {
  margin: 0;
  padding-bottom: 0;
}

.comment {
  background: yellow;
}

.footnote, .footnoteref {
  font-size: 0.8em;
}

span.footnote, span.footnoteref {
  vertical-align: super;
}

#footnotes {
  margin: 20px 0 20px 0;
  padding: 7px 0 0 0;
}

#footnotes div.footnote {
  margin: 0 0 5px 0;
}

#footnotes hr {
  border: none;
  border-top: 1px solid silver;
  height: 1px;
  text-align: left;
  margin-left: 0;
  width: 20%;
  min-width: 100px;
}

div.colist td {
  padding-right: 0.5em;
  padding-bottom: 0.3em;
  vertical-align: top;
}
div.colist td img {
  margin-top: 0.3em;
}

@media print {
  #footer-badges { display: none; }
}

#toc {
  margin-bottom: 2.5em;
}

#toctitle {
  color: #527bbd;
  font-size: 1.1em;
  font-weight: bold;
  margin-top: 1.0em;
  margin-bottom: 0.1em;
}

div.toclevel0, div.toclevel1, div.toclevel2, div.toclevel3, div.toclevel4 {
  margin-top: 0;
  margin-bottom: 0;
}
div.toclevel2 {
  margin-left: 2em;
  font-size: 0.9em;
}
div.toclevel3 {
  margin-left: 4em;
  font-size: 0.9em;
}
div.toclevel4 {
  margin-left: 6em;
  font-size: 0.9em;
}

span.aqua { color: aqua; }
span.black { color: black; }
span.blue { color: blue; }
span.fuchsia { color: fuchsia; }
span.gray { color: gray; }
span.green { color: green; }
span.lime { color: lime; }
span.maroon { color: maroon; }
span.navy { color: navy; }
span.olive { color: olive; }
span.purple { color: purple; }
span.red { color: red; }
span.silver { color: silver; }
span.teal { color: teal; }
span.white { color: white; }
span.yellow { color: yellow; }

span.aqua-background { background: aqua; }
span.black-background { background: black; }
span.blue-background { background: blue; }
span.fuchsia-background { background: fuchsia; }
span.gray-background { background: gray; }
span.green-background { background: green; }
span.lime-background { background: lime; }
span.maroon-background { background: maroon; }
span.navy-background { background: navy; }
span.olive-background { background: olive; }
span.purple-background { background: purple; }
span.red-background { background: red; }
span.silver-background { background: silver; }
span.teal-background { background: teal; }
span.white-background { background: white; }
span.yellow-background { background: yellow; }

span.big { font-size: 2em; }
span.small { font-size: 0.6em; }

span.underline { text-decoration: underline; }
span.overline { text-decoration: overline; }
span.line-through { text-decoration: line-through; }

div.unbreakable { page-break-inside: avoid; }


/*
 * xhtml11 specific
 *
 * */

div.tableblock {
  margin-top: 1.0em;
  margin-bottom: 1.5em;
}
div.tableblock > table {
  border: 3px solid #527bbd;
}
thead, p.table.header {
  font-weight: bold;
  color: #527bbd;
}
p.table {
  margin-top: 0;
}
/* Because the table frame attribute is overriden by CSS in most browsers. */
div.tableblock > table[frame="void"] {
  border-style: none;
}
div.tableblock > table[frame="hsides"] {
  border-left-style: none;
  border-right-style: none;
}
div.tableblock > table[frame="vsides"] {
  border-top-style: none;
  border-bottom-style: none;
}


/*
 * html5 specific
 *
 * */

table.tableblock {
  margin-top: 1.0em;
  margin-bottom: 1.5em;
}
thead, p.tableblock.header {
  font-weight: bold;
  color: #527bbd;
}
p.tableblock {
  margin-top: 0;
}
table.tableblock {
  border-width: 3px;
  border-spacing: 0px;
  border-style: solid;
  border-color: #527bbd;
  border-collapse: collapse;
}
th.tableblock, td.tableblock {
  border-width: 1px;
  padding: 4px;
  border-style: solid;
  border-color: #527bbd;
}

table.tableblock.frame-topbot {
  border-left-style: hidden;
  border-right-style: hidden;
}
table.tableblock.frame-sides {
  border-top-style: hidden;
  border-bottom-style: hidden;
}
table.tableblock.frame-none {
  border-style: hidden;
}

th.tableblock.halign-left, td.tableblock.halign-left {
  text-align: left;
}
th.tableblock.halign-center, td.tableblock.halign-center {
  text-align: center;
}
th.tableblock.halign-right, td.tableblock.halign-right {
  text-align: right;
}

th.tableblock.valign-top, td.tableblock.valign-top {
  vertical-align: top;
}
th.tableblock.valign-middle, td.tableblock.valign-middle {
  vertical-align: middle;
}
th.tableblock.valign-bottom, td.tableblock.valign-bottom {
  vertical-align: bottom;
}


/*
 * manpage specific
 *
 * */

body.manpage h1 {
  padding-top: 0.5em;
  padding-bottom: 0.5em;
  border-top: 2px solid silver;
  border-bottom: 2px solid silver;
}
body.manpage h2 {
  border-style: none;
}
body.manpage div.sectionbody {
  margin-left: 3em;
}

@media print {
  body.manpage div#toc { display: none; }
}


@media screen {
  body {
    max-width: 50em; /* approximately 80 characters wide */
    margin-left: 16em;
  }

  #toc {
    position: fixed;
    top: 0;
    left: 0;
    bottom: 0;
    width: 13em;
    padding: 0.5em;
    padding-bottom: 1.5em;
    margin: 0;
    overflow: auto;
    border-right: 3px solid #f8f8f8;
    background-color: white;
  }

  #toc .toclevel1 {
    margin-top: 0.5em;
  }

  #toc .toclevel2 {
    margin-top: 0.25em;
    display: list-item;
    color: #aaaaaa;
  }

  #toctitle {
    margin-top: 0.5em;
  }
}
</style>
<script type="text/javascript">
/*<![CDATA[*/
var asciidoc = {  // Namespace.

/////////////////////////////////////////////////////////////////////
// Table Of Contents generator
/////////////////////////////////////////////////////////////////////

/* Author: Mihai Bazon, September 2002
 * http://students.infoiasi.ro/~mishoo
 *
 * Table Of Content generator
 * Version: 0.4
 *
 * Feel free to use this script under the terms of the GNU General Public
 * License, as long as you do not remove or alter this notice.
 */

 /* modified by Troy D. Hanson, September 2006. License: GPL */
 /* modified by Stuart Rackham, 2006, 2009. License: GPL */

// toclevels = 1..4.
toc: function (toclevels) {

  function getText(el) {
    var text = "";
    for (var i = el.firstChild; i != null; i = i.nextSibling) {
      if (i.nodeType == 3 /* Node.TEXT_NODE */) // IE doesn't speak constants.
        text += i.data;
      else if (i.firstChild != null)
        text += getText(i);
    }
    return text;
  }

  function TocEntry(el, text, toclevel) {
    this.element = el;
    this.text = text;
    this.toclevel = toclevel;
  }

  function tocEntries(el, toclevels) {
    var result = new Array;
    var re = new RegExp('[hH]([1-'+(toclevels+1)+'])');
    // Function that scans the DOM tree for header elements (the DOM2
    // nodeIterator API would be a better technique but not supported by all
    // browsers).
    var iterate = function (el) {
      for (var i = el.firstChild; i != null; i = i.nextSibling) {
        if (i.nodeType == 1 /* Node.ELEMENT_NODE */) {
          var mo = re.exec(i.tagName);
          if (mo && (i.getAttribute("class") || i.getAttribute("className")) != "float") {
            result[result.length] = new TocEntry(i, getText(i), mo[1]-1);
          }
          iterate(i);
        }
      }
    }
    iterate(el);
    return result;
  }

  var toc = document.getElementById("toc");
  if (!toc) {
    return;
  }

  // Delete existing TOC entries in case we're reloading the TOC.
  var tocEntriesToRemove = [];
  var i;
  for (i = 0; i < toc.childNodes.length; i++) {
    var entry = toc.childNodes[i];
    if (entry.nodeName.toLowerCase() == 'div'
     && entry.getAttribute("class")
     && entry.getAttribute("class").match(/^toclevel/))
      tocEntriesToRemove.push(entry);
  }
  for (i = 0; i < tocEntriesToRemove.length; i++) {
    toc.removeChild(tocEntriesToRemove[i]);
  }

  // Rebuild TOC entries.
  var entries = tocEntries(document.getElementById("content"), toclevels);
  for (var i = 0; i < entries.length; ++i) {
    var entry = entries[i];
    if (entry.element.id == "")
      entry.element.id = "_toc_" + i;
    var a = document.createElement("a");
    a.href = "#" + entry.element.id;
    a.appendChild(document.createTextNode(entry.text));
    var div = document.createElement("div");
    div.appendChild(a);
    div.className = "toclevel" + entry.toclevel;
    toc.appendChild(div);
  }
  if (entries.length == 0)
    toc.parentNode.removeChild(toc);
},


/////////////////////////////////////////////////////////////////////
// Footnotes generator
/////////////////////////////////////////////////////////////////////

/* Based on footnote generation code from:
 * http://www.brandspankingnew.net/archive/2005/07/format_footnote.html
 */

footnotes: function () {
  // Delete existing footnote entries in case we're reloading the footnodes.
  var i;
  var noteholder = document.getElementById("footnotes");
  if (!noteholder) {
    return;
  }
  var entriesToRemove = [];
  for (i = 0; i < noteholder.childNodes.length; i++) {
    var entry = noteholder.childNodes[i];
    if (entry.nodeName.toLowerCase() == 'div' && entry.getAttribute("class") == "footnote")
      entriesToRemove.push(entry);
  }
  for (i = 0; i < entriesToRemove.length; i++) {
    noteholder.removeChild(entriesToRemove[i]);
  }

  // Rebuild footnote entries.
  var cont = document.getElementById("content");
  var spans = cont.getElementsByTagName("span");
  var refs = {};
  var n = 0;
  for (i=0; i<spans.length; i++) {
    if (spans[i].className == "footnote") {
      n++;
      var note = spans[i].getAttribute("data-note");
      if (!note) {
        // Use [\s\S] in place of . so multi-line matches work.
        // Because JavaScript has no s (dotall) regex flag.
        note = spans[i].innerHTML.match(/\s*\[([\s\S]*)]\s*/)[1];
        spans[i].innerHTML =
          "[<a id='_footnoteref_" + n + "' href='#_footnote_" + n +
          "' title='View footnote' class='footnote'>" + n + "</a>]";
        spans[i].setAttribute("data-note", note);
      }
      noteholder.innerHTML +=
        "<div class='footnote' id='_footnote_" + n + "'>" +
        "<a href='#_footnoteref_" + n + "' title='Return to text'>" +
        n + "</a>. " + note + "</div>";
      var id =spans[i].getAttribute("id");
      if (id != null) refs["#"+id] = n;
    }
  }
  if (n == 0)
    noteholder.parentNode.removeChild(noteholder);
  else {
    // Process footnoterefs.
    for (i=0; i<spans.length; i++) {
      if (spans[i].className == "footnoteref") {
        var href = spans[i].getElementsByTagName("a")[0].getAttribute("href");
        href = href.match(/#.*/)[0];  // Because IE return full URL.
        n = refs[href];
        spans[i].innerHTML =
          "[<a href='#_footnote_" + n +
          "' title='View footnote' class='footnote'>" + n + "</a>]";
      }
    }
  }
},

install: function(toclevels) {
  var timerId;

  function reinstall() {
    asciidoc.footnotes();
    if (toclevels) {
      asciidoc.toc(toclevels);
    }
  }

  function reinstallAndRemoveTimer() {
    clearInterval(timerId);
    reinstall();
  }

  timerId = setInterval(reinstall, 500);
  if (document.addEventListener)
    document.addEventListener("DOMContentLoaded", reinstallAndRemoveTimer, false);
  else
    window.onload = reinstallAndRemoveTimer;
}

}
asciidoc.install(2);
/*]]>*/
</script>
</head>
<body class="article">
<div id="header">
<h1>Snort 3 User Manual</h1>
<span id="author">The Snort Team</span><br>
<span id="revnumber">version 3.1.78.0,</span>
<span id="revdate">2024-01-16 01:23:40 EST</span>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div id="toc">
  <div id="toctitle">Contents</div>
  <noscript><p><b>JavaScript must be enabled in your browser to display the table of contents.</b></p></noscript>
<div class="toclevel1"><a href="https://snort-org-site.s3.amazonaws.com/production/release_files/files/000/037/699/original/snort_user.html?X-Amz-Algorithm=AWS4-HMAC-SHA256&amp;X-Amz-Credential=AKIAU7AK5ITMJQBJPARJ%2F20240119%2Fus-east-1%2Fs3%2Faws4_request&amp;X-Amz-Date=20240119T060321Z&amp;X-Amz-Expires=3600&amp;X-Amz-SignedHeaders=host&amp;X-Amz-Signature=3f60940722326d7506860e0898ec8f9e23932274db70a3266524d1e0fe0f4143#_overview">Overview</a></div><div class="toclevel2"><a href="https://snort-org-site.s3.amazonaws.com/production/release_files/files/000/037/699/original/snort_user.html?X-Amz-Algorithm=AWS4-HMAC-SHA256&amp;X-Amz-Credential=AKIAU7AK5ITMJQBJPARJ%2F20240119%2Fus-east-1%2Fs3%2Faws4_request&amp;X-Amz-Date=20240119T060321Z&amp;X-Amz-Expires=3600&amp;X-Amz-SignedHeaders=host&amp;X-Amz-Signature=3f60940722326d7506860e0898ec8f9e23932274db70a3266524d1e0fe0f4143#_first_steps">First Steps</a></div><div class="toclevel2"><a href="https://snort-org-site.s3.amazonaws.com/production/release_files/files/000/037/699/original/snort_user.html?X-Amz-Algorithm=AWS4-HMAC-SHA256&amp;X-Amz-Credential=AKIAU7AK5ITMJQBJPARJ%2F20240119%2Fus-east-1%2Fs3%2Faws4_request&amp;X-Amz-Date=20240119T060321Z&amp;X-Amz-Expires=3600&amp;X-Amz-SignedHeaders=host&amp;X-Amz-Signature=3f60940722326d7506860e0898ec8f9e23932274db70a3266524d1e0fe0f4143#_configuration">Configuration</a></div><div class="toclevel2"><a href="https://snort-org-site.s3.amazonaws.com/production/release_files/files/000/037/699/original/snort_user.html?X-Amz-Algorithm=AWS4-HMAC-SHA256&amp;X-Amz-Credential=AKIAU7AK5ITMJQBJPARJ%2F20240119%2Fus-east-1%2Fs3%2Faws4_request&amp;X-Amz-Date=20240119T060321Z&amp;X-Amz-Expires=3600&amp;X-Amz-SignedHeaders=host&amp;X-Amz-Signature=3f60940722326d7506860e0898ec8f9e23932274db70a3266524d1e0fe0f4143#_output">Output</a></div><div class="toclevel1"><a href="https://snort-org-site.s3.amazonaws.com/production/release_files/files/000/037/699/original/snort_user.html?X-Amz-Algorithm=AWS4-HMAC-SHA256&amp;X-Amz-Credential=AKIAU7AK5ITMJQBJPARJ%2F20240119%2Fus-east-1%2Fs3%2Faws4_request&amp;X-Amz-Date=20240119T060321Z&amp;X-Amz-Expires=3600&amp;X-Amz-SignedHeaders=host&amp;X-Amz-Signature=3f60940722326d7506860e0898ec8f9e23932274db70a3266524d1e0fe0f4143#_concepts">Concepts</a></div><div class="toclevel2"><a href="https://snort-org-site.s3.amazonaws.com/production/release_files/files/000/037/699/original/snort_user.html?X-Amz-Algorithm=AWS4-HMAC-SHA256&amp;X-Amz-Credential=AKIAU7AK5ITMJQBJPARJ%2F20240119%2Fus-east-1%2Fs3%2Faws4_request&amp;X-Amz-Date=20240119T060321Z&amp;X-Amz-Expires=3600&amp;X-Amz-SignedHeaders=host&amp;X-Amz-Signature=3f60940722326d7506860e0898ec8f9e23932274db70a3266524d1e0fe0f4143#_terminology">Terminology</a></div><div class="toclevel2"><a href="https://snort-org-site.s3.amazonaws.com/production/release_files/files/000/037/699/original/snort_user.html?X-Amz-Algorithm=AWS4-HMAC-SHA256&amp;X-Amz-Credential=AKIAU7AK5ITMJQBJPARJ%2F20240119%2Fus-east-1%2Fs3%2Faws4_request&amp;X-Amz-Date=20240119T060321Z&amp;X-Amz-Expires=3600&amp;X-Amz-SignedHeaders=host&amp;X-Amz-Signature=3f60940722326d7506860e0898ec8f9e23932274db70a3266524d1e0fe0f4143#_modules">Modules</a></div><div class="toclevel2"><a href="https://snort-org-site.s3.amazonaws.com/production/release_files/files/000/037/699/original/snort_user.html?X-Amz-Algorithm=AWS4-HMAC-SHA256&amp;X-Amz-Credential=AKIAU7AK5ITMJQBJPARJ%2F20240119%2Fus-east-1%2Fs3%2Faws4_request&amp;X-Amz-Date=20240119T060321Z&amp;X-Amz-Expires=3600&amp;X-Amz-SignedHeaders=host&amp;X-Amz-Signature=3f60940722326d7506860e0898ec8f9e23932274db70a3266524d1e0fe0f4143#_parameters">Parameters</a></div><div class="toclevel2"><a href="https://snort-org-site.s3.amazonaws.com/production/release_files/files/000/037/699/original/snort_user.html?X-Amz-Algorithm=AWS4-HMAC-SHA256&amp;X-Amz-Credential=AKIAU7AK5ITMJQBJPARJ%2F20240119%2Fus-east-1%2Fs3%2Faws4_request&amp;X-Amz-Date=20240119T060321Z&amp;X-Amz-Expires=3600&amp;X-Amz-SignedHeaders=host&amp;X-Amz-Signature=3f60940722326d7506860e0898ec8f9e23932274db70a3266524d1e0fe0f4143#_plugins">Plugins</a></div><div class="toclevel2"><a href="https://snort-org-site.s3.amazonaws.com/production/release_files/files/000/037/699/original/snort_user.html?X-Amz-Algorithm=AWS4-HMAC-SHA256&amp;X-Amz-Credential=AKIAU7AK5ITMJQBJPARJ%2F20240119%2Fus-east-1%2Fs3%2Faws4_request&amp;X-Amz-Date=20240119T060321Z&amp;X-Amz-Expires=3600&amp;X-Amz-SignedHeaders=host&amp;X-Amz-Signature=3f60940722326d7506860e0898ec8f9e23932274db70a3266524d1e0fe0f4143#_operation">Operation</a></div><div class="toclevel2"><a href="https://snort-org-site.s3.amazonaws.com/production/release_files/files/000/037/699/original/snort_user.html?X-Amz-Algorithm=AWS4-HMAC-SHA256&amp;X-Amz-Credential=AKIAU7AK5ITMJQBJPARJ%2F20240119%2Fus-east-1%2Fs3%2Faws4_request&amp;X-Amz-Date=20240119T060321Z&amp;X-Amz-Expires=3600&amp;X-Amz-SignedHeaders=host&amp;X-Amz-Signature=3f60940722326d7506860e0898ec8f9e23932274db70a3266524d1e0fe0f4143#_rules_2">Rules</a></div><div class="toclevel2"><a href="https://snort-org-site.s3.amazonaws.com/production/release_files/files/000/037/699/original/snort_user.html?X-Amz-Algorithm=AWS4-HMAC-SHA256&amp;X-Amz-Credential=AKIAU7AK5ITMJQBJPARJ%2F20240119%2Fus-east-1%2Fs3%2Faws4_request&amp;X-Amz-Date=20240119T060321Z&amp;X-Amz-Expires=3600&amp;X-Amz-SignedHeaders=host&amp;X-Amz-Signature=3f60940722326d7506860e0898ec8f9e23932274db70a3266524d1e0fe0f4143#_pattern_matching">Pattern Matching</a></div><div class="toclevel1"><a href="https://snort-org-site.s3.amazonaws.com/production/release_files/files/000/037/699/original/snort_user.html?X-Amz-Algorithm=AWS4-HMAC-SHA256&amp;X-Amz-Credential=AKIAU7AK5ITMJQBJPARJ%2F20240119%2Fus-east-1%2Fs3%2Faws4_request&amp;X-Amz-Date=20240119T060321Z&amp;X-Amz-Expires=3600&amp;X-Amz-SignedHeaders=host&amp;X-Amz-Signature=3f60940722326d7506860e0898ec8f9e23932274db70a3266524d1e0fe0f4143#_tutorial">Tutorial</a></div><div class="toclevel2"><a href="https://snort-org-site.s3.amazonaws.com/production/release_files/files/000/037/699/original/snort_user.html?X-Amz-Algorithm=AWS4-HMAC-SHA256&amp;X-Amz-Credential=AKIAU7AK5ITMJQBJPARJ%2F20240119%2Fus-east-1%2Fs3%2Faws4_request&amp;X-Amz-Date=20240119T060321Z&amp;X-Amz-Expires=3600&amp;X-Amz-SignedHeaders=host&amp;X-Amz-Signature=3f60940722326d7506860e0898ec8f9e23932274db70a3266524d1e0fe0f4143#_dependencies">Dependencies</a></div><div class="toclevel2"><a href="https://snort-org-site.s3.amazonaws.com/production/release_files/files/000/037/699/original/snort_user.html?X-Amz-Algorithm=AWS4-HMAC-SHA256&amp;X-Amz-Credential=AKIAU7AK5ITMJQBJPARJ%2F20240119%2Fus-east-1%2Fs3%2Faws4_request&amp;X-Amz-Date=20240119T060321Z&amp;X-Amz-Expires=3600&amp;X-Amz-SignedHeaders=host&amp;X-Amz-Signature=3f60940722326d7506860e0898ec8f9e23932274db70a3266524d1e0fe0f4143#_building">Building</a></div><div class="toclevel2"><a href="https://snort-org-site.s3.amazonaws.com/production/release_files/files/000/037/699/original/snort_user.html?X-Amz-Algorithm=AWS4-HMAC-SHA256&amp;X-Amz-Credential=AKIAU7AK5ITMJQBJPARJ%2F20240119%2Fus-east-1%2Fs3%2Faws4_request&amp;X-Amz-Date=20240119T060321Z&amp;X-Amz-Expires=3600&amp;X-Amz-SignedHeaders=host&amp;X-Amz-Signature=3f60940722326d7506860e0898ec8f9e23932274db70a3266524d1e0fe0f4143#_running">Running</a></div><div class="toclevel2"><a href="https://snort-org-site.s3.amazonaws.com/production/release_files/files/000/037/699/original/snort_user.html?X-Amz-Algorithm=AWS4-HMAC-SHA256&amp;X-Amz-Credential=AKIAU7AK5ITMJQBJPARJ%2F20240119%2Fus-east-1%2Fs3%2Faws4_request&amp;X-Amz-Date=20240119T060321Z&amp;X-Amz-Expires=3600&amp;X-Amz-SignedHeaders=host&amp;X-Amz-Signature=3f60940722326d7506860e0898ec8f9e23932274db70a3266524d1e0fe0f4143#_tips">Tips</a></div><div class="toclevel2"><a href="https://snort-org-site.s3.amazonaws.com/production/release_files/files/000/037/699/original/snort_user.html?X-Amz-Algorithm=AWS4-HMAC-SHA256&amp;X-Amz-Credential=AKIAU7AK5ITMJQBJPARJ%2F20240119%2Fus-east-1%2Fs3%2Faws4_request&amp;X-Amz-Date=20240119T060321Z&amp;X-Amz-Expires=3600&amp;X-Amz-SignedHeaders=host&amp;X-Amz-Signature=3f60940722326d7506860e0898ec8f9e23932274db70a3266524d1e0fe0f4143#_common_errors">Common Errors</a></div><div class="toclevel2"><a href="https://snort-org-site.s3.amazonaws.com/production/release_files/files/000/037/699/original/snort_user.html?X-Amz-Algorithm=AWS4-HMAC-SHA256&amp;X-Amz-Credential=AKIAU7AK5ITMJQBJPARJ%2F20240119%2Fus-east-1%2Fs3%2Faws4_request&amp;X-Amz-Date=20240119T060321Z&amp;X-Amz-Expires=3600&amp;X-Amz-SignedHeaders=host&amp;X-Amz-Signature=3f60940722326d7506860e0898ec8f9e23932274db70a3266524d1e0fe0f4143#_gotchas">Gotchas</a></div><div class="toclevel2"><a href="https://snort-org-site.s3.amazonaws.com/production/release_files/files/000/037/699/original/snort_user.html?X-Amz-Algorithm=AWS4-HMAC-SHA256&amp;X-Amz-Credential=AKIAU7AK5ITMJQBJPARJ%2F20240119%2Fus-east-1%2Fs3%2Faws4_request&amp;X-Amz-Date=20240119T060321Z&amp;X-Amz-Expires=3600&amp;X-Amz-SignedHeaders=host&amp;X-Amz-Signature=3f60940722326d7506860e0898ec8f9e23932274db70a3266524d1e0fe0f4143#_known_issues">Known Issues</a></div><div class="toclevel1"><a href="https://snort-org-site.s3.amazonaws.com/production/release_files/files/000/037/699/original/snort_user.html?X-Amz-Algorithm=AWS4-HMAC-SHA256&amp;X-Amz-Credential=AKIAU7AK5ITMJQBJPARJ%2F20240119%2Fus-east-1%2Fs3%2Faws4_request&amp;X-Amz-Date=20240119T060321Z&amp;X-Amz-Expires=3600&amp;X-Amz-SignedHeaders=host&amp;X-Amz-Signature=3f60940722326d7506860e0898ec8f9e23932274db70a3266524d1e0fe0f4143#_usage">Usage</a></div><div class="toclevel2"><a href="https://snort-org-site.s3.amazonaws.com/production/release_files/files/000/037/699/original/snort_user.html?X-Amz-Algorithm=AWS4-HMAC-SHA256&amp;X-Amz-Credential=AKIAU7AK5ITMJQBJPARJ%2F20240119%2Fus-east-1%2Fs3%2Faws4_request&amp;X-Amz-Date=20240119T060321Z&amp;X-Amz-Expires=3600&amp;X-Amz-SignedHeaders=host&amp;X-Amz-Signature=3f60940722326d7506860e0898ec8f9e23932274db70a3266524d1e0fe0f4143#_help">Help</a></div><div class="toclevel2"><a href="https://snort-org-site.s3.amazonaws.com/production/release_files/files/000/037/699/original/snort_user.html?X-Amz-Algorithm=AWS4-HMAC-SHA256&amp;X-Amz-Credential=AKIAU7AK5ITMJQBJPARJ%2F20240119%2Fus-east-1%2Fs3%2Faws4_request&amp;X-Amz-Date=20240119T060321Z&amp;X-Amz-Expires=3600&amp;X-Amz-SignedHeaders=host&amp;X-Amz-Signature=3f60940722326d7506860e0898ec8f9e23932274db70a3266524d1e0fe0f4143#_sniffing_and_logging">Sniffing and Logging</a></div><div class="toclevel2"><a href="https://snort-org-site.s3.amazonaws.com/production/release_files/files/000/037/699/original/snort_user.html?X-Amz-Algorithm=AWS4-HMAC-SHA256&amp;X-Amz-Credential=AKIAU7AK5ITMJQBJPARJ%2F20240119%2Fus-east-1%2Fs3%2Faws4_request&amp;X-Amz-Date=20240119T060321Z&amp;X-Amz-Expires=3600&amp;X-Amz-SignedHeaders=host&amp;X-Amz-Signature=3f60940722326d7506860e0898ec8f9e23932274db70a3266524d1e0fe0f4143#_configuration_2">Configuration</a></div><div class="toclevel2"><a href="https://snort-org-site.s3.amazonaws.com/production/release_files/files/000/037/699/original/snort_user.html?X-Amz-Algorithm=AWS4-HMAC-SHA256&amp;X-Amz-Credential=AKIAU7AK5ITMJQBJPARJ%2F20240119%2Fus-east-1%2Fs3%2Faws4_request&amp;X-Amz-Date=20240119T060321Z&amp;X-Amz-Expires=3600&amp;X-Amz-SignedHeaders=host&amp;X-Amz-Signature=3f60940722326d7506860e0898ec8f9e23932274db70a3266524d1e0fe0f4143#_ids_mode">IDS mode</a></div><div class="toclevel2"><a href="https://snort-org-site.s3.amazonaws.com/production/release_files/files/000/037/699/original/snort_user.html?X-Amz-Algorithm=AWS4-HMAC-SHA256&amp;X-Amz-Credential=AKIAU7AK5ITMJQBJPARJ%2F20240119%2Fus-east-1%2Fs3%2Faws4_request&amp;X-Amz-Date=20240119T060321Z&amp;X-Amz-Expires=3600&amp;X-Amz-SignedHeaders=host&amp;X-Amz-Signature=3f60940722326d7506860e0898ec8f9e23932274db70a3266524d1e0fe0f4143#_plugins_2">Plugins</a></div><div class="toclevel2"><a href="https://snort-org-site.s3.amazonaws.com/production/release_files/files/000/037/699/original/snort_user.html?X-Amz-Algorithm=AWS4-HMAC-SHA256&amp;X-Amz-Credential=AKIAU7AK5ITMJQBJPARJ%2F20240119%2Fus-east-1%2Fs3%2Faws4_request&amp;X-Amz-Date=20240119T060321Z&amp;X-Amz-Expires=3600&amp;X-Amz-SignedHeaders=host&amp;X-Amz-Signature=3f60940722326d7506860e0898ec8f9e23932274db70a3266524d1e0fe0f4143#_output_files">Output Files</a></div><div class="toclevel2"><a href="https://snort-org-site.s3.amazonaws.com/production/release_files/files/000/037/699/original/snort_user.html?X-Amz-Algorithm=AWS4-HMAC-SHA256&amp;X-Amz-Credential=AKIAU7AK5ITMJQBJPARJ%2F20240119%2Fus-east-1%2Fs3%2Faws4_request&amp;X-Amz-Date=20240119T060321Z&amp;X-Amz-Expires=3600&amp;X-Amz-SignedHeaders=host&amp;X-Amz-Signature=3f60940722326d7506860e0898ec8f9e23932274db70a3266524d1e0fe0f4143#_daq_alternatives">DAQ Alternatives</a></div><div class="toclevel2"><a href="https://snort-org-site.s3.amazonaws.com/production/release_files/files/000/037/699/original/snort_user.html?X-Amz-Algorithm=AWS4-HMAC-SHA256&amp;X-Amz-Credential=AKIAU7AK5ITMJQBJPARJ%2F20240119%2Fus-east-1%2Fs3%2Faws4_request&amp;X-Amz-Date=20240119T060321Z&amp;X-Amz-Expires=3600&amp;X-Amz-SignedHeaders=host&amp;X-Amz-Signature=3f60940722326d7506860e0898ec8f9e23932274db70a3266524d1e0fe0f4143#_logger_alternatives">Logger Alternatives</a></div><div class="toclevel2"><a href="https://snort-org-site.s3.amazonaws.com/production/release_files/files/000/037/699/original/snort_user.html?X-Amz-Algorithm=AWS4-HMAC-SHA256&amp;X-Amz-Credential=AKIAU7AK5ITMJQBJPARJ%2F20240119%2Fus-east-1%2Fs3%2Faws4_request&amp;X-Amz-Date=20240119T060321Z&amp;X-Amz-Expires=3600&amp;X-Amz-SignedHeaders=host&amp;X-Amz-Signature=3f60940722326d7506860e0898ec8f9e23932274db70a3266524d1e0fe0f4143#_shell">Shell</a></div><div class="toclevel2"><a href="https://snort-org-site.s3.amazonaws.com/production/release_files/files/000/037/699/original/snort_user.html?X-Amz-Algorithm=AWS4-HMAC-SHA256&amp;X-Amz-Credential=AKIAU7AK5ITMJQBJPARJ%2F20240119%2Fus-east-1%2Fs3%2Faws4_request&amp;X-Amz-Date=20240119T060321Z&amp;X-Amz-Expires=3600&amp;X-Amz-SignedHeaders=host&amp;X-Amz-Signature=3f60940722326d7506860e0898ec8f9e23932274db70a3266524d1e0fe0f4143#_signals">Signals</a></div><div class="toclevel1"><a href="https://snort-org-site.s3.amazonaws.com/production/release_files/files/000/037/699/original/snort_user.html?X-Amz-Algorithm=AWS4-HMAC-SHA256&amp;X-Amz-Credential=AKIAU7AK5ITMJQBJPARJ%2F20240119%2Fus-east-1%2Fs3%2Faws4_request&amp;X-Amz-Date=20240119T060321Z&amp;X-Amz-Expires=3600&amp;X-Amz-SignedHeaders=host&amp;X-Amz-Signature=3f60940722326d7506860e0898ec8f9e23932274db70a3266524d1e0fe0f4143#_features">Features</a></div><div class="toclevel2"><a href="https://snort-org-site.s3.amazonaws.com/production/release_files/files/000/037/699/original/snort_user.html?X-Amz-Algorithm=AWS4-HMAC-SHA256&amp;X-Amz-Credential=AKIAU7AK5ITMJQBJPARJ%2F20240119%2Fus-east-1%2Fs3%2Faws4_request&amp;X-Amz-Date=20240119T060321Z&amp;X-Amz-Expires=3600&amp;X-Amz-SignedHeaders=host&amp;X-Amz-Signature=3f60940722326d7506860e0898ec8f9e23932274db70a3266524d1e0fe0f4143#_active_response">Active Response</a></div><div class="toclevel2"><a href="https://snort-org-site.s3.amazonaws.com/production/release_files/files/000/037/699/original/snort_user.html?X-Amz-Algorithm=AWS4-HMAC-SHA256&amp;X-Amz-Credential=AKIAU7AK5ITMJQBJPARJ%2F20240119%2Fus-east-1%2Fs3%2Faws4_request&amp;X-Amz-Date=20240119T060321Z&amp;X-Amz-Expires=3600&amp;X-Amz-SignedHeaders=host&amp;X-Amz-Signature=3f60940722326d7506860e0898ec8f9e23932274db70a3266524d1e0fe0f4143#_appid">AppId</a></div><div class="toclevel2"><a href="https://snort-org-site.s3.amazonaws.com/production/release_files/files/000/037/699/original/snort_user.html?X-Amz-Algorithm=AWS4-HMAC-SHA256&amp;X-Amz-Credential=AKIAU7AK5ITMJQBJPARJ%2F20240119%2Fus-east-1%2Fs3%2Faws4_request&amp;X-Amz-Date=20240119T060321Z&amp;X-Amz-Expires=3600&amp;X-Amz-SignedHeaders=host&amp;X-Amz-Signature=3f60940722326d7506860e0898ec8f9e23932274db70a3266524d1e0fe0f4143#_binder">Binder</a></div><div class="toclevel2"><a href="https://snort-org-site.s3.amazonaws.com/production/release_files/files/000/037/699/original/snort_user.html?X-Amz-Algorithm=AWS4-HMAC-SHA256&amp;X-Amz-Credential=AKIAU7AK5ITMJQBJPARJ%2F20240119%2Fus-east-1%2Fs3%2Faws4_request&amp;X-Amz-Date=20240119T060321Z&amp;X-Amz-Expires=3600&amp;X-Amz-SignedHeaders=host&amp;X-Amz-Signature=3f60940722326d7506860e0898ec8f9e23932274db70a3266524d1e0fe0f4143#_byte_rule_options">Byte rule options</a></div><div class="toclevel2"><a href="https://snort-org-site.s3.amazonaws.com/production/release_files/files/000/037/699/original/snort_user.html?X-Amz-Algorithm=AWS4-HMAC-SHA256&amp;X-Amz-Credential=AKIAU7AK5ITMJQBJPARJ%2F20240119%2Fus-east-1%2Fs3%2Faws4_request&amp;X-Amz-Date=20240119T060321Z&amp;X-Amz-Expires=3600&amp;X-Amz-SignedHeaders=host&amp;X-Amz-Signature=3f60940722326d7506860e0898ec8f9e23932274db70a3266524d1e0fe0f4143#_consolidated_config">Consolidated Config</a></div><div class="toclevel2"><a href="https://snort-org-site.s3.amazonaws.com/production/release_files/files/000/037/699/original/snort_user.html?X-Amz-Algorithm=AWS4-HMAC-SHA256&amp;X-Amz-Credential=AKIAU7AK5ITMJQBJPARJ%2F20240119%2Fus-east-1%2Fs3%2Faws4_request&amp;X-Amz-Date=20240119T060321Z&amp;X-Amz-Expires=3600&amp;X-Amz-SignedHeaders=host&amp;X-Amz-Signature=3f60940722326d7506860e0898ec8f9e23932274db70a3266524d1e0fe0f4143#_dce_inspectors">DCE Inspectors</a></div><div class="toclevel2"><a href="https://snort-org-site.s3.amazonaws.com/production/release_files/files/000/037/699/original/snort_user.html?X-Amz-Algorithm=AWS4-HMAC-SHA256&amp;X-Amz-Credential=AKIAU7AK5ITMJQBJPARJ%2F20240119%2Fus-east-1%2Fs3%2Faws4_request&amp;X-Amz-Date=20240119T060321Z&amp;X-Amz-Expires=3600&amp;X-Amz-SignedHeaders=host&amp;X-Amz-Signature=3f60940722326d7506860e0898ec8f9e23932274db70a3266524d1e0fe0f4143#_file_processing">File Processing</a></div><div class="toclevel2"><a href="https://snort-org-site.s3.amazonaws.com/production/release_files/files/000/037/699/original/snort_user.html?X-Amz-Algorithm=AWS4-HMAC-SHA256&amp;X-Amz-Credential=AKIAU7AK5ITMJQBJPARJ%2F20240119%2Fus-east-1%2Fs3%2Faws4_request&amp;X-Amz-Date=20240119T060321Z&amp;X-Amz-Expires=3600&amp;X-Amz-SignedHeaders=host&amp;X-Amz-Signature=3f60940722326d7506860e0898ec8f9e23932274db70a3266524d1e0fe0f4143#_high_availability">High Availability</a></div><div class="toclevel2"><a href="https://snort-org-site.s3.amazonaws.com/production/release_files/files/000/037/699/original/snort_user.html?X-Amz-Algorithm=AWS4-HMAC-SHA256&amp;X-Amz-Credential=AKIAU7AK5ITMJQBJPARJ%2F20240119%2Fus-east-1%2Fs3%2Faws4_request&amp;X-Amz-Date=20240119T060321Z&amp;X-Amz-Expires=3600&amp;X-Amz-SignedHeaders=host&amp;X-Amz-Signature=3f60940722326d7506860e0898ec8f9e23932274db70a3266524d1e0fe0f4143#_ftp">FTP</a></div><div class="toclevel2"><a href="https://snort-org-site.s3.amazonaws.com/production/release_files/files/000/037/699/original/snort_user.html?X-Amz-Algorithm=AWS4-HMAC-SHA256&amp;X-Amz-Credential=AKIAU7AK5ITMJQBJPARJ%2F20240119%2Fus-east-1%2Fs3%2Faws4_request&amp;X-Amz-Date=20240119T060321Z&amp;X-Amz-Expires=3600&amp;X-Amz-SignedHeaders=host&amp;X-Amz-Signature=3f60940722326d7506860e0898ec8f9e23932274db70a3266524d1e0fe0f4143#_http_inspector">HTTP Inspector</a></div><div class="toclevel2"><a href="https://snort-org-site.s3.amazonaws.com/production/release_files/files/000/037/699/original/snort_user.html?X-Amz-Algorithm=AWS4-HMAC-SHA256&amp;X-Amz-Credential=AKIAU7AK5ITMJQBJPARJ%2F20240119%2Fus-east-1%2Fs3%2Faws4_request&amp;X-Amz-Date=20240119T060321Z&amp;X-Amz-Expires=3600&amp;X-Amz-SignedHeaders=host&amp;X-Amz-Signature=3f60940722326d7506860e0898ec8f9e23932274db70a3266524d1e0fe0f4143#_http_2_inspector">HTTP/2 Inspector</a></div><div class="toclevel2"><a href="https://snort-org-site.s3.amazonaws.com/production/release_files/files/000/037/699/original/snort_user.html?X-Amz-Algorithm=AWS4-HMAC-SHA256&amp;X-Amz-Credential=AKIAU7AK5ITMJQBJPARJ%2F20240119%2Fus-east-1%2Fs3%2Faws4_request&amp;X-Amz-Date=20240119T060321Z&amp;X-Amz-Expires=3600&amp;X-Amz-SignedHeaders=host&amp;X-Amz-Signature=3f60940722326d7506860e0898ec8f9e23932274db70a3266524d1e0fe0f4143#_iec104_inspector">IEC104 Inspector</a></div><div class="toclevel2"><a href="https://snort-org-site.s3.amazonaws.com/production/release_files/files/000/037/699/original/snort_user.html?X-Amz-Algorithm=AWS4-HMAC-SHA256&amp;X-Amz-Credential=AKIAU7AK5ITMJQBJPARJ%2F20240119%2Fus-east-1%2Fs3%2Faws4_request&amp;X-Amz-Date=20240119T060321Z&amp;X-Amz-Expires=3600&amp;X-Amz-SignedHeaders=host&amp;X-Amz-Signature=3f60940722326d7506860e0898ec8f9e23932274db70a3266524d1e0fe0f4143#_javascript_normalization">JavaScript Normalization</a></div><div class="toclevel2"><a href="https://snort-org-site.s3.amazonaws.com/production/release_files/files/000/037/699/original/snort_user.html?X-Amz-Algorithm=AWS4-HMAC-SHA256&amp;X-Amz-Credential=AKIAU7AK5ITMJQBJPARJ%2F20240119%2Fus-east-1%2Fs3%2Faws4_request&amp;X-Amz-Date=20240119T060321Z&amp;X-Amz-Expires=3600&amp;X-Amz-SignedHeaders=host&amp;X-Amz-Signature=3f60940722326d7506860e0898ec8f9e23932274db70a3266524d1e0fe0f4143#_mms_inspector">MMS Inspector</a></div><div class="toclevel2"><a href="https://snort-org-site.s3.amazonaws.com/production/release_files/files/000/037/699/original/snort_user.html?X-Amz-Algorithm=AWS4-HMAC-SHA256&amp;X-Amz-Credential=AKIAU7AK5ITMJQBJPARJ%2F20240119%2Fus-east-1%2Fs3%2Faws4_request&amp;X-Amz-Date=20240119T060321Z&amp;X-Amz-Expires=3600&amp;X-Amz-SignedHeaders=host&amp;X-Amz-Signature=3f60940722326d7506860e0898ec8f9e23932274db70a3266524d1e0fe0f4143#_performance_monitor">Performance Monitor</a></div><div class="toclevel2"><a href="https://snort-org-site.s3.amazonaws.com/production/release_files/files/000/037/699/original/snort_user.html?X-Amz-Algorithm=AWS4-HMAC-SHA256&amp;X-Amz-Credential=AKIAU7AK5ITMJQBJPARJ%2F20240119%2Fus-east-1%2Fs3%2Faws4_request&amp;X-Amz-Date=20240119T060321Z&amp;X-Amz-Expires=3600&amp;X-Amz-SignedHeaders=host&amp;X-Amz-Signature=3f60940722326d7506860e0898ec8f9e23932274db70a3266524d1e0fe0f4143#_pop_and_imap">POP and IMAP</a></div><div class="toclevel2"><a href="https://snort-org-site.s3.amazonaws.com/production/release_files/files/000/037/699/original/snort_user.html?X-Amz-Algorithm=AWS4-HMAC-SHA256&amp;X-Amz-Credential=AKIAU7AK5ITMJQBJPARJ%2F20240119%2Fus-east-1%2Fs3%2Faws4_request&amp;X-Amz-Date=20240119T060321Z&amp;X-Amz-Expires=3600&amp;X-Amz-SignedHeaders=host&amp;X-Amz-Signature=3f60940722326d7506860e0898ec8f9e23932274db70a3266524d1e0fe0f4143#_port_scan">Port Scan</a></div><div class="toclevel2"><a href="https://snort-org-site.s3.amazonaws.com/production/release_files/files/000/037/699/original/snort_user.html?X-Amz-Algorithm=AWS4-HMAC-SHA256&amp;X-Amz-Credential=AKIAU7AK5ITMJQBJPARJ%2F20240119%2Fus-east-1%2Fs3%2Faws4_request&amp;X-Amz-Date=20240119T060321Z&amp;X-Amz-Expires=3600&amp;X-Amz-SignedHeaders=host&amp;X-Amz-Signature=3f60940722326d7506860e0898ec8f9e23932274db70a3266524d1e0fe0f4143#_sensitive_data_filtering">Sensitive Data Filtering</a></div><div class="toclevel2"><a href="https://snort-org-site.s3.amazonaws.com/production/release_files/files/000/037/699/original/snort_user.html?X-Amz-Algorithm=AWS4-HMAC-SHA256&amp;X-Amz-Credential=AKIAU7AK5ITMJQBJPARJ%2F20240119%2Fus-east-1%2Fs3%2Faws4_request&amp;X-Amz-Date=20240119T060321Z&amp;X-Amz-Expires=3600&amp;X-Amz-SignedHeaders=host&amp;X-Amz-Signature=3f60940722326d7506860e0898ec8f9e23932274db70a3266524d1e0fe0f4143#_smtp">SMTP</a></div><div class="toclevel2"><a href="https://snort-org-site.s3.amazonaws.com/production/release_files/files/000/037/699/original/snort_user.html?X-Amz-Algorithm=AWS4-HMAC-SHA256&amp;X-Amz-Credential=AKIAU7AK5ITMJQBJPARJ%2F20240119%2Fus-east-1%2Fs3%2Faws4_request&amp;X-Amz-Date=20240119T060321Z&amp;X-Amz-Expires=3600&amp;X-Amz-SignedHeaders=host&amp;X-Amz-Signature=3f60940722326d7506860e0898ec8f9e23932274db70a3266524d1e0fe0f4143#_telnet">Telnet</a></div><div class="toclevel2"><a href="https://snort-org-site.s3.amazonaws.com/production/release_files/files/000/037/699/original/snort_user.html?X-Amz-Algorithm=AWS4-HMAC-SHA256&amp;X-Amz-Credential=AKIAU7AK5ITMJQBJPARJ%2F20240119%2Fus-east-1%2Fs3%2Faws4_request&amp;X-Amz-Date=20240119T060321Z&amp;X-Amz-Expires=3600&amp;X-Amz-SignedHeaders=host&amp;X-Amz-Signature=3f60940722326d7506860e0898ec8f9e23932274db70a3266524d1e0fe0f4143#_trace">Trace</a></div><div class="toclevel2"><a href="https://snort-org-site.s3.amazonaws.com/production/release_files/files/000/037/699/original/snort_user.html?X-Amz-Algorithm=AWS4-HMAC-SHA256&amp;X-Amz-Credential=AKIAU7AK5ITMJQBJPARJ%2F20240119%2Fus-east-1%2Fs3%2Faws4_request&amp;X-Amz-Date=20240119T060321Z&amp;X-Amz-Expires=3600&amp;X-Amz-SignedHeaders=host&amp;X-Amz-Signature=3f60940722326d7506860e0898ec8f9e23932274db70a3266524d1e0fe0f4143#_wizard">Wizard</a></div><div class="toclevel1"><a href="https://snort-org-site.s3.amazonaws.com/production/release_files/files/000/037/699/original/snort_user.html?X-Amz-Algorithm=AWS4-HMAC-SHA256&amp;X-Amz-Credential=AKIAU7AK5ITMJQBJPARJ%2F20240119%2Fus-east-1%2Fs3%2Faws4_request&amp;X-Amz-Date=20240119T060321Z&amp;X-Amz-Expires=3600&amp;X-Amz-SignedHeaders=host&amp;X-Amz-Signature=3f60940722326d7506860e0898ec8f9e23932274db70a3266524d1e0fe0f4143#_daq_configuration_and_modules">DAQ Configuration and Modules</a></div><div class="toclevel2"><a href="https://snort-org-site.s3.amazonaws.com/production/release_files/files/000/037/699/original/snort_user.html?X-Amz-Algorithm=AWS4-HMAC-SHA256&amp;X-Amz-Credential=AKIAU7AK5ITMJQBJPARJ%2F20240119%2Fus-east-1%2Fs3%2Faws4_request&amp;X-Amz-Date=20240119T060321Z&amp;X-Amz-Expires=3600&amp;X-Amz-SignedHeaders=host&amp;X-Amz-Signature=3f60940722326d7506860e0898ec8f9e23932274db70a3266524d1e0fe0f4143#_building_the_daq_library_and_its_bundled_daq_modules">Building the DAQ Library and Its Bundled DAQ Modules</a></div><div class="toclevel2"><a href="https://snort-org-site.s3.amazonaws.com/production/release_files/files/000/037/699/original/snort_user.html?X-Amz-Algorithm=AWS4-HMAC-SHA256&amp;X-Amz-Credential=AKIAU7AK5ITMJQBJPARJ%2F20240119%2Fus-east-1%2Fs3%2Faws4_request&amp;X-Amz-Date=20240119T060321Z&amp;X-Amz-Expires=3600&amp;X-Amz-SignedHeaders=host&amp;X-Amz-Signature=3f60940722326d7506860e0898ec8f9e23932274db70a3266524d1e0fe0f4143#_configuration_11">Configuration</a></div><div class="toclevel2"><a href="https://snort-org-site.s3.amazonaws.com/production/release_files/files/000/037/699/original/snort_user.html?X-Amz-Algorithm=AWS4-HMAC-SHA256&amp;X-Amz-Credential=AKIAU7AK5ITMJQBJPARJ%2F20240119%2Fus-east-1%2Fs3%2Faws4_request&amp;X-Amz-Date=20240119T060321Z&amp;X-Amz-Expires=3600&amp;X-Amz-SignedHeaders=host&amp;X-Amz-Signature=3f60940722326d7506860e0898ec8f9e23932274db70a3266524d1e0fe0f4143#_interaction_with_multiple_packet_threads">Interaction With Multiple Packet Threads</a></div><div class="toclevel2"><a href="https://snort-org-site.s3.amazonaws.com/production/release_files/files/000/037/699/original/snort_user.html?X-Amz-Algorithm=AWS4-HMAC-SHA256&amp;X-Amz-Credential=AKIAU7AK5ITMJQBJPARJ%2F20240119%2Fus-east-1%2Fs3%2Faws4_request&amp;X-Amz-Date=20240119T060321Z&amp;X-Amz-Expires=3600&amp;X-Amz-SignedHeaders=host&amp;X-Amz-Signature=3f60940722326d7506860e0898ec8f9e23932274db70a3266524d1e0fe0f4143#_daq_modules_included_with_snort_3">DAQ Modules Included With Snort 3</a></div></div>
<img alt="snorty" src="data:image/png;base64,%0A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%0AO45NONbU4Nlw9Lexv1UeNzpefkLrxMqT1JMFJwdO5Z3qa5Q29pwWnn7UNLPp7pkpZ66dnXy27VzYuQvn%0Ag8+fafZrPnXB68LxFo+WYxfdLtZdcrlU2+rcevR359+Ptrm01V52vVzf7t7e0DG+4+QVnyunrwZePX+N%0Ac+3S9UnXO27E3rh1c9pNxS3+rWe302+/upN7p//uonuke0X31e6XPtB7UPGH1R8HFC6KE52Bna0Pox/e%0AfcR79OJx9uPPXQVP6E9Knxo+rX7m8Ox4d3B3+/Opz7teSF/09xT+qf7n5peWL4/85ftXa++U3q5XslcD%0Ar0ve6LypfOv0tqkvsu/Bu4x3/e+LPuh8qPro9rH5U/ynp/2zPlM+l32x+tLwNezrvYGMgQEpV8YdPAtg%0AsEZTUgB4XQnvRQnw7NAOAJUxdDcaVCBD9zmIkeFC0P+Fh+5PRAM8Q4BKXwBiFwEQ3gjAVljMIKbBN3HM%0Aj/EFqKPjtwIZ4slOcXQYBAhNBo8mHwYG3ugDQGkA4ItsYKB/y8DAl13w3H0bgMasoTsZoSbDc/x2eG8A%0AoKWtZBHx/vH5D/IjYGjniSMUAAAACXBIWXMAABYlAAAWJQFJUiTwAAABnWlUWHRYTUw6Y29tLmFkb2Jl%0ALnhtcAAAAAAAPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iWE1QIENv%0AcmUgNS4xLjIiPgogICA8cmRmOlJERiB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIv%0AMjItcmRmLXN5bnRheC1ucyMiPgogICAgICA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIgogICAg%0AICAgICAgICB4bWxuczpleGlmPSJodHRwOi8vbnMuYWRvYmUuY29tL2V4aWYvMS4wLyI+CiAgICAgICAg%0AIDxleGlmOlBpeGVsWERpbWVuc2lvbj4zODI8L2V4aWY6UGl4ZWxYRGltZW5zaW9uPgogICAgICAgICA8%0AZXhpZjpQaXhlbFlEaW1lbnNpb24+MTk4PC9leGlmOlBpeGVsWURpbWVuc2lvbj4KICAgICAgPC9yZGY6%0ARGVzY3JpcHRpb24+CiAgIDwvcmRmOlJERj4KPC94OnhtcG1ldGE+ChfvoHgAAEAASURBVHgB7L3ndyNn%0AluZJA++9IQh6b9NKJamqq7tne6b3zOnZb/tH7vfZPdNmuqpkSlJauqS38B4gvCG4v8BLIpF0IrOkzBQV%0ASBxmEAzz4kbEE/e997nP7T46OuqSX7IFZAvIFviwFuj5sIeTjyZbQLaAbAHJAjL0yNeBbAHZAh/BAjL0%0AfASjy4eULSBbQIYe+RqQLSBb4CNYQIaej2B0+ZCyBWQLyNAjXwOyBWQLfAQLyNDzEYwuH1K2gGwBGXrk%0Aa0C2gGyBj2ABGXo+gtHlQ8oWkC0gQ498DcgWkC3wESwgQ89HMLp8SNkCsgVk6JGvAdkCsgU+ggVk6PkI%0ARpcPKVtAtoAMPfI1IFtAtsBHsIAMPR/B6PIhZQvIFpChR74GZAvIFvgIFpCh5yMYXT6kbAHZAjL0yNeA%0AbAHZAh/BAjL0fASjy4eULSBbQCGb4ANbIJ/PR4LBtdXVb77+Wq1W//d/+ZeZ+TmD3qBUqT7wSOTDyRb4%0AiBaQoedDGP/09PTk5KRaqRQKhVgsdrC/v7O7m0gmjUZjOp3KZ7NqlVqGng9xJuRjfDIWkKHnQ5wKcKdS%0ALgM6O9vb6+vrS8vLh4eHuVyuz+PZ2962Wyx6g0Gn13+IocjHkC3waVhAhp5f9jxIzk61epzLRiPR/f29%0AtbW19Tfr65ubyVSKAyt7e7c2N+02m29wyO78ZUci7122wCdlARl6ftnTAe6kksn93d3Xr15tbGzsHx7G%0A4nHCPeKox/k8MGSxWR88ffrLjkPeu2yBT8wCMvTc7YTU6/VSqdSo19msu7tboVB091ydJazVasVCIZFI%0ABI6Otre2VpaXj44Oj4+zPaenoy5X8/Q0lsuWa7VYIn4UDMVicX8up9PplErlTw5IRI5OGtKL/bTX72mN%0Ap1eh6O3tZWztz+UF2QKfoAVk6LnbSQF3AoRpslk2U6lUN4BFJpPZ3d3htb2zGwqHieycNqoGddeo2/vV%0A5EKtcfpvy6+3IuF64ySTzRF4drvd/sFBs9n8kwMSkaNSqVgsFOu1Wnt9AtV6g16n02u0WjCx/bm8IFvg%0AE7SAfIHe7aRwvwMTODLVWq2np4fY8HV+Siad3t3dPTjYPwwESsWSXq322swTPsfD4ZEvJ2aL1Xo0l8Hr%0ACaZSmWx2Y2PdarFYbdZO6BHeTa1aLbN9qcyrwvytVqtIr3K5yFiK+FbtLwAU6vV6rV6n0Wh1Wi2wqNVq%0ANdIv0uu6cbY3lxdkC3xIC8jQczdrkx3HlVlaWkqkUgABUxsA6MpdAAqsLPkmpbJBrR5xux+OjPz9/NyM%0A3+8wWtL5wu8mpk+aXcVKLZ3NLL1+BUpMzkz7+v3tvQnvJp1MBA8Pg4FgMByKxOLJdLpQLPIn6cWEq9ls%0Ar89IxGyLUQFkg35/v8/n8Xp9/f239Kfau5IXZAv80haQoeduFgZQcGdCvCKR40KBjXt7utVKCX2q9eZJ%0A823khWgLf9Kp1X0W66DTOTcw8GRs/MnYpN8hpbJ6exXzg0PFSuUwHi8FK+TdSbenkikRgRZxolwum0ql%0AY9FIC3oCwVCYwFA6k63WqkqFkoiOguAOaNPbw2ErxJ9OGl2nDRCJkcAYioSCPp/P6/WCPOzf4/VYLBaD%0A0SR7QHc75fLav4wFZOj5W+0K7tiNavaSyldL1ZP27sAdjUrZb7c/Hh1/MDQ8Ozg45HLZjSaxAvOvIbc7%0AXynvRiOlauUwkTjOF+PxOERnVhBxoj1eBwfxRIK5VbnMlEuCl+6uptmgNxpNRo3WqFAYVGq9RlNrNiOF%0AfL5cOK0XWJWRsAUTvXgyub65ZTQYrBbz8PDQg8WHE1NTsgfUPkfywke0gAw9dzM+vgbxHRwHpjZiS7NO%0ANz/gM+v0qUK9XHsLPTgjQM+Aw/lkdHzGPwDQWDpIg0qFwqJQDDldj0dGy5VKtljM54+3NjeqlXKzeZpK%0ApYgThYKBZDxRr1Q0KrVZqXRatFq1yqjVGPTvQI9Bo6k2m1Ggp1Jo1gtMx6LpUrpQLlYreFXxbC7SPMFH%0AwnsiWJRnElgs+v1+m91OJOhuX15eW7bAz2cBGXruZkuVWu3g5XSGolGxpdts+28Ln80PDje6uptdb1Pa%0AZxMuldramuTg5lw+ks1g+N3YBEUWu/Hobirxw1+/e/3qZaVWx8EBIlTd3R6j0dPv77PZXWazTW+wGQ1W%0Ao1Gn1SgUSuiIV064iuVKMnscSqX3E/HdWHQ7Ek4c58ijhaKx4vc/kMjf399/8GDx6ee/IwZ0eUjyJ7IF%0APowFZOi5m53xerTC6+ntFVtqlWqv2THtGyCRdKssEokryDgtPo5WqfQ7HNmif35gsFStJuLxSr2u7FGo%0AlUqHWuO1Wif6+oZdbqDHCfQwb9LrTXq9+sZCU1Jgxzg+2Yw/7uyz2Txm8348Fk5nCCPFolF8q1IhDyEI%0APGT8N/g+Ir9Wr9eqlSrcJTlCdLcLRV77pywgQ89PWein/l6t15PHx8ncsRvguR0hsNlonLYyU93dPcSi%0AXVbrH6dm1T29f9lcP66UIf4AN8NOl9/p9NrseDpMuAAjlUKh6u1lpnbziFgBeCLRbjebJ32+3OTUTjj8%0A7ebG8tHhXixGKIgYkIiGF/LHN/g+hKvJ4BPqBhBxsuQI0c1ml/96Vwv8xHV8193d+/WZ6BC1JX/U5uyd%0ANJs4LLxJdN/89euNRrFazRcL2XwOzrLHZKVmtLtbSc6JjDtztVrXaaFSGff2jbo9xKQ9FutP+jhnR+wB%0Awnq7FL1dLOBP1WrqE7XeZPJ04V2dOpyuU41apdX2KpQHsViuVAwEAz3dXXwFT5+PL3PBoxGMbRJ50WiY%0A0rNYNGYymcAygBWVDzL3N39N+a+yBW5jARl6bmOlt+vA0PP29ZGxfo8YLbjDnb8dPloP7phV6n+eeWxU%0AqIErVU+P02p9pNX6PR7wy6jRkLTSqzUa7vWf8nHEyMCdbr2uW6fp1mgAjuN0+qRaM4IUKlW3WuUw6n9n%0AMtjsDrNe/4KSjsPDTKmI76MzGIeHhwlaX/BoBGN7Y/3NyxfP9w8OcvnC4MCg0WRiRml3OMCpt+aQl2QL%0AvK8FZOi5m+V4+Nt42e0siC0bzZNCtcIbRs3N+8IzCiQSm6HQVjjsNZpIbHWxSb2rV6UEa4AAr91+8x6u%0A+GvL32koe6vNk/zxcSoeSzH7SyQb1SriYyaj0eJyWoxGl6+P6gomd/gtBG62gsFk/jgYDK6urkipd5vV%0AYDDAlIb/SI1INBLZ290l3bb+5g1MxlwBznQduQ8nuNOKc10xDPkj2QJ3tIAMPXczGJMU6qR4tZPr5Xo9%0Aksvxxme5eV+VWjWcTiVyeVWvzqy1KHuV0uSocULAp4sg0XvNY4S/A+6Ectk3hwffLb3eCQSOqe2qNyhs%0Adbuc0zMzi9PTT6enHP7+B3q9xW53mEzO1dVv19czHSxqq81Ohf3B3h5lrvt7u1AQCUgT7oFAVKpItGyS%0A/S6X0+vz2d8DH2+2i/zX36QFZOi522kHcajP1BlIM8GV6YG+3Dhp5qsV3j8Z66FiK5xJpwp50uQOk1Wt%0AUBGJkdDn5CzhdduhULoBVLUKOKo93aXmSTCTXt7eXt7aXNrcDCUS9ZNTXCqI0cZwKFUu9ygUUyMjfp9Z%0Ao4dcrVJDAmiehjKZ8tEhELO1ufVm7Q1F9oR1oE0fbG3lkkn9ScNGEMhgpGqjVq5IpMfDA7fbNb+42Gj4%0A5Mr4254peb3rLSBDz/W2ueov3HXMXKTycAozVUo4OFetdfVnAnoyxcKox0u+XHs+Zbt67Rs+VSpPTcYu%0AtTTjy5dKu8nky83N//zmm3A0ajAaxsfG1RotJakoAYE+/HRZLPkvv5R4RkqlyWodmhzPN+oSi7pcgkUN%0A0+d///u/AzOpVLKnVndp9U/8g9NeL0wiIk1rwWAmm14LBgKhkOPggMIO0l5yZfwNJ0f+0y0tIEPPLQ11%0Atho3MHMunVZHfSZV5ifZXPO0WWs0yF6xcN2+RG6LHHy6kGcW4zGa/Bbr+0CPyGRp1d0GHaWr+XJ5P5N+%0AtrWJy5PI57UGw/TEBAWjxIPDsSjR4t39vRyhn1SKsi9JXqi7W63T2pSK4dLQ07m5Wq1aqlfix8fr6280%0AKlXvyYkPYOrzPxwanvcPuMxnNR+jLnc4nY5lc4ichUJBmNAej0dhMFz3ZeXPZQvcxgIy9NzGShfXIfvk%0Adns8bk+pUmXCRb0CSXEWLq53/rvIbZHeorgB3uGQ2TJotiC3cf732/5/lsky6MlkMaXajcefra//x1/+%0Aks3nx8fGZsfHHwI9Tgc85+3DA1weIJFMVufeQR98H5fL9fvPnqpVPalCvLR1jIBZl9Y47et7NDz61fTM%0AeF+fWauDQcSGZoNhvM8XzeX4poV8gWCzw+4gJo2YdOdu5WXZAne1gAw9d7WYtD4cF4tVEthRhiPkkgo1%0A6U2q67p9HZdKbwJHG+Eg+OQymGxanUWtuW7lmz5HiFClqPd0I8YBR/nF2trrN29iiYTFZJqfnPzdgweT%0A/n67SfJWms2TEb8/EEZmI/HODlu+D/My/eBAoXg8tTUYSySJDzH5IkPHFNJjtXis1vYmBp1uzOPF69mJ%0ARKj/2tvZdTmdY+Pj7vYa8oJsgfeygAw972M23AroLcxrCP3UTk/xLqTahFZtxJW7yxTyz3e3Xx8eNLq7%0Aid1CDr5ytVt+SHxnO5PB3/m3P/+ZSRBYsDgz82R6GtwxnleEwv8DGm0WMwtX7BYekEZjstqnB8bj0Wwk%0AXWbaRbUXpRt5Uv4dL+hFkBvhBLAQzcVQtvd4XMgjdqwiL8oWeB8LXC1z9T57+i1tI6kgKyV2L+pcOAto%0AX/CuX8XrIcpDVTpeA2FdyjjpekNtBIGVv8VaNUo3crlENks0x6DTLkxNfbYwP9rvw99pAw1kQrfNxpsF%0AqWas2WSrXKmUKTBtKjBZO+nupoxrrG9gzOs3aHW1Rp04FCME11LHuc3QIW8WKId1msw+h8NmNoOz5OOj%0AsVg2Ix2aoNXf8i3kbX/jFpC9nr/1Aqg36lBgeBNYubwvEeXZjURS+YKyu3fM4Zx0ueErX17zrp8Q5X44%0AP2816L96/HhiaAho6NwDWXSkgnjr1EBP86ReRysjnM8jsKo/PTVptVa7TWgGHbnd7ap6xMaOi4XN4OF3%0AW8vs7cuJhRG3D71Vp9XW53IdZFIIlQldIUhAMrO50+Dy8l0tIEPP3SzGox7WbzaXSyUT2UwGVXY+kYS8%0AyuUrvQAR5XkTDLBg0mhHbY4xm93Q9nq6u0+lwG836afbjIMpHUqIVM/j4Ix2d/uh95lNM6Oj7g6aX7Fc%0ATlB+FYuHgkEiPeg5M787DIV7lKrtWAwVxWGnc8DlMp6cEOc2m00Wi0mrUbNPBlIol7YjgYN493cbb6hI%0A6z5V5cu1PruDWRgunlaDvk8Wp4lUu7+/X2Y23+aUyetcZwEZeq6zzNWfi75aR4cHlBkQ+ECYHVYh7B7e%0Aneqo7Y1FlOfV/m65Xh2y20es1s7cFrhzSs2n1FHnltCD/9IAKcZ9fUPdPc2TE4iNZqOxfTgWwJ0/P3v2%0AanWVThgHoE8iUW3Uv0YHaGtrc3/fZDb/13/4B7vb3aCytKenCQhq1GqNmgAzsorJfO67zWVYApuhOD0z%0AcqUXb0Lhmf6Bk65upo3iKDKzudPa8vJ7W0CGntuaTvg78Vh0a2NDqjbY30+mktVanUBK4+S0Vm+IdhHQ%0A8IRQfKVWyxWL6FTQ8YaWW4gZ9qOeYzB25rZwNMAdqeL8dl5PF2236nWVRq03GHt1FzUGKRyla0UwHF5a%0AW3u5tpZMZyD+UGqP5Ea5cdJTryFWpuvuRrKjJOkilk6RGwN/Wi19aF7BhBGh1VStirq8Um9sVBsRokLB%0AYL5cIayOACtKQESO0MFnthWPxWghf1vbyevJFrhkARl6Lpnkmg+EvwPu/Ok///fy8nIoEu30dIiSADRo%0AdLVlLvh1aX//1e5uLJNF/QsVnnFPn0Gas3S8erp7hNdzO+ihAqK3Vu+u1Vjo2MvZooQ7oRDFVvsH+/TP%0AGR4cpFI0mUhQ7jo9Mz3q7TPWGypENUCiXC4IE1qjcbUYkpIIiNEID0it1bm8sI4s/fUmsaFMKkVJ6noo%0ADKqiC00RCatRwUbkiD4bDVTo5Zdsgfe1gAw9P205/BpcHvRrJB2Jly8l3AkGqcDqs0qF5ugKooAjqtIP%0A4jG/06VVq6EO7oQjP25vrR4dlKolu0E76+2b8fqI754dD6whvKJUdAM917TTuWJk1HydnHTXG81qlTIu%0AafOObfFK4ul0IpM5OT1tyesoUPZgML4+7/To2ITPZzvtOqbaa38vETzqNZq8VpvO5cbHoa6LOA6MbJvN%0AMTox3ddqyFMuFpNJauCTtN8hksVg8IwcNpu+9RV8Ph+dvq4YofyRbIHbWUCGnp+2E7hD4RIi7d/85S8v%0AXjzH3wF3Zv1+ss5sHMvlUMAhirwaOBKpInLnB/H40sHB1+tvgqmYorcx6rI8HfAvePvMba9HYtao4QcC%0AQD89gnfXaAI9+QINlJVGI3I87T8S8U4Xi9Xubp9/oEcdT8RjMI+mp2fmp2emBvwuk6mcyTKwPz9/fhCL%0AGs2WuZHRofNe74Si8Wh8Pv+DR48nJibYJ6QBug8CZ7xFBJ3kujThag2Y2n2ny9U+tLwgW+CuFpCh5yaL%0ACX8HCRvcnLXV1dW11Wg4bFZrETD9bHjUZ7UReyGUcxSPJfP5rXCIfZFNR8kUSXYYenuxKIGgYZdjpq9/%0AxO50G03ElaWwDrwgHBZw53ZKYBeHeHJyWio3CVETJO7tkcCrNV9DLxEFj3JHwBsu8vjQ0PToKMSc3tPT%0ASLkUTKcC8VgkHqdavlIsNqu1Hug5p6cUpqFASL68z9eHctjFI8q/yxb4uS0gQ89NFj33d4LfffP18xcv%0AwpGoQa39YnLq8eDworfPoTdQOAqn8Bu15jCZJKKcOD5eOTokgMOEizr1aqM26HB8NjzzeGjUqje281nE%0Ad6R51t39HTHWs4hPb6WrVDoFxWAJdUAYVOMDUm/lktPlXpiefjg5KVjOyUyGJstUY/Wq1C6na2hw0O/1%0AGnoVx6Vyd/MUX0ZSIdLrFL3yJXHTJSH/7eeygHyd3WRJbuPA4eHKyvKrV68C+wdGhWrU6cTfeTwwSI7c%0AqFQBPVDrJjzeTLl0XC6kClmSWeSANEoVXbcGnI75fv/DgZExZx+MYQlrqMnkDVJ0xGhuGsGVfxMRn2r9%0AtFiWos3N0260B5UKicFst3scjgMdDbuUc+PjD6amR/okljNrweiB8titUiMWRhed6aEhtDuMKhWl9Hg9%0AZOWgZxNIPmnSTrkBEknZN/klW+AXs4AMPTeZNp1Mff/dX589+3Fja1vdPH06OvpkcPhx/4Dg5rRqORU0%0AnPnDzKzeoF0P7UYy6UK1qVFo+qw2qi4XBoemPd4Ri41abzLcpypFD7FhXJ6f464m9N1VLDUbdWSYe/Q6%0AQjUQfObHx0WVBpSfp7NzzLbo2yW+IdKoVrvD5y/xq6G359HwyLDVZuxoHMbnbEVUS1bkuemakP/2M1lA%0Ahp6rDUmiOp1KbWxsLC0t7e7sdlVrPqfzoX9Q+Dttbg4oYtPrF/v9erXCoetFhLBYaaqVmj6LbdTjmfMP%0A+q1WnCOVQgnuiHxWZ07q6mPf8lOkBsWbGA+1EmjxkCw3GE77fBRYEaWaHhlxO+xIZIj90U7HabWcNOrm%0Anl4EL4ZpK6jRkqqnDg3fR9PTUymVIpHwm7VVSIPU5dN3Aw18AtW8oDLfclDyarIFbmkBGXquNhS48+yH%0A75/9+Gxze7terkx4vU8Gh4jvdHKRxZaUI/ChXaOZcTiJ70Av7O3pZcJFP2JohFqlCuGbU+XP6e90jljE%0AfbokSnX1RK3u0WtNvb2zA4NM7uizDu60PSzaDfahEt/VXVGpFbW6pYei+zqbaxRKiI5BpXIvEYvGY4eH%0AB06nq6/P5/X2ebxeOpRe6FfReXR5WbbAe1tAhp6LphNdqAKBwOvXS2tv1tDRctFV3df/eGBo0Gpr+zvt%0AzZQ9vRY1b02XydL+8O1CT+8pEhkt/s7P5u+83bvUZwumD50tTmu1rlq92Wyq1CqnSs20jvj3KZTl85V7%0AabPTONH19DaJOvXUJNxhQyZfavWYyw1nUNPdHcqkculMIHecTiToV+Fyu33BfvSbafWMS4WuswoPTvwg%0AHyb35Dq3rfz/e1hAhp6LRmO2Qmh5c30dVWOKMKnbHuvzPR0cfoeVc3Gj63+/I1/5+h399F9E9KeL+oZW%0AVWqTSHZnUIk5WLMpeUmoKbYWxB5pzrU4PDzkctKnFF2elcDRdix6lE2TgMcC8AbxnpwOqr48NMOR5NFo%0AneNw2ByoFco9uX76pMhrXGcBGXreWqaTtbwGhScShvOCxsWjgaEJMtWGd6o032523dJZVbrEu/lF/J3L%0Ax22FfqQ8VuvV9nc6V7yctSIszRsReGq7fFa7XqtDFNUcCQdTSYQ+SplMlC4a/BoIms2S9pjVZiNcLaCH%0AvoB4QrxbnZlxtGh+Qc2YikwZB5UoiO/rGYlzISXbKC3jVWu96sgKNSjg4Iuyf6rtOW6Lty05YxTBcmw5%0AN9d5uj/lZRl63p4dweKh2y9dN1eWlyqUQVlt/2V0/IvhUaf+zlLEbRbPLavS347jYywREgI2rGbzomp0%0ApM+LSkYsk0FmKJBMRpEHy2XD0dhBICjJo7WAhh/c9rQYpLQCb4gXy0AY5WD4RKI1q1avf2/PSJyLEj0J%0AkXHN5TJJaEmIBaEWlKd8DCTCSKh2cFygEH1+etPDrgYc5W4ZH+PyeZ9jytDz1mqCxbO+9mZza4tr3Wk0%0ATff55umAbrNDUH673u2WpPguW92+Kv12u/2l1mK43d3IcfAW2syoZFDkxRSMtoVHicRuNBrPZUu1Wqlc%0AAQsIqFfqNaQabVaLnZ7KTmcLeqRqDHwiTas5MqkxCXr0esaMMaAO4adAm6Zq7MpvgZ605OSckLFr0u+0%0AQpK/CPYUj7PZTCpJDV06mzvOU6Jbwg1iD+yf41qtAKYZDHJ73Mjdc0SmhHxCcOrKo8gffiIWuPMd9YmM%0A+5cYhmDxfP/D97CWtUr1w+HRz0bH3BYLuAOF585H/IBRnjuP7RYbCA1DenjN1gaK5QoKYfFc7jCVohQD%0AMILBBJPguFLGFaEpeygaBVNaEy4F3hCzHo7AT5b5vLXcgyQQpacGgzRHu/L4FIsVCsdInSEJQPdUHB/p%0A1ZpwUU0mzbmkj6UZF0EraZ8KBcfFD+NFLtFsNHi93rGx8amp6bmFBZcMPVda+ZP58D5DD9ct9Y8wdGit%0AycOT+DGX7QXLdz6N93f3YC3T76VaLvY7nLN9fbNen1Wn5466sNXtfpUe9B8oynO7Ad1pLYSHLLxbPgu3%0AOpGgbKE4mE5RjQH0gDtSJ1WUYWEgghmNhtSMrI7lSplGnWr+dtGpOCiwBPRQ+04nZaZqV46EyhN0ZqmS%0AB3pu6Cx05bZi/6FgKJWkYWoJVAKmbHa7mPpduYn84ce1wH2GHqGwEw4Gd3d39vcP6EhFP7wL5u5t3RLi%0AaUwe/c36Ok2pDOouv90wYbddZvFc2Pw38itzMSJBSPUMq5RIzeMHMeHiXSiXM/l8Ol9IFwtM0BAPSRWL%0AiIrhHyVSKSG1IUwktBxRcqSDu5BSu2w68A2nRvJ0WlHkyyvc8InYfyKVpl9YLp8v5FEHST39/Hfwkm7Y%0ASv7TR7TA/YQennj4OLFIZGtrCy9md3f34GC/BT15ZEDVShVEXRjG2F08LUnLIH9DJz+aUnWf1tCkMWtV%0APDEvs3g+4qn6mIduRYKk0LJK1UlewrUh9JIpFtMFCXqOS8VksRgt5BESoeUpJaynTUnqqFoHc6QpEq3K%0AqK2/zqMhfZUn3tNiG931y5IRYx7WwMMtU7pfg7TNRM8/OEQQ+r2zbHcdg7z+nSxwP6FHcHOQMf3L119v%0A7+xQGSDlSkplcAe3n0TIuLfP3kqWc08xn8qVS8hc4O3z1FVdHQO9k1V/KyszKUOVkXoLu9nMZBapRtjc%0A6BmKCRcTMKZpmJ2Oz0ipYZRCtRLJ5fLVq5VVU4U8SiMEs1sTriu5AbcyLEfkMWMhRn50JALPBKRvtaW8%0A0ge0wH2DHukZW63i74A7Pz57trS8jGYo9oTyQdSGDLDbahl0OIEeWwdPhxZUVr0+lDblCsVKDSmcaq5c%0APcxk7IaMHSEJ5dVh0Q94mj7RQzF1kng914xORIhwQ5K5K6CHM4V8dZnerZVKsVZlOa/oVSl6tVLhmF7R%0A06tTKHlOKPFPCSMTwxaRfqnrPFRJKfrG3IyMG2G8XA412mI7uoTPm83VpQ7xQalDPG2aZei55hR9zI/v%0AG/SI+A7zLPwdcCeVTgvrmnX6+cHBB0PDD0dHB2kFcz7hEn+VXP1KJX2ciyRSG6Gj73c3D1P5r3d3q41T%0ASD06iww973ONiggRBahupRIWILsga+X3eMQykBRPpQPJBLBBU0EpaF3I00mRXJXT6fZYrH690W2zWt1u%0AqcW0VA3XKmGlJOVcn+i4XA6kMzsHB5JK/8HBhegS6YUIr3C4z+d7n9HL2/zCFrh30FOp0Czh8OBgd2+v%0A7e+AOxN9fZ+NjX82PkHRANfylVaVbgZH2mY00J44mT/mcV7lwX19O+MrdyJ/+NYCrQgRlfF4LeJDoEeD%0An0I/DFyhYgG4CaSS/CRaxLoOi2VAiwaJVSpbtTn69QY3RRseF8wdq06nOYMeZbde362Sdiigx4UAY2vv%0AtNnoDGyTi4cJBBGRhbdDkpc+GQvcN+ipVCo86Hja8dATRhb+Drjzd7Nzkz4fJUvXGZ+5g8tu02g1PJlp%0AIwORBG0wqs+vW1/+/K4WYE6Ep7Mbj70MBRGWDUYiWeJrpycOo2nWPzjmHxjw9zudDoPRoGPWhWYr1GlN%0Aq1TiKkVHrUrlt1l7msMMg0JY9oaIfXtITOjKxPykBs0XGRXtdeSFj2iB+wY9POJ40PFqP+sseh2SXfg7%0A4M51/o44ARLXVqsl0e6120XuhqyJThIM7aY0nBrxj3iefr2HxtPBmMLTYWIVjES3opGlSCiSzTaqNcrh%0A3VYzBbpPRsamhoaBHqZXJByvS8B32kHZ26ukPYbDTqEsCbW/mozkK8my82I1EIfcAuhz0pB7w3ea7VNZ%0Avm/Q07rgStIFd56jFZXZzLNu8Hcunw2Ru5H00inBIm1bqXZdoiNe3kr+5LIFLns6EBErJ3XC/E/Gx6eG%0AhsbHRn0EdJAm0+kJ6YA7TL4u7+e6T4TvM+iw2wx6ItLt7BikZ5KavOV+YdeZ7uN+ft+gh/oguvjyD66g%0AsCxl1GSvYOWCJre3tcjdnK1PV+ImHRykJ6ns+9zKhpLnIfWDhrUQTqV2AoHVUPAVCadsBo4PURu/0zHZ%0A1/d0bHJ2dHQEpVZrJ1vo7RFgA5HG4nccnOs45cL3sVFtTyZLq4VBJHhDnEFiTLxglL/do7z0yVjgDnfj%0AJzPmmwYCx4QgJa/1zS2x3uW+oDdtf+XfWj2zuhD9kn2fK+1z6UNwB0ZPhg5lgaNXB/vPYXXGo4SWqeAa%0AHh6eHRp6PDw85vG4LFaLCWLQtdE3cCdTksSkCTNfBz3i4BAIKdHgDVuabtR8CJOQ4lLKSqkjuzRA+YOP%0Ab4H7Bj2kcuHOj42NB4Ih+B0k12nO9yZwhFxpH/XVVDRrdbjlkkt/e6+eNRUKaQ6A78N/rWhCNwGF66I/%0AZ0o9dznEx78Sfp4RiMhOjlrTTGaHmM7h4VrwaDMcoNjcYbUPDQwuzMw8oFXGwKDPZn0b02lZjJlRudKq%0AuYOlUy4THqpQGtbVhTuj8nrPMlzYnJkvfiiB544ziI/T4lqrWRDfBH9HSo3ZbHz+83w3eS8/qwXuG/RA%0AHkNLWAQLEHD44ccf6U7zb8uvD5Lxmf6Buf6Bef8ArEIqku4UUJBsLnwfhQKH/pSrv3Eioc9Vr1+XUs9V%0A3+D9PxORHbD+zxtra8FALIu8Rpn+q/MD/V8+/nJufGrA3SLq6CAMvo3pYLFmby/EQgrieWbs8wqG9uIx%0AWA59fX0L4+O0TrWL1hpIwSLD2Dxps3uuGyvQw4OGFwvXrSN//hEtcN+gR1xwXQMD+PyULxMsQOccruxB%0ANlM7aVJwlCvkSWDhHNGMHEV06LN0nyIMhDIGCncstB+bF89Ky/eR+mfxyMX3wekh9XWV7yOB2q9Iqefi%0A93zP36EjQw4MtSI7L/d2v9lcJ7KjVGtogzHutS9OTHz58OH44Mhbho7wdIjm1Os4OIlCIZxMHgSDh0dH%0AR4eHoUQiViyigghSSXG7toPT8nqAqi6V5IDe8GKeReU6EmKy13ODlT7in+4b9AhTCt9HbzD0D/i5jvd3%0Ad0NHR+FIeD8a+WZj3aw3EANAiIdODA693qSTgtDEKYlGE3i4Tk1G7BlYwWM67eqWyLmEFK70fX7lSj3v%0AdzmCO0v7+4AOkR1KseBkagyGifHxh5MTX02NT/b77Va7kb465wwd4elUm81cubwbCPx1dXVtdzcQDmez%0A2ZN6TavXDQ0PTw8PfzU1PTMw4DjvJnb7sRHrQbeQNzmH228lr/nBLHA/oUf4PsQvnU6nx+02m+gQ0wvf%0ALJQNUaUFfcdJl06LxWcyec0Wt9nitVqrVhti6ZpeherdrnicCUnhtB1ZAHskp4aVWtMtfJ+Oh6/kDvGA%0AbvWf+Jv6i36w8/83HkhKZJ0WKqVoNr0VDj/b2nl9sL8WCBRrNRyO0cHBh/MLT6amaJ0ISVk6VMvTAXQw%0AabVxguBGNJWi1HNte/uvKytHkQjhHpLlPofH5/EMD49MDw0vnEeFbh4pXAqozLwJNnGueX4QwGYMSKYi%0A6XrztvJfP4oF7if0CFNyCaLUS5qDX6miRrgH4hkZEEoWqfcpo/aQSSfM5kGHi4wv6+DY2xQqfSuN/s7J%0AUPZ28+TsyM1L907b9znpyN0yW/vb+qm/c9xP/hdwh0xWOBH7X9TqIk0SSSeOC3SaH/C6v3z46NH0NLSd%0AAacLzo74KsLT6SbQplQcZ3NrR4ev1tZ+fPmKOqxULmcw6GcmJ+dGRxfpB+906vUGnFCqtzqjQteZhBgT%0AYj2cVhbAHR4tqKWaTWYuAC6D67aSP/+IFrjP0ANAtFQ7e+GzQm5G+g7GB+kpwjn0IbbrdE6jwWM0uZht%0AaTQGhVKNfwOLpAVDnaeEG4zMuuTcXOn79Epzr7MXkSAQ6jzJcv7pPfy/JevVYJIVSSZf7m99s/5mLXCU%0ALze0Gt10/+D8xOTvHz6Es+Oz2020/eKFq4j1enro7o5oRiKe2zkKPF9bfbGy+mplJZZIEM6h1c7M0PBX%0ACwsLg4O4oldbrbUfya/EFW298Hc4t+iiIOEqarhg9/T7fP7+fkJFQp716l3Jn35UC9xn6BGGRVFheWnp%0A2bNnFJSKpyJKPVSxz/X5Zt0ev8Vq0ukMag1+Pm9aiV5xOqSsSrWVVbnC93knxQ7acW/8Bl7AODF7Mln/%0A+vrli72dg0SsXG0YtYrZEf8/f/n3DydncTosJqO2ragh5Qc1XQBM4yQaT/zrX797trK6c3gYjpEEy53p%0AKJlMs76+KY/XqNFea8LWfqTy0XNfBtzJwKFIvS2dIcY3ymtsDLmMa/cj/+FjW+A+Q4/QKqSL5traGt3T%0Ak+mUimQtYj0ez5OR0QWff6rVXYvc1s10Nc6RpEPOm/By5wn7zQBN55cWzJ1ELkurnB93tr/d3KActEeh%0AdDpcEz7n5zMzX84vTgyNSJyd3l5mWCKyQ5mVxO08LiK5//LN2tc/Plva3GzLXJh02n67fdzrHeKMmM1s%0A23nEs2WRETttSp0qcHHKZTwap81GlW8snYqnmWpVOSGgmNFooBC1398vCzNfYcZP5qP7DD1Cq1D0EQ2E%0AQs1GfdDp/LvJ6YcDQ2MOp9dkMqqRSf3pbhPS/UNPGyIU507+J3P6PsJABHNn9ejgP9ZWYCofJhLgjt/n%0AWxgb/Ye52YWRUZ/HK6IznZEdHgO0rljb2vrXb79+sbZ2EI6msll2Jb6AVW98PDpOXQX85usiO2JviNhG%0AUsmjWGw3HIa39cenTxESQ6med6laE94TrSlojCPntj7CxXGXQ95P6CE6QwiACvaN9Terqys4PieVKrjz%0AaGjoi7Hx+b5+J92hrny0XmU7aQ712+PpXLYEk6xitQr75s3BwfOd7R+3t48yKXCn3+N5PD39+czs06np%0AQbfrrb/DnEipJIBfQ0QplUIi+8fXr795/nxjf7/dc0Jko7xOx+L4BLEh0lKXeVWUU5RpVlGpZsrlWDod%0ACIf4mS2VwDupbVezGYzFAjFmfBW1Sk0ZKWU06KLKua3LZ/CT+uR+Qg+4g1cu+oguvX5FCzm30YS/A+7M%0A0DtcpyeZdYfT8Jvk6Vy2D7hzEIu93N35j6Wl1aNDmDuU6nL/gzv//Pnn+Duwbzr9HXCnR6WslUqhSGR5%0Aff1PP3y/tL5+GImCO+2eEyIbNeQfmJqaGBkZvrKeC9yRmIrB0NLOzn4omEgmUDxdnJ4Z7eszaLXJbDYY%0ACvOmNyGbk5IfGxunEaCc27p8Bj+pT+4n9FTpLSFpFR5KoeV43KhSE99hnnUHf0cEKfB3flM8nWuuTeHv%0AHMRjz3d2vt/aeLm/F8ll9QRoWv7OF3PziyOjg263tHXLbqfn/g6aFSh4La+sPFt6/SMypsFg298RhzLq%0A9RNDQ3MT4wM+3+X69Uq1ShA6EI+/CQTWj442Dw9pe2zQarxu99jg4KDHo+npKR4fowwXS8ThT9httlE0%0AOMbGLUzcOsgQ13wt+eOPaYH7CT2kWumBs7m5mUxl1ArVrN9PXJn4zu39nXZ85zfF07nuShT+DrhDPmvl%0AUPJ3wJ1BrDozg78D7lCXK7YVERnh74A726HQ85WVP/35z2ubG6mM1Gqi7e+I9Wll8cX8/O8WFuyWK7Lp%0A4M6r1bUXGxs/bm9Fczk0CyeGh//p91/NTUzQ3tigUikaJ4VkOh6P0wQVZROH3To5OTk2Pi7ntq47lZ/O%0A5/cNekSUhxnW7s723s4uGGTRame8PvJZxJVvFd8RzBFFi6HTii7/Fng6112RF/wdcEf4O4M+H7hzwd8h%0A4d3NW9FbO+0Cd/Yj4WcrK399+fLV+rrQye48Cj1C0K4d8XpnEdDo72fqJP4qNHrydBPMpLb3939YWnm5%0AucVx4fIsTE3NjI0+WViYGh1l5eJxPpYIHUUjyUyGKbbTbvNB5/H7pbIvuetxp60/yeX7Bj0iypNKJnd2%0Ato8O90/qVcoX4e+QRyefdatTIDFH1F2CtPabTJ93Wun2/o6EO9zwSqlrTTFfwN8Bd/4Nf2d9vd0XpHPP%0AQjP78fDIkNNJTWm7tkto9Gwf7n/38q/LGxu7wUQYpnOpODowIPlH8ws4SmI/mVLx1eEhb0LOcpSn07a/%0AiuX7Bj21ajWdTETCoXA4DJnQoFZ7zBZ4g26DkTz6tafkQmRHpegsm7h2q3v9hzv5O8yz8HfAHfJZ+dJb%0AfwfcuezvCPaN3WxaoGZifNxtsQotHuHvxDKZzcDRy/XVr1+92tzfT+WrJ6e98JKHBgZmJyfHh4YMSIvh%0A3J6e0uB4/WCfABC9KBDHkKM8v67r8fq78df1Pc5HWy4Vg4eHR/sHGSb/p91us7XfZoevfDN/R47snNvv%0A7f+393dEfId5Fv4OuLMZCD5bXr7B3xHsG7fdujg9PT85aT6vShf+DrjzP//ylxdvVkOxaDZfrdabhJ+n%0AJycX56GgD1pbIhjStLpez2eze7s7wrd12P1ylOftyfs1LN036CmVysFAEMkXKnp4lg673GMeL8qEN/OV%0Az5g7wtn5pSuwWk/sd8ovxIUiJnefQB2GqM9KZLMrhwfPd7dXj45uiO9IqC3yWd3dhWoVst/z1VXiO1f6%0AO+KL6rU66kunKXUYHPC4nOTjO/2d71dWqO0S3B9i0uAUEejFqakHMzMel0sQlOl0RIetQCQSCkeKpRL6%0ABCg8Dw6RZJOjPL8G1GmN8b5BDxdlMBwSLI8+o3HOPzDnH/zpXlofkLkD8lDtLVVmvPvqlqre766d+O5O%0AfpbfmGpRn3UQj36/tf5idztTzN8mn0X1fyiTXdrZ/c9vvnnd0ff18pDsVgt17dSXUucleEA1hJwld0ny%0Ad8CdNvdH+Edeu+3p9NTjyUnruX8klY/t7y/v7sUzWQ19ZRcWHz1+4vH0yVyey9b+ZD+5P9AjOeEnJ6S0%0AwtEYrLOe04bDoBuy2wn0aKVeWte8RJSH9hVMFz6Iv0Nvr9N6o+vkIvRIebTmaRc5NZyIj+T7nPk7udxW%0AOEgqHX8nlE6edjW9duejyckL+ay2v9Ps6a7X6olUcnl7G/7Om42Ny/EdYX0IhFQ/oOODnkaLu2xE6RHc%0AEfGdTn9HdJXQa/X4RzOjIxODgz6XsxcCestnzB0fr+1sb+zvVuoIAzmmp2cQFEOGWebyXHOVf4ofX39P%0AfoqjvWlMIreVO87F4vHj46xB3eU2aRxqlRH90+vv5HaU5wPUZ535O/VGd61BHfyFL4PM2Gm9W8qsvasN%0AdGG1X/RX4e+AO//vy+fPdnaoz2qeNq165VS/6/94tPh0Zv5K/g64A5the2vrz3/6zx+XV1Kpty1AL4wW%0A3CFqg34YOj7oaVDX3hnf6fR3xIZn/tHjJy6nhDtMSaUHDOVg6fT6+vre/j4ZeuhFEHkQ5Eaa8sLh5F8/%0AZQvcH+ip12u5XDaVSmePj6lmNpnNdohlNE6/2ZehFF0SkXmnIv2XOmGSrjB6QLg8J92XJlzSQUWbr55e%0ASfaZIX3I6E/Lm4BNsx0OvNrbfgEtKhICd5xmw8xQP/XoCwRTLvGVCS0zyONCfm1z68dXr5ZWVvYPpPqs%0AywYUtVp9Lhf+DrqF6Ifp1Rpw5zp/B51JZnkDvv6Hs3Mktixms/BJiezEYvHNvb1dmM2FwujI6Pj4ONLx%0AZLguH1T+5FO2wP2BnmqlSs0E72q1quxVmbQWs9ai7L1KfuFjnZDmafeNrSykcQltoEb9tFWw+sGiP8Ij%0Ai2dS3268RgcjmEoKfwfc+Zc//MPTmQWPTRJ75CXyWYKvLJVNnJygg0E9OnWh7RiNWLPzp6jVmhgY+D3Q%0AMzqKbuHN/o6ILk1PTEyMj6H71Za/oGLr69evvn75MhhPqLX6mbn5+YUF81VM6M6jy8ufoAXuD/QgGYVe%0AVDqVgtqDH+4wWXlTRfETRse/wAEhldLT/KBeRsewGs1mtdVjk6JWFBTpM3Xa7DkFpwj9fKjoTwnR2HQG%0A6a9XB3ub4VC+UkfCfWLI93hm9tH0PJ0kiAefDRlfDFhUKoBFKqogUKG/gw5GZz16x5eT1MHUyh6vzTw3%0ANvbZ9PQ0bGOL5QZ/h923s1qP5mYpTzWZTOyQTcq1GvVcL9+8ebO722ie9lPJNT4+NDKCDEHnEeXlX4UF%0A7g/0oAgDh5AXCxqVus9m543w4M2nQepmwySIe5zKx67TX9bL6EH3RwGmXOhjAe4kSkXGSYmZBD2MpDWq%0AbgDxQ0V/0oXC9ztb321sbIVTmWKdjJ/P7fnD06++WFhwO90iDyUsSVBM0idtRV5iyeT/+ubbr3/8Ef2d%0Ay/VZYn1wx25Uzwx6/vvvnj6ZXXBbrTf7OyKr1e9y/vHRo68ePHScezQS7qQzm8HQ+u5uIplyOuwUiiIJ%0ARpE6zSfEseSfvyIL3B/okYQy07A9MkCPQamy6Q28b2Iwi7N0eiqFLlkmQCF5QL9kjoloN2UGuDPn6S2E%0Aouunp8lScS0SKlUrXqMecQ+XwYJgq9R5ivcvH/05Yy0n4i/2dl8fHEQzxzTyJK+0MDH5YGp2YnAUasKZ%0Ahg7jIQ8I6CgUEA4T6TRKg98vveYnul8iJ9V56Qv/xWI0Tg77CPE8pLDT5yPok8ofbwUP4SvDG7zsK1ES%0AQRX7LFmr8YlBX5+U1Wq98hSjHhys7+xEY3EGMjIywioQeeTocqfNf0XL9wh6qtUkr0SCWI9CpaZSVK+g%0AlURHu4jrT8uH8TK4FfGqpL7J+DKtBBe4kz9p7GXT/7GxFkhGbXrVjLfvHycWxxxeQBNysDTkXzj6I1jL%0Aa4eHpNL3YjF+7fd6JN7Ngwdjfb7O6ipRpSV0kROx2J+fPfv2+XOwQCheX7au8F86vSdwh0RkLBH79tm3%0A3y4vw1e+7CuRLP/iq6+++uwzl9cjslpiz+QQVpaX36yuVMtFEOfBwwcLi4tydPmy2X8tn9wf6EEzuES5%0AdKl00mhQi2hRq80aTbso8SfOR8v3kdaR5l5doqsESCH5HT/jiz2yQ7JCSpoItjwsdo/oM1jEnKtYCGQK%0AmWJRq9CXayc+q83SkjTrjP5IrBbmhXQB+znG1slapn8WqfRSrWbRG8b7fI8np+bHxlxWy1mn8zP2kzTy%0ACk37IP4cHPy4tPRydRVdd9EH4rKd0OIZ9vU9npl7ND0nvKdKvR5Jplb39l4haLK/T51Ep6+kUavJZE2O%0Ajj6ZX5idnGpntaS+pvn8/lFgY3MzGotZLZbxMeTAxn39/XAILx9X/uRXYYH7Az2d5iZeS9zk9uo8nduC%0ABHRVJ7f9S8V9pApvqbMFR+lt1I1dXYNmy+/GJkgewx5eCcRypRc4En8/PYvWx4Xoz88bk7rMWhbV5J+N%0AT8z4/YJ3IywjslqiSgs638r29vdLS8tv3tC9r1gqv2O9jl/cdsc/ffn73z9YnPQPCO8pmk5/t7H+zera%0AVihBXSj1WR2rd4E1D+fnv3z8eG542G+ztuN04A5HhPVDBwv0fhYXZ2XucqfdfqXL9xN68BR0yms62/zU%0AiaKf6Hn/Cck1+flfkuPT6tXVI6VyGKrTZJ7r81frjXg2tx4K7uB91BsatYbM14TT7WnJDNHe4eeMSXWw%0AeJYPdklsCdZyn938aHLi8dSU3+Vq989qs5ZPurtrlSqhlpcrq8+Xlg8CwWzu+Er76NRqh9E0NzT0lALR%0AsXFwp+e06zh3zCYvNtaXtnei6Vyp+pZUKVg8Q/7+J4sLT+bnBtwcXXJnmJ0RwhNHXN7YpEKdNuoQl2Xu%0A8pVm/3V9eD+h59M/B8yYpLhPq/BS39MzxIhb+XWLwfBXiVaT/s/11UTh+Hhiav60H7fIopbEpH+umNR1%0ALJ7RfufnD+Yfzs7igAgbdrJ4BGsZDvEPL17Qtw8JQbHO5Z/gzlfT07+fmx/zeIS/A+7s7e2vrq29Wd+8%0A7CsJFs/CzMzvFhfnx8fbteyix5Y44tbhIQ2sIUNPkqCXucuXjf5r++R+Qg/+QqleK9brZ0yZu5wVAjxS%0AORXvnzfQc2EMUtinFUjq7VJRPtHVNcQKvb3VRmMnFksWi/vJRA3Sc6+ixuyv/7TLSj2D1NpKQh9e55kv%0AaRd3qvliczTz6e5QyO9EwkuHBxuhYLZYNej044P9yACODw9TIC4dQrwYJRDZwVp+sby8tbsbjcfP13jn%0AfxGvmRoe/nxu/uHEpMdqI9xGJCuezazs7rze3DwKhzt9pbOOFC73w5mZp/Pz6DS77XZpjy2/jKDS2ubm%0Aq5XlPYkkXVsYmp+dne3v75ejy+8Y/df5y/2EHsGUgSzTjpXc4ex8wCr2s1G1oj+w4oa6ulLHLuoVYqUC%0AYsP0lipWaunj1qSmp7vt+5xtdU1P1J/4pq2tsunMcjj4Yu9gL5YRMZchq/3Lx19++fCh3dq688/3Ilg8%0AyGK0Wct/efYsdn2VlojXfDE392h2dsTXT6ZcsHj24vG/bm2IOvjzfUv/C5bz9MjIf/ns86cLC20WD8hD%0ArZbgSX/38mUun+vzD8hZrU7T/dqX7w/0oFQFqxWWR69CUW3UY4V8LJ83XdXLWJpunJ7iGdVbhVRKxCog%0ArvB4p5iLn79wFbvIK6FQw6WDipCSHoR4WAqFCnHRrq4Bh+OBf5BGd0tEVdKpfLnCaE2Crdvh+0iXHf4L%0AvGcWfrLmq+VBSOsTQYf1BCXnOLcWDKwEA7FsHg1AtLiGBgbnxqdgLUNilnbOC6fsnMVzXC63Wcvktq6s%0A0hLxGqHZ/GR2dtjvp6kWR6ZKa+3w4BkN0Q72j5KJ9rYtS3dbTcap4aGH0+TAxjtZPEVabsXiq9tb6DrT%0AY8tms8lZLXFa7s3P+wM9KkKbvJzOUDRaJomby0WOs/1w8C+lX8EdhBqYjuVqVU6kuUUCEjKGH6DLqMgr%0AMX3g0BqVCljhyS9dTy3fx2W3/8PYuKbZzGTT2cIxNyrtH75dX0ehRlrnOt/nxpovCWpF7ViDhjH141ot%0AXMy/CQe3I+F8pSKqyYmzDLjd17F4bsNaPovXTE5+Pjk57/dDROS4HI/T8b+++ea75aULFV5nrB+n46vF%0AB188WHQ5HJ0sns5aLVmRRzr19+51j6BHpUKxxWq18vgtFQoHqUS/1TrlcJ4YjJJH0wqsiGqpbKkYyqRT%0ApUKxUdNrNKN2BKvMMPh6hUphK67xS5xowRvGC9iLRsqVKjcnxBkVtfUCehihQmHQ60Ydzmw222+1BahI%0Aa+aprjqqJhi/zWRSKXrV3T1KS+/bGJbwfTpqvk5bpRiSzyLK8eFnE8BGJKiFPvlSYSeTWAsf7cWjqXyu%0Ap6fpdVgeTU0ix+Oxnmkks23L++tk8Ryi8X4da/ksXuN0PZqaosZ9wuej9ScGLBSL0Xjizfb26/X1y6xl%0AKkJ9HvfUxMTC9PT40DAIKGrTBYsH34ojootBtIsyrjl0NmRFnl/iovx4+7w/0APiEH3kxUK6UuGR7tTp%0APusfqFlsbWawiAG9iYT+tL4WyMRVyq5Rt0en1ZqtVq1G3a3mvj6XqvgFTongDb/a2/vT6jKAMj8w+HBk%0AhP4K5o7qRwJNjBYxaSSl+9LpYqVKK3HGglQggZLTk4ZJRaN41YUY1juZL8LkvIhHEx5m2gTinDSlStQW%0AbRK4+XZz+dud7XZt+rjX/tXU+NNWNbm04XlteieLR3BqrmMti3jNzMjwPz1+giBGW9Mnlc1B//nu1etw%0AQppnXejARZe+xQcPnz55Mjw6IhSXxdEFi0fwhjLZ7IDfD2t5dg6xSVmRR1jonvy8P9BD6yWX2+3xeOhY%0AEG6eEM7gwb4aPtSqet0mq6pXWahW4pBiM6nNWGQnBXO34tMbDQa9WqtRqNW06KUq8uqz2o6VtP8s3KiW%0AJ9X+7CcXCpUK2auVwOF66FDR00tjQrVSdaHUA9jgE51KRX7aJnXROJPdknyfZEIFVdJg4uC0b/YYzZ2+%0ATzvzJYZxeiLVvkvLjTNtoEbzhDlmIJtZDQZEVguN5CGfd2Z4GPpyn832dvwcQKHoZPG8WLmatcykqV2V%0ATs/1tqZPrVYvFouHweDLjfXl3Z1U7riTtQxUSVqFQ0OPELygDutccbmG0nu5vBsM0qf09doaSKfR6sbG%0Ax+Ss1ttTc4+WrrnZfoXfkAAzD0b6HVstZppB1RsnR6nkv2+8TpazT4emtUrNdjy2FY2sh0OVRoPJxZPR%0AsUdjI6Mer8NoMWi0hHuv+9IiVtKppszU4D24zvlqZTMe3c8kVKrTYaft6cTY4vBwp8vTHkBvTy8zQd4K%0AYt6tFy4DjoPg+2RLBT5DYOOC79PenAXhB50ttP4A7hzmslupdCBVEFmtPrdlcebB4sxDi+mdzp8iq0VS%0AH+3Bm1k8l6vSxRjAnb29/ZX19ZW9fVEXJj4XP0V06enDh0+mpyf9/cbzYghwh24WP6ytff3Dj/uHB4pe%0AxfDgILgjdxPttN69Wb72fvvVfUMx4fL29aEuhWrPUSiULhZWQ/Vyo15r9GpU2v1EPEwQpVh0mExT/X6g%0AhzsfDYerv2mL/3LmOJCNglzTykmdrUw85e417uSzKA7wWiz9Zs2Exzvp871zdOFbSUe5gkXNHwnXEKWq%0ANGpk41wmo0bRo3L3aXpN7UjWO1+kXZXWosgQWadhHvXxK6FQNFeoN3uMRn2/1zszOjk+OCx1thLeE80m%0AAABAAElEQVQv/LjzrFaxUNg+OFzd2NjZ37/M4sExwuXprEof7+9HW0P0lhAsnldbW4exGFVp7YFxjkQ0%0AGtbyZwvzo/0+e0uLR7CWUbZdXn/zcmVl92AfMuHszOgC64yOyX0m2ga8Twv3B3rEWSHH9eWXv+/u6S3+%0Ax/8+PDzg8V6pxcPpslqhrJ+e2Aymx6NjcwODgM6Qy3Wlx3F2dlv8F8o6W7+2VLs6EIGA0Hso6dj1hi9G%0ARue9XpNOYzcaPe8yaIRv1ZofnZ4wOapUeHfOUxiJ8H0imfSP+296umsOrdaqkVqMndW4nw394n8ioxfL%0AZn/c2UL5tN1hYmp0bMLP3S9pJJ9tI2XZNKI2nZaf368s/3VlhYWLe8Tn6unWqJSdVelC00f0lriOxSNw%0A5+Hc7N8/fUp/G9s5Z1qwlvd39579+MPK2lqlVOz3+ylff/zkqagRJZJ9eQzyJ79qC9w36DEYjRNTU6j2%0Abm5ukSCiuDGZL2WKZRQ5B53OiT7v0/Hx+UE4s25L+1F/4QQKf6fWIAMPcab9x1bwtv1bi0/Mb0zTWpSg%0A21CfaYU65nKz0duEesf+WjydVh7q9JR6rlQ+ny7ka4268C8o6TIZjYAI5Qt0Ad6JNgwq9bDVq1fpvGbz%0AzT2dmWAmCvn9VHI7GgmkkkxFPTb75PAwPSH6HM6zWi0xklaWTdSm7x4Flje3yDQhRdg5TLF8uSpdaPoU%0AyuWdYHB5d/fN0WEni6eTtfz5wsLM6KivxZlu+zsbW1uimwWzPI/bPYck89zcyOgotelyn4nL9r8Hn9w3%0A6EGwDtk6xOuQsMtm0pQL0R6H5zO4888PHj0ZGxtyeZwWi/4GXTvh74A7raKqm87xHWvcCScJcuDVcaUO%0A5WZ6vISz6XAmzYLwLzxOB+VLOEEUT9HqB29uJ5b5zrDf1a34Sjl2M/Tg+W0k4muxaCJfAHcIhLltlofj%0A4/QdvtLv66wUvy6rdbkqXRgKzbDvl5e/XXodSiQ7s1oiC3aZtSz8HXDnf/7pP5+vrMD9sdrtn3/x5dPP%0APvP1++W+Wjddfr/yv9036JEuZbQK02mSLOLUoPgH7jwcGv5sbHxhaPhqj0OsKqItok9Wh79z3SmWVm80%0ApHz87aYD+AVnFJ72HsURWzxjqVNFA+pfnXhwvFigoU+mWGD+IlT7UEdfXFisVWtUb7M1vg9dgVeCQZ1K%0A4291dhYVXu0diwV2LzlK5dJGLMKbsAvBabvNBud4wu+nYoNI9tkmrSgPtVpsgl+1urmx9OYNIZ7LWjyX%0Aq9KFpg8tAHOl0m4kQjeuDRpPH+fFbFH4O/SimJuY+N2DB8yzBGu509/5/tUrCXeiUb3ROD4+sbD4QGbx%0AXDiV9+/X+wY9BJif/fD98+cvXr1+HQhKajKDNvvfTU5TSD1KkEWvv9rjaJ1Y6UZt8e4kFswtXmdsGqAH%0AEc/3ikW8PaJ0XNTppfw3eai9TCZdLAmvQaj2PX70aHh4BC00xqXTaPB90uk0ySNaypCkY/pzscKrNX4R%0A5UF3efOcu6w3GNjPxNiEz+m6zF2mVos6D9Hlan1z8zifv2yGy1XpYh1wZyUQeL67w4Sr01cS/g648z/+%0A8R+fzM/3ec60B1Hvz6TSnf4OuPP0CUSfJ/ShkBWXL1v+nn1yf6CnWqnwuN7Z3n758uXSkoQ75VLZSkG2%0At+/RyOjcwJDTbLnodJyfTMEzLlPQXakqT0+tCqWGwqiffIksEpBRF7VU53TEm/k+4A1ujvB0OnjG4A5I%0AIfJQpKLSxSK/M9sym01o8uEFwFriOzZw5xr1aCIBLhxXKofJ5OvgkUGjNimVRqXqQrZLRHkO0yl4BhCd%0AiF5bTSaIPHMjIy7LuQKh+JoiykNUKJXaDQT2jgLReAzs67SB8Hfmh4epDhVV6cLfaX2h00z+eG13Z3lr%0Ai7EJX6nT3/ny0SNwZ3x4iGoJCRCrVfJZ4I7wd/ZDYaVaMzA4tPjgAVwft9crKy53Wv5eLt8f6JGmCcvL%0Az1+8WF5ZFYow4M784OCT8fExv99lt12HO5xXwTNGQy9XLJpVqkW3V2NAPvB2L1FBfmMVVeeOuFHbFVWd%0APOOTVmVZZx5KRHkMOi1EGL1BT7RVaTSOTU1BL9za2cXrASYEy1nVdTpisnj0UBDfyXZdjvJ4LObHw8MP%0ABgYt7TLRjsFl8vkXm5vP1jciqXRnpEasIvwdcOezxcUhv5+ZoPicb0StViadWdtY7/SVbu/vgDsT4+OP%0AHtLvT2Ytd5yPe714T6Ann89Ho9Fl6oxevz4KBHLHee5bh8n4YGgYl4f8sf6ct3bhbHIb0yDhIB5HFz2T%0AL/AYV1qtlHpdWO2mX/Ff3u2cxbTlrH7q8mZM5To8HdGDlFu3RoSlUopkksuhg/VQoDM3VKlU4hRxx2LQ%0Atc1mi02tJoiOYBa9N4j7MDNjZZtWt+lDVd7QznZJAHchytPTixwiYa8Rl8tnw7F721eLii0pQ3fazOSy%0Ay0R5NjYudJjo9HeezMyCOxS7t78cw0BxeePocO/oSPhKt/d34C73KJT+vj6qJR4sLvqpOz3PuLf3Ly/c%0ASwvcE+iJBIMH+/tLy8s8dYEh4S+4rZaHo6PXMYbF6QR3vltff76zTT8Gyhf+cXrWa7Jo27flrc/5O1VU%0AvT1Svy1iQO++pDY4xHQ6KqrE30Vfit1s8uvN18/3dpkctT0OFtCs+fbbb08aJ3q9AehhEzQLmZWggB+M%0AcMunWIcy/R8PD1RKZTvbdTnKY9RomHtO9vVbjCbBwRFHFzqEFJ12Q19OZ6j0FDbsHPt1/o5YJ5nPS4rL%0Ab94Ek9JgmCdSEOe0228T35Fwx+dbmJ/7/PPPp2dmZNzpNPv9Xr4n0HN0dBQ4gsAc4lbkhKlVSopCKfX2%0AOezvMIZbJ1Mo5hQqUH6ybwKB7zbeUNJJyLbPai21ZDTe55S32cPoB4r6KVFB3rEvqRTjvKJKwFK9VVdF%0AHy5Cy/g73+/t0vkzV6mTleNuR9+PurNm/WR/Z9eEfvMiE0Ev7AFkiYZGRhLJpPPly3A4XKXtaqGwFg6i%0AZzzqcNkNRmq7UDuEyyOiPPFclvSTx2ajY97owIDJYBAcnLOhtSq2KicnzFgDkUgwHBY2FHwi6rzsVsv8%0A4PCXC4toNl/wdwR3mVr81zvbyzs7qJpB5jQbtH1u9/TY2O8WHzxZmB8fujq+s310dNrVQ7v0+bn5R48e%0AUS1BMKvDWh9zkewbLZX4ySAInzHVRQQKVw6bfMxh3a9j3xPo2d/bi0Qi5fJZdwSlFBWBgmciPHL5fAnF%0AnO1I4Lut5Vf7e1uhZIQgT7V6s8rP5f1c98lZ/VT3W9nzszVpZMPsrOMl8lmrkRCdP9+EAlST03GY4vVB%0Ah5OsHMVNlJui/hHKZEORSDgU8vl8IvXDzz5+8XrDrXQSgwc6LVodQRzix9R2dUZ5hCdCaGZoeHhoZJiw%0AUccQukTFVrFcenN4uLa/fyYMdM5XphcgPbmeTs8sDg2jFd+O74g9CAXCUDK5s38g4muCr/xobu6//v73%0Ai5OT7nMVnsv5LHDHZrVMjo///u/+jtkWeu+do/q4y+BOKpkst/KJStTmkDLR6WVy4897Uu4J9BD4YJ7V%0AOCfjMN2AVFKt1QulEnp3xDt5doE4ODXHpVIidxxJp7ajweVgYC+ZiB0f5ytlpgmFSnUnHrPp9HaNlgcc%0APD0NEoI86e76rGt7QO+eK+IvxJLxdMoIldWq+XIhfJyjnpO6KuobRHyHY+k1CrNeh6C6WavLsU42Wa1W%0AKMjkfiCai+vE45cEkN1uHxwYiITDzLyS5TIMoEA6uR4J2A1arae/WKvsp6J7ySg5bxCPGRBSRj6vB91l%0A5JPfHRfyjL35Uml9d+fNzvZxocAYmLGSCxv0eoAPegHSk4t42Tu859YuKtUq3J9AKMxPeAwS7lAct7Dw%0AxYMHCABBO4RJFEmlGHkum41Gokvr61SlC51DdIrAYarV4SgFQ8FwJMxpYlIpXtier0mcC7YElILGCfG3%0Ad1C7/RUQPGITIVDJBXCn9fH+GBtPLArW6OBGAhH6OE5xsVAEeviEo7B/AFerh9KgxZXG8vzKMNEbwgNl%0ADzhH5VIJn5GfN4yzPeD2gqQQpVYroXjS71Wl0ur0fGW+AuPBXNi2vebfsiCOwrCxEl+tPU72iS+Hndvf%0AhaP/LQe667b3BHoufG3mIGR/CIUEI1G/yUJ6ixPA8zyQTBDTeRMMbIXD+XpVj4SnzZMrAVINXAMKFFYO%0AD9mWveGPTDldbkm24p2c0YUD3elXEX/JVisRVN9T0fXQ7m48Rh059ZwkqoRvwsHa+6yf1HLl7HE5ywIO%0Af+uKl/JcYgWupNGxsUQiIUV80mk+lLJdhxta5Wm/0YxERjgT5V2uV0Smqc/ppF7/HS5P+0hdXaTq1zel%0AKA8LIlIG7vy33//hs7k5epAiafa2zqtjK27Rg719omwg41ld6MLC//nHP86PjFgUqlgo9OrwcC8STiaS%0AKAogVwhCoessvqk4R6+WlnDoTGYTjHPCQ0PDIyN8q/FxSkbxMgRLq7V/ZP6l83L5hT4cW+DQoVtQyOdh%0Add1+fZIKQAye4+7uDhP2WCyaPZaUIasMrj3h6ukRsy3uTLoPDvr9w8NDFLX29ffjewIZlXIZh3SZLwKP%0ArHjtOC+PHAyj5BDnHAEmm93WPzio0ekwaTAQoM8qiYXLm7zHJ+IoPr8fq/Loao+TXaEnzCS3/V0+MKHh%0AnkAP9xR1WzzPeYLgv/AggloSTiZf7u7SlVRAD4nzaDZLp4dw/rhIMMhuHR4aApIcrhAck2QqwwNBUnuI%0Ax7RqVbFaSWSzfWYqxFWEb6XONT0KnCCElNunXygr8wkKOzhH7c+BmBMS6Gg/w01mKM2T+gkLdfT3AJhM%0AuRIrl8KFzFE2nT5pdJlNNqPZ3GhQ8JFKJXnwEkDJFUs70ahK0R1MJwu1KleP3WY1mdE11HMbiAPxIfcb%0At/Tr5WXxrRnzbizmMpjiw3li3PHjnKgC02kMSD4Pu9ykwM66ibbHSvfTk5N6uUxJPxCQSMa7u5oem3kI%0AMtTM3JcLC7OjY6DV5a3EDpim7QUCRIiIWwt/h6mW1+Xizl3d24cf1IKeCN2oU+kUQve4b2hAalVtG9bz%0AuRSCkfhZPPvtNjvgRAyLMq7BoUGPpw+wev16af3NmnRL198hGbW/AQpNuJOACA/wVCp1y/U5IjvkTIE4%0AQNXu7m4wcBSNRY+Pj6k1YYeMszNPwEVFw0JYDpFQsAWhCe5kqI/UDOaPYZPtvHrJtbZzwzjbA24vcKuj%0A59uCHiUYFInHDAYjqMeQnj9/ThSvvebfssD+mZtzbdcgrVWrr16+ANqgxbNP9DFBz0QiOTk1NTc/D9uW%0A2eXfcqw7bXtPoIeHJc6kxWyMqZQ8tbh4sEIsl/vXlaUf9nZAD+lSO2mg8Gdx2PuGhr6YItXjt9ttfJ7N%0AZIhP04l3d3tnf3+PK2ktEDiIxb5Ra6x6jdOkMeh03Uq9UWPwGoyGjnODNwEYEBKmubvyXFiH45LjKTbq%0ARIiZ7OTL6FxUmFvhvxAMThxXitUGamBao8HucS3S5XN4hH0AeVy4f/3224PDA0ZPD+L/r1IF5XBkkDHz%0AevtGhoYYbWdNExduW58Il0F6Vteb1HaFM8VQLg8YpYu1QlVqpMrMcdLlmXS5jXQ9vfSi9CSbz+OYHBeK%0AFKXRc2d+1P/PX/79o+l533kXrUsbnX3ARHU7GgodZ+yUmE1M4O+AO5Fk8i+7ey9fvSLXnmXCC1ETD4KK%0Ak66mSa82qFHCf7s/qkcYZKV2wrcGn0qVKnHutdWV0ZERWoxyJ+OIbfH84Ixew3ggQ+dLJCyRCDsFFG65%0APg+Rg/29VDq9vbMbiUbB/XIZkkCFowCCGlXvhXGWqyfYlkklIS3GyVGQqc8fH7tcTghW29s7a+vrZDpu%0AGOfb73y+xFMET1CKYdOxUquBr4BynVaj4yG6u7eXzmTOV/yb/mcGzfY80kLBIF8wCNW2XGLiyIfofzPP%0A5bscBYM82AhpWVUdinF/02F/euOOq+CnV/501xgYGIAgvBBeYPqdyWRLZcl34NlFvVO1VqW/sDSX1utM%0ATie4Mzk5RVyz3bEbh9nb50Ov0+lwEAuhq/dxnmusnKtWi5VSrquiKheb3Xm9Whc/hx48KR7s+Dt0Cpag%0Ah2duhzdEtID5Wgt6ishfCehh3lRpnpwqSRmZEDPzeD3tyYXRaMDNdjjsOPoEx8X4KR/Hw7d7+xHxoxR2%0Abm7OZrO3Z1ucCY5JKtrpcvZ5PYd2B/cDUS1aeqYK5YN0Cm8uyd0k9TRv6jRq9tLvdmvV5xVb4ky2NJgJ%0APMVgJ2bSOGdOs2FmqP+L+YUv5xcnhkZA1HdyYR3nn+9YPjnJEk07aUJ5nJuenp2YYP7KhIWADr1JKfXI%0AZBJGXY9R2+uy9Rq1CqNOa9Ao9BoUYN96iAgEFCvNQqWRL9WyhUYydxyNHMejaGenASNGj1NVKubsxl6z%0Avteo61UrpW3rJ6eVajNbPIllGtyoADfPD3SZaJsB+lxeP1dsBhN11sd5ASm4CQt5bsliMpUMhEKVUl6n%0A6bJoeozSOFVGneryOEvVRupYlc7X0vkKkk+HySgRGaLPLocThyIQDPL0qlVyPrvSzINIIbU1ufASY+Zn%0Ax+foIvDIOM2XTuK5rqjkO2rIjXDK8BBVPdV+J3u7tKOO7a9bLFeb6XyD75svNfHIoeljn2g0woSLpwv3%0ACC8msASzsB02MZrMR0eHfB2rVYae64x6zefe/n4qgLgVF44WjvYPkkkpoABAsDo3IU4BCRTm0m6PF98B%0A+7Jm24NgQZJVNRhwoYvFQjaTjcfjqUQik0oeZ4mTgkOlUrlKUUKkkBcTLoCJW52yC2UrDKAgUPvuhKsh%0AxbmleRY/uX+4iYjXuDzuljLfDBMlIKMdUgVQWCbieGH8hDS9Xi8QCYeQEV6ZA2JDIIx5SqlSBXr4vkAe%0AeTGGk8wXMAIXllKjsdJtwuNSvev1CEYP92MgnYrn0jp1F7jzL3/4hyfTCz6Pl/sAl/Aae3eBO0HC282m%0AyeGwuVz/7Q9/wLF/s7OzurVFL/ZWT+QcuDPlV0/5NZP9mn6HymZS6tS9BLM6JzLEjnFoQMz0cX0zWPtm%0AtbIVrGaK9LGIFb//gYcHjgm48/mUbnFEO+nX2E1SyjJfPgmnaku75X9/lRfB2EqlTGEJWU4WLq+/dlj9%0Af/58vLRXxiDgFL4twI25eH40G3WnRT3k7hnrU94wTsyIU3mUqP64UWA/G4Eqs8Kl168IPDNxy0voV/Q7%0AlP/XF+bFEZ3ZAERehAwxZlDmgklTx43NYGU/WgunGrmCVLkH3OMhTvr1//cfTbODVziqF/Zw+ddQqtYe%0AJwRXYjo8evFxeJghhGTQGxgzmRlFNo3nztMTBbvA4VGtUll48PDy3n6hT+6J18MknIwDty5SL16Xm8AC%0AgZV2m612GM/mcAI0nb4DZuVXBRLNBoNglYAzhB7TyWSGN9UB2SyR1wvhQ65alS0NALE5Ez0ptFQsEmgg%0Ay8bVzK98zn1LvJaTrWwl+OtUpZ+g7YM8oBEfjbAfTx7+Ks4r1xehigvjJ+iI6CKBQCbk14UApWmXfyAU%0ACu8dHopdoQC9G4+yTOAK1GOBWBXOPOEwrj+xTvsnTMIaoaVymRH3ez20wXgwOXutv9PykqQv1tPN10To%0AGo9p2Ndv0eu8bje3zdr29o9U7YZCzXph2N074tXPD2tmBiTosRpojsbESkKZZlNSdMaL8doVRq10i1Zq%0AhLdOHKZqqUIislk+qiVyRe5nMU6zSwPu/HHBMOnX2k3SFZvJN3YjCm5j/TopKmktfBApkh0Os+Cz9LbX%0AtxiQykV6rQuPSewNLxhnh1PD89+i7x3u1w67lUOenkGXYtClMmgV9RPIlacMQ63qshsV7AHHDeVuNg8l%0AlVqVdFpzxa6DWB3CA7bgc74SJ91u0jwY1f1h3sBX07TiWewHB6Rca/IzV+zRKiWcZSSqDmBKHUO5ohGA%0A5B3nilKFHgANGo71qT+b1D2ZuNTLSXyNG3+uH1X2IjVFb41zRfiGSDy3ABczlx/ePU9ZnCCWSTIS3nHY%0ApXgTOb7oNVPaGw/1/n+8J9CDAbiNgRWHyw2IEL/gahDyptwn7eQlnkX7br/OZiACtzoAQXCO/dSQVyVc%0A/G5yl+usDTE8QHjSkuj5/q/fbW1tk1kTkCTyRDwVcaE5llTsSQZteYmL1GQyMdQLgHJ5/AhcaDRohBE9%0Av/bRxwrAE84RyCu+keD4sMyC+ITwIRVb1+W2xDrIM3tmHhL94kK8zt8RXhIEO2LCUmQ6k+mt1Z6OjDBE%0AhN9XdndXN7ck3GnUR7y6f36sezim8TuVDrMS9yeWqX+zml89KB/FMWeP3aTCO/jvn+uN/RIaMkPhdh30%0AqD6bOsHcqEomOpQRuVfxd8AdIECM9vJPEYUBelgw9qna64M7gBouFRM64QOyLQtatYKo1uKo9n98YZwb%0AUus1MK6kic9moPr9ZvUwRk6g7rb2/O7M29LaWwEqm1Hx2aSeNkPBRFeuUMY7q1Sl4Hcr4cB8UPLs+CJ8%0AHTFCECecquODBBO1YuWE2aLbqnRalI4WgIp1+p2qES/enDqYzMWzkgI3sz+8MNCQUYl17vqzWDk9iDYP%0AYs1Spctl0XJ5QEyi7T0XMw9CrmYepUSaifhoNVqP1ws//oZr7K5Hv+X69wd6AHjJf1EoSP3c8stfuRoQ%0AgCvBq/1XLkqwhmwrIWOmXrx4yBEbRPUYl0esJh0dqOAaPJ+kkJW3UlTlcAz1+aiBAnqI5lK3EQsE3qws%0A4/DPLy52HuX9xg8w4RbRn4Jri6MzL4Dgw7s9eBbgKFEacmWWiiKy7lPepxBjhh1Ov8POA5DnYefm0nLL%0A35Fq0ygx4cYiBsTjEm1mrXa4z4ee2fL6+uu1VejkjWph0K19NKb9cla/OKLhPoS8Q9xhN1x9tln8cbMU%0ASAA93Xajmuf/4ojSa+vVqnuYhfWquk26Hqe5x2Z8GwziUDp1t9Pc67Ephb9zcWDEfQiTtyKyZGqYHV9Y%0AP1M4CSVrwWRN8tBaPiCPBIJNLrNibkj71azhyxndRAv+Qsn6RqD2fLvy7VqJ0QIBPrvEq8AH6XOo7dLj%0Ao4uh+tSq5HHT71LtR6vHZZKYkoer0XWz8oBLaTEo/v/2zvWpjTQ741x0v0sgEAibm/F97PHOONnMzmQr%0AX1KbfEnlS/69VOUPyKcktZvdqq3abFI7mfXY2MY25o6EBLqABOiGuOT39oHmRS0wHo/NEFqlwu3W2293%0Av919+rzPec5zxN+R49ys7jPXm1rC4EIZ2mc0Jgb342EnJsz0pGiZiDrzZWrMVrmFOjuZrKvZeqG883Su%0AmiupS4ntNlAkZdQ4fumcv1u1/SzTtMoek0Euvbmenc5mGhvbB7y8kGe6fn2Y99fC/HytCPeoyuuKFxUE%0AImYG0NzBDYL7e8Ytf3zPm119vIX/P6bn440Rdgcoer2QTy8tpUEUMyjwFbe3N5l2cYM2Faa0t1OvVbaY%0AmW2haCFH4nG6BqOxR8Ojf/3Zg2vxOHF2NNLJF0Oo9Ol331XqtQFK5X1w6oD4aH196MT7Jc7FI33OocDi%0AwIfr4uE5OIC2A2nwhE6z1ov4O9gdSgZJKQ6M6RD84z2wnp5iOvV8isTdp8AffeGur+95vrnvHR9wyft/%0Adb35v9OV/3m1/Wy+jt2pNrDXB0SL0oXuxbV6stcx2INbpNwZIFgAEb7mKWBHrsV5pB0+t8UaHh2eYDf8%0AjwVre3BWkBS+JsgiVTTuj/j+8Rehx7e8TPqkp0J5D6TpDy+r6byyOzzJ27WDmZW9wZ69L26eGFK3syMe%0A7ohHOjKKTaU+EX8XZvTzMWcEl0j7SJ9/elNdZyLeRB+yk2kav3OCavKoh/q0rThmsKTV9d3vpmsYO35h%0AxvoPX4EieRlSbLTZFrvz799WJuerxc0dSKXmeoHVDzrgkSoiEiAmtygkj0IxTxteVKTpcrMqRlghDwYE%0AJkmMmJm72cMnWLBNz1mDzPUiMEy0BbZYCrHhhUX+zWSzRFU7oJng8qjcCNUD7k7M5Q6Eu73dTqJahrAp%0APogCmPf3dvzOrt5Yf9jj28Zp2mk8mZ/r8npgu/AKwna8cw54xiGKjxaJRgC5eo04F2RYa3u8Mz44VnyO%0AfzVY157urnggwErIbVa+sspo51XMF6KL4jY5pEYo72cab1crqdzay/n56dlZgA+8wETU/XDMDcTTFzl8%0A/8ub/9lcA7vDIyF7B/Eh+rarvahZDzgH5sqXsJc0gwE01OtM9jq9bu2w5bejv4Ld8D8e7nCka2zAzZc4%0AmvxO+Gwu25zNNLfrh7vG3WA69uVN3xc3veLvqBhTbW8pt/M6VRd/R/wj6D14E3XKCZw8Tvw4rCRPurk6%0A4O0EpeYbMKArdo1xYbaV3WhOrzRAXrBl0ic/jfQ7B3ud1/sOJ9F0zqwQegG2iZcYLk9j96BRxuvBnzpk%0AUVbr+z+/42vsuPePppyyFdPYp7PVP75U1Y0YUjll/nKVcY56Yt6hZHJkZIQpFW9I4hXMufiJEDuwOF8i%0Aovg+QIFE1iFwAEGaPXyCBdv0nDXI2B0g5zevX/3xD3+YfjtN2FvNtvZ2Ix4vMapkJNofDPmNcg67B/tk%0AYFJ+J10orKwXkVUm0gQ9p7pTK2znHq2OfXXzQW8wemswScrCi+Vl4vcqjlYotCA+Zx3N6b9Z41x6W4yO%0AgquazbYgTtDjvZ0YoD0L+laHyxgdRFThumCD1GzyhAmAAPhk+s33hLRWMkBroCdDvZ6Rfg+OjLyu6UTH%0AHfT+Pe6uwR6X3hI4FliE0BUPrbSkE9oke1waC1HvQy3zEPJgy4IyK0MK1TZBZevee8PdX9/38O0NHZon%0A7M50qvZ6qZovKRthGhrl3USUg8OC/rH26XF2AeL0R13mbEtQHhyokqqJctynYE9Mkcwoe1s0St9d22XZ%0AKl9urm7UsTuYSL2Z4Iy9sQi0R6je4Mq8or766muAvOUl9K+zf/7+CZyAyvZWoi/+s5998ehnFGq5kRgc%0A1Dv52Mu26Wk/woLv4O9gd56gt/rkzxBMmGijo86sBGYwAhTDPXH0cXxOF68rakhAI0QF+VpP72ppI7Ne%0AzJY21krlaqP2cmmpUqt3HrjuDo30hyNUASNCzzSbCQIJinunFQJrf1zt13JvkX8ADxg+HsLUPDx8zKa8%0ASzdr1U3wVz/i0K0zFzCgfkMiB8MkmM7hhpgZTA0hdupDC4Va9XrAO5OUFIzO/MICVbqolkNOVmGj5HUc%0ADPY4RvpdfdHDCZT002geFDZ5hzNEJx6PSm2fKEzQe+yjLa41phbr6UITGyTv7ZDPMZbAluHFnAowc0i4%0AGNI+7HcC2WL7/G7mkcrvKGzuZjegC6m9C3LEFO/esGsiSTDL9Iz22PX8an0TJ8DAg+TImeUB3+jTPfE1%0ANqt7a6XDPnnImcFFAsrugEaZlCUxo6k8mXrH/g7dYsIDXuo7dpuQjWp5hEaBFkYiqN2iLuXltZcz/GJa%0AupzdGF+unYnC4RjiHq5tQIbCiHUTwcRz4QOOw17ondk3Ls9DRN1GR0E/wRap1MJ9Eo6EA6GQK5WCiiJt%0APn/4iJ/6KGcbPLc8ngzQh/21TU/78WOqBb7DPAt/B7uzkl3F7qCz9WB45Jt7pDUNIn/jgxxN0TsebIxI%0AY8d3sE/W+L3rw4DQxFnIF5skFzy9PJ1JTaXWytUn6fWNv33wUXgT3FLM54Fa4AFnM2nDvT82PfVmkxTZ%0Atc0yxHnkRFpOmIdWGR3DSxdMh4g7/+U2J5IFdG+K3vOQ7zWbsGxfLSw8ffX62ydPZhcWqNIF9YB4XzzY%0APZFUX2Yf+i5Adjge/c0vvy6t7fzLb4uErs3GTI5ypSYeAXiQvLfjEc+dYd/ZsS3ZXNpHgu6huFs8Kavf%0AEfIp5GhswAloLTiUbGv1tmS9iqwd+lCHRsrqoWARgMwTUQ/g8Yk+G5AYFbxdPfLgTutTR6N4+Kk7Mjo6%0ASkyKUOnvf/975vkYCGvsDNAau8OEq26kd7DV3Xv37qMta6CHhocKQ9obiUQCwRAQMldT+dd+Pwjjoy++%0AZKYPFMBKvY0c4Sf7a5ue9kMN8EYOAMmZs3OzvN55cgYi0bF4/6ORscc3JkYTCTbDc4E7Q7pGKp9jgTXk%0AMke5fWAY+XzO/gSvGq/Hw6tyIbeWXlesikQ4SvgJ6o3Lp1hecC7MiFj74zjfWuJc3HNghwhpZDNZ6I46%0A4rNdq86lF5PxWBQ+N+E/AlXavAk7cWwqMDdgOgZXBfgKl0f5QUeeTpkiGevry5nM87l5lAzhK5MOah5g%0AwOvEleArVB1zPbtydqugEu6PIODiodSaXXOrAhwdtgU6I68CUhSeBx5Hb9hBWAc7clpsy9wFC7getB+I%0AOohby2yr0iC6DL0Fssyh34GvAQw0kSRcdSIOVWscEN4Sb0v65NQNNFohMsne4+me7qGIf4TpAYrCOYoG%0AT/SJ9VzO7y7nlBmVPuWsYXXDrtT71NGoYCR489bN2zdviQMCDijn1R+B+HPIFZLetmv7AFgKw6od4CVh%0ArR4+ePDF48cwLaSB9a/EsBA8sP50IWts09N+2IHfAOKIWAEMyxubhAlK8PINHBWQwdxM8v5fmH86P0dF%0AUDoCsQt6PSSIT/QPjPUnRoglxHoQ/Xq2OP90YW6tXPrP5095Dlig9mlLJnr74zjfWmbyQhS6cWOiWFCZ%0AUECI5qblzdLkq2dhd+cNsMTEgMJujnJQzTaHC2DKwhs0nCCeFt3TmZqdef36NUzl3EaJFE/ELvTNlY/Q%0Ajn2jnuGQC9fAhELFQxHGE6w2sxNCvVAQAOIZ8PfltljbK5KOxLYUX1J9rEiQrMcxgW0k0TdZY9idNr6M%0A7qFIS1y8tr6eFQ+Ss7b6L3rLRFB5r8lrQyspok9Kf8p6XrLfUuXg2Xxzcp7skP1kTDF3MDoy25IGP/2/%0Atulpf41ASyCMkEZM7Fzeb8R0gl4fX8QDZRsmMsA6c6vZKXKNC3m8G7m9+sKR1Y1SuVZ3ut0s3xkaIqGe%0AtIrX6XSqUNisqdm/y+lQkx+8HnP63v5AzrVWTZrgDUai4zcm0BhsQXzIL19Ip6lufufGoj8CQJXwe9xs%0Aovs++m4gPUKlxASUt7dVhtT2NlmOeDpTM29JNTxSX3bwZlYsWDXbgqF8AF+OLAerh8I0BPYgb+mXix3Z%0A9WNAlDd6bw9pp/EQtTEMziR02/m5uezaKqgsWR3X+7qvxwmrH/tk+kG2LAc8KhNifMCpx7bmsw2+uBXi%0AcehIkGwusS3C//nynhl946fTfBndQ5EeAIxafD0rxiQt8bmG+90Tg24Y0kxkmbtt1PagCL1cbCysIdjS%0A6fEFyddLJocY2Fw+xz0FCcd6Xgw125LvtpyDrKhIUlC6eMdB1MD5lX1dir+26TnvZYLpRVIo2g0tIWHC%0A6szG+YpzxF+FLtcbwCsLpY3PR0a+Gh3/gtKDaLJ4A2TSF7e2jdxoct1bEd/zHsop7U5DfEBY8TjepHO/%0A+36y2un42ukYQYjr9BQt7A4VspYyK9QvnkPpPZtZQ00D+kcZuf1DXSHQUPAFzPHCwjx5CZz1KQfVAXEG%0A1nJfRJ0srTgSpi20P+jsotDoHQOhEH7T/Nzs737zG6XZVd/xufeYmMD0NSNlp/Uv6624jO7LyCtBR4Jk%0AK4ltTaeOWT+y/vy+jNXXs2JM0mevwXhSkbWwyu0A0ppZUTlr0CwXsjUUWZgtiz4BgXCSORlYzHpi4Cy8%0AiXcY9xKULohdQDlYc9nXpfhrm572l4kpjNfvJ2QAGTQSDgEbU7tiqZifWcsGAz50DiidDMaciERvJZMg%0AJIOxGDZlG0LPniKJbtXr1bW1kiKL7pAwfrs/MdbXD7djBkUYRCR2VdIwFCHcZIQvKL/T/iDec60gPkz7%0Ab9+6rVyV7CroDC9JvpA+ssXS99PTe0bSUa5YJN2EORozRM6U/eDb4d4TVWGmiYIEGhoLyF+Bc6VSqNgQ%0AiFXGoqOTbENJvh0eHgZcgGewt8tpNfdw8hoqNE6wBqqubi+AfiRbIlfaB/FZXOtc3VDTBJxJRQ1voA3S%0AZQRnwgg7ILoDGYo1bHUtDsvxGGc5bTDEo9ExFKsvg8fRggRJb7CBef754pTp/fs8nQS2jNjWoc9l9WXw%0A8oRkTPjf6ut5nJ2JKAEyB1aGqBYWaizhuh7vdnSR4rAzn+0gLv56uYHpAa+pNR3oFty+fXt8bBx5XBIH%0AV1cRvC6SZ9YT9JyBN0Ep74/3Dg1y95En80m5yPpw/bBl2/S0HzdeILxG9NrtUvGKDCM2IGoz0t9PoJ1y%0AF6OJfgwNdwo1f7MbG0gdQuqZyWaK21vknr7ca+7vlLNj439z5xHlT6FPwABCD8haZ6L9cbzPWkF8kkPX%0AUDsm6/2P//WHRl3hJjw2dCNZTuj4LS0tItueGBhEJATZPYBwflXc1hUE4akusYkJRbuHb4nZlqFiw3sY%0A+yV1JtBXox4G4lJEbclgoENll+uN9a0a2dJkV5LlRLZBy4GL73P7uuPFguP5fB2QAumitzMzitu2tYki%0AHzIm5c0ymm0MGnnbkaDXjFW1dNXyXyuGUtpWPB3dlzkNMRG+MpRlFvRuz8PTiQSMvPzriGyc8F4NLpLz%0A/qh3Y3uXs8a7IZpOpIyZILOk795Wt6pd61t78HEI58Eb3Otwh0IR9IkeP348PDKyWS4jXcZ8XXhS1tiZ%0AjjeFglF8zzu3bkueoH4KP/1l2/S0v0Y8xrxGkKp48OAB4XNcHFTjyNV+Qc0ZhxMV38LWBu+akDcQC4YS%0A0VgyGgPWyTMlqVZmV7P4PvgRZLJnizV8IPYxEBsY6um/mUxS6CCPS7KxMTs75/P6RsbGcEB47X/4RF0Q%0AH9KUKVVKtsJmuYSA4loeKWqVT4/5KJWbeDTU9JpNpRL9CdjPeHSCTeqmR4BeQbgYB9PTicfjCNHfGB/H%0A9HDYmGYI2cCipJVkc/lSRalJgGLg2vCqJ0nShF04ffF9ekIoHHXA1vG4dl4tNxbXykvLZB8RTKw2ULsp%0Ab2J68BrJ29ZjVeJxiAHFg+DZVn6Et7s/4hztd0HSRvRBMBRh9Fl9mdMQEzLgFWJiMInkPuD4VRZYxDFg%0AZI2dwdPh7MYGXGMJN53r9xBxOkg3ZPgNxBzObg9mHzcQ0wOrG4mPFwtkSOznS9wbauKJ3ezvizGGFKO/%0AdfsOtxwqtel0Cuvv6lY8KWvsTMebIj2BsRs3xsbHUV7Qj+FSLNum56zLhETO47/8eTzel4jHJ6nyNTWV%0ALhYr9Z23meXr8RDFzm8nx6/19Me48kZOE2xDjE5PKEzwCxphpd7ACeIme7WS73K9+Nl47a/GJ2CLgQFt%0A7u4SPptbWICvSHwdRkbfj4QRir8GSYwT48ifPZuEHGDm0+O84AcxP8JPYUbGhKvLmHBBdlahPFBgZk98%0AjnIEsDtIJounA+GVbH58JRKdYYiwI4wmyr65XB74GfUsMo9AWDYru7zP/+ZhyJ9ohR6MJAZvNOgc6W/+%0A+a3jP77rmM02SXYnWIYvhnFEHdnqoQh6Ai7DGdGD0Hb4K57Fneu7qHONDyoMRa6l1ZexIkGCtljZwJIF%0A1ob7Y+HpEP5vi0YJfgQnmwWMzuiAG7YhntHUIrPRg+k02STNal1RHMVfQ+ntF7/4xRdfPibRAaA9n8vh%0APaOFcB68iYR0VKj4Iil/1n38k/zNNj1nXRbMBDcEUxLU+vBKcADmFymZVUrB3quuU6S4UG4M9RTQPI4E%0A/My/eFDpbg2BMfAcIx/nEGfB1HQtIS7x6PpIbyh8l2yaamVyawuJmVdTU6FQcHgUgnT/WYdy7t/EX+vr%0AT0CNRRUBfw2XChvHvsxo1G69UasfSmroHYuPQ1qGElNAUQHZunCEsMvY6Kjp6eiYAuODOvpN+GyLi4BE%0AxWJhaY34ncpkJIRXrhxgDshHFz+FHaF6Q84k/kIsSJZ/J/EdYKj57HZ6pVzIK4oQZhHWnxmrYvSwEZKp%0AhCAhuavX4i4YLpgSvix/MeHjCcceEVxjR9Je92V4vM9g6CznqD3b1LOfiG2RNWb4Gid4NDpP5whdcrag%0AUYIxzWXq5Oin8ir9qg+j4yeNtiMa7IoGu0FtcuW90hZYe0ehvI/eBl0xnsh3DV0bYsSxOagsrq2uQhmP%0Ahc+KnUlWOleH2wYVKtRg9Ot4KZZt0/Puy4T0N5XOY33xiTt3iPm8mJxcWpjfKOaW8uXs+pTLMYM+BoEG%0AFAslUg50WkDhWT3oh4838x38jsVMZjqVupUcfDA4xJyEahlLhTyBDAKjIB7vPo73aSG+jzINySQeEL4V%0ANs6MRsnkxdqf+DgUzBlKIl19jdcpd3ZYKPpHno6+leyFqqGs7Iv3oi2dTi+itofqFeozn43sENBBZw8P%0ABUthbsikhoj7LSVVEYj4O/71vxuAIBgdGmA7dA9FfJO3K43/+G5zPtuEHPTlzQ5ogQMGLU58KPIIhLKI%0AgbP6Mudn6MjhGUhNm6wxnX0j3spp8TLszm+fbhPUp8OI3/lsdvfxLT8xPqSL/umXwb+66yaxi2nXH6eU%0AMiE4nHJCDaUx2PNgZ5kMAo3K9AQHHC08KT12JlXMeCtwdbBZvDPM4b0sC7bpefeV4pVCpXPoJ0CzffE+%0A1JX74nGmBmh3iorzJoEho5IEBLzD7hA+RBaQ6UxnJzQZ0BPmFNDwFtZWkYS7OTC4u5tElytfZnUJq4Rt%0AevdxvE8L8X14o1LzIBgKcRj4Vtg40oKYCSoFB/LGgSWMhAlD5ZUtugOUZ4nFBhByHgStHsL0WHUdiUOp%0AzMMKlcSUZ0cP0E8gIlLUFFVzdIGQK0RtD9UrwFS0YZlcMDPCQ8FSiNYfjy7KD+Ap/Hdjq/m7p2j6qDws%0A1ht5CcccYslUWlprvFlWkaCBWGey143UoYyE+FD6qOABEWLTfZnzM3TEl7FmjYkvYyh+gQqriRLm7Ix4%0A2eQ8R9sgD54D83v2C+Uun8fxzWdkyXdhhWEqZYpOl6N7LrufXSdbXQUIUe1CCQop3QIaFtT/qmz6XHvx%0AsLtFpUgSPiQvjOJgyUG4h0NcXChd+iBcluVLedAXMrg8mbxecCIAOFD5kifQVHEGuOH1JY+iHB4eATMd%0AYteUmEM0nLQDoBTSSvPlPvK8BmI9NwcHUQ4ju50NxQp8pPPiMMCSmNMZSgkI1Blq4NgOw96Rz6HyFY0S%0Ad0DOOD4Q/HCXfNCNfaTlt2p6YHdePn9OFIbnBFlYjhloiKg8I4BcFaEWWDmMBCe1tLbPxDOdrxPrYWbU%0AolAjvg8yxiwcjhi855P5UCpR8yhT6TyDo0d/pP15EBNpKb6MNWtMsBs9r92KRkkPVowJKSTqbQAMm26m%0A4VUxU0MN1kHRC1QEeQdgx1Xlwmp1bXWtvLXd1bk72MPsrFWlCK/HzAszUDZwNpWVfp6R+Qm2sU3PeS+K%0AxI94yfCVbbhXTBVnYszqiTP8CPmVB5hnHtId4oZv375dJR8sm6U2FlkUFM8AGBqIxuKhcLq4rkDdI2/p%0AvEfzPu1AqcCwBUsCkcGxJz2NNBHo2nQDo5oqKOcp7KuSKhAGWV9/OTVFjTrRG2o5EOJiRtq88mLgB6Nh%0AjNfgdYOboDR4gv+iVG92Ub1Bxvbw5K0eip6p1LKjtv/Voz/S4DwMHWkpvow1a0ziZdNpNSuUqN/542Xk%0Aw/k96suCfFRGGzm53Yakt8FgUtWvjCRkAGaKRvBmQKNjNIFq6rHqkGyL5ND8KvxstFb3e6M+5L3xTHlJ%0AHHZ92f6xTc8Pv2KCdEB7xxUiQqQeuqPAEJ0SOeKWwmAx4XJ6vG9n52oU+atsw/oh3g78Sy6Yn9LK1rIp%0AP/yI3r2l+G4cGFiyPPPMxfDYZc519vbYHcwWBUSnXr2afPECT4c3dssm+H0tk0fYg7B4woFmi9afIBdE%0AgihrI51YPRQ9U6llR23/qyMy0uA8DB1peX5fRkejZFsrxnRan3pLpJ0hEAoXGS9mHaEVI7YVsqgOSW/4%0AdG+WdwgjspB0u+PUAOvrc5+sMiItL8Vf2/T88MvEYwyYwuedXZBrSU55xqgsvlFBYeXwiVWPPb3g658r%0AUemd+3l3A/HdsDU/ICICuINKLFXeVzIrxWKOODTvfxPBweHD0+GFXCR+v38oIYw/p6YJBbgzuyzoxyfI%0ABdAMC7Jez4eSWJVkKrE5GhH4RPrmLcvS/kOUdDidlqwx6VOPlwkepDOn5TDUuZzEmGS9tU9dZ2d3vzMW%0ACVGbiWI1sMJRv4Q7xiyYabqpOiT9HOFNOytFsr26/D5/HFIWLIdwxOlsZW+2jMxP9r+26fkUlwbEhBuF%0AlCXyMI2IBvMR6t7VEUvF6yH/60dJIv3YZ4IqvlKnXlqqVapH/Bc3ZDlJI5DHg+nAt2+qqxt7nBTHIyfL%0AX744hfoR6siFrFfexFHuu3gHLZUk9M1blq3tDcS6Tfa5db/SlZWno3sokLNMJo41+9yKMZ3Wp66zA7Km%0AiJ29cWayxeL6/OKi1PM4LXYm/GypbW+tRtsyID/9/9qm51NcI6BcSMZklnd2dWN0uNVIyKAg+vbOTigS%0AhrMnhKBPcSgfsA+SzyAHAUgAsRtcXjeVJx6O+xJR9eJFpCJbVHDXc5UVr7w5VlJfwdF9QBq6z009ixOm%0AR2fKAH9gy/TKE9ZKEmcfuPgdeuUJK3IkPej7lTVHvkwrT8fqy2AcAYNg/bRUnrBiTKf1qaNXwPhUd0Ro%0Aqa4AZgjheeqgtjC55Qh1fjbgDh40MA+I/iWNbclJ2aZHxuHj/gVbAXLmw4LsCbgH0KfcbCSSQ5QPBXn5%0AuEfwY/ROFScKIq6XyiRlhA08Artza8grVaVgMBPJsu5H/CNrvEbHZaxtTvMjrP3LGmt7K3IkLfX9yhqJ%0AbbXxNSzVLE6rPHH+PnX0aiAJF5zEvoENdE7ElzylApceOwv1KHUelN4vlzqP9cLZpsc6Jh9rjSA7VKjI%0AlUo4BfmtMp7A9dFRZJUvRYgUryeL05Nbo3LTYIgadajPeKkhhS/AkJWr+1tVuDwHcAMNno6i/LCA99FS%0AVeIIuUBu5pApQ4ZXSxurH3H2VbG2f9/Ylp41JihPodx8tVx/g6TGkdgY5qxt5QldAVqO08r9kT4FvRKd%0AHWhQ8DZjsdj0q1fIGBB4PDt2BldzZ69TbTV0TZHszwEynj1oF/urbXo+xfiTnQQdBuZLd2dHo7lDDipm%0ACFpeoIfUwRtkD14K0wOZYCmV4kuqOvyflnoS+puZxwxwh5FlwcoPtjJlrG2sfsTZ18na/kNiW4LypPLN%0AFwuYHhVRkr1/eJ+CXkEAM3V2vP4A+bfIBpBDNxRtr84juWYSEYtGwmgGoLVynvjG2YN2sb/apufjjj+v%0AfWLSqP0RviA85AVVbh7MZjMOl8sbCl8bHrk+PMxs/8PT1j/uaRi9k4uPABB58Abt2BH2Haogy66VuWmq%0AwlWqlJTBTkbRBmUJkBGgaKkqIW9+Kmo+X2i8WKxTlZQ19KZziAmTgQSLHyGZSj5va8BeP1m9vV73ghwx%0A1CrwIxxauU59Q5bZNe4JWNWDUTdUYzMLjMzy6fTO01lVudyoh3XY8vyVJ6z+i45GkV6HDhSRB7fbVW80%0AshAW8hSEblpjZ3pEjKFiK9JN431xJu8t53Lp/mubno97yYQLA/NwdnZmdSUddrqp/5AqFvyRCHlh9x4+%0ATCQGL1cOjiAjRlTuBCPAWpOTdO3b19yPb/m+vOWXqhLiTVDR/M9vd0RXWHrTOcTYHbIWpIKVZCpBOSTX%0ABDmztpdKby8BtbbNWClMYmSAgHU8LhV0QxMD/vTEoO+b+6oSKYnmcoTYnX/7dpuqoYTqpDcsVAvTWtaf%0AFi+zcn90NMrvDzHPJhMCebb19Y2VbFZUioI+b0vVdj0i5vcH2eqyIIOnXQVzvW16zKH4KAsQhzMrK/Pz%0Ac5TxKhSKnp4e8hNcgUBsIHH73n2EdYh8XZY4BeQjKEigVIRv8G6kUqjJ6wGvoZjndt1LuApPgb/UUbh9%0A3UVpc2o2IAaLOCHoCbMYvImXS6reFs+VlUMMBRG1Qz1TiQtD8kej1t706JUnxIcisMaCimTldikL4fN0%0A+wxJHaXyY+S7fznhwxPaqu5getDioqDw+KCbNvky1bUOjxC7QzCboqByW7x/vOysyhMIHYzdGEeGubpd%0AgcyzsbEhKkVnV54A3EG7jvLEl32qJUNqm56PYnHMToF4nk9SjvzZWi6/YWQ8UZjt1r17d+9/RiIYXPhL%0AdBtBPsLZAaQAqqBQJ2lNvaFOMzMLlwF9wuE+15cTTYBkkrMMdQs2UfTChWyD+hCgtqAnzGLwJniqMRBW%0ADrHuR0imEoNJfYZGbdMcVX1BrzwhPhS/4tFg/pAfxVT2hp292uxEMsh/+cAD7IKyLfWzqAVGiO20I5R9%0AvW+8zMr90dGoK1V5Qr9Y+rJtevTR+DGXlS9dLL55/XpycpIcLqU753ZHUNIdG7v34CEF27A7l2vGjr+G%0A3UwPDiLrUNzceTpXZbwKmwd9EcwR5QJVgWDYkWj0MEWC+MOnUu9AZ4eHHMYNpodoEahtcVOpZMlYG6gQ%0AtUlVb2BArMTl+X4WEZ/jTCVW8sLHTtVQmF5v8OtW7TiKT+HQ72eqCFAgfwMEi1dA++VUqlqrvE03MHy9%0AYbwwVdCKTHeOkPwpY26I2aFMiMqoQlB1ZqVJvrt5hFu1blgzEVcHkQHJCzHcqD3SPr6fqVC8UA6ev1NL%0AjdlMQ8eY5CcMImeqJ8lIS0GvYpHoIFUktcoT1nGQftiKiqyXuvKEOVYtC7bpaRmQH+2/2J3vvv0TNZOf%0APnuWyWYoe47Ewdff/PXnnz8i4Zg6s5fI35FBoZQlRXIpk1X507eFfAbWMkIW8RcNVGkwNJEAHkSHx3WA%0AgA6Iyc4usfaOXKkTciBTG4wFTyOxLSAP3Tfhvzyiq+u7303XwGLYEV4P8HOpolpKphIrSZdTU7ytxpOZ%0A3cx6jcmdeZ0Iq0MpwqfYP3CMXLv2q1/9ip9+/etfz868JST0ZKZJ+74wmasulC44QpI5+TDXK1UQ9CCF%0AFUmzfaNyedM8QswOmsc0Q32xoWAmxL32OF8OlSkb8LnqwviwbTrPzPFY1xEjhc81ndr/59/shP3Hxykt%0ADzrcsahSX0Nnh6Q/s/IEEiYt46D3T2VEMyJGAgWjcbj7y/yPbXp+zKsHqExSJf4OBSEW5udnZ6hAsUqO%0AFoAiL+SbNyceP/4LhLu4ey6d3WGYKKHLweMFbFeq02/dzCUXcvXFXN3laKD/EAl0xCOwltV4Yn2wCKXt%0Ag1wZSAVLtEdMB2w1GA0MXA9ALGhUK7iBqo4FAZ4yXg+QyrErQQ/Qu3n+BwcGyJGEwYgiPQATQSJVWmP9%0AREu1P5RxvN54TwyR/s8ePIQ7jkwACBqTXPSQXizWnF0NQGLcsZYjxCmr1rs4QowU8SPzCIeSQ/fu3lU6%0A1nk4WBuGw7WfNpLRZHfmX2EtwxSlEDaeC7QDiBQE3RBgLGyeAKekZU9MeY6is0PcU1QESOCiNGvbcZAd%0ABQP+ZKKfKiA9vT2X8c4xh0tfsE2PPhofuozdIZiVSafn5mZBl3F8iIbyPFChDS4G9SGJp6J5eEnfWtz0%0A0El4sJENQTIV3YzFpUVCM5uVOu7DRqUjs97hMF7zZGtRrYx3NZOgg4Mu3tjGOIyBrUJiIt996sULJqHo%0AQ7fVaeUyMBnB7+D57+vrR7HYj0itUemMp7rtRUJyiOgPFCnMeizW86u/+3sGHIhtGtHoVIp5Ex7TVr2z%0A5QiZcO3udRJHI4NcP0JKSLNfLuLUy+eZdAov5rT9igfHxJlsLLL22Rfa+22PUFoixD8xcVN0dpQAc4Aq%0AikrhCPG2tlvJSlJwFfnFFwAAAj9JREFUHn7+CJcTx/OMZpfrJ9v0/JjXC6+nVqlgfZYXl5AxpGtumqGh%0AJA/c7bt3eSp+zJ198r54t/OMqUxXSrM2GquZDCldHR0lpOQxMad9wIA8XU6SHuPxXiUvf/8+ydnFfH5l%0AJYNUx2lbYZ0x09TAQEkIbSHAbSOydgzxtGyI6lAEWcgYAUQfz6djYoIGebjX2VWnY1WQmmobNWrVDZbR%0A73HoR4iFDfgD7Jec8rP3iy9DAy8oXjiMfWJfLQdm/ldagpf19JCsHsWCUy8E547Sz2pIz/yoRNPEAC8w%0Aj+eyqvNYz69zeXnZutZeY4+APQL2CHzUEXiHuf2o+7Y7t0fAHoErOwK26bmyl94+cXsELnIEbNNzkaNv%0A79segSs7ArbpubKX3j5xewQucgRs03ORo2/v2x6BKzsCtum5spfePnF7BC5yBGzTc5Gjb+/bHoErOwK2%0A6bmyl94+cXsELnIEbNNzkaNv79segSs7ArbpubKX3j5xewQucgRs03ORo2/v2x6BKzsCtum5spfePnF7%0ABC5yBGzTc5Gjb+/bHoErOwK26bmyl94+cXsELnIEbNNzkaNv79segSs7ArbpubKX3j5xewQucgRs03OR%0Ao2/v2x6BKzsCtum5spfePnF7BC5yBGzTc5Gjb+/bHoErOwK26bmyl94+cXsELnIEbNNzkaNv79segSs7%0AArbpubKX3j5xewQucgRs03ORo2/v2x6BKzsCtum5spfePnF7BC5yBGzTc5Gjb+/bHoErOwL/BxO3tcAh%0AGzKXAAAAAElFTkSuQmCC" data-xblocker="passed" style="visibility: visible;">
</div>
</div>
<div class="sect1">
<h2 id="_overview">Overview</h2>
<div class="sectionbody">
<div class="paragraph"><p>Snort 3.0 is an updated version of the Snort Intrusion Prevention System
(IPS) which features a new design that provides a superset of Snort 2.X
functionality with better throughput, detection, scalability, and
usability.  Some of the key features of Snort 3.0 are:</p></div>
<div class="ulist"><ul>
<li>
<p>
Support multiple packet processing threads
</p>
</li>
<li>
<p>
Use a shared configuration and attribute table
</p>
</li>
<li>
<p>
Autodetect services for portless configuration
</p>
</li>
<li>
<p>
Modular design
</p>
</li>
<li>
<p>
Plugin framework with over 200 plugins
</p>
</li>
<li>
<p>
More scalable memory profile
</p>
</li>
<li>
<p>
LuaJIT configuration, loggers, and rule options
</p>
</li>
<li>
<p>
Hyperscan support
</p>
</li>
<li>
<p>
Rewritten TCP handling
</p>
</li>
<li>
<p>
New rule parser and syntax
</p>
</li>
<li>
<p>
Service rules like alert http
</p>
</li>
<li>
<p>
Rule "sticky" buffers
</p>
</li>
<li>
<p>
Way better SO rules
</p>
</li>
<li>
<p>
New HTTP inspector
</p>
</li>
<li>
<p>
New performance monitor
</p>
</li>
<li>
<p>
New time and space profiling
</p>
</li>
<li>
<p>
New latency monitoring and enforcement
</p>
</li>
<li>
<p>
Inspection Events
</p>
</li>
<li>
<p>
Autogenerate reference documentation
</p>
</li>
</ul></div>
<div class="paragraph"><p>Additional features are on the road map:</p></div>
<div class="ulist"><ul>
<li>
<p>
Use a shared network map
</p>
</li>
<li>
<p>
Support hardware offload for fast pattern acceleration
</p>
</li>
<li>
<p>
Provide support for DPDK and ODP
</p>
</li>
<li>
<p>
Support pipelining of packet processing
</p>
</li>
<li>
<p>
Support proxy mode
</p>
</li>
<li>
<p>
Multi-tennant support
</p>
</li>
<li>
<p>
Incremental reload
</p>
</li>
<li>
<p>
New serialization of perf data and events
</p>
</li>
<li>
<p>
Enhanced rule processing
</p>
</li>
<li>
<p>
Windows support
</p>
</li>
<li>
<p>
Anomaly detection
</p>
</li>
<li>
<p>
and more!
</p>
</li>
</ul></div>
<div class="paragraph"><p>The remainder of this section provides a high level survey of the inputs,
processing, and outputs available with Snort 3.0.</p></div>
<div class="paragraph"><p>Snort++ is the project that is creating Snort 3.0.  In this manual "Snort"
or "Snort 3" refers to the 3.0 version and earlier versions will be
referred to as "Snort 2" where the distinction is relevant.</p></div>
<div class="sect2">
<h3 id="_first_steps">First Steps</h3>
<div class="paragraph"><p>Snort can be configured to perform complex packet processing and deep
packet inspection but it is best start simply and work up to more
interesting tasks.  Snort won’t do anything you didn’t specifically ask it
to do so it is safe to just try things out and see what happens.  Let’s
start by just running Snort with no arguments:</p></div>
<div class="literalblock">
<div class="content">
<pre><code>$ snort</code></pre>
</div></div>
<div class="paragraph"><p>That will output usage information including some basic help commands.  You
should run all of these commands now to see what is available:</p></div>
<div class="literalblock">
<div class="content">
<pre><code>$ snort -V
$ snort -?
$ snort --help</code></pre>
</div></div>
<div class="paragraph"><p>Note that Snort has extensive command line help available so if anything
below isn’t clear, there is probably a way to get the exact information you
need from the command line.</p></div>
<div class="paragraph"><p>Now let’s examine the packets in a capture file (pcap):</p></div>
<div class="literalblock">
<div class="content">
<pre><code>$ snort -r a.pcap</code></pre>
</div></div>
<div class="paragraph"><p>Snort will decode and count the packets in the file and output some
statistics.  Note that the output excludes non-zero numbers so it is easy
to see what is there.</p></div>
<div class="paragraph"><p>You may have noticed that there are command line options to limit the
number of packets examined or set a filter to select particular packets.
Now is a good time to experiment with those options.</p></div>
<div class="paragraph"><p>If you want to see details on each packet, you can dump the packets to
console like this:</p></div>
<div class="literalblock">
<div class="content">
<pre><code>$ snort -r a.pcap -L dump</code></pre>
</div></div>
<div class="paragraph"><p>Add the -d option to see the TCP and UDP payload.  Now let’s switch to live
traffic.  Replace eth0 in the below command with an available network
interface:</p></div>
<div class="literalblock">
<div class="content">
<pre><code>$ snort -i eth0 -L dump</code></pre>
</div></div>
<div class="paragraph"><p>Unless the interface is taken down, Snort will just keep running, so enter
Control-C to terminate or use the -n option to limit the number of packets.</p></div>
<div class="paragraph"><p>Generally it is better to capture the packets for later analysis like this:</p></div>
<div class="literalblock">
<div class="content">
<pre><code>$ snort -i eth0 -L pcap -n 10</code></pre>
</div></div>
<div class="paragraph"><p>Snort will write 10 packets to log.pcap.# where # is a timestamp value.
You can read these back with -r and dump to console or pcap with -L.  You
get the idea.</p></div>
<div class="paragraph"><p>Note that you can do similar things with other tools like tcpdump or
Wireshark however these commands are very useful when you want to check
your Snort setup.</p></div>
<div class="paragraph"><p>The examples above use the default pcap DAQ.  Snort supports non-pcap
interfaces as well via the DAQ (data acquisition) library.  Other DAQs
provide additional functionality such as inline operation and/or higher
performance.  There are even DAQs that support raw file processing (ie
without packets), socket processing, and plain text packets.  To load
external DAQ libraries and see available DAQs or select a particular DAQ
use one of these commands:</p></div>
<div class="literalblock">
<div class="content">
<pre><code>$ snort --daq-dir &lt;path&gt; --daq-list
$ snort --daq-dir &lt;path&gt; --daq &lt;type&gt;</code></pre>
</div></div>
<div class="paragraph"><p>Be sure to put the --daq-dir option ahead of the --daq-list option or the
external DAQs won’t appear in the list.</p></div>
<div class="paragraph"><p>To leverage intrusion detection features of Snort you will need to provide
some configuration details.  The next section breaks down what must be
done.</p></div>
</div>
<div class="sect2">
<h3 id="_configuration">Configuration</h3>
<div class="paragraph"><p>Effective configuration of Snort is done via the environment, command
line, a Lua configuration file, and a set of rules.</p></div>
<div class="paragraph"><p>Note that backwards compatibility with Snort 2 was sacrificed to obtain
new and improved functionality.  While Snort 3 leverages some of the
Snort 2 code base, a lot has changed.  The configuration of Snort 3 is
done with Lua, so your old conf won’t work as is.  Rules are still text
based but with syntax tweaks, so your 2.X rules must be fixed up.  However,
snort2lua will help you convert your conf and rules to the new format.</p></div>
<div class="sect3">
<h4 id="_command_line">Command Line</h4>
<div class="paragraph"><p>A simple command line might look like this:</p></div>
<div class="literalblock">
<div class="content">
<pre><code>snort -c snort.lua -R cool.rules -r some.pcap -A cmg</code></pre>
</div></div>
<div class="paragraph"><p>To understand what that does, you can start by just running snort with no
arguments by running snort --help.  Help for all configuration and rule
options is available via a suitable command line.  In this case:</p></div>
<div class="paragraph"><p>-c snort.lua is the main configuration file.  This is a Lua script that is
executed when loaded.</p></div>
<div class="paragraph"><p>-R cool.rules contains some detection rules.  You can write your own or
obtain them from Talos (native 3.0 rules are not yet available from Talos
so you must convert them with snort2lua).  You can also put your rules
directly in your configuration file.</p></div>
<div class="paragraph"><p>-r some.pcap tells Snort to read network traffic from the given packet
capture file.  You could instead use -i eth0 to read from a live interface.
There many other options available too depending on the DAQ you use.</p></div>
<div class="paragraph"><p>-A cmg says to output intrusion events in "cmg" format, which has basic
header details followed by the payload in hex and text.</p></div>
<div class="paragraph"><p>Command line options have precedence over Lua configuration files. This can be
used to make a custom run keeping all configuration files unchanged:</p></div>
<div class="literalblock">
<div class="content">
<pre><code>--daq-batch-size=32</code></pre>
</div></div>
<div class="paragraph"><p>will override daq.batch_size value.</p></div>
<div class="paragraph"><p>Notably, you can add to and/or override anything in your configuration file by
using the --lua command line option.  For example:</p></div>
<div class="literalblock">
<div class="content">
<pre><code>--lua 'ips = { enable_builtin_rules = true }'</code></pre>
</div></div>
<div class="paragraph"><p>will load the built-in decoder and inspector rules.  In this case, ips is
overwritten with the config you see above.  If you just want to change the
config given in your configuration file you would do it like this:</p></div>
<div class="literalblock">
<div class="content">
<pre><code>--lua 'ips.enable_builtin_rules = true'</code></pre>
</div></div>
</div>
<div class="sect3">
<h4 id="_configuration_file">Configuration File</h4>
<div class="paragraph"><p>The configuration file gives you complete control over how Snort processes
packets.  Start with the default snort.lua included in the distribution
because that contains some key ingredients.  Note that most of the
configurations look like:</p></div>
<div class="literalblock">
<div class="content">
<pre><code>stream = { }</code></pre>
</div></div>
<div class="paragraph"><p>This means enable the stream module using internal defaults.  To see what
those are, you could run:</p></div>
<div class="literalblock">
<div class="content">
<pre><code>snort --help-config stream</code></pre>
</div></div>
<div class="paragraph"><p>Snort is organized into a collection of builtin and plugin modules.
If a module has parameters, it is configured by a Lua table of the same
name.  For example, we can see what the active module has to offer with
this command:</p></div>
<div class="literalblock">
<div class="content">
<pre><code>$ snort --help-module active</code></pre>
</div></div>
<div class="literalblock">
<div class="content">
<pre><code>What: configure responses</code></pre>
</div></div>
<div class="literalblock">
<div class="content">
<pre><code>Type: basic</code></pre>
</div></div>
<div class="literalblock">
<div class="content">
<pre><code>Configuration:</code></pre>
</div></div>
<div class="literalblock">
<div class="content">
<pre><code>int active.attempts = 0: number of TCP packets sent per response (with
varying sequence numbers) { 0:20 }</code></pre>
</div></div>
<div class="literalblock">
<div class="content">
<pre><code>string active.device: use 'ip' for network layer responses or 'eth0' etc
for link layer</code></pre>
</div></div>
<div class="literalblock">
<div class="content">
<pre><code>string active.dst_mac: use format '01:23:45:67:89:ab'</code></pre>
</div></div>
<div class="literalblock">
<div class="content">
<pre><code>int active.max_responses = 0: maximum number of responses { 0: }</code></pre>
</div></div>
<div class="literalblock">
<div class="content">
<pre><code>int active.min_interval = 255: minimum number of seconds between
responses { 1: }</code></pre>
</div></div>
<div class="paragraph"><p>This says active is a basic module that has several parameters.  For each,
you will see:</p></div>
<div class="literalblock">
<div class="content">
<pre><code>type module.name = default: help { range }</code></pre>
</div></div>
<div class="paragraph"><p>For example, the active module has a max_responses parameter that takes
non-negative integer values and defaults to zero.  We can change that in
Lua as follows:</p></div>
<div class="literalblock">
<div class="content">
<pre><code>active = { max_responses = 1 }</code></pre>
</div></div>
<div class="paragraph"><p>or:</p></div>
<div class="literalblock">
<div class="content">
<pre><code>active = { }
active.max_responses = 1</code></pre>
</div></div>
<div class="paragraph"><p>If we also wanted to limit retries to at least 5 seconds, we could do:</p></div>
<div class="literalblock">
<div class="content">
<pre><code>active = { max_responses = 1, min_interval = 5 }</code></pre>
</div></div>
</div>
<div class="sect3">
<h4 id="_lua_variables">Lua Variables</h4>
<div class="paragraph"><p>The following Global Lua Variables are available when Snort is run with
a lua config using -c option.</p></div>
<div class="ulist"><ul>
<li>
<p>
SNORT_VERSION: points to a string containing snort version and build as
follows:
</p>
<div class="literalblock">
<div class="content">
<pre><code>SNORT_VERSION = "3.0.2-x"</code></pre>
</div></div>
</li>
<li>
<p>
SNORT_MAJOR_VERSION: Snort version’s major
number.
</p>
<div class="literalblock">
<div class="content">
<pre><code>SNORT_MAJOR_VERSION = 3</code></pre>
</div></div>
</li>
<li>
<p>
SNORT_MINOR_VERSION: Snort version’s minor
number.
</p>
<div class="literalblock">
<div class="content">
<pre><code>SNORT_MINOR_VERSION = 0</code></pre>
</div></div>
</li>
<li>
<p>
SNORT_PATCH_VERSION: Snort version’s patch
number.
</p>
<div class="literalblock">
<div class="content">
<pre><code>SNORT_PATCH_VERSION = 2</code></pre>
</div></div>
</li>
<li>
<p>
SNORT_DEP_VERSIONS: Snort dependencies version numbers table.
If snort wasn’t built with some dependency, its value will be nil.
</p>
<div class="literalblock">
<div class="content">
<pre><code>SNORT_DEP_VERSIONS.DAQ = 3.0.7
SNORT_DEP_VERSIONS.LUAJIT = 2.1.0
SNORT_DEP_VERSIONS.OPENSSL = 3.0.5
SNORT_DEP_VERSIONS.LIBPCAP = 1.9.1
SNORT_DEP_VERSIONS.PCRE = 8.45
SNORT_DEP_VERSIONS.ZLIB = 1.2.11
SNORT_DEP_VERSIONS.HYPERSCAN = 5.4.8
SNORT_DEP_VERSIONS.LZMA = 5.0.5</code></pre>
</div></div>
</li>
</ul></div>
</div>
<div class="sect3">
<h4 id="_whitelist">Whitelist</h4>
<div class="paragraph"><p>When Snort is run with the --warn-conf-strict option, warnings will be
generated for all Lua tables present in the configuration files that do
not map to Snort module names. Like with other warnings, these will
upgraded to errors when Snort is run in pedantic mode.</p></div>
<div class="paragraph"><p>To dynamically add exceptions that should bypass this strict validation,
two Lua functions are made available to be called during the evaluation
of Snort configuration files: snort_whitelist_append() and
snort_whitelist_add_prefix(). Each function takes a whitespace-delimited
list, the former a list of exact table names and the latter a list of table
name prefixes to allow.</p></div>
<div class="paragraph"><p>Examples:
snort_whitelist_append("table1 table2")
snort_whitelist_add_prefix("local_ foobar_")</p></div>
<div class="paragraph"><p>The accumulated contents of the whitelist (both exact and prefix) will be
dumped when Snort is run in verbose mode (-v).</p></div>
</div>
<div class="sect3">
<h4 id="_rules">Rules</h4>
<div class="paragraph"><p>Rules determine what Snort is looking for.  They can be put directly in
your Lua configuration file with the ips module, on the command line with
--lua, or in external files.  Generally you will have many rules obtained
from various sources such as Talos and loading external files is the way to
go so we will summarize that here.  Add this to your Lua configuration:</p></div>
<div class="literalblock">
<div class="content">
<pre><code>ips = { include = 'rules.txt' }</code></pre>
</div></div>
<div class="paragraph"><p>to load the external rules file named rules.txt.  You can only specify
one file this way but rules files can include other rules files with the
include statement.  In addition you can load rules like:</p></div>
<div class="literalblock">
<div class="content">
<pre><code>$ sort -c snort.lua -R rules.txt</code></pre>
</div></div>
<div class="paragraph"><p>You can use both approaches together.</p></div>
</div>
<div class="sect3">
<h4 id="_includes">Includes</h4>
<div class="paragraph"><p>Your configuration file may include other files, either directly via Lua or via
various parameters. Snort will find relative includes in the following order:</p></div>
<div class="olist arabic"><ol class="arabic">
<li>
<p>
If you specify --include-path, this directory will be tried first.
</p>
</li>
<li>
<p>
Snort will try the directory containing the including file.
</p>
</li>
<li>
<p>
Snort will try the directory containing the -c configuration file.
</p>
</li>
<li>
<p>
Snort will try the current working directory.
</p>
</li>
</ol></div>
<div class="paragraph"><p>Some things to keep in mind:</p></div>
<div class="ulist"><ul>
<li>
<p>
If you use the Lua dofile function, then you must specify absolute paths
  or paths relative to your working directory since Lua will execute the
  include before Snort sees the file contents.
</p>
</li>
<li>
<p>
For best results, use include in place of dofile.  This function is
  provided to follow Snort’s include logic.
</p>
</li>
<li>
<p>
As of now, appid and reputation paths must be absolute or relative to the
  working directory.  These will be updated in a future release.
</p>
</li>
</ul></div>
</div>
<div class="sect3">
<h4 id="_converting_your_2_x_configuration">Converting Your 2.X Configuration</h4>
<div class="paragraph"><p>If you have a working 2.X configuration snort2lua makes it easy to get up
and running with Snort 3.  This tool will convert your configuration and/or
rules files automatically.  You will want to clean up the results and
double check that it is doing exactly what you need.</p></div>
<div class="literalblock">
<div class="content">
<pre><code>snort2lua -c snort.conf</code></pre>
</div></div>
<div class="paragraph"><p>The above command will generate snort.lua based on your 2.X configuration.
For more information and options for more sophisticated use cases, see the
Snort2Lua section later in the manual.</p></div>
</div>
</div>
<div class="sect2">
<h3 id="_output">Output</h3>
<div class="paragraph"><p>Snort can produce quite a lot of data.  In the following we will summarize
the key aspects of the core output types.  Additional data such as from
appid is covered later.</p></div>
<div class="sect3">
<h4 id="_basic_statistics">Basic Statistics</h4>
<div class="paragraph"><p>At shutdown, Snort will output various counts depending on configuration
and the traffic processed.  Generally, you may see:</p></div>
<div class="ulist"><ul>
<li>
<p>
Packet Statistics - this includes data from the DAQ and decoders such as
  the number of packets received and number of UDP packets.
</p>
</li>
<li>
<p>
Module Statistics - each module tracks activity via a set of peg counts
  that indicate how many times something was observed or performed.  This
  might include the number of HTTP GET requests processed and the number of
  TCP reset packets trimmed.
</p>
</li>
<li>
<p>
File Statistics - look here for a breakdown of file type, bytes,
  signatures.
</p>
</li>
<li>
<p>
Summary Statistics - this includes total runtime for packet processing
  and the packets per second.  Profiling data will appear here as well if
  configured.
</p>
</li>
</ul></div>
<div class="paragraph"><p>Note that only the non-zero counts are output.  Run this to see the
available counts:</p></div>
<div class="literalblock">
<div class="content">
<pre><code>$ snort --help-counts</code></pre>
</div></div>
</div>
<div class="sect3">
<h4 id="_alerts">Alerts</h4>
<div class="paragraph"><p>If you configured rules, you will need to configure alerts to see the
details of detection events.  Use the -A option like this:</p></div>
<div class="literalblock">
<div class="content">
<pre><code>$ snort -c snort.lua -r a.pcap -A cmg</code></pre>
</div></div>
<div class="paragraph"><p>There are many types of alert outputs possible.  Here is a brief list:</p></div>
<div class="ulist"><ul>
<li>
<p>
-A cmg is the same as -A fast -d -e and will show information about the
  alert along with packet headers and payload.
</p>
</li>
<li>
<p>
-A u2 is the same as -A unified2 and will log events and triggering
  packets in a binary file that you can feed to other tools for post
  processing.  Note that Snort 3 does not provide the raw packets for
  alerts on PDUs; you will get the actual buffer that alerted.
</p>
</li>
<li>
<p>
-A csv will output various fields in comma separated value format.  This
  is entirely customizable and very useful for pcap analysis.
</p>
</li>
</ul></div>
<div class="paragraph"><p>To see the available alert types, you can run this command:</p></div>
<div class="literalblock">
<div class="content">
<pre><code>$ snort --list-plugins | grep logger</code></pre>
</div></div>
</div>
<div class="sect3">
<h4 id="_files_and_paths">Files and Paths</h4>
<div class="paragraph"><p>Note that output is specific to each packet thread.  If you run 4 packet
threads with u2 output, you will get 4 different u2 files.  The basic
structure is:</p></div>
<div class="literalblock">
<div class="content">
<pre><code>&lt;logdir&gt;/[&lt;run_prefix&gt;][&lt;id#&gt;][&lt;X&gt;]&lt;name&gt;</code></pre>
</div></div>
<div class="paragraph"><p>where:</p></div>
<div class="ulist"><ul>
<li>
<p>
logdir is set with -l and defaults to ./
</p>
</li>
<li>
<p>
run_prefix is set with --run-prefix else not used
</p>
</li>
<li>
<p>
id# is the packet thread number that writes the file; with one packet
  thread, id# (zero) is omitted without --id-zero
</p>
</li>
<li>
<p>
X is / if you use --id-subdir, else _ if id# is used
</p>
</li>
<li>
<p>
name is based on module name that writes the file
</p>
</li>
</ul></div>
<div class="paragraph"><p>Additional considerations:</p></div>
<div class="ulist"><ul>
<li>
<p>
There is no way to explicitly configure a full path to avoid issues with
  multiple packet threads.
</p>
</li>
<li>
<p>
All text mode outputs default to stdout
</p>
</li>
</ul></div>
</div>
<div class="sect3">
<h4 id="_performance_statistics">Performance Statistics</h4>
<div class="paragraph"><p>Still more data is available beyond the above.</p></div>
<div class="ulist"><ul>
<li>
<p>
By configuring the perf_monitor module you can capture a configurable set
  of peg counts during runtime.  This is useful to feed to an external
  program so you can see what is happening without stopping Snort.
</p>
</li>
<li>
<p>
The profiler module allows you to track time and space used by module and
  rules.  Use this data to tune your system for best performance.  The
  output will show up under Summary Statistics at shutdown.
</p>
</li>
</ul></div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_concepts">Concepts</h2>
<div class="sectionbody">
<div class="paragraph"><p>This section provides background on essential aspects of Snort’s operation.</p></div>
<div class="sect2">
<h3 id="_terminology">Terminology</h3>
<div class="ulist"><ul>
<li>
<p>
<strong>basic module</strong>: a module integrated into Snort that does not come from a
  plugin.
</p>
</li>
<li>
<p>
<strong>binder</strong>: inspector that maps configuration to traffic
</p>
</li>
<li>
<p>
<strong>builtin rules</strong>: codec and inspector rules for anomalies detected
  internally.
</p>
</li>
<li>
<p>
<strong>codec</strong>: short for coder / decoder.  These plugins are used for basic
   protocol decoding, anomaly detection, and construction of active responses.
</p>
</li>
<li>
<p>
<strong>data module</strong>: an adjunct configuration plugin for use with certain inspectors.
</p>
</li>
<li>
<p>
<strong>dynamic rules</strong>: plugin rules loaded at runtime.  See SO rules.
</p>
</li>
<li>
<p>
<strong>fast pattern</strong>: the content in an IPS rule that must be found by the
  search engine in order for a rule to be evaluated.
</p>
</li>
<li>
<p>
<strong>fast pattern matcher</strong>: see search engine.
</p>
</li>
<li>
<p>
<strong>hex</strong>: a type of protocol magic that the wizard uses to identify binary
  protocols.
</p>
</li>
<li>
<p>
<strong>inspector</strong>: plugin that processes packets (similar to the Snort 2
  preprocessor)
</p>
</li>
<li>
<p>
<strong>IPS</strong>:  intrusion prevention system, like Snort.
</p>
</li>
<li>
<p>
<strong>IPS action</strong>: plugin that allows you to perform custom actions when
  events are generated.  Unlike loggers, these are invoked before
  thresholding and can be used to control external agents or send active
  responses.
</p>
</li>
<li>
<p>
<strong>IPS option</strong>: this plugin is the building blocks of IPS rules.
</p>
</li>
<li>
<p>
<strong>logger</strong>: a plugin that performs output of events and packets.  Events
  are thresholded before reaching loggers.
</p>
</li>
<li>
<p>
<strong>module</strong>: the user facing portion of a Snort component.  Modules chiefly
  provide configuration parameters, but may also provide commands, builtin
  rules, profiling statistics, peg counts, etc.  Note that not all modules
  are plugins and not all plugins have modules.
</p>
</li>
<li>
<p>
<strong>peg count</strong>: the number of times a given event or condition occurs.
</p>
</li>
<li>
<p>
<strong>plugin</strong>: one of several types of software components that can be loaded
  from a dynamic library when Snort starts up.  Some plugins are coupled
  with the main engine in such a way that they must be built statically,
  but a newer version can be loaded dynamically.
</p>
</li>
<li>
<p>
<strong>search engine</strong>: a plugin that performs multipattern searching of packets
  and payload to find rules that should be evaluated.  There are currently
  no specific modules, although there are several search engine plugins.
  Related configuration is done with the basic detection module.  Aka fast
  pattern matcher.
</p>
</li>
<li>
<p>
<strong>SO rule</strong>: a IPS rule plugin that performs custom detection that can’t
  be done by a text rule.  These rules typically do not have associated
  modules.  SO comes from shared object, meaning dynamic library.
</p>
</li>
<li>
<p>
<strong>spell</strong>: a type of protocol magic that the wizard uses to identify ASCII
  protocols.
</p>
</li>
<li>
<p>
<strong>text rule</strong>: a rule loaded from the configuration that has a header and
  body.  The header specifies action, protocol, source and destination IP
  addresses and ports, and direction.  The body specifies detection and
  non-detection options.
</p>
</li>
<li>
<p>
<strong>wizard</strong>: inspector that applies protocol magic to determine which
  inspectors should be bound to traffic absent a port specific binding.
  See hex and spell.
</p>
</li>
</ul></div>
</div>
<div class="sect2">
<h3 id="_modules">Modules</h3>
<div class="paragraph"><p>Modules are the building blocks of Snort.  They encapsulate the types of
data that many components need including parameters, peg counts, profiling,
builtin rules, and commands.  This allows Snort to handle them generically
and consistently.  You can learn quite a lot about any given module from
the command line.  For example, to see what stream_tcp is all about, do
this:</p></div>
<div class="literalblock">
<div class="content">
<pre><code>$ snort --help-module stream_tcp</code></pre>
</div></div>
<div class="paragraph"><p>Modules are configured using Lua tables with the same name.  So the
stream_tcp module is configured with defaults like this:</p></div>
<div class="literalblock">
<div class="content">
<pre><code>stream_tcp = { }</code></pre>
</div></div>
<div class="paragraph"><p>The earlier help output showed that the default session tracking timeout is
30 seconds.  To change that to 60 seconds, you can configure it this way:</p></div>
<div class="literalblock">
<div class="content">
<pre><code>stream_tcp = { session_timeout = 60 }</code></pre>
</div></div>
<div class="paragraph"><p>Or this way:</p></div>
<div class="literalblock">
<div class="content">
<pre><code>stream_tcp = { }
stream_tcp.session_timeout = 60</code></pre>
</div></div>
<div class="paragraph"><p>More on parameters is given in the next section.</p></div>
<div class="paragraph"><p>Other things to note about modules:</p></div>
<div class="ulist"><ul>
<li>
<p>
Shutdown output will show the non-zero peg counts for all modules.  For
  example, if stream_tcp did anything, you would see the number of sessions
  processed among other things.
</p>
</li>
<li>
<p>
Providing the builtin rules allows the documentation to include them
  automatically and also allows for autogenerating the rules at startup.
</p>
</li>
<li>
<p>
Only a few module provide commands at this point, most notably the snort
  module.
</p>
</li>
</ul></div>
</div>
<div class="sect2">
<h3 id="_parameters">Parameters</h3>
<div class="paragraph"><p>Parameters are given with this format:</p></div>
<div class="literalblock">
<div class="content">
<pre><code>type name = default: help { range }</code></pre>
</div></div>
<div class="paragraph"><p>The following types are used:</p></div>
<div class="ulist"><ul>
<li>
<p>
<strong>addr</strong>: any valid IP4 or IP6 address or CIDR
</p>
</li>
<li>
<p>
<strong>addr_list</strong>: a space separated list of addr values
</p>
</li>
<li>
<p>
<strong>bit_list</strong>: a list of consecutive integer values from 1 to the range
  maximum
</p>
</li>
<li>
<p>
<strong>bool</strong>: true or false
</p>
</li>
<li>
<p>
<strong>dynamic</strong>: a select type determined by loaded plugins
</p>
</li>
<li>
<p>
<strong>enum</strong>: a string selected from the given range
</p>
</li>
<li>
<p>
<strong>implied</strong>: an IPS rule option that takes no value but means true
</p>
</li>
<li>
<p>
<strong>int</strong>: a whole number in the given range
</p>
</li>
<li>
<p>
<strong>interval</strong>: a set of ints (see below)
</p>
</li>
<li>
<p>
<strong>ip4</strong>: an IP4 address or CIDR
</p>
</li>
<li>
<p>
<strong>mac</strong>: an ethernet address with the form 01:02:03:04:05:06
</p>
</li>
<li>
<p>
<strong>multi</strong>: one or more space separated strings from the given range
</p>
</li>
<li>
<p>
<strong>port</strong>: an int in the range 0:65535 indicating a TCP or UDP port number
</p>
</li>
<li>
<p>
<strong>real</strong>: a real number in the given range
</p>
</li>
<li>
<p>
<strong>select</strong>: a string selected from the given range
</p>
</li>
<li>
<p>
<strong>string</strong>: any string with no more than the given length, if any
</p>
</li>
</ul></div>
<div class="paragraph"><p>The parameter name may be adorned in various ways to indicate additional
information about the type and use of the parameter:</p></div>
<div class="ulist"><ul>
<li>
<p>
For Lua configuration (not IPS rules), if the name ends with [] it is
  a list item and can be repeated.
</p>
</li>
<li>
<p>
For IPS rules only, names starting with ~ indicate positional
  parameters.  The names of such parameters do not appear in the rule.
</p>
</li>
<li>
<p>
IPS rules may also have a wild card parameter, which is indicated by a
  *.  Used for unquoted, comma-separated lists such as service and metadata.
</p>
</li>
<li>
<p>
The snort module has command line options starting with a -.
  The options passed from command line override the options configured via
  snort module.
</p>
</li>
<li>
<p>
$ denotes variable names.
</p>
</li>
</ul></div>
<div class="paragraph"><p>Some additional details to note:</p></div>
<div class="ulist"><ul>
<li>
<p>
Table and variable names are case sensitive; use lower case only.
</p>
</li>
<li>
<p>
String values are case sensitive too; use lower case only.
</p>
</li>
<li>
<p>
Numeric ranges may be of the form low:high where low and high are
  bounds included in the range.  If either is omitted, there is no hard
  bound. E.g. 0: means any x where x &gt;= 0.
</p>
</li>
<li>
<p>
Strings may have a numeric range indicating a length limit; otherwise
  there is no hard limit.
</p>
</li>
<li>
<p>
bit_list is typically used to store a set of byte, port, or VLAN ID
  values.
</p>
</li>
<li>
<p>
interval takes the form [operator]i, j&lt;&gt;k, or j&lt;⇒k where i,j,k are
  integers and operator is one of =, !, != (same as !), &lt;, ⇐, &gt;, &gt;=.
  j&lt;&gt;k means j &lt; int &lt; k and j&lt;⇒k means j ⇐ int ⇐ k.
</p>
</li>
<li>
<p>
Ranges may use maxXX like { 1:max32 } since max32 is easier to read
  than 4294967295.  To get the values of maxXX, use snort --help-limits.
</p>
</li>
</ul></div>
<div class="paragraph"><p>Parameter limits:</p></div>
<div class="ulist"><ul>
<li>
<p>
max31 = 2147483647
</p>
</li>
<li>
<p>
max32 = 4294967295
</p>
</li>
<li>
<p>
max53 = 9007199254740992
</p>
</li>
<li>
<p>
maxSZ = 9007199254740992
</p>
</li>
<li>
<p>
max63 = 9223372036854775807
</p>
</li>
<li>
<p>
max64 = 18446744073709551615
</p>
</li>
</ul></div>
</div>
<div class="sect2">
<h3 id="_plugins">Plugins</h3>
<div class="paragraph"><p>Snort uses a variety of plugins to accomplish much of its processing
objectives, including:</p></div>
<div class="ulist"><ul>
<li>
<p>
Codec - to decode and encode packets
</p>
</li>
<li>
<p>
Inspector - like Snort 2 preprocessors, for normalization, etc.
</p>
</li>
<li>
<p>
IpsOption - for detection in Snort rules
</p>
</li>
<li>
<p>
IpsAction - for custom actions
</p>
</li>
<li>
<p>
Logger - for handling events
</p>
</li>
<li>
<p>
Mpse - for fast pattern matching
</p>
</li>
<li>
<p>
So - for dynamic rules
</p>
</li>
</ul></div>
<div class="paragraph"><p>The power of plugins is that they have a very focused purpose and can be
created with relative ease.  For example, you can extend the rule language
by writing your own IpsOption and it will plug in and function just like
existing options.  The extra directory has examples of each type of plugin.</p></div>
<div class="paragraph"><p>Most plugins can be built statically or dynamically.  By default they are
all static.  There is no difference in functionality between static or
dynamic plugins but the dynamic build generates a slightly lighter weight
binary.  Either way you can add dynamic plugins with --plugin-path and
newer versions will replace older versions, even when built statically.</p></div>
<div class="paragraph"><p>A single dynamic library may contain more than one plugin.  For example, an
inspector will typically be packaged together with any associated rule
options.</p></div>
</div>
<div class="sect2">
<h3 id="_operation">Operation</h3>
<div class="paragraph"><p>Snort is a signature-based IPS, which means that as it receives network
packets it reassembles and normalizes the content so that a set of rules
can be evaluated to detect the presence of any significant conditions that
merit further action.  A rough processing flow is as follows:</p></div>
<img alt="snort2x" src="data:image/png;base64,%0AiVBORw0KGgoAAAANSUhEUgAAAp0AAAA6CAIAAAB9MXUWAAAAA3NCSVQICAjb4U/gAAAACXBIWXMAAAfQ%0AAAAH0AG5i+efAAAXWUlEQVR4nO3deVQTxx8A8MlyVbEgooAQKQIiVEFJlcNftaUtR9+rRxEPqj4Elcqj%0AiPoUxYO2EbSiYkFtrQqiaNV699FnqUXFowiiQChQKCJRQMCjHqVACMnvj7HbGDawhN1sgt/PX3Gd7H4z%0ATOa72Z2ZRXLAkLa2NvTKCA8P12TdHj58mOtPzJmEhASN1XNZWRnXH1ejkpKSNFa3pEuXLnH9uTVn//79%0Amq9hoM/1370P6tevH9chsKijo0MikXByaD09PUNDQ04OzQmpVNre3q754xIEYWRkpPnjalJ7e7tUKuUw%0AgD5fyZzX8KsM8jrDTExMnj59ynUULDp48GBISAgnhw4JCUlNTeXk0JyIj49fv3695o87duzYmzdvav64%0AmrR27dqNGzdyGICfn9+5c+c4DIBtERERu3fv5jqKVxTBdQAAAAAAYAzkdQAAAKDvgLwOAAAA9B2Q1wEA%0AAIC+A/I6AAAA0Hd0NR5eJpNdu3YtPz9fJBJp1YwFa2vrN99809vb29nZmetYAAAA6AC5XH716tXCwsLC%0AwkKuJut2gSAIR0dHFxeXCRMm8Pn83uyKOq+3t7enp6dv2LDh3r17vdk726ZMmSIUCseMGcN1IAAAALRU%0Aa2trWlraV199peUZDTMwMJg3b15sbKyjo6N6e6DI648ePfL398cTWN966y0fH59x48Zpz3ogcrm8pqbm%0Axo0bJ0+e/PHHHzMzMzdv3rxixQqu4wIAAKB1ampqAgICKioqEEICgeCdd94ZP378a6+9xnVcyjo6OsrK%0AykQi0enTp9PS0jIyMvbs2TN//nw1dqWc12tqavz9/SsrK0eMGJGUlPTRRx8xEC87mpubY2Njd+7cuXLl%0AyoaGhi1btvB4PK6DAgAAoC1yc3OnTZvW1NTk5ua2efPmgIAAriPq3sOHD1evXp2amhoaGlpeXr5p0yaC%0A6NlIuJdK//33376+vpWVld7e3tevX9fmpI4QMjY2TklJOXPmTL9+/bZt27Zp0yauIwIAAKAtKioq/Pz8%0Ampqapk+fnpubqxNJHSE0ePDgffv2HT169LXXXktMTPz88897uoeX8vpnn31WVVXl4eFx+fLlQYMGMRcn%0Ai6ZMmfLLL78QBPH555/n5uZyHQ4AAADuNTc3BwUF/f3335988snx48f79+/PdUQ9M2vWrOzsbH19/Y0b%0AN/788889eu9/ef3cuXMHDhwwNTU9cuSIvr4urRv/9ttvx8XFSaXSOXPmaNW4fQAAAJyIjo7+/fff3d3d%0AU1NTdfQW7YQJE7Zt2yaTyYKCghobG+m/8UVe7+joiI6ORgilpKTY29uzEiOb1q9fLxAI7ty5s2PHDq5j%0AAQAAwCWRSLR//35jY+Off/5ZC4fI0bdkyRJfX9/m5ub4+Hj673qR148cOfLnn3+6urrOnTuXnfDYRRDE%0A1q1bEUJbtmxpaWnhOhygS3j/srKyCgkJefToEdcRAQB6JS4uTiaTLVmyxMLCgutYeuvbb781MDDYs2eP%0AWCym+ZYXeR2fC6xbt66n4+60h4+Pz8SJE+/fv5+WlsZ1LEDHyOVyuVx+8+bNlpaWJUuWcB0OAEB9v//+%0A+9mzZwcOHLhy5UquY2GAg4NDWFiYRCJJSEig+RYCIVRQUFBRUWFnZzdjxgw2w2NdTEwMQujQoUNcBwJ0%0Ako2Nzc6dO7OyshBCPB5v+/btw4YNw2e6MpksPj5++PDhgwYNCgsLa25u5jpYAAC17777DiEUGRlpZmbG%0AdSzMWLduHY/HO3bsGM2r0QRC6OTJkwihmTNn6ujgApKfn9/AgQPz8vJqa2u5jgXovJycnLy8PJlMhhD6%0A+uuvL126dOHChdu3b7e3t8fFxXEdHQCAQkdHx4kTJxBCc+bM4ToWxvD5/EmTJj179uzcuXN0yhMIoVOn%0ATiGEAgMD2Q2NfYaGhh999JFcLj99+jTXsQDdU19fHx0d7evri/+ZnJxsbW2NX+/du3fXrl3Dhw83MzPb%0AunUrPhUGAGibnJychoYGNzc3FxcXrmNh0qxZsxBCR48epVOYEIvFlZWVlpaWHh4eLAemCdOmTUMInT9/%0AnutAgC7B4+bc3d319PRSUlLwRltbW7KAWCx2dnYmh9eRq0yTY+44CBoA0Ame6q3r95Q7mz59OkIoKytL%0ALpd3W5goLi5GCHl5eWmyb2LvWPjsBH8oxv3www906lRraW36efjwYUNDA4cB4HFzjY2Nhw4dGjJkCN6o%0AWF22trZ37tyR/6ujo0PxjTrUKtLT07kOoY9ra2ujP24Z9Eh1dfXjx4+7LnPr1i2EkJeXl0YiUsZeH2th%0AYeHo6Pjs2bPbt293W5goKipCCPWZR6INGzZs0KBBd+/e7fbPrwahUDh69OijR4/ie66AKQ8ePLC2tg4M%0ADMStUQtFREQsWrSovLxcIpGUlJTMnj2b64jUFBERMWHCBDw2ELChra3Nzs7O19f36tWrXMfS11RVVVla%0AWoaGhlZVVVEWkMvlhYWFCCGBQKDZ0JSxkeDd3d3RvycuXXvxe71HeV2T833VqB38WVj6yV5WVhYcHOzq%0A6spIdsfVSBCEqampu7v76tWrHzx4wEicOgePihAIBNqZ3aOioqZMmRIYGGhiYjJnzpzg4GCuI1IfXiib%0AjeyuRnvuTfentdefEEK//vrrxIkTNZzdtblCmCKVStPT011cXCizu1gsfvz4sZ2dHf110IcOHdra2qq0%0A8cmTJ25ubn/99ZfacXZ7DU+NPxY+WaGV1/Gdwp4+51Wb5/viz8Lqc3YZzO5yuVwmk9XX16elpbW0tIwd%0AO7ampoahMHUPJ9md8huotJEgiKioqPLy8tbWVpFINHXqVM3Exh6Wsju0Z0WcZPdXgarsfvfuXYSQk5MT%0A/V29/fbb+/fvV9q4e/duT09PbZsmhz8X/oxdI54+fYoQGjhwoBqHUZzvW1lZGRQUZG5ubmpqGhgY+PDh%0AQ1xGKpXGxcW98cYbZmZm27ZtU9rDzZs3+Xx+cnIy5fxgfEbT03FJ+LPgz8UqBrO7sbGxu7t7cnLyggUL%0A1q9fjzdS1gllfba1tS1dutTKysrKymrp0qVtbW14u0QiiYyMNDc3t7Ky2rJlC3k4LZ+NreW/3fsSlrI7%0Azfbc+QuuqmV2bvbqdQ6c4Da7q+oc2traIiIicOeQmJio/dXYWefsjn9h9yidxcbGJiUlKXbgEolk165d%0AK1euVJWVFFe2UNXHKtYnU60Xn2c8efKk25IELmRqakp/75RmzJgRGRlZW1t79+5dGxub2NhYvH3z5s1X%0Arly5cOFCdXW10rTyzMzMDz/8cNeuXdHR0ZTzg/Fvpp6OS8Kfhc6HZwSZ3X/44Yfe723hwoW//vorfk1Z%0AJ5T1mZCQUFpaWlBQUFBQIBKJNm7ciLdv3LixsrJSJBIVFBQoTnzUidnYitkdBiKxiszu165dY3bPXbfn%0Azl9wVS2zc7NXr3PgEJndS0pKNHlcVZ1DfHy8WCwuKSm5detWdna2JkNilmJ2r6ysRP/mP5oEAoG9vb3i%0AzNUjR454eHg4OTmpao2KK1uo6mMVMdV68fkKrdRmZGREEERHR4ecNjKgurq62bNnz549W6nA06dP+Xw+%0Afu3o6FhSUtJ5Dzt37rS2ts7Pz8dbnJ2d//jjD/y6oaHhjTfeUDoWfTt37kQI4ft8zKJT9f369aNfmZ0/%0AnUQiMTAw6KJOKOvT3t6+tLQUvy4pKXFwcMCvHRwcFLeTh1NV23QcOHCAjertulbxWe20adPox9kHbNiw%0AgfGqptOGHR0d1QtYjfas9BZVLVNVN6JenHK5fM2aNSz1EjQr2dPTU+3gVaGsEFWdg729fXl5OX5dWlra%0Am8qktHjxYsZruNtft7hAeHh4j0K9ePHi+PHjyX+6urrm5eXJVbfYmpoasrCqPlaxPplqvdXV1QghZ2fn%0Abkuq+TxWXH0WFha+vr7bt29HCBUUFKxataqwsBBfCdHT08Mla2trKW/eJyUlhYSEjB8/Hv8Tzw8m/5fm%0Ad6MLBEEw/rRZiUQiZ/nHwf379wcPHoxfU9YJZX3W19eTT+FzdHSsq6vDr+vq6hS3k+V7X9vMVq9cLpdI%0AJN0W08VLhb2np6dHfpt6j7wM2wUG67nb9qxEVRlV3UgvMVu3JA1XctdUdQ719fXDhw/Hr9l7hiezNSyT%0Aydrb27st1tMO7d1339XT07t48aKPj09WVpa5uTmeL62qNSqubKGqj1XEbOul03KIgQMHymSy58+f92jX%0A+KRAcb7v7NmzQ0JCqqqqpFLpo0ePyAm+w4YNo5yTkJOTc/z4cfKGhKr5wWq0fnyZ4osvvmhl2ptvvqnq%0AoK6urkeOHEEIGRgY9OakZN++fR988AF+TVknlPVpbW2NT+UQQlVVVTY2Nvi1jY0NuV1x1qOq2qZvwYIF%0ADFZsFzfRCYKYOXPmV199hXp4ea3P+PLLLxms6i6eWTlx4kQ8gOj1119nKvhu27PSF1xVy6Rs9r1PjYmJ%0AiQzWLdbU1NTFEQMCAr755huk7pAmNajqHKytre/cuYNfkwUYt3fvXgbrNjMzU9WBDAwMFi5cmJiYiBBS%0AY7RTbGwsfu/WrVtXrVqFN9LJSqr6WEVMtV6c2ui0HALfje79KLPm5mYTExNjY2OxWBweHk5unz9/flRU%0AVHV19V9//bVs2TJyO5/Pz8nJSU1N3bRpE1I9P3jw4MHl5eU9igR/lt6PGKDJ1dX1+PHjRUVFvVmI959/%0A/iksLFy6dGlqaqpQKMQbKeuEsj6Dg4Ojo6Nra2tra2ujo6PJWViffPLJsmXL6urq6urqli5dSh5OJ2Zj%0A44xeXFx87NgxPp/PdTh92cSJE7Ozsy9fvuzp6cnIDum3Z6UvuKqWSdns1egcOBQQEJCbm3vu3Lkufh6w%0AQVXnEBwcvHz58vr6+vr6+uXLl2syJGbhjF5RUbF37148YlyNwVWTJ0+ura3NyMh48OBBQEAA3kinn1TV%0AxypiqvXSz+v/LdBG/yo/orox8NNPP40cOdLAwMDW1havxIm3SySSNWvW8Pl8MzOzpKQkpT3cv3/fxcVF%0AKBR2dHSkpKQ4OzsbGRm5urqeOXMGF9i2bRv+GPTDW7RoEULowIED9N9C06hRoxSrDmd08m46vvhmYmJC%0Af4d4Pzweb8CAAWPGjImJiWlsbCT/l7JOKOuzpaUlKirK0tLS0tIyKiqqpaUFb29tbV28eLGZmZmFhQU+%0AG+1izzTh++s9vYPVtbKyMsWKxRld8Y7U4cOHEUJhYWEMHlT74fvrCQkJDO5T6fc6zujk/+I/hEAgUG/n%0AarRnpS+4qpZJ2ezV6BxI+P46uSsGdf6NhDM6WeDSpUt4I+OH7ty9y1V3Di0tLeHh4bhzEAqF5DAIpuD7%0A6/v372dwn0qzNnBGr66uJgvk5OQghHx9fdXYeUZGhr6+/qFDh8gtlK1Rqb2p6mMVizHVevHgvuDg4G5L%0Avlh19uTJk/T3ruV8fHwQQhcvXmR8z2ReV8romBp5XRexmtc7Z3QM8jpTyLyulNGxXuZ1HaKZvK6U0TH2%0A8rraiouLhw8fzuw+Wc3rnTM6hu8s9GggsA7B17ZXr17dbUkCr87Wl2YJ45Xm3Nzc2Ng5edU9KCio94P7%0AAEnxqvvo0aOZ2i2Px0tMTLS0tDQ3N//ss8/I0XlKk1BVzfGlXC2AclZrdna2QCDo16+fnZ3dvn37cEnK%0AjZwjr7q/9957XMfSZ5FX3blaqJyOZcuWNTQ0iMXi5cuX4ydmaT/Fq+7kuD+SnZ2dubm5WCxmdRVUruCV%0A5ugskUuwuuqq5uGV4W1tbemvI0jfl19+WVxcDBmdcUOGDLl//z6zGZ10/vz5W7duiUSiiooKfMKLKU5C%0AVTXHl3K1AMpZrfPmzVu7du2TJ08uX758/fp1XJJyI7f27NkDGZ1VRkZG9+7d0/KMjtnZ2Y0fP97Dw8Pe%0A3j4+Pp7rcLrn5OTU1NREmdFJ9BdR1zk9yOtjx45FCF2/fl2uI8s7dC0/Px8hhD8U46ZPn/5qTrVi2+DB%0Agy0sLFjaeXJyso2NjY2Nzddff52RkaG4nXy8+uHDh5OTk/l8Pp/PT0lJwZf9EULp6ek7duxwcHAwMzPD%0A8zmRimex6+vr19fXNzU12drakj/NKTdya968eVyH0McZGRnpyjDP6Ojoe/fuNTY27tmzp3///lyH0z07%0AO7tuR43htJebm6uRiDSnsbHx9u3bpqamdCYlEra2tiNHjmxqasrLy9NAcGw7c+YMQsjX15frQIC2IL8G%0ADg4O5ORd9PIkVFVzfCknnlI+i/3MmTMXLlxwd3d3cnIil52i3AgAYA8ezX7ixAmuA2EY/kQBAQG05q8j%0A9N/QObYjY1tbW1tmZiZBEB9//DHXsQBtQc4ura6uJifvopfnj6qa40s58ZRyVqtAIDh9+vSDBw+2b98e%0AFhaGS1JuBACwZ9KkSUOHDi0pKVGaZaPrjh07hhCaNWsWncL/5fXjx4/r+qX4rKysp0+fenl5KXbf4BVH%0Azi5dtmzZnDlzKMuomuNLOfGUclZrcHBwWVkZXgyLHH5BuREAwB49Pb0ZM2YghA4dOsR1LIy5d+/e1atX%0ATUxMPvzwQzrlCYSQQCBwcXERi8X4jEB34emDc+fO5ToQoEXef/99gUDg6urq4OCAZzd1tm7dOhcXl3Hj%0Axo0bN27UqFFr167F21euXDlhwoR33nnHwcGBvG5P+Sz2qVOnBgYGmpqarl+/nuxQKDcCAFgVHh7O4/G+%0A+eabx48fcx0LM4RCoVwuDw4O7mK9yJfga4l4oNCoUaN69AAYrYIfG2VtbU0uvKBhMH+dPWrPX0dMP81C%0Ak9iYv941mL+uAVo4f50NbMxfpw/fil21ahUnR2dWZWWlvr6+kZGRWCym+ZYX1wZnzZo1cuTI0tLSgwcP%0AMnuioRkymWzFihUIoZiYGLpnNAAAAPoioVBIEMSOHTsaGhq4jqW3IiIipFLpp59+qjjUt2sv8rqenh5e%0A/HXJkiWUj2nRcl988UVRUZGDg0NkZCTXsQAAAODS6NGjFy5c+M8//wQEBLS0tHAdjvqSkpKys7MHDBhA%0A3hyk47+xPH5+fmFhYc+fPw8ODpZKpSxEyJbLly8nJCQYGBh8//33jD+bFeg0uY4PBQUAqGf79u1ubm7F%0AxcWhoaE62g9cuXIlJiaGIIiTJ0/2aIWPl8bopqSkODk5FRQU/O9//3v48CHTQbLi1KlT/v7+Mplsw4YN%0A+Bk2AAAAXnH9+/c/ceKEiYnJsWPHPv74Y7zesw45fPiwr69vR0dHXFycn59fj977Ul43NjY+f/68i4tL%0Afn6+p6fn6dOntfk05/nz55GRkUFBQa2tratXr46JieE6IgAAANpixIgR58+ft7KyOnv2rKenZ2ZmpjZn%0ANFJTU1NoaOjcuXPb2trWrFmDV6ruEeWr1ra2tteuXfP3979x40ZgYOCYMWN8fHzGjRtnYGDAUMwMqKmp%0Ayc/PP3v2rFQqJQhi9+7dik98BwAAABBCHh4e+fn5/v7+paWlkydPdnNzmzRpkoeHh5GREdehKZPJZGVl%0AZcXFxZmZmTKZzNDQMC0tTdWSG12juBttZmb222+/ZWRkCIXC4uJirX0kDI/HCwwMFAqFSo9FBwAAALBh%0Aw4YVFRWlp6dv2rRJJBKJRCKuI+qGoaHh/PnzY2Nj7ezs1NsD9SgzfX390NDQ+fPnX79+/caNGyKRSKtG%0A0g0dOnTUqFFeXl6d1+4GAAAAFBkaGoaHhy9atCgvL+/WrVtFRUXkI5u1B4/Hc3R0dHFx8fb2Hjp0aG92%0A1dXocR6P5+3t7e3t3ZsDAAAAAJzj8XheXl7a//zc3oM1qwEAAIC+A/I6AAAA0HdAXgcAAAD6DsjrAAAA%0AQN8BeR0AAADoO2A1dYY9e/ZMq9bwYRyHCzalp6fr6PMG1SOTyTg5bmFhYd9uw4i7uiVlZWX17UrmvIZf%0AZZDXmfQqPHWGx+Pp6+vr6elp8qAEQbwKdauE+JfGjoj/uBo7HIc0X7ekV6SSOaxh8H9ZpgkclhMrzwAA%0AAABJRU5ErkJggg==">
<div class="paragraph"><p>The steps are:</p></div>
<div class="olist arabic"><ol class="arabic">
<li>
<p>
Decode each packet to determine the basic network characteristics such
as source and destination addresses and ports.  A typical packet might have
ethernet containing IP containing TCP containing HTTP (ie eth:ip:tcp:http).
The various encapsulating protocols are examined for sanity and anomalies
as the packet is decoded.  This is essentially a stateless effort.
</p>
</li>
<li>
<p>
Preprocess each decoded packet using accumulated state to determine the
purpose and content of the innermost message.  This step may involve
reordering and reassembling IP fragments and TCP segments to produce the
original application protocol data unit (PDU).  Such PDUs are analyzed and
normalized as needed to support further processing.
</p>
</li>
<li>
<p>
Detection is a two step process.  For efficiency, most rules contain a
specific content pattern that can be searched for such that if no match is
found no further processing is necessary.  Upon start up, the rules are
compiled into pattern groups such that a single, parallel search can be
done for all patterns in the group.  If any match is found, the full rule
is examined according to the specifics of the signature.
</p>
</li>
<li>
<p>
The logging step is where Snort saves any pertinent information
resulting from the earlier steps.  More generally, this is where other
actions can be taken as well such as blocking the packet.
</p>
</li>
</ol></div>
<div class="sect3">
<h4 id="_snort_2_processing">Snort 2 Processing</h4>
<div class="paragraph"><p>The preprocess step in Snort 2 is highly configurable.  Arbitrary
preprocessors can be loaded dynamically at startup, configured in
snort.conf, and then executed at runtime.  Basically, the preprocessors are
put into a list which is iterated for each packet.  Recent versions have
tweaked the list handling some, but the same basic architecture has allowed
Snort 2 to grow from a sniffer, with no preprocessing, to a full-fledged
IPS, with lots of preprocessing.</p></div>
<div class="paragraph"><p>While this "list of plugins" approach has considerable flexibility, it
hampers future development when the flow of data from one preprocessor to
the next depends on traffic conditions, a common situation with advanced
features like application identification.  In this case, a preprocessor
like HTTP may be extracting and normalizing data that ultimately is not
used, or appID may be repeatedly checking for data that is just not
available.</p></div>
<div class="paragraph"><p>Callbacks help break out of the preprocess straitjacket.  This is where one
preprocessor supplies another with a function to call when certain data is
available.  Snort has started to take this approach to pass some HTTP and
SIP preprocessor data to appID.  However, it remains a peripheral feature
and still requires the production of data that may not be consumed.</p></div>
</div>
<div class="sect3">
<h4 id="_snort_3_processing">Snort 3 Processing</h4>
<div class="paragraph"><p>One of the goals of Snort 3 is to provide a more flexible framework for
packet processing by implementing an event-driven approach.  Another is to
produce data only when needed to minimize expensive normalizations.
However, the basic packet processing provides very similar functionality.</p></div>
<div class="paragraph"><p>The basic processing steps Snort 3 takes are similar to Snort 2 as seen
in the following diagram.  The preprocess step employs specific inspector
types instead of a generalized list, but the basic procedure includes
stateless packet decoding, TCP stream reassembly, and service specific
analysis in both cases.  (Snort 3 provides hooks for arbitrary inspectors,
but they are not central to basic flow processing and are not shown.)</p></div>
<img alt="snort3x" src="data:image/png;base64,%0A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" data-xblocker="passed" style="visibility: visible;">
<div class="paragraph"><p>However, Snort 3 also provides a more flexible mechanism than callback
functions.  By using inspection events, it is possible for an inspector to
supply data that other inspectors can process.  This is known as the
observer pattern or publish-subscribe pattern.</p></div>
<div class="paragraph"><p>Note that the data is not actually published.  Instead, access to the data
is published, and that means that subscribers can access the raw or
normalized version(s) as needed.  Normalizations are done only on the first
access, and subsequent accesses get the previously normalized data.  This
results in just in time (JIT) processing.</p></div>
<div class="paragraph"><p>A basic example of this in action is provided by the extra data_log plugin.
It is a passive inspector, ie it does nothing until it receives the data it
subscribed for (<em>other</em> in the above diagram).  By adding the following to
your snort.lua configuration, you will get a simple URI logger.</p></div>
<div class="literalblock">
<div class="content">
<pre><code>data_log = { key = 'http_raw_uri' }</code></pre>
</div></div>
<div class="paragraph"><p>Inspection events coupled with pluggable inspectors provide a very flexible
framework for implementing new features.  And JIT buffer stuffers allow
Snort to work smarter, not harder.  These capabilities will be leveraged
more and more as Snort development continues.</p></div>
</div>
</div>
<div class="sect2">
<h3 id="_rules_2">Rules</h3>
<div class="paragraph"><p>Rules tell Snort how to detect interesting conditions, such as an attack,
and what to do when the condition is detected.  Here is an example rule:</p></div>
<div class="literalblock">
<div class="content">
<pre><code>alert tcp any any -&gt; 192.168.1.1 80 ( msg:"A ha!"; content:"attack"; sid:1; )</code></pre>
</div></div>
<div class="paragraph"><p>The structure is:</p></div>
<div class="literalblock">
<div class="content">
<pre><code>action proto source dir dest ( body )</code></pre>
</div></div>
<div class="paragraph"><p>Where:</p></div>
<div class="paragraph"><p>action - tells Snort what to do when a rule "fires", ie when the signature
matches.  In this case Snort will log the event.  It can also do thing like
block the flow when running inline.</p></div>
<div class="paragraph"><p>proto - tells Snort what protocol applies.  This may be ip, icmp, tcp, udp,
http, etc.</p></div>
<div class="paragraph"><p>source - specifies the sending IP address and port, either of which can be
the keyword any, which is a wildcard.</p></div>
<div class="paragraph"><p>dir - must be either unidirectional as above or bidirectional indicated by
&lt;&gt;.</p></div>
<div class="paragraph"><p>dest - similar to source but indicates the receiving end.</p></div>
<div class="paragraph"><p>body - detection and other information contained in parenthesis.</p></div>
<div class="paragraph"><p>There are many rule options available to construct as sophisticated a
signature as needed.  In this case we are simply looking for the "attack"
in any TCP packet.  A better rule might look like this:</p></div>
<div class="literalblock">
<div class="content">
<pre><code>alert http
(
    msg:"Gotcha!";
    flow:established, to_server;
    http_uri:"attack";
    sid:2;
)</code></pre>
</div></div>
<div class="paragraph"><p>Note that these examples have a sid option, which indicates the signature
ID.  In general rules are specified by gid:sid:rev notation, where gid is
the generator ID and rev is the revision of the rule.  By default, text
rules are gid 1 and shared-object (SO) rules are gid 3.  The various
components within Snort that generate events have 1XX gids, for example the
decoder is gid 116.  You can list the internal gids and sids with these
commands:</p></div>
<div class="literalblock">
<div class="content">
<pre><code>$ snort --list-gids
$ snort --list-builtin</code></pre>
</div></div>
<div class="paragraph"><p>For details on these and other options, see the reference section.</p></div>
</div>
<div class="sect2">
<h3 id="_pattern_matching">Pattern Matching</h3>
<div class="paragraph"><p>Snort evaluates rules in a two-step process which includes a fast pattern
search and full evaluation of the signature.  More details on this process
follow.</p></div>
<div class="sect3">
<h4 id="_rule_groups">Rule Groups</h4>
<div class="paragraph"><p>When Snort starts or reloads configuration, rules are grouped by protocol,
port and service.  For example, all TCP rules using the HTTP_PORTS variable
will go in one group and all service HTTP rules will go in another group.
These rule groups are compiled into multipattern search engines (MPSE)
which are designed to search for all patterns with just a single pass
through a given packet or buffer.  You can select the algorithm to use for
fast pattern searches with search_engine.search_method which defaults to
<em>ac_bnfa</em>, which balances speed and memory.  For a faster search at the
expense of significantly more memory, use <em>ac_full</em>.  For best performance
and reasonable memory, download the hyperscan source from Intel.</p></div>
</div>
<div class="sect3">
<h4 id="_fast_patterns">Fast Patterns</h4>
<div class="paragraph"><p>Fast patterns are content strings that have the fast_pattern option or
which have been selected by Snort automatically to be used as a fast
pattern.  Snort will by default choose the longest pattern in the rule
since that is likely to be most unique.  That is not always the case so add
fast_pattern to the appropriate content or regex option for best performance.  The
ideal fast pattern is one which, if found, is very likely to result in a
rule match.  Fast patterns that match frequently for unrelated traffic will
cause Snort to work hard with little to show for it.</p></div>
<div class="paragraph"><p>Certain contents are not eligible to be used as fast patterns.
Specifically, if a content is negated, then if it is also relative to
another content, case sensitive, or has non-zero offset or depth, then it
is not eligible to be used as a fast pattern.</p></div>
</div>
<div class="sect3">
<h4 id="_rule_evaluation">Rule Evaluation</h4>
<div class="paragraph"><p>For each fast pattern match, the corresponding rule(s) are evaluated
left-to-right.  Rule evaluation requires checking each detection option in
a rule and is a fairly costly process which is why fast patterns are so
important.  Rule evaluation aborts on the first non-matching option.</p></div>
<div class="paragraph"><p>When rule evaluation takes place, the fast pattern match will automatically
be skipped if possible.  Note that this differs from Snort 2 which provided
the fast_pattern:only option to designate such cases.  This is one less
thing for the rule writer to worry about.</p></div>
<div class="sect4">
<h5 id="_stateful_evaluation">Stateful Evaluation</h5>
<div class="paragraph"><p>When data forms a kind of stream, e.g. contiguous byte flow (like a file
transferred over the network or byte sequence from TCP session packets),
the point of interest may be in a signature which spans across packets (its
parts lies in different data blocks). In this case, the stateful evaluation
becomes handy.</p></div>
<div class="paragraph"><p>If rule evaluation starts in a packet and the cursor position is moved beyond
the current packet boundary, then the evaluation gets paused and will resume
later when more data become available to finish the process.</p></div>
<div class="paragraph"><p>Stateful evaluation is supported for the following buffers:</p></div>
<div class="olist arabic"><ol class="arabic">
<li>
<p>
pkt_data — as a sequence of TCP session bytes with respect to their
 direction (client-to-server, server-to-client)
</p>
</li>
<li>
<p>
js_data — normalized JavaScript text from the same data transfer session
</p>
</li>
<li>
<p>
file_data — the same file bytes, e.g. flows from different files do not
 overlap
</p>
</li>
</ol></div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_tutorial">Tutorial</h2>
<div class="sectionbody">
<div class="paragraph"><p>The section will walk you through building and running Snort.  It is not
exhaustive but, once you master this material, you should be able to figure
out more advanced usage.</p></div>
<div class="sect2">
<h3 id="_dependencies">Dependencies</h3>
<div class="paragraph"><p>Required:</p></div>
<div class="ulist"><ul>
<li>
<p>
a compiler that supports the C++14 feature set
</p>
</li>
<li>
<p>
cmake to build from source
</p>
</li>
<li>
<p>
daq from <a href="https://github.com/snort3/libdaq">https://github.com/snort3/libdaq</a> for packet IO
</p>
</li>
<li>
<p>
dnet from <a href="https://github.com/dugsong/libdnet.git">https://github.com/dugsong/libdnet.git</a> for network utility
  functions
</p>
</li>
<li>
<p>
hwloc from <a href="https://www.open-mpi.org/projects/hwloc/">https://www.open-mpi.org/projects/hwloc/</a> for CPU affinity
  management
</p>
</li>
<li>
<p>
LuaJIT from <a href="http://luajit.org/">http://luajit.org</a> for configuration and scripting
</p>
</li>
<li>
<p>
OpenSSL from <a href="https://www.openssl.org/source/">https://www.openssl.org/source/</a> for SHA and MD5 file signatures,
  the protected_content rule option, and SSL service detection
</p>
</li>
<li>
<p>
pcap from <a href="http://www.tcpdump.org/">http://www.tcpdump.org</a> for tcpdump style logging
</p>
</li>
<li>
<p>
pcre from <a href="http://www.pcre.org/">http://www.pcre.org</a> for regular expression pattern matching
</p>
</li>
<li>
<p>
pkgconfig from <a href="https://www.freedesktop.org/wiki/Software/pkg-config/">https://www.freedesktop.org/wiki/Software/pkg-config/</a> to locate
  build dependencies
</p>
</li>
<li>
<p>
zlib from <a href="http://www.zlib.net/">http://www.zlib.net</a> for decompression (&gt;= 1.2.8 recommended)
</p>
</li>
</ul></div>
<div class="paragraph"><p>Optional:</p></div>
<div class="ulist"><ul>
<li>
<p>
asciidoc from <a href="http://www.methods.co.nz/asciidoc/">http://www.methods.co.nz/asciidoc/</a> to build the HTML
  manual
</p>
</li>
<li>
<p>
cpputest from <a href="http://cpputest.github.io/">http://cpputest.github.io</a> to run additional unit tests with
  make check
</p>
</li>
<li>
<p>
dblatex from <a href="http://dblatex.sourceforge.net/">http://dblatex.sourceforge.net</a> to build the pdf manual (in
  addition to asciidoc)
</p>
</li>
<li>
<p>
hyperscan &gt;= 4.4.0 from <a href="https://github.com/01org/hyperscan">https://github.com/01org/hyperscan</a> to build new
  the regex and sd_pattern rule options and hyperscan search engine.
  Hyperscan is large so it recommended to follow their instructions for
  building it as a shared library.
</p>
</li>
<li>
<p>
iconv from <a href="https://ftp.gnu.org/pub/gnu/libiconv/">https://ftp.gnu.org/pub/gnu/libiconv/</a> for converting
  UTF16-LE filenames to UTF8 (usually included in glibc)
</p>
</li>
<li>
<p>
libunwind from <a href="https://www.nongnu.org/libunwind/">https://www.nongnu.org/libunwind/</a> to attempt to dump a
  somewhat readable backtrace when a fatal signal is received
</p>
</li>
<li>
<p>
lzma &gt;= 5.1.2 from <a href="http://tukaani.org/xz/">http://tukaani.org/xz/</a> for decompression of SWF and
  PDF files
</p>
</li>
<li>
<p>
safec &gt;= 3.5 from <a href="https://github.com/rurban/safeclib/">https://github.com/rurban/safeclib/</a> for runtime bounds
  checks on certain legacy C-library calls
</p>
</li>
<li>
<p>
source-highlight from <a href="http://www.gnu.org/software/src-highlite/">http://www.gnu.org/software/src-highlite/</a> to
  generate the dev guide
</p>
</li>
<li>
<p>
w3m from <a href="http://sourceforge.net/projects/w3m/">http://sourceforge.net/projects/w3m/</a> to build the plain text
  manual
</p>
</li>
<li>
<p>
uuid from uuid-dev package for unique identifiers
</p>
</li>
</ul></div>
</div>
<div class="sect2">
<h3 id="_building">Building</h3>
<div class="ulist"><ul>
<li>
<p>
Optionally built features are listed in the reference section.
</p>
</li>
<li>
<p>
Create an install path:
</p>
<div class="literalblock">
<div class="content">
<pre><code>export my_path=/path/to/snorty
mkdir -p $my_path</code></pre>
</div></div>
</li>
<li>
<p>
If LibDAQ was installed to a custom, non-system path:
</p>
<div class="literalblock">
<div class="content">
<pre><code>export PKG_CONFIG_PATH=/libdaq/install/path/lib/pkgconfig:$PKG_CONFIG_PATH</code></pre>
</div></div>
</li>
<li>
<p>
Now do one of the following:
</p>
<div class="olist loweralpha"><ol class="loweralpha">
<li>
<p>
To build with cmake and make, run configure_cmake.sh.  It will
   automatically create and populate a new subdirectory named <em>build</em>.
</p>
<div class="literalblock">
<div class="content">
<pre><code>./configure_cmake.sh --prefix=$my_path
cd build
make -j $(nproc)
make install
ln -s $my_path/conf $my_path/etc</code></pre>
</div></div>
</li>
<li>
<p>
You can also specify a cmake project generator:
</p>
<div class="literalblock">
<div class="content">
<pre><code>./configure_cmake.sh --generator=Xcode --prefix=$my_path</code></pre>
</div></div>
</li>
<li>
<p>
Or use ccmake directly to configure and generate from an arbitrary build
   directory like one of these:
</p>
<div class="literalblock">
<div class="content">
<pre><code>ccmake -G Xcode /path/to/Snort++/tree
open snort.xcodeproj</code></pre>
</div></div>
<div class="literalblock">
<div class="content">
<pre><code>ccmake -G "Eclipse CDT4 - Unix Makefiles" /path/to/Snort++/tree
run eclipse and do File &gt; Import &gt; Existing Eclipse Project</code></pre>
</div></div>
</li>
</ol></div>
</li>
<li>
<p>
To build with g++ on OS X where clang is installed, do this first:
</p>
<div class="literalblock">
<div class="content">
<pre><code>export CXX=g++</code></pre>
</div></div>
</li>
</ul></div>
</div>
<div class="sect2">
<h3 id="_running">Running</h3>
<div class="paragraph"><p>Examples:</p></div>
<div class="ulist"><ul>
<li>
<p>
Get some help:
</p>
<div class="literalblock">
<div class="content">
<pre><code>$my_path/bin/snort --help
$my_path/bin/snort --help-module suppress
$my_path/bin/snort --help-config | grep thread</code></pre>
</div></div>
</li>
<li>
<p>
Examine and dump a pcap:
</p>
<div class="literalblock">
<div class="content">
<pre><code>$my_path/bin/snort -r &lt;pcap&gt;
$my_path/bin/snort -L dump -d -e -q -r &lt;pcap&gt;</code></pre>
</div></div>
</li>
<li>
<p>
Verify config, with or w/o rules:
</p>
<div class="literalblock">
<div class="content">
<pre><code>$my_path/bin/snort -c $my_path/etc/snort/snort.lua
$my_path/bin/snort -c $my_path/etc/snort/snort.lua -R $my_path/etc/snort/sample.rules</code></pre>
</div></div>
</li>
<li>
<p>
Run IDS mode.  To keep it brief, look at the first n packets in each file:
</p>
<div class="literalblock">
<div class="content">
<pre><code>$my_path/bin/snort -c $my_path/etc/snort/snort.lua -R $my_path/etc/snort/sample.rules \
    -r &lt;pcap&gt; -A alert_test -n 100000</code></pre>
</div></div>
</li>
<li>
<p>
Let’s suppress 1:2123.  We could edit the conf or just do this:
</p>
<div class="literalblock">
<div class="content">
<pre><code>$my_path/bin/snort -c $my_path/etc/snort/snort.lua -R $my_path/etc/snort/sample.rules \
    -r &lt;pcap&gt; -A alert_test -n 100000 --lua "suppress = { { gid = 1, sid = 2123 } }"</code></pre>
</div></div>
</li>
<li>
<p>
Go whole hog on a directory with multiple packet threads:
</p>
<div class="literalblock">
<div class="content">
<pre><code>$my_path/bin/snort -c $my_path/etc/snort/snort.lua -R $my_path/etc/snort/sample.rules \
    --pcap-filter \*.pcap --pcap-dir &lt;dir&gt; -A alert_fast -n 1000 --max-packet-threads 8</code></pre>
</div></div>
</li>
</ul></div>
<div class="paragraph"><p>For more examples, see the usage section.</p></div>
</div>
<div class="sect2">
<h3 id="_tips">Tips</h3>
<div class="paragraph"><p>One of the goals of Snort 3 is to make it easier to configure your sensor.
Here is a summary of tips and tricks you may find useful.</p></div>
<div class="paragraph"><p>General Use</p></div>
<div class="ulist"><ul>
<li>
<p>
Snort tries hard not to error out too quickly.  It will report multiple
  semantic errors.
</p>
</li>
<li>
<p>
Snort always assumes the simplest mode of operation.  Eg, you can omit the -T
  option to validate the conf if you don’t provide a packet source.
</p>
</li>
<li>
<p>
Warnings are not emitted unless --warn-* is specified.  --warn-all enables all
  warnings, and --pedantic makes such warnings fatal.
</p>
</li>
<li>
<p>
You can process multiple sources at one time by using the -z or --max-threads
  option.
</p>
</li>
<li>
<p>
To make it easy to find the important data, zero counts are not output at
  shutdown.
</p>
</li>
<li>
<p>
Load plugins from the command line with --plugin-path /path/to/install/lib.
</p>
</li>
<li>
<p>
You can process multiple sources at one time by using the -z or
  --max-threads option.
</p>
</li>
<li>
<p>
Unit tests are configured with --enable-unit-tests.  They can then be run
  with snort --catch-test [tags]|all.
</p>
</li>
<li>
<p>
Benchmark tests are configured with --enable-benchmark-tests.  They can then
  be run with snort --catch-test [tags]|all or built as a separate executable.
  It is also preferred to configure a non-debug build with optimizations enabled.
</p>
</li>
</ul></div>
<div class="paragraph"><p>Lua Configuration</p></div>
<div class="ulist"><ul>
<li>
<p>
Some parameters could be configured via a command line option or snort module.
  In this case a command line option has the highest precedence, in turn,
  snort module configuration has precedence over other modules.
</p>
</li>
<li>
<p>
Configure the wizard and default bindings will be created based on configured
  inspectors.  No need to explicitly bind ports in this case.
</p>
</li>
<li>
<p>
You can override or add to your Lua conf with the --lua command line option.
</p>
</li>
<li>
<p>
The Lua conf is a live script that is executed when loaded.  You can add
  functions, grab environment variables, compute values, etc.
</p>
</li>
<li>
<p>
You can also rename symbols that you want to disable.  For example,
  changing normalizer to  Xnormalizer (an unknown symbol) will disable the
  normalizer.  This can be easier than commenting in some cases.
</p>
</li>
<li>
<p>
By default, symbols unknown to Snort are silently ignored.  You can
  generate warnings for them  with --warn-unknown.  To ignore such symbols,
  export them in the environment variable SNORT_IGNORE.
</p>
</li>
</ul></div>
<div class="paragraph"><p>Writing and Loading Rules</p></div>
<div class="paragraph"><p>Snort rules allow arbitrary whitespace.  Multi-line rules make it easier to
structure your rule  for clarity.  There are multiple ways to add comments to
your rules:</p></div>
<div class="ulist"><ul>
<li>
<p>
The # character starts a comment to end of line.  In addition, all lines
  between #begin and #end are comments.
</p>
</li>
<li>
<p>
The rem option allows you to write a comment that is conveyed with the rule.
</p>
</li>
<li>
<p>
C style multi-line comments are allowed, which means you can comment out
  portions of a rule while  testing it out by putting the options between /* and
  */.
</p>
</li>
</ul></div>
<div class="paragraph"><p>There are multiple ways to load rules too:</p></div>
<div class="ulist"><ul>
<li>
<p>
Set ips.rules or ips.include.
</p>
</li>
<li>
<p>
include statements can be used in rules files.
</p>
</li>
<li>
<p>
Use -R to load a rules file.
</p>
</li>
<li>
<p>
Use --stdin-rules with command line redirection.
</p>
</li>
<li>
<p>
Use --lua to specify one or more rules as a command line argument.
</p>
</li>
</ul></div>
<div class="paragraph"><p>Ips states are similar to ips rules, except that they are parsed after the rules.
That way rules can be overwritten in custom policies.</p></div>
<div class="paragraph"><p>States without the <em>enable</em> option are loaded as stub rules with default gid:0, sid:0.
A user should specify <em>gid</em>, <em>sid</em>, <em>enable</em> options to avoid dummy rules.</p></div>
<div class="paragraph"><p>Output Files</p></div>
<div class="paragraph"><p>To make it simple to configure outputs when you run with multiple packet
threads, output files are not explicitly configured.  Instead, you can use the
options below to format the paths:</p></div>
<div class="literalblock">
<div class="content">
<pre><code>&lt;logdir&gt;/[&lt;run_prefix&gt;][&lt;id#&gt;][&lt;X&gt;]&lt;name&gt;</code></pre>
</div></div>
<div class="ulist"><ul>
<li>
<p>
logdir is set with -l and defaults to ./
</p>
</li>
<li>
<p>
run_prefix is set with --run-prefix else not used
</p>
</li>
<li>
<p>
id# is the packet thread number that writes the file; with one packet thread,
  id# (zero) is omitted without --id-zero
</p>
</li>
<li>
<p>
X is / if you use --id-subdir, else _ if id# is used
</p>
</li>
<li>
<p>
name is based on module name that writes the file
</p>
</li>
<li>
<p>
all text mode outputs default to stdout
</p>
</li>
</ul></div>
</div>
<div class="sect2">
<h3 id="_common_errors">Common Errors</h3>
<div class="paragraph"><p><em>PANIC: unprotected error in call to Lua API (cannot open
snort_defaults.lua: No such file or directory)</em></p></div>
<div class="ulist"><ul>
<li>
<p>
export SNORT_LUA_PATH to point to any dofiles
</p>
</li>
</ul></div>
<div class="paragraph"><p><em>ERROR can’t find xyz</em></p></div>
<div class="ulist"><ul>
<li>
<p>
if xyz is the name of a module, make sure you are not assigning a scalar
  where a table is required (e.g. xyz = 2 should be xyz = { }).
</p>
</li>
</ul></div>
<div class="paragraph"><p><em>ERROR can’t find x.y</em></p></div>
<div class="ulist"><ul>
<li>
<p>
module x does not have a parameter named y.  check --help-module x for
  available parameters.
</p>
</li>
</ul></div>
<div class="paragraph"><p><em>ERROR invalid x.y = z</em></p></div>
<div class="ulist"><ul>
<li>
<p>
the value z is out of range for x.y.  check --help-config x.y for the range
  allowed.
</p>
</li>
</ul></div>
<div class="paragraph"><p><em>ERROR: x = { y = z } is in conf but is not being applied</em></p></div>
<div class="ulist"><ul>
<li>
<p>
make sure that x = { } isn’t set later because it will override the
  earlier setting.  same for x.y.
</p>
</li>
</ul></div>
<div class="paragraph"><p><em>FATAL: can’t load lua/errors.lua: lua/errors.lua:68: <em>=</em> expected near
';'</em></p></div>
<div class="ulist"><ul>
<li>
<p>
this is a syntax error reported by Lua to Snort on line 68 of errors.lua.
</p>
</li>
</ul></div>
<div class="paragraph"><p><em>ERROR: rules(2) unknown rule keyword: find.</em></p></div>
<div class="ulist"><ul>
<li>
<p>
this was due to not including the --script-path.
</p>
</li>
</ul></div>
<div class="paragraph"><p><em>WARNING: unknown symbol x</em></p></div>
<div class="ulist"><ul>
<li>
<p>
if you any variables, you can squelch such warnings by setting them in
  an environment variable SNORT_IGNORE.  to ignore x, y, and z:
</p>
<div class="literalblock">
<div class="content">
<pre><code>export SNORT_IGNORE="x y z"</code></pre>
</div></div>
</li>
</ul></div>
</div>
<div class="sect2">
<h3 id="_gotchas">Gotchas</h3>
<div class="ulist"><ul>
<li>
<p>
A nil key in a table will not be caught.  Neither will a nil value in a
  table.  Neither of the following will cause errors, nor will they
  actually set http_inspect.request_depth:
</p>
<div class="literalblock">
<div class="content">
<pre><code>http_inspect = { request_depth }
http_inspect = { request_depth = undefined_symbol }</code></pre>
</div></div>
</li>
<li>
<p>
It is not an error to set a value multiple times.  The actual value
  applied may not be the last in the table either.  It is best to avoid
  such cases.
</p>
<div class="literalblock">
<div class="content">
<pre><code>http_inspect =
{
    request_depth = 1234,
    request_depth = 4321
}</code></pre>
</div></div>
</li>
<li>
<p>
Snort can’t tell you the exact filename or line number of a semantic
  error but it will tell you the fully qualified name.
</p>
</li>
</ul></div>
</div>
<div class="sect2">
<h3 id="_known_issues">Known Issues</h3>
<div class="ulist"><ul>
<li>
<p>
The dump DAQ will not work with multiple threads unless you use --daq-var
  output=none.  This will be fixed at some point to use the Snort log
  directory, etc.
</p>
</li>
<li>
<p>
If you build with hyperscan on OS X and see:
</p>
<div class="literalblock">
<div class="content">
<pre><code>dyld: Library not loaded: @rpath/libhs.4.0.dylib</code></pre>
</div></div>
<div class="literalblock">
<div class="content">
<pre><code>when you try to run src/snort, export DYLD_LIBRARY_PATH with the path to
libhs.  You can also do:</code></pre>
</div></div>
<div class="literalblock">
<div class="content">
<pre><code>install_name_tool -change @rpath/libhs.4.0.dylib \
    /path-to/libhs.4.0.dylib src/snort</code></pre>
</div></div>
</li>
<li>
<p>
Snort built with tcmalloc support (--enable-tcmalloc) on Ubuntu 17.04/18.04
  crashes immediately.
</p>
<div class="literalblock">
<div class="content">
<pre><code>Workaround:
Uninstall gperftools 2.5 provided by the distribution and install gperftools
2.7 before building Snort.</code></pre>
</div></div>
</li>
</ul></div>
<div class="sect3">
<h4 id="_reload_limitations">Reload Limitations</h4>
<div class="paragraph"><p>The following parameters can’t be changed during reload, and require a restart:</p></div>
<div class="ulist"><ul>
<li>
<p>
active.attempts
</p>
</li>
<li>
<p>
active.device
</p>
</li>
<li>
<p>
alerts.detection_filter_memcap
</p>
</li>
<li>
<p>
alerts.event_filter_memcap
</p>
</li>
<li>
<p>
alerts.rate_filter_memcap
</p>
</li>
<li>
<p>
attribute_table.max_hosts
</p>
</li>
<li>
<p>
attribute_table.max_services_per_host
</p>
</li>
<li>
<p>
daq.snaplen
</p>
</li>
<li>
<p>
file_id.max_files_cached
</p>
</li>
<li>
<p>
process.chroot
</p>
</li>
<li>
<p>
process.daemon
</p>
</li>
<li>
<p>
process.set_gid
</p>
</li>
<li>
<p>
process.set_uid
</p>
</li>
<li>
<p>
snort.--bpf
</p>
</li>
<li>
<p>
snort.-l
</p>
</li>
<li>
<p>
trace.output
</p>
</li>
</ul></div>
<div class="paragraph"><p>In addition, the following scenarios require a restart:</p></div>
<div class="ulist"><ul>
<li>
<p>
Enabling file capture for the first time
</p>
</li>
<li>
<p>
Changing file_id.capture_memcap if file capture was previously or currently
  enabled
</p>
</li>
<li>
<p>
Changing file_id.capture_block_size if file capture was previously or
  currently enabled
</p>
</li>
<li>
<p>
Adding/removing stream_* inspectors if stream was already configured
</p>
</li>
</ul></div>
<div class="paragraph"><p>In all of these cases reload will fail with the following message: "reload
failed - restart required". The original config will remain in use.</p></div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_usage">Usage</h2>
<div class="sectionbody">
<div class="paragraph"><p>For the following examples "$my_path" is assumed to be the path to the
Snort install directory. Additionally, it is assumed that "$my_path/bin"
is in your PATH.</p></div>
<div class="sect2">
<h3 id="_help">Help</h3>
<div class="paragraph"><p>Print the help summary:</p></div>
<div class="literalblock">
<div class="content">
<pre><code>snort --help</code></pre>
</div></div>
<div class="paragraph"><p>Get help on a specific module ("stream", for example):</p></div>
<div class="literalblock">
<div class="content">
<pre><code>snort --help-module stream</code></pre>
</div></div>
<div class="paragraph"><p>Get help on the "-A" command line option:</p></div>
<div class="literalblock">
<div class="content">
<pre><code>snort --help-options A</code></pre>
</div></div>
<div class="paragraph"><p>Grep for help on threads:</p></div>
<div class="literalblock">
<div class="content">
<pre><code>snort --help-config | grep thread</code></pre>
</div></div>
<div class="paragraph"><p>Output help on "rule" options in AsciiDoc format:</p></div>
<div class="literalblock">
<div class="content">
<pre><code>snort --markup --help-options rule</code></pre>
</div></div>
<div class="admonitionblock">
<table><tbody><tr>
<td class="icon">
<img src="./Snort 3 User Manual_files/note.png" alt="Note">
</td>
<td class="content">Snort stops reading command-line options after the "--help-<strong>" and
"--list-</strong>" options, so any other options should be placed before them.</td>
</tr></tbody></table>
</div>
</div>
<div class="sect2">
<h3 id="_sniffing_and_logging">Sniffing and Logging</h3>
<div class="paragraph"><p>Read a pcap:</p></div>
<div class="literalblock">
<div class="content">
<pre><code>snort -r /path/to/my.pcap</code></pre>
</div></div>
<div class="paragraph"><p>Dump the packets to stdout:</p></div>
<div class="literalblock">
<div class="content">
<pre><code>snort -r /path/to/my.pcap -L dump</code></pre>
</div></div>
<div class="paragraph"><p>Dump packets with application data and layer 2 headers</p></div>
<div class="literalblock">
<div class="content">
<pre><code>snort -r /path/to/my.pcap -L dump -d -e</code></pre>
</div></div>
<div class="admonitionblock">
<table><tbody><tr>
<td class="icon">
<img src="./Snort 3 User Manual_files/note.png" alt="Note">
</td>
<td class="content">Command line options must be specified separately. "snort -de" won’t
work.  You can still concatenate options and their arguments, however, so
"snort -Ldump" will work.</td>
</tr></tbody></table>
</div>
<div class="paragraph"><p>Dump packets from all pcaps in a directory:</p></div>
<div class="literalblock">
<div class="content">
<pre><code>snort --pcap-dir /path/to/pcap/dir --pcap-filter '*.pcap' -L dump -d -e</code></pre>
</div></div>
<div class="paragraph"><p>Log packets to a directory:</p></div>
<div class="literalblock">
<div class="content">
<pre><code>snort --pcap-dir /path/to/pcap/dir --pcap-filter '*.pcap' -L dump -l /path/to/log/dir</code></pre>
</div></div>
</div>
<div class="sect2">
<h3 id="_configuration_2">Configuration</h3>
<div class="paragraph"><p>Validate a configuration file:</p></div>
<div class="literalblock">
<div class="content">
<pre><code>snort -c $my_path/etc/snort/snort.lua</code></pre>
</div></div>
<div class="paragraph"><p>Validate a configuration file and a separate rules file:</p></div>
<div class="literalblock">
<div class="content">
<pre><code>snort -c $my_path/etc/snort/snort.lua -R $my_path/etc/snort/sample.rules</code></pre>
</div></div>
<div class="paragraph"><p>Read rules from stdin and validate:</p></div>
<div class="literalblock">
<div class="content">
<pre><code>snort -c $my_path/etc/snort/snort.lua --stdin-rules &lt; $my_path/etc/snort/sample.rules</code></pre>
</div></div>
<div class="paragraph"><p>Enable warnings for Lua configurations and make warnings fatal:</p></div>
<div class="literalblock">
<div class="content">
<pre><code>snort -c $my_path/etc/snort/snort.lua --warn-all --pedantic</code></pre>
</div></div>
<div class="paragraph"><p>Tell Snort where to look for additional Lua scripts:</p></div>
<div class="literalblock">
<div class="content">
<pre><code>snort --script-path /path/to/script/dir</code></pre>
</div></div>
</div>
<div class="sect2">
<h3 id="_ids_mode">IDS mode</h3>
<div class="paragraph"><p>Run Snort in IDS mode, reading packets from a pcap:</p></div>
<div class="literalblock">
<div class="content">
<pre><code>snort -c $my_path/etc/snort/snort.lua -r /path/to/my.pcap</code></pre>
</div></div>
<div class="paragraph"><p>Log any generated alerts to the console using the "-A" option:</p></div>
<div class="literalblock">
<div class="content">
<pre><code>snort -c $my_path/etc/snort/snort.lua -r /path/to/my.pcap -A alert_full</code></pre>
</div></div>
<div class="paragraph"><p>Capture separate stdout, stderr, and stdlog files (out has startup and
shutdown output, err has warnings and errors, and log has alerts):</p></div>
<div class="literalblock">
<div class="content">
<pre><code>snort -c $my_path/etc/snort/snort.lua -r /path/to/my.pcap -A csv \
    1&gt;out 2&gt;err 3&gt;log</code></pre>
</div></div>
<div class="paragraph"><p>Add or modify a configuration from the command line using the "--lua" option:</p></div>
<div class="literalblock">
<div class="content">
<pre><code>snort -c $my_path/etc/snort/snort.lua -r /path/to/my.pcap -A cmg \
    --lua 'ips = { enable_builtin_rules = true }'</code></pre>
</div></div>
<div class="admonitionblock">
<table><tbody><tr>
<td class="icon">
<img src="./Snort 3 User Manual_files/note.png" alt="Note">
</td>
<td class="content">The "--lua" option can be specified multiple times.</td>
</tr></tbody></table>
</div>
<div class="paragraph"><p>Run Snort in IDS mode on an entire directory of pcaps, processing each
input source on a separate thread:</p></div>
<div class="literalblock">
<div class="content">
<pre><code>snort -c $my_path/etc/snort/snort.lua --pcap-dir /path/to/pcap/dir \
    --pcap-filter '*.pcap' --max-packet-threads 8</code></pre>
</div></div>
<div class="paragraph"><p>Run Snort on 2 interfaces, eth0 and eth1:</p></div>
<div class="literalblock">
<div class="content">
<pre><code>snort -c $my_path/etc/snort/snort.lua -i "eth0 eth1" -z 2 -A cmg</code></pre>
</div></div>
<div class="paragraph"><p>Run Snort inline with the afpacket DAQ:</p></div>
<div class="literalblock">
<div class="content">
<pre><code>snort -c $my_path/etc/snort/snort.lua --daq afpacket -i "eth0:eth1" \
    -A cmg</code></pre>
</div></div>
</div>
<div class="sect2">
<h3 id="_plugins_2">Plugins</h3>
<div class="paragraph"><p>Load external plugins and use the "ex" alert:</p></div>
<div class="literalblock">
<div class="content">
<pre><code>snort -c $my_path/etc/snort/snort.lua \
    --plugin-path $my_path/lib/snort_extra \
    -A alert_ex -r /path/to/my.pcap</code></pre>
</div></div>
<div class="paragraph"><p>Test the LuaJIT rule option <em>find</em> loaded from stdin:</p></div>
<div class="literalblock">
<div class="content">
<pre><code>snort -c $my_path/etc/snort/snort.lua \
    --script-path $my_path/lib/snort_extra \
    --stdin-rules -A cmg -r /path/to/my.pcap &lt;&lt; END
alert tcp any any -&gt; any 80 (
    sid:3; msg:"found"; content:"GET";
    find:"pat='HTTP/1%.%d'" ; )
END</code></pre>
</div></div>
</div>
<div class="sect2">
<h3 id="_output_files">Output Files</h3>
<div class="paragraph"><p>To make it simple to configure outputs when you run with multiple packet
threads, output files are not explicitly configured. Instead, you can use
the options below to format the paths:</p></div>
<div class="literalblock">
<div class="content">
<pre><code>&lt;logdir&gt;/[&lt;run_prefix&gt;][&lt;id#&gt;][&lt;X&gt;]&lt;name&gt;</code></pre>
</div></div>
<div class="paragraph"><p>Log to unified in the current directory:</p></div>
<div class="literalblock">
<div class="content">
<pre><code>snort -c $my_path/etc/snort/snort.lua -r /path/to/my.pcap -A unified2</code></pre>
</div></div>
<div class="paragraph"><p>Log to unified in the current directory with a different prefix:</p></div>
<div class="literalblock">
<div class="content">
<pre><code>snort -c $my_path/etc/snort/snort.lua -r /path/to/my.pcap -A unified2 \
    --run-prefix take2</code></pre>
</div></div>
<div class="paragraph"><p>Log to unified in /tmp:</p></div>
<div class="literalblock">
<div class="content">
<pre><code>snort -c $my_path/etc/snort/snort.lua -r /path/to/my.pcap -A unified2 -l /tmp</code></pre>
</div></div>
<div class="paragraph"><p>Run 4 packet threads and log with thread number prefix (0-3):</p></div>
<div class="literalblock">
<div class="content">
<pre><code>snort -c $my_path/etc/snort/snort.lua --pcap-dir /path/to/pcap/dir \
    --pcap-filter '*.pcap' -z 4 -A unified2</code></pre>
</div></div>
<div class="paragraph"><p>Run 4 packet threads and log in thread number subdirs (0-3):</p></div>
<div class="literalblock">
<div class="content">
<pre><code>snort -c $my_path/etc/snort/snort.lua --pcap-dir /path/to/pcap/dir \
    --pcap-filter '*.pcap' -z 4 -A unified2 --id-subdir</code></pre>
</div></div>
<div class="admonitionblock">
<table><tbody><tr>
<td class="icon">
<img src="./Snort 3 User Manual_files/note.png" alt="Note">
</td>
<td class="content">subdirectories are created automatically if required.  Log filename
is based on module name that writes the file.  All text mode outputs
default to stdout.  These options can be combined.</td>
</tr></tbody></table>
</div>
</div>
<div class="sect2">
<h3 id="_daq_alternatives">DAQ Alternatives</h3>
<div class="paragraph"><p>Process hext packets from stdin:</p></div>
<div class="literalblock">
<div class="content">
<pre><code>snort -c $my_path/etc/snort/snort.lua \
    --daq-dir $my_path/lib/snort/daqs --daq hext -i tty &lt;&lt; END
$packet 10.1.2.3 48620 -&gt; 10.9.8.7 80
"GET / HTTP/1.1\r\n"
"Host: localhost\r\n"
"\r\n"
END</code></pre>
</div></div>
<div class="paragraph"><p>Process raw ethernet from hext file:</p></div>
<div class="literalblock">
<div class="content">
<pre><code>snort -c $my_path/etc/snort/snort.lua \
    --daq-dir $my_path/lib/snort/daqs --daq hext \
    --daq-var dlt=1 -r &lt;hext-file&gt;</code></pre>
</div></div>
<div class="paragraph"><p>Process a directory of plain files (ie non-pcap) with 4 threads with 8K
buffers:</p></div>
<div class="literalblock">
<div class="content">
<pre><code>snort -c $my_path/etc/snort/snort.lua \
    --daq-dir $my_path/lib/snort/daqs --daq file \
    --pcap-dir path/to/files -z 4 -s 8192</code></pre>
</div></div>
<div class="paragraph"><p>Bridge two TCP connections on port 8000 and inspect the traffic:</p></div>
<div class="literalblock">
<div class="content">
<pre><code>snort -c $my_path/etc/snort/snort.lua \
    --daq-dir $my_path/lib/snort/daqs --daq socket</code></pre>
</div></div>
</div>
<div class="sect2">
<h3 id="_logger_alternatives">Logger Alternatives</h3>
<div class="paragraph"><p>Dump TCP stream payload in hext mode:</p></div>
<div class="literalblock">
<div class="content">
<pre><code>snort -c $my_path/etc/snort/snort.lua -L hext</code></pre>
</div></div>
<div class="paragraph"><p>Output timestamp, pkt_num, proto, pkt_gen, dgm_len, dir, src_ap, dst_ap,
rule, action for each alert:</p></div>
<div class="literalblock">
<div class="content">
<pre><code>snort -c $my_path/etc/snort/snort.lua -A csv</code></pre>
</div></div>
<div class="paragraph"><p>Output the old test format alerts:</p></div>
<div class="literalblock">
<div class="content">
<pre><code>snort -c $my_path/etc/snort/snort.lua \
    --lua "alert_csv = { fields = 'pkt_num gid sid rev', separator = '\t' }"</code></pre>
</div></div>
</div>
<div class="sect2">
<h3 id="_shell">Shell</h3>
<div class="paragraph"><p>You must build with --enable-shell to make the command line shell available.</p></div>
<div class="paragraph"><p>Enable shell mode:</p></div>
<div class="literalblock">
<div class="content">
<pre><code>snort --shell &lt;args&gt;</code></pre>
</div></div>
<div class="paragraph"><p>You will see the shell mode command prompt, which looks like this:</p></div>
<div class="literalblock">
<div class="content">
<pre><code>o")~</code></pre>
</div></div>
<div class="paragraph"><p>(The prompt can be changed with the SNORT_PROMPT environment variable.)</p></div>
<div class="paragraph"><p>You can pause immediately after loading the configuration and again before
exiting with:</p></div>
<div class="literalblock">
<div class="content">
<pre><code>snort --shell --pause &lt;args&gt;</code></pre>
</div></div>
<div class="paragraph"><p>In that case you must issue the resume() command to continue.  Enter quit()
to terminate Snort or detach() to exit the shell.  You can list the
available commands with help().</p></div>
<div class="paragraph"><p>To enable local telnet access on port 12345:</p></div>
<div class="literalblock">
<div class="content">
<pre><code>snort --shell -j 12345 &lt;args&gt;</code></pre>
</div></div>
<div class="paragraph"><p>The command line interface is still under development.  Suggestions are
welcome.</p></div>
</div>
<div class="sect2">
<h3 id="_signals">Signals</h3>
<div class="admonitionblock">
<table><tbody><tr>
<td class="icon">
<img src="./Snort 3 User Manual_files/note.png" alt="Note">
</td>
<td class="content">The following examples assume that Snort is currently running and has
a process ID of &lt;pid&gt;.</td>
</tr></tbody></table>
</div>
<div class="paragraph"><p>Modify and Reload Configuration:</p></div>
<div class="literalblock">
<div class="content">
<pre><code>echo 'suppress = { { gid = 1, sid = 2215 } }' &gt;&gt; $my_path/etc/snort/snort.lua
kill -hup &lt;pid&gt;</code></pre>
</div></div>
<div class="paragraph"><p>Dump stats to stdout:</p></div>
<div class="literalblock">
<div class="content">
<pre><code>kill -usr1 &lt;pid&gt;</code></pre>
</div></div>
<div class="paragraph"><p>Shutdown normally:</p></div>
<div class="literalblock">
<div class="content">
<pre><code>kill -term &lt;pid&gt;</code></pre>
</div></div>
<div class="paragraph"><p>Exit without flushing packets:</p></div>
<div class="literalblock">
<div class="content">
<pre><code>kill -quit &lt;pid&gt;</code></pre>
</div></div>
<div class="paragraph"><p>List available signals:</p></div>
<div class="literalblock">
<div class="content">
<pre><code>snort --help-signals</code></pre>
</div></div>
<div class="admonitionblock">
<table><tbody><tr>
<td class="icon">
<img src="./Snort 3 User Manual_files/note.png" alt="Note">
</td>
<td class="content">The available signals may vary from platform to platform.</td>
</tr></tbody></table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_features">Features</h2>
<div class="sectionbody">
<div class="paragraph"><p>This section explains how to use key features of Snort.</p></div>
<div class="sect2">
<h3 id="_active_response">Active Response</h3>
<div class="paragraph"><p>Snort can take more active role in securing network by sending active
responses to shutdown offending sessions. When active responses is
enabled, snort will send TCP RST and ICMP unreachable when
dropping a TCP session and ICMP unreachable packets for UDP.</p></div>
<div class="sect3">
<h4 id="_changes_from_snort_2_9">Changes from Snort 2.9</h4>
<div class="ulist"><ul>
<li>
<p>
stream5_global:max_active_responses and min_response_seconds are now
active.max_responses and active.min_interval.
</p>
</li>
<li>
<p>
Response actions were removed from IPS rule body to the rule action
in the header.  This includes react, reject, and rewrite (split out of
replace which now just does the detection part). These IPS actions are
plugins.
</p>
</li>
<li>
<p>
drop and block are synonymous in Snort 2.9 but in Snort 3.0 drop means
don’t forward the current packet only whereas block means don’t forward
this or any following packet on the flow.
</p>
</li>
</ul></div>
</div>
<div class="sect3">
<h4 id="_configure_active">Configure Active</h4>
<div class="paragraph"><p>Active response is enabled by configuring one of following IPS action
plugins:</p></div>
<div class="literalblock">
<div class="content">
<pre><code>react = { }
reject = { }</code></pre>
</div></div>
<div class="paragraph"><p>When these active responses are not configured the default configuration
is used.</p></div>
<div class="paragraph"><p>Active responses will be performed for reject, react or rewrite IPS rule
actions, and response packets are encoded based on the triggering packet.
TTL will be set to the value captured at session pickup.</p></div>
<div class="paragraph"><p>Configure the number of attempts to land a TCP RST within the session’s
current window (so that it is accepted by the receiving TCP).  This
sequence "strafing" is really only useful in passive mode.  In inline mode
the reset is put straight into the stream in lieu of the triggering packet
so strafing is not necessary.</p></div>
<div class="paragraph"><p>Each attempt (sent in rapid succession) has a different sequence number.
Each active response will actually cause this number of TCP resets to be
sent. TCP data is multiplied similarly. At most 1 ICMP unreachable is sent,
iff attempts &gt; 0.</p></div>
<div class="paragraph"><p>Device IP will perform network layer injection.  It is probably a better
choice to specify an interface and avoid kernel routing tables, etc.</p></div>
<div class="paragraph"><p>dst_mac will change response destination MAC address, if the device is
eth0, eth1, eth2 etc. Otherwise, response destination MAC address is
derived from packet.</p></div>
<div class="paragraph"><p>Example:</p></div>
<div class="literalblock">
<div class="content">
<pre><code>active =
{
    attempts = 2,
    device = "eth0",
    dst_mac = "00:06:76:DD:5F:E3",
}</code></pre>
</div></div>
</div>
<div class="sect3">
<h4 id="_reject">Reject</h4>
<div class="paragraph"><p>IPS action reject perform active response to shutdown hostile network
session by injecting TCP resets and ICMP unreachable for TCP
connections, and ICMP unreachable packets for UDP.</p></div>
<div class="paragraph"><p>Example:</p></div>
<div class="literalblock">
<div class="content">
<pre><code>reject = { reset = "both", control = "all" }</code></pre>
</div></div>
<div class="literalblock">
<div class="content">
<pre><code>local_rules =
[[
reject tcp ( msg:"hostile connection"; flow:established, to_server;
content:"HACK!"; sid:1; )
]]</code></pre>
</div></div>
<div class="literalblock">
<div class="content">
<pre><code>ips =
{
    rules = local_rules,
}</code></pre>
</div></div>
</div>
<div class="sect3">
<h4 id="_react">React</h4>
<div class="paragraph"><p>IPS action react enables sending an HTML page on a session and then
resetting it.</p></div>
<div class="paragraph"><p>The headers used are:</p></div>
<div class="literalblock">
<div class="content">
<pre><code>"HTTP/1.1 403 Forbidden\r\n" \
"Connection: close\r\n" \
"Content-Type: text/html; charset=utf-8\r\n" \
"Content-Length: 438\r\n" \
"\r\n"</code></pre>
</div></div>
<div class="paragraph"><p>The page to be sent can be read from a file:</p></div>
<div class="literalblock">
<div class="content">
<pre><code>react = { page = "customized_block_page.html", }</code></pre>
</div></div>
<div class="paragraph"><p>or else the default is used:</p></div>
<div class="literalblock">
<div class="content">
<pre><code>"&lt;!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.1//EN\"\r\n" \
"    \"http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd\"&gt;\r\n" \
"&lt;html xmlns=\"http://www.w3.org/1999/xhtml\" xml:lang=\"en\"&gt;\r\n" \
"&lt;head&gt;\r\n" \
"&lt;meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\" /&gt;\r\n" \
"&lt;title&gt;Access Denied&lt;/title&gt;\r\n" \
"&lt;/head&gt;\r\n" \
"&lt;body&gt;\r\n" \
"&lt;h1&gt;Access Denied&lt;/h1&gt;\r\n" \
"&lt;p&gt;You are attempting to access a forbidden site.&lt;br /&gt;" \
"Consult your system administrator for details.&lt;/p&gt;\r\n" \
"&lt;/body&gt;\r\n" \
"&lt;/html&gt;\r\n"</code></pre>
</div></div>
<div class="paragraph"><p>Note that the file contains the message body only. The headers will be added
with an updated value for Content-Length. For HTTP/2 traffic Snort will
translate the page to HTTP/2 format.</p></div>
<div class="paragraph"><p>Limitations for HTTP/2:</p></div>
<div class="ulist"><ul>
<li>
<p>
Packet will be injected against the last received stream id.
</p>
</li>
<li>
<p>
Injection triggered while server-to-client flow of traffic is in a middle
of a frame is not supported. The traffic will be blocked, but the page will
not be injected/displayed.
</p>
</li>
</ul></div>
<div class="paragraph"><p>When using react, payload injector must be configured as well.
Also Snort should be in ips mode, so the rule is triggered on the client
packet, and not delayed until the server sends ACK. To achieve this use
the default normalizer. It will set normalizer.tcp.ips = true.
Example:</p></div>
<div class="literalblock">
<div class="content">
<pre><code>react = { page = "my_block_page.html" }
payload_injector = { }
normalizer = { }</code></pre>
</div></div>
<div class="literalblock">
<div class="content">
<pre><code>local_rules =
[[
react http ( msg:"Unauthorized Access Prohibited!"; flow:established,
to_server; http_method; content:"GET"; sid:1; )
]]</code></pre>
</div></div>
<div class="literalblock">
<div class="content">
<pre><code>ips =
{
    rules = local_rules,
}</code></pre>
</div></div>
<div class="paragraph"><p>React has debug trace functionality. It can be used to get traces in case
injection is not successful.
To turn it on:</p></div>
<div class="literalblock">
<div class="content">
<pre><code>trace =
{
    modules = { react = { all = 1 } }
}</code></pre>
</div></div>
</div>
<div class="sect3">
<h4 id="_rewrite">Rewrite</h4>
<div class="paragraph"><p>IPS action "rewrite" enables overwrite packet contents based on "replace"
option in the rules. Note that using "rewrite" action without "replace"
option will raise corresponding rule alert, but will not overwrite the
packet payload.</p></div>
<div class="paragraph"><p>For example:</p></div>
<div class="literalblock">
<div class="content">
<pre><code>local_rules =
[[
rewrite tcp 10.1.1.87 any -&gt; 10.1.1.0/24 80
(
    sid:1000002;
    msg:"test replace rule";
    content:"index.php", nocase;
    replace:"indax.php";
)
]]</code></pre>
</div></div>
<div class="literalblock">
<div class="content">
<pre><code>ips =
{
    rules = local_rules,
}</code></pre>
</div></div>
<div class="paragraph"><p>this rule replaces the first occurrence of "index.php" with "indax.php",
and "rewrite" action updates that packet.</p></div>
<div class="paragraph"><p>Content and replacement are aligned to the right side of the matching
content and are limited not by the size of the matching content, but
by the boundaries of the packet.</p></div>
<div class="literalblock">
<div class="content">
<pre><code>Example:</code></pre>
</div></div>
<div class="literalblock">
<div class="content">
<pre><code>rewrite http any any -&gt; any any
(
    msg:"Small replace";
    content:"content";
    replace:"text";
    sid:1000002;
)</code></pre>
</div></div>
<div class="literalblock">
<div class="content">
<pre><code>this rule replaces "malicious content" to "malicious context".</code></pre>
</div></div>
<div class="literalblock">
<div class="content">
<pre><code>Example:</code></pre>
</div></div>
<div class="literalblock">
<div class="content">
<pre><code>rewrite http any any -&gt; any any
(
    msg:"Big replace";
    content:"content";
    replace:"y favorite page!";
    sid:1000002;
)</code></pre>
</div></div>
<div class="literalblock">
<div class="content">
<pre><code>this rule replaces "malicious content" to "my favorite page!".</code></pre>
</div></div>
<div class="paragraph"><p>Be aware that after the match there should be enough room left for the
"replace" content in the matched packet. If there is not enough space
for the "replace" content the rule will not match.</p></div>
<div class="paragraph"><p>"replace" works for raw packets only. So, TCP data must either fit
under the "pkt_data" buffer requirements or one should enable detection
on TCP payload before reassembly: search_engine.detect_raw_tcp=true.
For example:</p></div>
<div class="literalblock">
<div class="content">
<pre><code>Rule that does not require search_engine.detect_raw_tcp=true:</code></pre>
</div></div>
<div class="literalblock">
<div class="content">
<pre><code>rewrite udp any any -&gt; any any
(
    msg:"TEST 1";
    sid:1000002;
    content:"attack";
    replace:"abc123";
)</code></pre>
</div></div>
<div class="literalblock">
<div class="content">
<pre><code>Rule that does require search_engine.detect_raw_tcp=true:</code></pre>
</div></div>
<div class="literalblock">
<div class="content">
<pre><code>rewrite http any any -&gt; any any
(
    msg:"TEST 2";
    content:"/content.html";
    replace:"/replace.html";
    sid:1000002;
)</code></pre>
</div></div>
</div>
</div>
<div class="sect2">
<h3 id="_appid">AppId</h3>
<div class="paragraph"><p>Network administrators need application awareness in order to fine tune
their management of the ever-growing number of applications passing traffic
over the network. Application awareness allows an administrator to create
rules for applications as needed by the business. The rules can be used to
take action based on the application, such as block, allow or alert.</p></div>
<div class="sect3">
<h4 id="_overview_2">Overview</h4>
<div class="paragraph"><p>The AppId inspector provides an application level view when managing
networks by providing the following features:</p></div>
<div class="ulist"><ul>
<li>
<p>
Network control: The inspector works with Snort rules by providing a set of
  application identifiers (AppIds) to Snort rule writers.
</p>
</li>
<li>
<p>
Application usage awareness: The inspector outputs statistics to show
  how many times applications are being used on the network.
</p>
</li>
<li>
<p>
Custom applications: Administrators can create their own application
  detectors to detect new applications. The detectors are written in Lua
  and interface with Snort using a well-defined C-Lua API.
</p>
</li>
<li>
<p>
Open Detector Package (ODP): A set of pre-defined application detectors are
  provided by the Snort team and can be downloaded from snort.org.
</p>
</li>
</ul></div>
</div>
<div class="sect3">
<h4 id="_dependency_requirements">Dependency Requirements</h4>
<div class="paragraph"><p>For proper functioning of the AppId inspector, at a minimum stream flow
tracking must be enabled. In addition, to identify TCP-based or UDP-based
applications, the appropriate stream inspector must be enabled, e.g.
stream_tcp or stream_udp.</p></div>
<div class="paragraph"><p>In order to identify HTTP-based applications, the HTTP inspector must be
enabled. Otherwise, only non-HTTP applications will be identified.</p></div>
<div class="paragraph"><p>AppId subscribes to the inspection events published by other inspectors,
such as the HTTP and SSL inspectors, to gain access to the data needed. It
uses that data to help determine the application ID.</p></div>
<div class="paragraph"><p>AppId subscribes to the events published by SIP and DCE/RPC inspectors to
detect applications on expected flows.</p></div>
</div>
<div class="sect3">
<h4 id="_configuration_3">Configuration</h4>
<div class="paragraph"><p>The AppId feature can be enabled via configuration. To enable it with the
default settings use:</p></div>
<div class="literalblock">
<div class="content">
<pre><code>appid = { }</code></pre>
</div></div>
<div class="paragraph"><p>To use an AppId as a matching parameter in an IPS rule, use the <em>appids</em>
keyword.  For example, to block HTTP traffic that contains a specific header:</p></div>
<div class="literalblock">
<div class="content">
<pre><code>block tcp any any -&gt; 192.168.0.1 any ( msg:"Block Malicious HTTP header";
  appids:"HTTP"; content:"X-Header: malicious"; sid:18000; )</code></pre>
</div></div>
<div class="paragraph"><p>Alternatively, the HTTP application can be specified in place of <em>tcp</em> instead
of using the <em>appids</em> keyword. The AppId inspector will set the service when
it is discovered so it can be used in IPS rules like this. Note that this rule
also does not specify the IPs or ports which default to <em>any</em>.</p></div>
<div class="literalblock">
<div class="content">
<pre><code>block http ( msg:"Block Malicious HTTP header";
  content:"X-Header: malicious"; sid:18000; )</code></pre>
</div></div>
<div class="paragraph"><p>It’s possible to specify multiple applications (as many as desired) with
the appids keyword. A rule is considered a match if any of the applications
on the rule match. Note that this rule does not match specific content which
will reduce performance.</p></div>
<div class="literalblock">
<div class="content">
<pre><code>alert tcp any any -&gt; 192.168.0.1 any ( msg:"Alert ";
  appids:"telnet,ssh,smtp,http";</code></pre>
</div></div>
<div class="paragraph"><p>Below is a minimal Snort configuration that is sufficient to block flows
based on a specific HTTP header:</p></div>
<div class="literalblock">
<div class="content">
<pre><code>stream = { }</code></pre>
</div></div>
<div class="literalblock">
<div class="content">
<pre><code>stream_tcp = { }</code></pre>
</div></div>
<div class="literalblock">
<div class="content">
<pre><code>binder =
{
    {
        when =
        {
            proto = 'tcp',
            ports = [[ 80 8080 ]],
        },
        use =
        {
            type = 'http_inspect',
        },
    },
}</code></pre>
</div></div>
<div class="literalblock">
<div class="content">
<pre><code>http_inspect = { }</code></pre>
</div></div>
<div class="literalblock">
<div class="content">
<pre><code>appid = { }</code></pre>
</div></div>
<div class="literalblock">
<div class="content">
<pre><code>local_rules =
[[
block http ( msg:"openAppId: test content match for app http";
content:"X-Header: malicious"; sid:18760; rev:4; )
]]</code></pre>
</div></div>
<div class="literalblock">
<div class="content">
<pre><code>ips =
{
    rules = local_rules,
}</code></pre>
</div></div>
</div>
<div class="sect3">
<h4 id="_session_application_identifiers">Session Application Identifiers</h4>
<div class="paragraph"><p>There are up to four AppIds stored in a session as defined below:</p></div>
<div class="ulist"><ul>
<li>
<p>
serviceAppId - An appId associated with server side of a session. Example:
  http server.
</p>
</li>
<li>
<p>
clientAppId - An appId associated with application on client side of a
  session.  Example: Firefox.
</p>
</li>
<li>
<p>
payloadAppId - For services like http this appId is associated with a
  webserver host.  Example: Facebook.
</p>
</li>
<li>
<p>
miscAppId - For some encapsulated protocols, this is the highest
  encapsulated application.
</p>
</li>
</ul></div>
<div class="paragraph"><p>For packets originating from the client, a payloadAppid in a session is
matched with all AppIds listed on a rule. Thereafter miscAppId, clientAppId
and serviceAppId are matched. Since Alert Events contain one AppId, only the
first match is reported. If a rule without an appids option matches, then the
most specific appId (in order of payload, misc, client, server) is reported.</p></div>
<div class="paragraph"><p>The same logic is followed for packets originating from the server with one
exception.  The order of matching is changed to make serviceAppId come
before clientAppId.</p></div>
</div>
<div class="sect3">
<h4 id="_appid_usage_statistics">AppId Usage Statistics</h4>
<div class="paragraph"><p>The AppId inspector prints application network usage periodically in the snort
log directory in unified2 format. File name, time interval for statistic and
file rollover are controlled by appId inspection configuration.</p></div>
</div>
<div class="sect3">
<h4 id="_open_detector_package_odp_installation">Open Detector Package (ODP) Installation</h4>
<div class="paragraph"><p>Application detectors from Snort team will be delivered in a separate package
called the Open Detector Package (ODP) that can be downloaded from snort.org.
ODP is a package that contains the following artifacts:</p></div>
<div class="ulist"><ul>
<li>
<p>
Application detectors in the Lua language.
</p>
</li>
<li>
<p>
appMapping.data file containing application metadata. This file should not
  be modified.  The first column contains application identifier and second
  column contains application name.  Other columns contain internal
  information.
</p>
</li>
<li>
<p>
Lua library file DetectorCommon.lua.
</p>
</li>
</ul></div>
<div class="paragraph"><p>A user can install the ODP package in any directory and configure this
directory via the app_detector_dir option in the appid preprocessor
configuration.  Installing ODP will not modify any subdirectory named
custom, where user-created detectors are located.</p></div>
<div class="paragraph"><p>When installed, ODP will create following sub-directories:</p></div>
<div class="ulist"><ul>
<li>
<p>
odp/lua     //Cisco Lua detectors
</p>
</li>
<li>
<p>
odp/libs    //Cisco Lua modules
</p>
</li>
</ul></div>
</div>
<div class="sect3">
<h4 id="_user_created_application_detectors">User Created Application Detectors</h4>
<div class="paragraph"><p>Users can detect new applications by adding detectors in the Lua language. A
document will be posted on the Snort Website with details on API. Users can also
copy over Snort team provided detectors and modify them. Users can also use the
detector creation tool described in the next section.</p></div>
<div class="paragraph"><p>Users must organize their Lua detectors and libraries by creating the
following directory structure, under the ODP installation directory.</p></div>
<div class="ulist"><ul>
<li>
<p>
custom/lua     //Lua detectors
</p>
</li>
<li>
<p>
custom/libs    //Lua modules
</p>
</li>
</ul></div>
<div class="paragraph"><p>The root path is specified by the "app_detector_dir" parameter of the appid
section of snort.conf:</p></div>
<div class="literalblock">
<div class="content">
<pre><code>appid  =
{
    app_detector_dir = '/usr/local/lib/openappid',
}</code></pre>
</div></div>
<div class="paragraph"><p>So the path to the user-created lua files would be
/usr/local/lib/openappid/custom/lua/</p></div>
<div class="paragraph"><p>None of the directories below /usr/local/lib/openappid/ would be added for
you.</p></div>
</div>
<div class="sect3">
<h4 id="_application_detector_reload">Application Detector Reload</h4>
<div class="paragraph"><p>Both ODP detectors and user created detectors can be reloaded using the command
appid.reload_detectors(). Detectors are expected to be updated in the path
appid.app_detector_dir before this command is issued. The command takes no
parameters.</p></div>
</div>
<div class="sect3">
<h4 id="_application_detector_creation_tool">Application Detector Creation Tool</h4>
<div class="paragraph"><p>For rudimentary Lua detectors, there is a tool provided called
appid_detector_builder.sh.  This is a simple, menu-driven bash script
which creates .lua files in your current directory, based on your choices
and on patterns you supply.</p></div>
<div class="paragraph"><p>When you launch the script, it will prompt for the Application Id
that you are giving for your detector. This is free-form ASCII with
minor restrictions. The Lua detector file will be named based on your
Application Id. If the file name already exists you will be prompted to
overwrite it.</p></div>
<div class="paragraph"><p>You will also be prompted for a description of your detector to be placed
in the comments of the Lua source code. This is optional.</p></div>
<div class="paragraph"><p>You will then be asked a series of questions designed to construct Lua
code based on the kind of pattern data, protocol, port(s), etc.</p></div>
<div class="paragraph"><p>When complete, the Protocol menu will be changed to include the option,
"Save Detector".  Instead of saving the file and exiting the script,
you are allowed to give additional criteria for another pattern which
may also be incorporated in the detection scheme. Then either pattern,
when matched, will be considered a valid detection.</p></div>
<div class="paragraph"><p>For example, your first choices might create an HTTP detection pattern
of "example.com", and the next set of choices would add the HTTP
detection pattern of "example.uk.co" (an equally fictional British
counterpart). They would then co-exist in the Lua detector, and either
would cause a detection with the name you give for your Application Id.</p></div>
<div class="paragraph"><p>The resulting .lua file will need to be placed in the directory,
"custom/lua", described in the previous section of the README above called
"User Created Application Detectors"</p></div>
</div>
</div>
<div class="sect2">
<h3 id="_binder">Binder</h3>
<div class="paragraph"><p>One of the fundamental differences between Snort 2 and Snort 3 concerns configuration
related to networks and ports. Here is a brief review of Snort 2 configuration for
network and service related components:</p></div>
<div class="ulist"><ul>
<li>
<p>
Snort’s configuration has a default policy and optional policies selected by
  VLAN or network (with config binding).
</p>
</li>
<li>
<p>
Each policy contains a user defined set of preprocessor configurations.
</p>
</li>
<li>
<p>
Each preprocessor has a default configuration and some support non-default
  configurations selected by network.
</p>
</li>
<li>
<p>
Most preprocessors have port configurations.
</p>
</li>
<li>
<p>
The default policy may also contain a list of ports to ignore.
</p>
</li>
</ul></div>
<div class="paragraph"><p>In Snort 3, the above configurations are done in a single module called the
binder.  Here is an example:</p></div>
<div class="literalblock">
<div class="content">
<pre><code>binder =
{
    -- allow all tcp port 22:
    -- (similar to Snort 2 config ignore_ports)
    { when = { proto = 'tcp', ports = '22' }, use = { action = 'allow' } },</code></pre>
</div></div>
<div class="literalblock">
<div class="content">
<pre><code>-- select a config file by vlan
-- (similar to Snort 2 config binding by vlan)
{ when = { vlans = '1024' }, use = { file = 'vlan.lua' } },</code></pre>
</div></div>
<div class="literalblock">
<div class="content">
<pre><code>-- use a non-default HTTP inspector for port 8080:
-- (similar to a Snort 2 targeted preprocessor config)
{ when = { nets = '192.168.0.0/16', proto = 'tcp', ports = '8080' },
  use = { name = 'alt_http', type = 'http_inspect' } },</code></pre>
</div></div>
<div class="literalblock">
<div class="content">
<pre><code>-- use the default inspectors:
-- (similar to a Snort 2 default preprocessor config)
{ when = { proto = 'tcp' }, use = { type = 'stream_tcp' } },
{ when = { service = 'http' }, use = { type = 'http_inspect' } },</code></pre>
</div></div>
<div class="literalblock">
<div class="content">
<pre><code>    -- figure out which inspector to run automatically:
    { use = { type = 'wizard' } }
}</code></pre>
</div></div>
<div class="paragraph"><p>Bindings are evaluated when a session starts and again if and when service is
identified on the session.  Essentially, the bindings are a list of when-use
rules evaluated from top to bottom.  The first matching network and service
configurations are applied.  binder.when can contain any combination of
criteria and binder.use can specify an action, config file, or inspector
configuration.</p></div>
<div class="paragraph"><p>If binder is not explicitly configured (via file *.lua or option --lua),
a default binder will be instantiated in which bindings will be created for all
service inspectors configured. Some bindings may require a configured wizard to
detect the service type.</p></div>
</div>
<div class="sect2">
<h3 id="_byte_rule_options">Byte rule options</h3>
<div class="sect3">
<h4 id="_byte_test">byte_test</h4>
<div class="paragraph"><p>This rule option tests a byte field against a specific value (with
operator). Capable of testing binary values or converting
representative byte strings to their binary equivalent and testing them.</p></div>
<div class="paragraph"><p>Snort uses the C operators for each of these operators. If the &amp;
operator is used, then it would be the same as using</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span>data <span style="color: #990000">&amp;</span> value<span style="color: #990000">)</span> <span style="color: #FF0000">{</span> <span style="font-weight: bold"><span style="color: #000000">do_something</span></span><span style="color: #990000">();</span> <span style="color: #FF0000">}</span></tt></pre></div></div>
<div class="paragraph"><p><em>!</em> operator negates the results from the base check. <em>!&lt;oper&gt;</em> is
considered as</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="color: #990000">!(</span>data <span style="color: #990000">&lt;</span>oper<span style="color: #990000">&gt;</span> value<span style="color: #990000">)</span></tt></pre></div></div>
<div class="paragraph"><p>Note:
The bitmask option applies bitwise AND operator on the bytes
converted. The result will be right-shifted by the number of bits
equal to the number of trailing zeros in the mask.
This applies for the other rule options as well.</p></div>
<div class="sect4">
<h5 id="_examples">Examples</h5>
<div class="literalblock">
<div class="content">
<pre><code>alert tcp (byte_test:2, =, 568, 0, bitmask 0x3FF0;)</code></pre>
</div></div>
<div class="paragraph"><p>This example extracts 2 bytes at offset 0, performs bitwise and with
bitmask 0x3FF0, shifts the result by 4 bits and compares to 568.</p></div>
<div class="literalblock">
<div class="content">
<pre><code>alert udp (byte_test:4, =, 1234, 0, string, dec;
    msg:"got 1234!";)</code></pre>
</div></div>
<div class="literalblock">
<div class="content">
<pre><code>alert udp (byte_test:8, =, 0xdeadbeef, 0, string, hex;
    msg:"got DEADBEEF!";)</code></pre>
</div></div>
</div>
</div>
<div class="sect3">
<h4 id="_byte_jump">byte_jump</h4>
<div class="paragraph"><p>The byte_jump rule option allows rules to be written for length
encoded protocols trivially. By having an option that reads the
length of a portion of data, then skips that far forward in the
packet, rules can be written that skip over specific portions of
length-encoded protocols and perform detection in very specific
locations.</p></div>
<div class="sect4">
<h5 id="_examples_2">Examples</h5>
<div class="literalblock">
<div class="content">
<pre><code>alert tcp (content:"Begin";
    byte_jump:0, 0, from_end, post_offset -6;
    content:"end..", distance 0, within 5;
    msg:"Content match from end of the payload";)</code></pre>
</div></div>
<div class="literalblock">
<div class="content">
<pre><code>alert tcp (content:"catalog";
    byte_jump:2, 1, relative, post_offset 2, bitmask 0x03f0;
    byte_test:2, =, 968, 0, relative;
    msg:"Bitmask applied on the 2 bytes extracted for byte_jump";)</code></pre>
</div></div>
</div>
</div>
<div class="sect3">
<h4 id="_byte_extract">byte_extract</h4>
<div class="paragraph"><p>The byte_extract keyword is another useful option for writing rules
against length-encoded protocols. It reads in some number of bytes
from the packet payload and saves it to a variable. These variables
can be referenced later in the rule, instead of using hard-coded values.</p></div>
<div class="sect4">
<h5 id="_other_options_which_use_byte_extract_variables">Other options which use byte_extract variables</h5>
<div class="paragraph"><p>A byte_extract rule option detects nothing by itself. Its use is in
extracting packet data for use in other rule options.</p></div>
<div class="paragraph"><p>Here is a list of places where byte_extract variables can be used:</p></div>
<div class="ulist"><ul>
<li>
<p>
content/uricontent: offset, depth, distance, within
</p>
</li>
<li>
<p>
byte_test: offset, value
</p>
</li>
<li>
<p>
byte_jump: offset, post_offset
</p>
</li>
<li>
<p>
isdataat: offset
</p>
</li>
</ul></div>
</div>
<div class="sect4">
<h5 id="_examples_3">Examples</h5>
<div class="literalblock">
<div class="content">
<pre><code>alert tcp (byte_extract:1, 0, str_offset;
    byte_extract:1, 1, str_depth;
    content:"bad stuff", offset str_offset, depth str_depth;
    msg:"Bad Stuff detected within field";)</code></pre>
</div></div>
<div class="literalblock">
<div class="content">
<pre><code>alert tcp (content:"START"; byte_extract:1, 0, myvar, relative;
    byte_jump:1, 3, relative, post_offset myvar;
    content:"END", distance 6, within 3;
    msg: "byte_jump - pass variable to post_offset";)</code></pre>
</div></div>
<div class="paragraph"><p>This example uses two variables.</p></div>
<div class="paragraph"><p>The first variable keeps the offset of a string, read from a byte at offset 0.
The second variable keeps the depth of a string, read from a byte at offset 1.
These values are used to constrain a pattern match to a smaller area.</p></div>
<div class="literalblock">
<div class="content">
<pre><code>alert tcp (content:"|04 63 34 35|", offset 4, depth 4;
    byte_extract: 2, 0, var_match, relative, bitmask 0x03ff;
    byte_test: 2, =, var_match, 2, relative;
    msg:"Test value match, after applying bitmask on bytes extracted";)</code></pre>
</div></div>
</div>
</div>
<div class="sect3">
<h4 id="_byte_math">byte_math</h4>
<div class="paragraph"><p>Perform a mathematical operation on an extracted value and a specified
value or existing variable, and store the outcome in a new resulting
variable. These resulting variables can be referenced later in the
rule, at the same places as byte_extract variables.</p></div>
<div class="paragraph"><p>The syntax for this rule option is different. The order of the options
is critical for the other rule options and can’t be changed. For
example, the first option is the number of bytes to extract.
Here the name of the option is explicitly written, for example : bytes 2.
The order is not important.</p></div>
<div class="admonitionblock">
<table><tbody><tr>
<td class="icon">
<img src="./Snort 3 User Manual_files/note.png" alt="Note">
</td>
<td class="content">Byte_math operations are performed on unsigned 32-bit values. When
      writing a rule it should be taken into consideration to avoid wrap around.</td>
</tr></tbody></table>
</div>
<div class="sect4">
<h5 id="_examples_4">Examples</h5>
<div class="literalblock">
<div class="content">
<pre><code>alert tcp ( byte_math: bytes 2, offset 0, oper *, rvalue 10, result area;
   byte_test:2,&gt;,area,16;)</code></pre>
</div></div>
<div class="paragraph"><p>At the zero offset of the payload, extract 2 bytes and apply multiplication operation with
value 10. Store result in variable area. The area variable is given as
input to byte_test value option.</p></div>
<div class="paragraph"><p>Let’s consider 2 bytes of extracted data is 5. The rvalue is 10.
Result variable area is 50 ( 5 * 10 ).
Area variable can be used in either byte_test offset/value options.</p></div>
</div>
</div>
<div class="sect3">
<h4 id="_testing_numerical_values">Testing Numerical Values</h4>
<div class="paragraph"><p>The rule options byte_test and byte_jump were written to support
writing rules for protocols that have length encoded data. RPC was
the protocol that spawned the requirement for these two rule options,
as RPC uses simple length based encoding for passing data.</p></div>
<div class="paragraph"><p>In order to understand why byte test and byte jump are useful, let’s
go through an exploit attempt against the sadmind service.</p></div>
<div class="paragraph"><p>This is the payload of the exploit:</p></div>
<div class="literalblock">
<div class="content">
<pre><code>89 09 9c e2 00 00 00 00 00 00 00 02 00 01 87 88  ................
00 00 00 0a 00 00 00 01 00 00 00 01 00 00 00 20  ...............
40 28 3a 10 00 00 00 0a 4d 45 54 41 53 50 4c 4f  @(:.....metasplo
49 54 00 00 00 00 00 00 00 00 00 00 00 00 00 00  it..............
00 00 00 00 00 00 00 00 40 28 3a 14 00 07 45 df  ........@(:...e.
00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00  ................
00 00 00 00 00 00 00 06 00 00 00 00 00 00 00 00  ................
00 00 00 00 00 00 00 04 00 00 00 00 00 00 00 04  ................
7f 00 00 01 00 01 87 88 00 00 00 0a 00 00 00 04  ................
7f 00 00 01 00 01 87 88 00 00 00 0a 00 00 00 11  ................
00 00 00 1e 00 00 00 00 00 00 00 00 00 00 00 00  ................
00 00 00 00 00 00 00 3b 4d 45 54 41 53 50 4c 4f  .......;metasplo
49 54 00 00 00 00 00 00 00 00 00 00 00 00 00 00  it..............
00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00  ................
00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00  ................
00 00 00 00 00 00 00 06 73 79 73 74 65 6d 00 00  ........system..
00 00 00 15 2e 2e 2f 2e 2e 2f 2e 2e 2f 2e 2e 2f  ....../../../../
2e 2e 2f 62 69 6e 2f 73 68 00 00 00 00 00 04 1e  ../bin/sh.......</code></pre>
</div></div>
<div class="paragraph"><p>Let’s break this up, describe each of the fields, and figure out how to write a
rule to catch this exploit.</p></div>
<div class="paragraph"><p>There are a few things to note with RPC:</p></div>
<div class="paragraph"><p>Numbers are written as uint32s, taking four bytes.  The number 26 would
show up as 0x0000001a.</p></div>
<div class="paragraph"><p>Strings are written as a uint32 specifying the length of the string, the
string, and then null bytes to pad the length of the string to end on a 4-byte
boundary.  The string <em>bob</em> would show up as 0x00000003626f6200.</p></div>
<div class="literalblock">
<div class="content">
<pre><code>89 09 9c e2     - the request id, a random uint32, unique to each request
00 00 00 00     - rpc type (call = 0, response = 1)
00 00 00 02     - rpc version (2)
00 01 87 88     - rpc program (0x00018788 = 100232 = sadmind)
00 00 00 0a     - rpc program version (0x0000000a = 10)
00 00 00 01     - rpc procedure (0x00000001 = 1)
00 00 00 01     - credential flavor (1 = auth_unix)
00 00 00 20     - length of auth_unix data (0x20 = 32)</code></pre>
</div></div>
<div class="literalblock">
<div class="content">
<pre><code>## the next 32 bytes are the auth_unix data
40 28 3a 10 - unix timestamp (0x40283a10 = 1076378128 = feb 10 01:55:28 2004 gmt)
00 00 00 0a - length of the client machine name (0x0a = 10)
4d 45 54 41 53 50 4c 4f 49 54 00 00  - metasploit</code></pre>
</div></div>
<div class="literalblock">
<div class="content">
<pre><code>00 00 00 00 - uid of requesting user (0)
00 00 00 00 - gid of requesting user (0)
00 00 00 00 - extra group ids (0)</code></pre>
</div></div>
<div class="literalblock">
<div class="content">
<pre><code>00 00 00 00 - verifier flavor (0 = auth_null, aka none)
00 00 00 00 - length of verifier (0, aka none)</code></pre>
</div></div>
<div class="paragraph"><p>The rest of the packet is the request that gets passed to procedure 1 of
sadmind.</p></div>
<div class="paragraph"><p>However, we know the vulnerability is that sadmind trusts the uid coming from
the client.  sadmind runs any request where the client’s uid is 0 as root.  As
such, we have decoded enough of the request to write our rule.</p></div>
<div class="paragraph"><p>First, we need to make sure that our packet is an RPC call.</p></div>
<div class="literalblock">
<div class="content">
<pre><code>content:"|00 00 00 00|", offset 4, depth 4;</code></pre>
</div></div>
<div class="paragraph"><p>Then, we need to make sure that our packet is a call to sadmind.</p></div>
<div class="literalblock">
<div class="content">
<pre><code>content:"|00 01 87 88|", offset 12, depth 4;</code></pre>
</div></div>
<div class="paragraph"><p>Then, we need to make sure that our packet is a call to the procedure 1, the
vulnerable procedure.</p></div>
<div class="literalblock">
<div class="content">
<pre><code>content:"|00 00 00 01|", offset 20, depth 4;</code></pre>
</div></div>
<div class="paragraph"><p>Then, we need to make sure that our packet has auth_unix credentials.</p></div>
<div class="literalblock">
<div class="content">
<pre><code>content:"|00 00 00 01|", offset 24, depth 4;</code></pre>
</div></div>
<div class="paragraph"><p>We don’t care about the hostname, but we want to skip over it and check a
number value after the hostname.  This is where byte_test is useful.  Starting
at the length of the hostname, the data we have is:</p></div>
<div class="literalblock">
<div class="content">
<pre><code>00 00 00 0a 4d 45 54 41 53 50 4c 4f 49 54 00 00
00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
00 00 00 00</code></pre>
</div></div>
<div class="paragraph"><p>We want to read 4 bytes, turn it into a number, and jump that many bytes
forward, making sure to account for the padding that RPC requires on strings.
If we do that, we are now at:</p></div>
<div class="literalblock">
<div class="content">
<pre><code>00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
00 00 00 00</code></pre>
</div></div>
<div class="paragraph"><p>which happens to be the exact location of the uid, the value we want to check.</p></div>
<div class="paragraph"><p>In English, we want to read 4 bytes, 36 bytes from the beginning of the packet,
and turn those 4 bytes into an integer and jump that many bytes forward,
aligning on the 4-byte boundary.  To do that in a Snort rule, we use:</p></div>
<div class="literalblock">
<div class="content">
<pre><code>byte_jump:4,36,align;</code></pre>
</div></div>
<div class="paragraph"><p>then we want to look for the uid of 0.</p></div>
<div class="literalblock">
<div class="content">
<pre><code>content:"|00 00 00 00|", within 4;</code></pre>
</div></div>
<div class="paragraph"><p>Now that we have all the detection capabilities for our rule, let’s put them
all together.</p></div>
<div class="literalblock">
<div class="content">
<pre><code>content:"|00 00 00 00|", offset 4, depth 4;
content:"|00 01 87 88|", offset 12, depth 4;
content:"|00 00 00 01|", offset 20, depth 4;
content:"|00 00 00 01|", offset 24, depth 4;
byte_jump:4,36,align;
content:"|00 00 00 00|", within 4;</code></pre>
</div></div>
<div class="paragraph"><p>The 3rd and fourth string match are right next to each other, so we should
combine those patterns.  We end up with:</p></div>
<div class="literalblock">
<div class="content">
<pre><code>content:"|00 00 00 00|", offset 4, depth 4;
content:"|00 01 87 88|", offset 12, depth 4;
content:"|00 00 00 01 00 00 00 01|", offset 20, depth 8;
byte_jump:4,36,align;
content:"|00 00 00 00|", within 4;</code></pre>
</div></div>
<div class="paragraph"><p>If the sadmind service was vulnerable to a buffer overflow when reading the
client’s hostname, instead of reading the length of the hostname and jumping
that many bytes forward, we would check the length of the hostname to make sure
it is not too large.</p></div>
<div class="paragraph"><p>To do that, we would read 4 bytes, starting 36 bytes into the packet, turn it
into a number, and then make sure it is not too large (let’s say bigger than
200 bytes).  In Snort, we do:</p></div>
<div class="literalblock">
<div class="content">
<pre><code>byte_test:4,&gt;,200,36;</code></pre>
</div></div>
<div class="paragraph"><p>Our full rule would be:</p></div>
<div class="literalblock">
<div class="content">
<pre><code>content:"|00 00 00 00|", offset 4, depth 4;
content:"|00 01 87 88|", offset 12, depth 4;
content:"|00 00 00 01 00 00 00 01|", offset 20, depth 8;
byte_test:4,&gt;,200,36;</code></pre>
</div></div>
<div class="paragraph"><p>In case of using any byte_* option with "string" parameter, the amount of bytes
to be extracted from payload can be less than specified by user.
This might happen when the buffer has fewer bytes (from the cursor position)
than specified in the option.</p></div>
</div>
</div>
<div class="sect2">
<h3 id="_consolidated_config">Consolidated Config</h3>
<div class="paragraph"><p>Config dump mode generates a consolidated dump of the config passed to Snort.
This output consists of the configured values as well as the module defaults
for the values that aren’t configured.</p></div>
<div class="paragraph"><p>In the dump mode Snort validates the config (similar to option -T)
and suppresses unrelated messages going to stdout
(configuration warnings and errors are still printed to stderr).</p></div>
<div class="paragraph"><p>The dump mode is activated by the following options:
--dump-config-text, --dump-config=all, --dump-config=top.
They are described in detail below.</p></div>
<div class="paragraph"><p>The simple configuration is used in examples.
The output contains applied configurations (defaults and configured).
To simplify the output we show a brief list of default options.</p></div>
<div class="paragraph"><p>snort.lua</p></div>
<div class="literalblock">
<div class="content">
<pre><code>stream =
{
    max_flows = 2
}</code></pre>
</div></div>
<div class="literalblock">
<div class="content">
<pre><code>stream_tcp =
{
    show_rebuilt_packets = true
}</code></pre>
</div></div>
<div class="literalblock">
<div class="content">
<pre><code>binder =
{
    { when = { nets = '10.1.2.0/24' }, use = { inspection_policy = 'http.lua' } },
    { when = { nets = '192.168.2.0/24' }, use = { inspection_policy = 'sip.lua' } },
}</code></pre>
</div></div>
<div class="paragraph"><p>http.lua</p></div>
<div class="literalblock">
<div class="content">
<pre><code>wizard =
{
    spells =
    {
        { service = 'http', proto = 'tcp', to_server = { 'GET' }, to_client = { 'HTTP/' } },
    }
}</code></pre>
</div></div>
<div class="paragraph"><p>sip.lua</p></div>
<div class="literalblock">
<div class="content">
<pre><code>wizard =
{
    spells =
    {
        { service = 'sip', to_server = { 'INVITE' } },
    }
}</code></pre>
</div></div>
<div class="sect3">
<h4 id="_text_format">Text Format</h4>
<div class="paragraph"><p>The --dump-config-text option verifies the configuration and dumps it to stdout in text format.
The output contains a config of the main policy and all other included sub-policies.</p></div>
<div class="paragraph"><p>Example:
    snort -c snort.lua --dump-config-text</p></div>
<div class="literalblock">
<div class="content">
<pre><code>consolidated config for snort.lua
alerts.order="pass reset block drop alert log"
alerts.rate_filter_memcap=1048576
binder[0].when.ips_policy_id=0
binder[0].when.role="any"
binder[0].when.nets="10.1.2.0/24"
binder[0].use.action="inspect"
binder[0].use.inspection_policy="http.lua"
binder[1].when.ips_policy_id=0
binder[1].when.role="any"
binder[1].when.nets="192.168.2.0/24"
binder[1].use.action="inspect"
binder[1].use.inspection_policy="sip.lua"
output.obfuscate=false
output.wide_hex_dump=true
packets.address_space_agnostic=false
packets.limit=0
search_engine.split_any_any=true
search_engine.queue_limit=128
stream.file_cache.idle_timeout=180
stream.file_cache.cap_weight=32
stream.max_flows=2
stream_tcp.small_segments.maximum_size=0
stream_tcp.session_timeout=30
stream_tcp.track_only=false
stream_tcp.show_rebuilt_packets=true
consolidated config for http.lua
wizard.spells[0].proto="tcp"
wizard.spells[0].service="http"
wizard.spells[0].to_client[0].spell="HTTP/"
wizard.spells[0].to_server[0].spell="GET"
consolidated config for sip.lua
wizard.spells[0].proto="tcp"
wizard.spells[0].service="sip"
wizard.spells[0].to_server[0].spell="INVITE"</code></pre>
</div></div>
<div class="paragraph"><p>For lists, the index next to the option name designates an element parsing order.</p></div>
</div>
<div class="sect3">
<h4 id="_json_format">JSON Format</h4>
<div class="paragraph"><p>The --dump-config=all command-line option verifies the configuration and dumps it to
stdout in JSON format. The output contains a config of the main policy and all other
included sub-policies. Snort dumps output in a one-line format.</p></div>
<div class="paragraph"><p>There is 3rd party tool <em>jq</em> for converting to a pretty printed format.</p></div>
<div class="paragraph"><p>Example:
    snort -c snort.lua --dump-config=all | jq <em>.</em></p></div>
<div class="literalblock">
<div class="content">
<pre><code>[
    {
        "filename": "snort.lua",
        "config": {
        "alerts": {
            "order": "pass reset block drop alert log",
            "rate_filter_memcap": 1048576
        },
        "binder": [
            {
            "when": {
                "ips_policy_id": 0,
                "role": "any",
                "nets": "10.1.2.0/24"
            },
            "use": {
                "action": "inspect",
                "inspection_policy": "http.lua"
            }
            },
            {
            "when": {
                "ips_policy_id": 0,
                "role": "any",
                "nets": "192.168.2.0/24"
            },
            "use": {
                "action": "inspect",
                "inspection_policy": "sip.lua"
            }
            }
        ],
        "output": {
            "obfuscate": false,
            "wide_hex_dump": true
        },
        "packets": {
            "address_space_agnostic": false,
            "limit": 0
        },
        "process": {
            "daemon": false,
            "dirty_pig": false,
            "utc": false
        },
        "search_engine": {
            "split_any_any": true,
            "queue_limit": 128
        },
        "stream": {
            "file_cache": {
            "idle_timeout": 180,
            "cap_weight": 32
            },
            "max_flows": 2
        },
        "stream_tcp": {
            "small_segments": {
                "maximum_size": 0
            },
            "session_timeout": 30,
            "track_only": false,
            "show_rebuilt_packets": true
        }
        }
    },
    {
        "filename": "http.lua",
        "config": {
        "wizard": {
            "spells": [
            {
                "proto": "tcp",
                "service": "http",
                "to_client": [
                {
                    "spell": "HTTP/"
                }
                ],
                "to_server": [
                {
                    "spell": "GET"
                }
                ]
            }
            ]
        }
        }
    },
    {
        "filename": "sip.lua",
        "config": {
        "wizard": {
            "spells": [
            {
                "proto": "tcp",
                "service": "sip",
                "to_server": [
                {
                    "spell": "INVITE"
                }
                ]
            }
            ]
        }
        }
    }
]</code></pre>
</div></div>
<div class="paragraph"><p>The --dump-config=top command-line option is similar to --dump-config=all,
except it produces dump for the main policy only.
It verifies the configuration and dumps the main policy configuration to
stdout in JSON format.</p></div>
<div class="paragraph"><p>Example:
    snort -c snort.lua --dump-config=top | jq <em>.</em></p></div>
<div class="literalblock">
<div class="content">
<pre><code>{
    "alerts": {
        "order": "pass reset block drop alert log",
        "rate_filter_memcap": 1048576,
    },
    "binder": [
        {
            "when": {
                "ips_policy_id": 0,
                "role": "any",
                "nets": "10.1.2.0/24"
            },
            "use": {
                "action": "inspect",
                "inspection_policy": "http.lua"
            }
        },
        {
            "when": {
                "ips_policy_id": 0,
                "role": "any",
                "nets": "192.168.2.0/24"
            },
            "use": {
                "action": "inspect",
                "inspection_policy": "sip.lua"
            }
        }
    ],
    "output": {
        "obfuscate": false,
        "wide_hex_dump": true
    },
    "packets": {
        "address_space_agnostic": false,
        "limit": 0,
    },
    "process": {
        "daemon": false,
        "dirty_pig": false,
        "utc": false
    },
    "search_engine": {
        "split_any_any": true,
        "queue_limit": 128
    },
    "stream": {
        "file_cache": {
            "idle_timeout": 180,
            "cap_weight": 32
        }
        "max_flows": 2
    },
    "stream_tcp": {
        "small_segments": {
            "count": 0,
            "maximum_size": 0
        },
        "session_timeout": 30,
        "track_only": false,
        "show_rebuilt_packets": true
    },
}</code></pre>
</div></div>
</div>
</div>
<div class="sect2">
<h3 id="_dce_inspectors">DCE Inspectors</h3>
<div class="paragraph"><p>The main purpose of these inspector are to perform SMB desegmentation and
DCE/RPC defragmentation to avoid rule evasion using these techniques.</p></div>
<div class="sect3">
<h4 id="_overview_3">Overview</h4>
<div class="paragraph"><p>The following transports are supported for DCE/RPC: SMB, TCP, and UDP.
New rule options have been implemented to improve performance, reduce false
positives and reduce the count and complexity of DCE/RPC based rules.</p></div>
<div class="paragraph"><p>Different from Snort 2, the DCE-RPC preprocessor is split into three inspectors
 - one for each transport: dce_smb, dce_tcp, dce_udp. This includes the
configuration as well as the inspector modules. The Snort 2 server configuration
is now split between the inspectors. Options that are meaningful to all
inspectors, such as policy and defragmentation, are copied into each inspector
configuration. The address/port mapping is handled by the binder. Autodetect
functionality is replaced by wizard curses.</p></div>
</div>
<div class="sect3">
<h4 id="_quick_guide">Quick Guide</h4>
<div class="paragraph"><p>A typical dcerpce configuration looks like this:</p></div>
<div class="literalblock">
<div class="content">
<pre><code>binder =
{
   {
       when =
       {
           proto = 'tcp',
           ports = '139 445 1025',
        },
       use =
       {
           type = 'dce_smb',
       },
    },
    {
       when =
       {
           proto = 'tcp',
           ports = '135 2103',
       },
       use =
       {
           type = 'dce_tcp',
       },
    },
    {
       when =
       {
           proto = 'udp',
           ports = '1030',
       },
       use =
       {
           type = 'dce_udp',
       },
    }
 }</code></pre>
</div></div>
<div class="literalblock">
<div class="content">
<pre><code>dce_smb = { }</code></pre>
</div></div>
<div class="literalblock">
<div class="content">
<pre><code>dce_tcp = { }</code></pre>
</div></div>
<div class="literalblock">
<div class="content">
<pre><code>dce_udp = { }</code></pre>
</div></div>
<div class="paragraph"><p>In this example, it defines smb, tcp and udp inspectors based on port. All the
configurations are default.</p></div>
</div>
<div class="sect3">
<h4 id="_target_based">Target Based</h4>
<div class="paragraph"><p>There are enough important differences between Windows and Samba versions that
a target based approach has been implemented. Some important differences:</p></div>
<div class="ulist"><ul>
<li>
<p>
Named pipe instance tracking
</p>
</li>
<li>
<p>
Accepted SMB commands
</p>
</li>
<li>
<p>
AndX command chaining
</p>
</li>
<li>
<p>
Transaction tracking
</p>
</li>
<li>
<p>
Multiple Bind requests
</p>
</li>
<li>
<p>
DCE/RPC Fragmented requests - Context ID
</p>
</li>
<li>
<p>
DCE/RPC Fragmented requests - Operation number
</p>
</li>
<li>
<p>
DCE/RPC Stub data byte order
</p>
</li>
</ul></div>
<div class="paragraph"><p>Because of those differences, each inspector can be configured to different
policy. Here are the list of policies supported:</p></div>
<div class="ulist"><ul>
<li>
<p>
WinXP (default)
</p>
</li>
<li>
<p>
Win2000
</p>
</li>
<li>
<p>
WinVista
</p>
</li>
<li>
<p>
Win2003
</p>
</li>
<li>
<p>
Win2008
</p>
</li>
<li>
<p>
Win7
</p>
</li>
<li>
<p>
Samba
</p>
</li>
<li>
<p>
Samba-3.0.37
</p>
</li>
<li>
<p>
Samba-3.0.22
</p>
</li>
<li>
<p>
Samba-3.0.20
</p>
</li>
</ul></div>
</div>
<div class="sect3">
<h4 id="_reassembling">Reassembling</h4>
<div class="paragraph"><p>Both SMB inspector and TCP inspector support reassemble. Reassemble threshold
specifies a minimum number of bytes in the DCE/RPC desegmentation and
defragmentation buffers before creating a reassembly packet to send to the
detection engine. This option is useful in inline mode so as to potentially
catch an exploit early before full defragmentation is done. A value of 0 s
supplied as an argument to this option will, in effect, disable this option.
Default is disabled.</p></div>
</div>
<div class="sect3">
<h4 id="_smb">SMB</h4>
<div class="paragraph"><p>SMB inspector is one of the most complex inspectors. In addition to supporting
rule options and lots of inspector rule events, it also supports file
processing for both SMB version 1, 2, and 3.</p></div>
<div class="sect4">
<h5 id="_finger_print_policy">Finger Print Policy</h5>
<div class="paragraph"><p>In the initial phase of an SMB session, the client needs to authenticate with a
SessionSetupAndX.  Both the request and response to this command contain OS and
version information that can allow the inspector to dynamically set the policy
for a session which allows for better protection against Windows and Samba
specific evasions.</p></div>
</div>
<div class="sect4">
<h5 id="_file_inspection">File Inspection</h5>
<div class="paragraph"><p>SMB inspector supports file inspection. A typical configuration looks like this:</p></div>
<div class="literalblock">
<div class="content">
<pre><code>binder =
{
   {
       when =
       {
           proto = 'tcp',
           ports = '139 445',
       },
       use =
       {
           type = 'dce_smb',
       },
   },
}</code></pre>
</div></div>
<div class="literalblock">
<div class="content">
<pre><code>dce_smb =
{
    smb_file_inspection = 'on',
    smb_file_depth = 0,
 }</code></pre>
</div></div>
<div class="literalblock">
<div class="content">
<pre><code>file_id =
{
    enable_type = true,
    enable_signature = true,
    enable_capture = true,
    file_rules = magics,
}</code></pre>
</div></div>
<div class="paragraph"><p>First, define a binder to map tcp port 139 and 445 to smb. Then, enable file
inspection in smb inspection and set the file depth as unlimited. Lastly, enable
file inspector to inspect file type, calculate file signature, and capture file.
The details of file inspector are explained in file processing section.</p></div>
<div class="paragraph"><p>SMB inspector does inspection of normal SMB file transfers.  This includes doing
file type and signature through the file processing as well as setting a pointer
for the "file_data" rule option.  Note that the "file_depth" option only applies
to the maximum amount of file data for which it will set the pointer for the
"file_data" rule option.  For file type and signature it will use the value
configured for the file API.  If "only" is specified, the inspector will only
do SMB file inspection, i.e. it will not do any DCE/RPC tracking or inspection.
If "on" is specified with no arguments, the default file depth is 16384 bytes.
An argument of -1 to "file-depth" disables setting the pointer for "file_data",
effectively disabling SMB file inspection in rules.  An argument of 0 to
"file_depth" means unlimited.  Default is "off", i.e. no SMB file inspection is
 done in the inspector.</p></div>
</div>
</div>
<div class="sect3">
<h4 id="_tcp">TCP</h4>
<div class="paragraph"><p>dce_tcp inspector supports defragmentation, reassembling, and policy that is
similar to SMB.</p></div>
</div>
<div class="sect3">
<h4 id="_udp">UDP</h4>
<div class="paragraph"><p>dce_udp is a very simple inspector that only supports defragmentation</p></div>
</div>
<div class="sect3">
<h4 id="_rule_options">Rule Options</h4>
<div class="paragraph"><p>New rule options are supported by enabling the dcerpc2 inspectors:</p></div>
<div class="ulist"><ul>
<li>
<p>
dce_iface
</p>
</li>
<li>
<p>
dce_opnum
</p>
</li>
<li>
<p>
dce_stub_data
</p>
</li>
</ul></div>
<div class="paragraph"><p>New modifiers to existing byte_test and byte_jump rule options:</p></div>
<div class="ulist"><ul>
<li>
<p>
byte_test: dce
</p>
</li>
<li>
<p>
byte_jump: dce
</p>
</li>
</ul></div>
<div class="sect4">
<h5 id="_dce_iface">dce_iface</h5>
<div class="paragraph"><p>For DCE/RPC based rules it has been necessary to set flow-bits based on a client
bind to a service to avoid false positives. It is necessary for a client to bind
to a service before being able to make a call to it. When a client sends a bind
request to the server, it can, however, specify one or more service interfaces
to bind to.  Each interface is represented by a UUID. Each interface UUID is
paired with a unique index (or context id) that future requests can use to
reference the service that the client is making a call to. The server will
respond with the interface UUIDs it accepts as valid and will allow the client
to make requests to those services.  When a client makes a request, it will
specify the context id so the server knows what service the client is making a
request to. Instead of using flow-bits, a rule can simply ask the inspector,
using this rule option, whether or not the client has bound to a specific
interface UUID and whether or not this client request is making a request to it.
This can eliminate false positives where more than one service is bound to
successfully since the inspector can correlate the bind UUID to the context
id used in the request.  A DCE/RPC request can specify whether numbers are
represented as big endian or little endian. The representation of the interface
UUID is different depending on the endianness specified in the DCE/RPC
previously requiring two rules - one for big endian and one for little endian.
The inspector eliminates the need for two rules by normalizing the UUID.
An interface contains a version. Some versions of an interface may not be
vulnerable to a certain exploit.  Also, a DCE/RPC request can be broken up into
1 or more fragments. Flags (and a field in the connectionless header) are set in
the DCE/RPC header to indicate whether the fragment is the first, a middle or
the last fragment. Many checks for data in the DCE/RPC request are only relevant
if the DCE/RPC request is a first fragment (or full request), since subsequent
fragments will contain data deeper into the DCE/RPC request. A rule which is
looking for data, say 5 bytes into the request (maybe it’s a length field), will
be looking at the wrong data on a fragment other than the first, since the
beginning of subsequent fragments are already offset some length from the
beginning of the request. This can be a source of false positives in fragmented
DCE/RPC traffic. By default it is reasonable to only evaluate if the request is
a first fragment (or full request). However, if the "any_frag" option is used to
specify evaluating on all fragments.</p></div>
<div class="paragraph"><p>Examples:</p></div>
<div class="literalblock">
<div class="content">
<pre><code>dce_iface: 4b324fc8-1670-01d3-1278-5a47bf6ee188;
dce_iface: 4b324fc8-1670-01d3-1278-5a47bf6ee188,&lt;2;
dce_iface: 4b324fc8-1670-01d3-1278-5a47bf6ee188,any_frag;
dce_iface: 4b324fc8-1670-01d3-1278-5a47bf6ee188,=1,any_frag;</code></pre>
</div></div>
<div class="paragraph"><p>This option is used to specify an interface UUID. Optional arguments are an
interface version and operator to specify that the version be less than (<em>&lt;</em>),
greater than (<em>&gt;</em>), equal to (<em>=</em>) or not equal to (<em>!</em>) the version specified.
Also, by default the rule will only be evaluated for a first fragment (or full
request, i.e. not a fragment) since most rules are written to start at the
beginning of a request. The "any_frag" argument says to evaluate for middle and
last fragments as well.  This option requires tracking client Bind and
Alter Context requests as well as server Bind Ack and Alter Context responses
for connection-oriented DCE/RPC in the inspector. For each Bind and
Alter Context request, the client specifies a list of interface UUIDs along
with a handle (or context id) for each interface UUID that will be used during
the DCE/RPC session to reference the interface.  The server response indicates
which interfaces it will allow the client to make requests to - it either
accepts or rejects the client’s wish to bind to a certain interface. This
tracking is required so that when a request is processed, the context id used
in the request can be correlated with the interface UUID it is a handle for.</p></div>
<div class="paragraph"><p>hexlong and hexshort will be specified and interpreted to be in big endian
order (this is usually the default way an interface UUID will be seen and
represented). As an example, the following Messenger interface UUID as taken
off the wire from a little endian Bind request:</p></div>
<div class="literalblock">
<div class="content">
<pre><code>|f8 91 7b 5a 00 ff d0 11 a9 b2 00 c0 4f b6 e6 fc|</code></pre>
</div></div>
<div class="paragraph"><p>must be written as:</p></div>
<div class="literalblock">
<div class="content">
<pre><code>5a7b91f8-ff00-11d0-a9b2-00c04fb6e6fc</code></pre>
</div></div>
<div class="paragraph"><p>The same UUID taken off the wire from a big endian Bind request:</p></div>
<div class="literalblock">
<div class="content">
<pre><code>|5a 7b 91 f8 ff 00 11 d0 a9 b2 00 c0 4f b6 e6 fc|</code></pre>
</div></div>
<div class="paragraph"><p>must be written the same way:</p></div>
<div class="literalblock">
<div class="content">
<pre><code>5a7b91f8-ff00-11d0-a9b2-00c04fb6e6fc</code></pre>
</div></div>
<div class="paragraph"><p>This option matches if the specified interface UUID matches the interface UUID
(as referred to by the context id) of the DCE/RPC request and if supplied, the
version operation is true. This option will not match if the fragment is not a
first fragment (or full request) unless the "any_frag" option is supplied in
which case only the interface UUID and version need match.  Note that a
defragmented DCE/RPC request will be considered a full request.</p></div>
<div class="paragraph"><p>Using this rule option will automatically insert fast pattern contents into
the fast pattern matcher.  For UDP rules, the interface UUID, in both big and
little endian format will be inserted into the fast pattern matcher.  For TCP
rules, (1) if the rule option "flow:to_server|from_client" is used, |05 00 00|
will be inserted into the fast pattern matcher, (2) if the rule option
"flow:from_server|to_client" is used, |05 00 02| will be inserted into the
fast pattern matcher and (3) if the flow isn’t known, |05 00| will be inserted
into the fast pattern matcher.  Note that if the rule already has content rule
options in it, the best (meaning longest) pattern will be used.  If a content
in the rule uses the fast_pattern rule option, it will unequivocally be used
over the above mentioned patterns.</p></div>
</div>
<div class="sect4">
<h5 id="_dce_opnum">dce_opnum</h5>
<div class="paragraph"><p>The opnum represents a specific function call to an interface. After is has
been determined that a client has bound to a specific interface and is making
a request to it (see above - dce_iface) usually we want to know what function
call it is making to that service. It is likely that an exploit lies in the
particular DCE/RPC function call.</p></div>
<div class="paragraph"><p>Examples:</p></div>
<div class="literalblock">
<div class="content">
<pre><code>dce_opnum: 15;
dce_opnum: 15-18;
dce_opnum: 15,18-20;
dce_opnum: 15,17,20-22;</code></pre>
</div></div>
<div class="paragraph"><p>This option is used to specify an opnum (or operation number), opnum range or
list containing either or both opnum and/or opnum-range. The opnum of a
DCE/RPC request will be matched against the opnums specified with this option.
This option matches if any one of the opnums specified match the opnum of the
DCE/RPC request.</p></div>
</div>
<div class="sect4">
<h5 id="_dce_stub_data">dce_stub_data</h5>
<div class="paragraph"><p>Since most DCE/RPC based rules had to do protocol decoding only to get to the
DCE/RPC stub data, i.e. the remote procedure call or function call data, this
option will alleviate this need and place the cursor at the beginning of the
DCE/RPC stub data. This reduces the number of rule option checks and the
complexity of the rule.</p></div>
<div class="paragraph"><p>This option takes no arguments.</p></div>
<div class="paragraph"><p>Example:</p></div>
<div class="literalblock">
<div class="content">
<pre><code>dce_stub_data;</code></pre>
</div></div>
<div class="paragraph"><p>This option is used to place the cursor (used to walk the packet payload in
rules processing) at the beginning of the DCE/RPC stub data, regardless of
preceding rule options. There are no arguments to this option.  This option
matches if there is DCE/RPC stub data.</p></div>
<div class="paragraph"><p>The cursor is moved to the beginning of the stub data.  All ensuing rule
options will be considered "sticky" to this buffer.  The first rule option
following dce_stub_data should use absolute location modifiers if it is
position-dependent.  Subsequent rule options should use a relative modifier if
they are meant to be relative to a previous rule option match in the stub data
buffer.  Any rule option that does not specify a relative modifier will be
evaluated from the start of the stub data buffer.  To leave the stub data buffer
and return to the main payload buffer, use the "pkt_data" rule option.</p></div>
</div>
<div class="sect4">
<h5 id="_byte_test_and_byte_jump">byte_test and byte_jump</h5>
<div class="paragraph"><p>A DCE/RPC request can specify whether numbers are represented in big or little
endian. These rule options will take as a new argument "dce" and will work
basically the same as the normal byte_test/byte_jump, but since the DCE/RPC
inspector will know the endianness of the request, it will be able to do
the correct conversion.</p></div>
<div class="paragraph"><p>Examples:</p></div>
<div class="literalblock">
<div class="content">
<pre><code>byte_test: 4,&gt;,35000,0,relative,dce;
byte_test: 2,!=,2280,-10,relative,dce;</code></pre>
</div></div>
<div class="paragraph"><p>When using the "dce" argument to a byte_test, the following normal byte_test
arguments will not be allowed: "big", "little", "string", "hex", "dec" and
"oct".</p></div>
<div class="paragraph"><p>Examples:</p></div>
<div class="literalblock">
<div class="content">
<pre><code>byte_jump:4,-4,relative,align,multiplier 2,post_offset -4,dce;</code></pre>
</div></div>
<div class="paragraph"><p>When using the dce argument to a byte_jump, the following normal byte_jump
arguments will not be allowed: "big", "little", "string", "hex", "dec", "oct"
and "from_beginning"</p></div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_file_processing">File Processing</h3>
<div class="paragraph"><p>With the volume of malware transferred through network increasing,
network file inspection becomes more and more important. This feature
will provide file type identification, file signature creation, and file
capture capabilities to help users deal with those challenges.</p></div>
<div class="sect3">
<h4 id="_overview_4">Overview</h4>
<div class="paragraph"><p>There are two parts of file services: file APIs and file policy.
File APIs provides all the file inspection functionalities, such as file
type identification, file signature calculation, and file capture.
File policy provides users ability to control file services, such
as enable/disable/configure file type identification, file signature, or
file capture.</p></div>
<div class="paragraph"><p>In addition to all capabilities from Snort 2, we support customized file
policy along with file event log.</p></div>
<div class="ulist"><ul>
<li>
<p>
Supported protocols: HTTP, SMTP, IMAP, POP3, FTP, and SMB.
</p>
</li>
<li>
<p>
Supported file signature calculation: SHA256
</p>
</li>
</ul></div>
</div>
<div class="sect3">
<h4 id="_quick_guide_2">Quick Guide</h4>
<div class="paragraph"><p>A very simple configuration has been included in lua/snort.lua file.
A typical file configuration looks like this:</p></div>
<div class="literalblock">
<div class="content">
<pre><code>dofile('magic.lua')</code></pre>
</div></div>
<div class="literalblock">
<div class="content">
<pre><code>my_file_policy =
{
    {  when = { file_type_id = 0 }, use = { verdict = 'log', enable_file_signature = true, enable_file_capture = true } }
    {  when = { file_type_id = 22 }, use = { verdict = 'log', enable_file_signature = true } },
    {  when = { sha256 = "F74DC976BC8387E7D4FC0716A069017A0C7ED13F309A523CC41A8739CCB7D4B6" }, use = { verdict = 'block'} },
}</code></pre>
</div></div>
<div class="literalblock">
<div class="content">
<pre><code>file_id =
{
    enable_type = true,
    enable_signature = true,
    enable_capture = true,
    file_rules = magics,
    trace_type = true,
    trace_signature = true,
    trace_stream = true,
    file_policy = my_file_policy,
 }</code></pre>
</div></div>
<div class="literalblock">
<div class="content">
<pre><code>file_log =
{
    log_pkt_time = true,
    log_sys_time = false,
}</code></pre>
</div></div>
<div class="paragraph"><p>There are 3 steps to enable file processing:</p></div>
<div class="ulist"><ul>
<li>
<p>
First, you need to include the file magic rules.
</p>
</li>
<li>
<p>
Then, define the file policy and configure the inspector
</p>
</li>
<li>
<p>
At last, enable file_log to get detailed information about file event
</p>
</li>
</ul></div>
</div>
<div class="sect3">
<h4 id="_pre_packaged_file_magic_rules">Pre-packaged File Magic Rules</h4>
<div class="paragraph"><p>A set of file magic rules is packaged with Snort. They can be located at
"lua/file_magic.rules". To use this feature, it is recommended that these
pre-packaged rules are used; doing so requires that you include
the file in your Snort configuration as such (already in snort.lua):</p></div>
<div class="literalblock">
<div class="content">
<pre><code>file_id = { rules_file = 'file_magic.rules' }</code></pre>
</div></div>
<div class="paragraph"><p>Example:</p></div>
<div class="literalblock">
<div class="content">
<pre><code>file_id (msg:"GIF"; file_meta:type GIF, id 62, category "Graphics";
  file_data; content:"| 47 49 46 38 37 61 |", depth 6, offset 0; gid:4; sid:56; rev:1;)</code></pre>
</div></div>
<div class="literalblock">
<div class="content">
<pre><code>file_id (msg:"GIF"; file_meta:type GIF, id 63, category 'Graphics";
  file_data; content:"| 47 49 46 38 39 61 |", depth 6, offset 0; gid:4; sid:57; rev:1;)</code></pre>
</div></div>
<div class="paragraph"><p>The previous two rules define GIF format, because two file magics are
different. File magics are specified by content and offset, which look
at content at particular file offset to identify the file type. In this
case, two magics look at the beginning of the file. You can use character
if it is printable or hex value in between "|".</p></div>
<div class="paragraph"><p>Note that <code>file_meta</code> and a fast-pattern option (content, regex) are required
for each file_id rule.</p></div>
</div>
<div class="sect3">
<h4 id="_file_policy">File Policy</h4>
<div class="paragraph"><p>You can enabled file type, file signature, or file capture by configuring
file_id. In addition, you can enable trace to see file stream data, file
type, and file signature information.</p></div>
<div class="paragraph"><p>Most importantly, you can configure a file policy that can block/alert
some file type or an individual file based on SHA. This allows you
build a file blacklist or whitelist.</p></div>
<div class="paragraph"><p>Example:</p></div>
<div class="literalblock">
<div class="content">
<pre><code>file_policy =
{
    {  when = { file_type_id = 22 }, use = { verdict = 'log', enable_file_signature = true } },
    {  when = { sha256 = "F74DC976BC8387E7D4FC0716A069017A0C7ED13F309A523CC41A8739CCB7D4B6" }, use = { verdict = 'block'} },
    {  when = { file_type_id = 0 }, use = { verdict = 'log', enable_file_signature = true, enable_file_capture = true } }
}</code></pre>
</div></div>
<div class="paragraph"><p>In this example, it enables this policy:</p></div>
<div class="ulist"><ul>
<li>
<p>
For PDF files, they will be logged with signatures.
</p>
</li>
<li>
<p>
For the file matching this SHA, it will be blocked
</p>
</li>
<li>
<p>
For all file types identified, they will be logged with signature, and
also captured onto log folder.
</p>
</li>
</ul></div>
</div>
<div class="sect3">
<h4 id="_file_capture">File Capture</h4>
<div class="paragraph"><p>File can be captured and stored to log folder. We use SHA as file name
instead of actual file name to avoid conflicts. You can capture either
all files, some file type, or a particular file based on SHA.</p></div>
<div class="paragraph"><p>You can enable file capture through this config:</p></div>
<div class="literalblock">
<div class="content">
<pre><code>enable_capture = true,</code></pre>
</div></div>
<div class="paragraph"><p>or enable it for some file or  file type in your file policy:</p></div>
<div class="literalblock">
<div class="content">
<pre><code>{  when = { file_type_id = 22 }, use = { verdict = 'log', enable_file_capture = true } },</code></pre>
</div></div>
<div class="paragraph"><p>The above rule will enable PDF file capture.</p></div>
</div>
<div class="sect3">
<h4 id="_file_events">File Events</h4>
<div class="paragraph"><p>File inspect preprocessor also works as a dynamic output plugin for file
events. It logs basic information about file. The log file is in the same
folder as other log files with name starting with "file.log".</p></div>
<div class="paragraph"><p>Example:</p></div>
<div class="literalblock">
<div class="content">
<pre><code>file_log = { log_pkt_time = true, log_sys_time = false }</code></pre>
</div></div>
<div class="paragraph"><p>All file events will be logged in packet time, system time is not logged.</p></div>
<div class="paragraph"><p>File event example:</p></div>
<div class="literalblock">
<div class="content">
<pre><code>08/14-19:14:19.100891  10.22.75.72:33734 -&gt; 10.22.75.36:80,
[Name: "malware.exe"] [Verdict: Block] [Type: MSEXE]
[SHA: 6F26E721FDB1AAFD29B41BCF90196DEE3A5412550615A856DAE8E3634BCE9F7A]
[Size: 1039328]</code></pre>
</div></div>
</div>
</div>
<div class="sect2">
<h3 id="_high_availability">High Availability</h3>
<div class="paragraph"><p>High Availability includes the HA flow synchronization and the SideChannel
messaging subsystems.</p></div>
<div class="sect3">
<h4 id="_ha">HA</h4>
<div class="paragraph"><p>HighAvailability (or HA) is a Snort module that provides state coherency
between two partner snort instances.  It uses SideChannel for messaging.</p></div>
<div class="paragraph"><p>There can be multiple types of HA within Snort and Snort plugins.  HA
implements an extensible architecture to enable plugins to subscribe to the
base flow HA messaging.  These plugins can then include their own messages
along with the flow cache HA messages.</p></div>
<div class="paragraph"><p>HA produces and consumes two type of messages:</p></div>
<div class="ulist"><ul>
<li>
<p>
Update - Update flow status.  Plugins may add their own data to the messages
</p>
</li>
<li>
<p>
Delete - A flow has been removed from the cache
</p>
</li>
</ul></div>
<div class="paragraph"><p>The HA module is configured with these items:</p></div>
<div class="literalblock">
<div class="content">
<pre><code>high_availability =
{
    ports = "1",
    enable = true,
    min_age = 0,
    min_sync = 0
}</code></pre>
</div></div>
<div class="paragraph"><p>The <em>ports</em> item maps to the SideChannel port to use for the HA messaging.</p></div>
<div class="paragraph"><p>The <em>enabled</em> item controls the overall HA operation.</p></div>
<div class="paragraph"><p>The items min_age and min_sync are used in the stream HA logic.  min_age is
the number of milliseconds that a flow must exist in the flow cache before sending
HA messages to the partner.  min_sync is the minimum time between HA status
updates.  HA messages for a particular flow will not be sent faster than
min_sync.  Both are expressed as a number of milliseconds.</p></div>
<div class="paragraph"><p>HA messages are composed of the base <em>stream</em> information plus any content
from additional modules.  Modules subscribe HA in order to add message
content.  The <em>stream</em> HA content is always present in the messages while
the ancillary module content is only present when requested via a status
change request.</p></div>
</div>
<div class="sect3">
<h4 id="_connector">Connector</h4>
<div class="paragraph"><p>Connectors are a set of modules that are used to exchange message-oriented
data among Snort threads and the external world.  A typical use-case is
HA (High Availability) message exchange.  Connectors serve to decouple the
message transport from the message creation/consumption.  Connectors expose
a common API for several forms of message transport.</p></div>
<div class="paragraph"><p>Connectors are a Snort plugin type.</p></div>
<div class="sect4">
<h5 id="_connector_parent_plugin_class">Connector (parent plugin class)</h5>
<div class="paragraph"><p>Connectors may either be a simplex channel and perform unidirectional
communications.  Or may be duplex and perform bidirectional communications.
The TcpConnector is duplex while the FileConnector is simplex.</p></div>
<div class="paragraph"><p>All subtypes of Connector have a <em>direction</em> configuration element and a
<em>connector</em> element.  The <em>connector</em> string is the key used to identify the
element for sidechannel configuration.  The <em>direction</em> element may have a
default value, for instance TcpConnector’s are <em>duplex</em>.</p></div>
<div class="paragraph"><p>There are currently two implementations of Connectors:</p></div>
<div class="ulist"><ul>
<li>
<p>
TcpConnector - Exchange messages over a tcp channel.
</p>
</li>
<li>
<p>
FileConnector - Write messages to files and read messages from files.
</p>
</li>
</ul></div>
</div>
<div class="sect4">
<h5 id="_tcpconnector">TcpConnector</h5>
<div class="paragraph"><p>TcpConnector is a subclass of Connector and implements a DUPLEX type Connector,
able to send and receive messages over a tcp session.</p></div>
<div class="paragraph"><p>TcpConnector adds a few session setup configuration elements:</p></div>
<div class="ulist"><ul>
<li>
<p>
setup = <em>call</em> or <em>answer</em> - <em>call</em> is used to have TcpConnector initiate
        the connection.  <em>answer</em> is used to have TcpConnector accept incoming
        connections.
</p>
</li>
<li>
<p>
address = <em>&lt;addr&gt;</em> - used for <em>call</em> setup to specify the partner
</p>
</li>
<li>
<p>
base_port = port - used to construct the actual port number for <em>call</em> and
        <em>answer</em> modes.  Actual port used is (base_port + instance_id).
</p>
</li>
</ul></div>
<div class="paragraph"><p>An example segment of TcpConnector configuration:</p></div>
<div class="literalblock">
<div class="content">
<pre><code>tcp_connector =
{
    {
        connector = 'tcp_1',
        address = '127.0.0.1',
        setup = 'call',
        base_port = 11000
    },
}</code></pre>
</div></div>
</div>
<div class="sect4">
<h5 id="_fileconnector">FileConnector</h5>
<div class="paragraph"><p>FileConnector implements a Connector that can either read from files or write
to files.  FileConnector’s are simplex and must be configured to be
CONN_TRANSMIT or CONN_RECEIVE.</p></div>
<div class="paragraph"><p>FileConnector configuration adds two additional element:</p></div>
<div class="ulist"><ul>
<li>
<p>
name = string - used as part of the message file name
</p>
</li>
<li>
<p>
format = <em>text</em> or <em>binary</em> - FileConnector supports two file types
</p>
</li>
</ul></div>
<div class="paragraph"><p>The configured <em>name</em> string is used to construct the actual names as in:</p></div>
<div class="ulist"><ul>
<li>
<p>
file_connector_NAME_transmit and file_connector_NAME_receive
</p>
</li>
</ul></div>
<div class="paragraph"><p>All messages for one Snort invocation are read and written to one file.</p></div>
<div class="paragraph"><p>In the case of a receive FileConnector, all messages are read from the file
prior to the start of packet processing.  This allows the messages to
establish state information for all processed packets.</p></div>
<div class="paragraph"><p>Connectors are used solely by SideChannel</p></div>
<div class="paragraph"><p>An example segment of FileConnector configuration:</p></div>
<div class="literalblock">
<div class="content">
<pre><code>file_connector =
{
    {
        connector = 'file_tx_1',
        direction = 'transmit',
        format = 'text',
        name = 'HA'
    },
    {
        connector = 'file_rx_1',
        direction = 'receive',
        format = 'text',
        name = 'HA'
    },
}</code></pre>
</div></div>
</div>
</div>
<div class="sect3">
<h4 id="_side_channel">Side Channel</h4>
<div class="paragraph"><p>SideChannel is a Snort module that uses Connectors to implement a messaging
infrastructure that is used to communicate between Snort threads and the
outside world.</p></div>
<div class="paragraph"><p>SideChannel adds functionality onto the Connector as:</p></div>
<div class="ulist"><ul>
<li>
<p>
message multiplexing/demultiplexing - An additional protocol layer is
    added to the messages.  This port number is used to direct message to/from
    various SideClass instancs.
</p>
</li>
<li>
<p>
application receive processing - handler for received messages on a
    specific port.
</p>
</li>
</ul></div>
<div class="paragraph"><p>SideChannel’s are always implement a duplex (bidirectional) messaging model
and can map to separate transmit and receive Connectors.</p></div>
<div class="paragraph"><p>The message handling model leverages the underlying Connector handling.  So
please refer to the Connector documentation.</p></div>
<div class="paragraph"><p>SideChannel’s are instantiated by various applications.  The SideChannel port
numbers are the configuration element used to map SideChannel’s to
applications.</p></div>
<div class="paragraph"><p>The SideChannel configuration mostly serves to map a port number to a Connector
or set of connectors.  Each port mapping can have at most one transmit plus
one receive connector or one duplex connector.  Multiple SideChannel’s
may be configured and instantiated to support multiple applications.</p></div>
<div class="paragraph"><p>An example SideChannel configuration along with the corresponding Connector
configuration:</p></div>
<div class="literalblock">
<div class="content">
<pre><code>side_channel =
{
    {
        ports = '1',
        connectors =
        {
            {
                connector = 'file_rx_1',
            },
            {
                connector = 'file_tx_1',
            }
        },
    },
}</code></pre>
</div></div>
<div class="literalblock">
<div class="content">
<pre><code>file_connector =
{
    {
        connector = 'file_tx_1',
        direction = 'transmit',
        format = 'text',
        name = 'HA'
    },
    {
        connector = 'file_rx_1',
        direction = 'receive',
        format = 'text',
        name = 'HA'
    },
}</code></pre>
</div></div>
</div>
</div>
<div class="sect2">
<h3 id="_ftp">FTP</h3>
<div class="paragraph"><p>Given an FTP command channel buffer, FTP will interpret the data,
identifying FTP commands and parameters, as well as FTP response codes
and messages.  It will enforce correctness of the parameters, determine
when an FTP command connection is encrypted, and determine when an FTP
data channel is opened.</p></div>
<div class="sect3">
<h4 id="_configuring_the_inspector_to_block_exploits_and_attacks">Configuring the inspector to block exploits and attacks</h4>
<div class="sect4">
<h5 id="_ftp_server_configuration">ftp_server configuration</h5>
<div class="ulist"><ul>
<li>
<p>
ftp_cmds
</p>
</li>
</ul></div>
<div class="paragraph"><p>This specifies additional FTP commands outside of those checked by
default within the inspector.  The inspector may be configured
to generate an alert when it sees a command it does not recognize.</p></div>
<div class="paragraph"><p>Aside from the default commands recognized, it may be necessary to
allow the use of the "X" commands, specified in RFC 775.  To do so, use
the following ftp_cmds option.  Since these are rarely used by FTP
client implementations, they are not included in the defaults.</p></div>
<div class="literalblock">
<div class="content">
<pre><code>ftp_cmds = [[ XPWD XCWD XCUP XMKD XRMD ]]</code></pre>
</div></div>
<div class="ulist"><ul>
<li>
<p>
def_max_param_len
</p>
</li>
</ul></div>
<div class="paragraph"><p>This specifies the default maximum parameter length for all commands
in bytes.  If the parameter for an FTP command exceeds that length,
and the inspector is configured to do so, an alert will be generated.
This is used to check for buffer overflow exploits within FTP servers.</p></div>
<div class="ulist"><ul>
<li>
<p>
cmd_validity
</p>
</li>
</ul></div>
<div class="paragraph"><p>This specifies the valid format and length for parameters of a given command.</p></div>
<div class="ulist"><ul>
<li>
<p>
cmd_validity[].len
</p>
</li>
</ul></div>
<div class="paragraph"><p>This specifies the maximum parameter length for the specified command
in bytes, overriding the default.  If the parameter for that FTP command
exceeds that length, and the inspector is configured to do so, an
alert will be generated.  It can be used to restrict specific commands to
small parameter values.  For example the USER command — usernames may
be no longer than 16 bytes, so the appropriate configuration would be:</p></div>
<div class="literalblock">
<div class="content">
<pre><code>cmd_validity =
{
    {
        command = 'USER',
        length = 16,
    }
}</code></pre>
</div></div>
<div class="ulist"><ul>
<li>
<p>
cmd_validity[].format
</p>
</li>
</ul></div>
<div class="paragraph"><p>format is as follows:</p></div>
<div class="literalblock">
<div class="content">
<pre><code>int                 Param must be an integer
number              Param must be an integer between 1 and 255
char &lt;chars&gt;        Param must be a single char, and one of &lt;chars&gt;
date &lt;datefmt&gt;      Param follows format specified where
                    # = Number, C=Char, []=optional, |=OR, {}=choice,
                    anything else=literal (i.e., .+- )
string              Param is string (effectively unrestricted)
host_port           Param must a host port specifier, per RFC 959.
long_host_port      Parameter must be a long host port specified, per RFC 1639
extended_host_port  Parameter must be an extended host port specified, per RFC 2428</code></pre>
</div></div>
<div class="paragraph"><p>Examples of the cmd_validity option are shown below.  These examples
are the default checks (per RFC 959 and others) performed by the
inspector.</p></div>
<div class="literalblock">
<div class="content">
<pre><code>cmd_validity =
{
    {
        command = 'CWD',
        length = 200,
    },
    {
        command = 'MODE',
        format = '&lt; char SBC &gt;',
    },
    {
        command = 'STRU',
        format = '&lt; char FRP &gt;',
    },
    {
        command = 'ALLO',
        format = '&lt; int [ char R int ] &gt;',
    },
    {
        command = 'TYPE',
        format = [[ &lt; { char AE [ char NTC ] | char I | char L [ number ]
            } &gt; ]],
    },
    {
        command = 'PORT',
        format = '&lt; host_port &gt;',
    },
}</code></pre>
</div></div>
<div class="paragraph"><p>A cmd_validity entry in the configuration can be used to override these
defaults and/or add a check for other commands.  A few examples follow.</p></div>
<div class="paragraph"><p>This allows additional modes, including mode Z which allows for
zip-style compression:</p></div>
<div class="literalblock">
<div class="content">
<pre><code>cmd_validity =
{
    {
        command = 'MODE',
        format = '&lt; char ASBCZ &gt;',
    },
}</code></pre>
</div></div>
<div class="paragraph"><p>Allow for a date in the MDTM command:</p></div>
<div class="literalblock">
<div class="content">
<pre><code>cmd_validity =
{
    {
        command = 'MDTM',
        format = '&lt; [ date nnnnnnnnnnnnnn[.n[n[n]]] ] string &gt;',
    },
}</code></pre>
</div></div>
<div class="paragraph"><p>MDTM is an odd case that is worth discussing…</p></div>
<div class="paragraph"><p>While not part of an established standard, certain FTP servers accept
MDTM commands that set the modification time on a file.  The most common
among servers that do, accept a format using YYYYMMDDHHmmss[.uuu].  Some
others accept a format using YYYYMMDDHHmmss[+|-]TZ format.  The example
above is for the first case.</p></div>
<div class="paragraph"><p>To check validity for a server that uses the TZ format, use the following:</p></div>
<div class="literalblock">
<div class="content">
<pre><code>cmd_validity =
{
    {
        command = 'MDTM',
        format = '&lt; [ date nnnnnnnnnnnnnn[{+|-}n[n]] ] string &gt;',
    },
}</code></pre>
</div></div>
<div class="ulist"><ul>
<li>
<p>
chk_str_fmt
</p>
</li>
</ul></div>
<div class="paragraph"><p>This causes the inspector to check for string format attacks on
the specified commands.</p></div>
<div class="ulist"><ul>
<li>
<p>
telnet_cmds
</p>
</li>
</ul></div>
<div class="paragraph"><p>Detect and alert when telnet cmds are seen on the FTP command channel.</p></div>
<div class="ulist"><ul>
<li>
<p>
ignore_telnet_erase_cmds
</p>
</li>
</ul></div>
<div class="paragraph"><p>This option allows Snort to ignore telnet escape sequences for erase character
(TNC EAC) and erase line (TNC EAL) when normalizing FTP command channel.  Some
FTP servers do not process those telnet escape sequences.</p></div>
<div class="ulist"><ul>
<li>
<p>
ignore_data_chan
</p>
</li>
</ul></div>
<div class="paragraph"><p>When set to true, causes the FTP inspector to force the rest of snort
to ignore the FTP data channel connections. NO INSPECTION other than state
(inspector AND rules) will be performed on that data channel. It can
be turned on to improve performance — especially with respect to large
file transfers from a trusted source — by ignoring traffic. If your rule
set includes virus-type rules, it is recommended that this option not be used.</p></div>
</div>
<div class="sect4">
<h5 id="_ftp_client_configuration">ftp_client configuration</h5>
<div class="ulist"><ul>
<li>
<p>
max_resp_len
</p>
</li>
</ul></div>
<div class="paragraph"><p>This specifies the maximum length for all response messages in bytes.
If the message for an FTP response (everything after the 3 digit code)
exceeds that length, and the inspector is configured to do so, an
alert will be generated.  This is used to check for buffer overflow
exploits within FTP clients.</p></div>
<div class="ulist"><ul>
<li>
<p>
telnet_cmds
</p>
</li>
</ul></div>
<div class="paragraph"><p>Detect and alert when telnet cmds are seen on the FTP command channel.</p></div>
<div class="ulist"><ul>
<li>
<p>
ignore_telnet_erase_cmds
</p>
</li>
</ul></div>
<div class="paragraph"><p>This option allows Snort to ignore telnet escape sequences for erase character
(TNC EAC) and erase line (TNC EAL) when normalizing FTP command channel.  Some
FTP clients do not process those telnet escape sequences.</p></div>
</div>
<div class="sect4">
<h5 id="_ftp_data">ftp_data</h5>
<div class="paragraph"><p>In order to enable file inspection for ftp, the following should be added to the
configuration:</p></div>
<div class="literalblock">
<div class="content">
<pre><code>ftp_data = {}</code></pre>
</div></div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_http_inspector">HTTP Inspector</h3>
<div class="paragraph"><p>One of the major undertakings for Snort 3 is developing a completely new
HTTP inspector.</p></div>
<div class="sect3">
<h4 id="_overview_5">Overview</h4>
<div class="paragraph"><p>You can configure it by adding:</p></div>
<div class="literalblock">
<div class="content">
<pre><code>http_inspect = {}</code></pre>
</div></div>
<div class="paragraph"><p>to your snort.lua configuration file. Or you can read about it in the
source code under src/service_inspectors/http_inspect.</p></div>
<div class="paragraph"><p>So why a new HTTP inspector?</p></div>
<div class="paragraph"><p>For starters it is object-oriented. That’s good for us because we maintain
this software. But it should also be really nice for open-source
developers. You can make meaningful changes and additions to HTTP
processing without having to understand the whole thing. In fact much of
the new HTTP inspector’s knowledge of HTTP is centralized in a series of
tables where it can be easily reviewed and modified. Many significant
changes can be made just by updating these tables.</p></div>
<div class="paragraph"><p>http_inspect is the first inspector written specifically for the new
Snort 3 architecture. This provides access to one of the very best features
of Snort 3: purely PDU-based inspection. The classic preprocessor processes
HTTP messages, but even while doing so it is constantly aware of IP packets
and how they divide up the TCP data stream. The same HTTP message might be
processed differently depending on how the sender (bad guy) divided it up
into IP packets.</p></div>
<div class="paragraph"><p>http_inspect is free of this burden and can focus exclusively on HTTP.
This makes it much simpler, easier to test, and less prone to false
positives. It also greatly reduces the opportunity for adversaries to probe
the inspector for weak spots by adjusting packet boundaries to disguise bad
behavior.</p></div>
<div class="paragraph"><p>Dealing solely with HTTP messages also opens the door for developing major
new features. The http_inspect design supports true stateful processing.
Want to ask questions that involve both the client request and the server
response? Or different requests in the same session? These things are
possible.</p></div>
<div class="paragraph"><p>http_inspect is taking a very different approach to HTTP header fields. The
classic preprocessor divides all the HTTP headers following the start line
into cookies and everything else. It normalizes the two pieces using a
generic process and puts them in buffers that one can write rules against.
There is some limited support for examining individual headers within the
inspector but it is very specific.</p></div>
<div class="paragraph"><p>The new concept is that every header should be normalized in an appropriate
and specific way and individually made available for the user to write
rules against it. If for example a header is supposed to be a date then
normalization means put that date in a standard format.</p></div>
</div>
<div class="sect3">
<h4 id="_legacy_and_enhanced_normalizers">Legacy and Enhanced Normalizers</h4>
<div class="paragraph"><p>Currently, there are Legacy and Enhanced Normalizers for JavaScript
normalization. Both normalizers are independent and can be configured
separately. The Legacy normalizer should be considered deprecated.
The Enhanced Normalizer is encouraged to use for JavaScript normalization
in the first place as we continue improving functionality and quality.
The Enhanced JavaScript Normalizer has to be configured as a separate
module:</p></div>
<div class="literalblock">
<div class="content">
<pre><code>js_norm = {}</code></pre>
</div></div>
<div class="paragraph"><p>Refer to JavaScript Normalization section for Enhanced Normalizer specifics.</p></div>
<div class="sect4">
<h5 id="_legacy_normalizer">Legacy Normalizer</h5>
<div class="paragraph"><p>The Legacy Normalizer can normalize obfuscated data within the JavaScript
functions such as unescape, String.fromCharCode, decodeURI, and decodeURIComponent.
It also replaces consecutive whitespaces with a single space and normalizes
the plus by concatenating the strings. For more information on how to enable
Legacy Normalizer, check the http_inspect.normalize_javascript option. Legacy
Normalizer is deprecated preferably to use Enhanced Normalizer. After
supporting backward compatibility in the Enhanced Normalizer, Legacy Normalizer
will be removed.</p></div>
</div>
</div>
<div class="sect3">
<h4 id="_configuration_4">Configuration</h4>
<div class="paragraph"><p>Configuration can be as simple as adding:</p></div>
<div class="literalblock">
<div class="content">
<pre><code>http_inspect = {}</code></pre>
</div></div>
<div class="paragraph"><p>to your snort.lua file. The default configuration provides a thorough
inspection and may be all that you need. But there are some options that
provide extra features, tweak how things are done, or conserve resources by
doing less.</p></div>
<div class="sect4">
<h5 id="_request_depth_and_response_depth">request_depth and response_depth</h5>
<div class="paragraph"><p>These replace the flow depth parameters used by the old HTTP inspector but
they work differently.</p></div>
<div class="paragraph"><p>The default is to inspect the entire HTTP message body. That’s a very sound
approach but if your HTTP traffic includes many very large files such as
videos the load on Snort can become burdensome. Setting the request_depth
and response_depth parameters will limit the amount of body data that is
sent to the rule engine. For example:</p></div>
<div class="literalblock">
<div class="content">
<pre><code>request_depth = 10000,
response_depth = 80000,</code></pre>
</div></div>
<div class="paragraph"><p>would examine only the first 10000 bytes of POST, PUT, and other message
bodies sent by the client. Responses from the server would be limited to
80000 bytes.</p></div>
<div class="paragraph"><p>These limits apply only to the message bodies. HTTP headers are always
completely inspected.</p></div>
<div class="paragraph"><p>If you want to only inspect headers and no body, set the depth to 0. If
you want to inspect the entire body set the depth to -1 or simply omit the
depth parameter entirely because that is the default.</p></div>
<div class="paragraph"><p>These limits have no effect on how much data is forwarded to file
processing.</p></div>
</div>
<div class="sect4">
<h5 id="_allowed_methods_and_disallowed_methods">allowed_methods and disallowed_methods</h5>
<div class="paragraph"><p>When either of these options are set, HTTP inspector will check if the method
in the HTTP request is allowed and if not raise alert 119:287. You can either
define a list of allowed methods or a list of disallowed methods. Defining
both is a configuration error. When a list of disallowed methods is defined,
any method not present on that list is implicitly allowed. Methods on either
of these lists are considered known methods and will not raise alert 119:31.
For example if configured for:</p></div>
<div class="literalblock">
<div class="content">
<pre><code>allowed_methods = "GET,PUT,BLUE"</code></pre>
</div></div>
<div class="paragraph"><p>HTTP inspector will raise 119:287 for POST and RED, no alert 119:31 will
be raised for BLUE, and 119:31 will be raised for RED.
If configured for</p></div>
<div class="literalblock">
<div class="content">
<pre><code>disallowed_methods = "POST,RED"</code></pre>
</div></div>
<div class="paragraph"><p>HTTP inspector will raise 119:287 for POST and RED, 119:31 for BLUE, and
no alert 119:31 will be raised for RED.</p></div>
</div>
<div class="sect4">
<h5 id="_script_detection">script_detection</h5>
<div class="paragraph"><p>Script detection is a feature that enables Snort to more quickly detect and
block response messages containing malicious JavaScript. When
http_inspect detects the end of a script it immediately forwards the
available part of the message body for early detection. This enables
malicious Javascripts to be detected more quickly but consumes somewhat
more of the sensor’s resources.</p></div>
<div class="paragraph"><p>This feature is off by default. script_detection = true will activate it.</p></div>
</div>
<div class="sect4">
<h5 id="_gzip">gzip</h5>
<div class="paragraph"><p>http_inspect by default decompresses deflate and gzip message bodies
before inspecting them. This feature can be turned off by unzip = false.
Turning off decompression provides a substantial performance improvement
but at a very high price. It is unlikely that any meaningful inspection of
message bodies will be possible. Effectively HTTP processing would be
limited to the headers.</p></div>
</div>
<div class="sect4">
<h5 id="_normalize_utf">normalize_utf</h5>
<div class="paragraph"><p>http_inspect will decode utf-8, utf-7, utf-16le, utf-16be, utf-32le, and
utf-32be in response message bodies based on the Content-Type header. This
feature is on by default: normalize_utf = false will deactivate it.</p></div>
</div>
<div class="sect4">
<h5 id="_decompress_pdf">decompress_pdf</h5>
<div class="paragraph"><p>decompress_pdf = true will enable decompression of compressed portions of
PDF files encountered in a message body. http_inspect will examine the
message body for PDF files that are then parsed to locate PDF streams with
a single /FlateDecode filter. The compressed content is decompressed and
made available through the file data rule option.</p></div>
</div>
<div class="sect4">
<h5 id="_decompress_swf">decompress_swf</h5>
<div class="paragraph"><p>decompress_swf = true will enable decompression of compressed SWF (Adobe
Flash content) files encountered in a message body. The available
decompression modes are ’deflate’ and ’lzma’. http_inspect will search for
the file signatures CWS for Deflate/ZLIB and ZWS for LZMA. The compressed
content is decompressed and made available through the file data rule
option. The compressed SWF file signature is converted to FWS to indicate
an uncompressed file.</p></div>
</div>
<div class="sect4">
<h5 id="_decompress_zip">decompress_zip</h5>
<div class="paragraph"><p>decompress_zip = true will enable decompression of compressed zip archives encountered in a message
body. The compressed content is decompressed and made available through the file_data rule option.</p></div>
</div>
<div class="sect4">
<h5 id="_decompress_vba">decompress_vba</h5>
<div class="paragraph"><p>decompress_vba = true will enable decompression of RLE (Run Length Encoding)
compressed vba (Visual Basic for Applications) macro data of MS Office
files encountered in a message body. The MS office files are PKZIP compressed which are parsed to
locate the OLE (Object Linking and Embedding) file embedded with the files
containing RLE compressed vba macro data. The decompressed vba macro data is
then made available through the vba_data ips rule option.</p></div>
</div>
<div class="sect4">
<h5 id="_max_mime_attach">max_mime_attach</h5>
<div class="paragraph"><p>HTTP request message bodies may be in MIME format. Each file attachment is
separately incorporated in the file_data rule option. When a request contains
many small file attachments these inspections may consume a lot of processing
power. This parameter limits the number of files from one message that are
inspected. The default value is 5.</p></div>
</div>
<div class="sect4">
<h5 id="_normalize_javascript">normalize_javascript</h5>
<div class="paragraph"><p>normalize_javascript = true will enable legacy normalizer of JavaScript within
the HTTP response body. http_inspect looks for JavaScript by searching for
the &lt;script&gt; tag without a type. Obfuscated data within the JavaScript
functions such as unescape, String.fromCharCode, decodeURI, and
decodeURIComponent are normalized. The different encodings handled within
the unescape, decodeURI, or decodeURIComponent are %XX, %uXXXX, XX and
uXXXXi. http_inspect also replaces consecutive whitespaces with a single
space and normalizes the plus by concatenating the strings. Such normalizations
refer to basic JavaScript normalization.</p></div>
</div>
<div class="sect4">
<h5 id="_xff_headers">xff_headers</h5>
<div class="paragraph"><p>This configuration supports defining custom x-forwarded-for type headers. In a
multi-vendor world, it is quite possible that the header name carrying the
original client IP could be vendor-specific. This is due to the absence
of standardization which would otherwise standardize the header name.
In such a scenario, this configuration provides a way with which such headers
can be introduced to HI. The default value of this configuration
is "x-forwarded-for true-client-ip". The default definition introduces the
two commonly known headers and is preferred in the same order by the
inspector as they are defined, e.g "x-forwarded-for" will be preferred than
"true-client-ip" if both headers are present in the stream. The header names
should be delimited by a space.</p></div>
</div>
<div class="sect4">
<h5 id="_maximum_host_length">maximum_host_length</h5>
<div class="paragraph"><p>Setting maximum_host_length causes http_inspect to generate 119:25 if the
Host header value including optional white space exceeds the specified length.
In the abnormal case of multiple Host headers, the total length of the combined
values is used. The default value is -1, meaning do not perform this check.</p></div>
</div>
<div class="sect4">
<h5 id="_maximum_chunk_length">maximum_chunk_length</h5>
<div class="paragraph"><p>http_inspect strictly limits individual chunks within a chunked message
body to be less than four gigabytes.</p></div>
<div class="paragraph"><p>A lower limit may be configured by setting maximum_chunk_length. Any chunk
longer than maximum chunk length will generate a 119:16 alert.</p></div>
</div>
<div class="sect4">
<h5 id="_maximum_header_length">maximum_header_length</h5>
<div class="paragraph"><p>http_inspect generates 119:19 when the length of a header exceeds
maximum_header_length = N {0 : 65535} (default 4096).</p></div>
</div>
<div class="sect4">
<h5 id="_maximum_headers">maximum_headers</h5>
<div class="paragraph"><p>http_inspect generates 119:20 when the number of headers exceeds
maximum_headers = N {0 : 65535} (default 200).</p></div>
</div>
<div class="sect4">
<h5 id="_maximum_pipelined_requests">maximum_pipelined_requests</h5>
<div class="paragraph"><p>http_inspect generates 119:34 when the number of pipelined requests exceeds
maximum_pipelined_requests = N {0 : 99} (default 99). This number does
not include the first request in a sequence of requests. Setting
maximum_pipelined_requests = 0, will not trigger an alert in the case
of an alternating sequence of requests and responses. It will trigger the
alert once the client issue a request before getting the response to a
previous request.</p></div>
</div>
<div class="sect4">
<h5 id="_uri_processing">URI processing</h5>
<div class="paragraph"><p>Normalization and inspection of the URI in the HTTP request message is a
key aspect of what http_inspect does. The best way to normalize a URI is
very dependent on the idiosyncrasies of the HTTP server being accessed.
The goal is to interpret the URI the same way as the server will so that
nothing the server will see can be hidden from the rule engine.</p></div>
<div class="paragraph"><p>The default URI inspection parameters are oriented toward following the
HTTP RFCs—reading the URI the way the standards say it should be read.
Most servers deviate from this ideal in various ways that can be exploited
by an attacker. The options provide tools for the user to cope with that.</p></div>
<div class="literalblock">
<div class="content">
<pre><code>utf8 = true
plus_to_space = true
percent_u = false
utf8_bare_byte = false
iis_unicode = false
iis_double_decode = true</code></pre>
</div></div>
<div class="paragraph"><p>The HTTP inspector normalizes percent encodings found in URIs. For instance
it will convert "%48%69%64%64%65%6e" to "Hidden". All the options listed
above control how this is done. The options listed as true are fairly
standard features that are decoded by default. You don’t need to list them
in snort.lua unless you want to turn them off by setting them to false. But
that is not recommended unless you know what you are doing and have a
definite reason.</p></div>
<div class="paragraph"><p>The other options are primarily for the protection of servers that support
irregular forms of decoding. These features are off by default but you can
activate them if you need to by setting them to true in snort.lua.</p></div>
<div class="literalblock">
<div class="content">
<pre><code>bad_characters = "0x25 0x7e 0x6b 0x80 0x81 0x82 0x83 0x84"</code></pre>
</div></div>
<div class="paragraph"><p>That’s a list of 8-bit Ascii characters that you don’t want present in any
normalized URI after the percent decoding is done. For example 0x25 is a
hexadecimal number (37 in decimal) which stands for the <em>%</em> character. The
% character is legitimately used for encoding special characters in a URI.
But if there is still a percent after normalization one might conclude that
something is wrong. If you choose to configure 0x25 as a bad character
there will be an alert whenever this happens.</p></div>
<div class="paragraph"><p>Another example is 0x00 which signifies the null character zero. Null
characters in a URI are generally wrong and very suspicious.</p></div>
<div class="paragraph"><p>The default is not to alert on any of the 256 8-bit Ascii characters. Add
this option to your configuration if you want to define some bad
characters.</p></div>
<div class="literalblock">
<div class="content">
<pre><code>ignore_unreserved = "abc123"</code></pre>
</div></div>
<div class="paragraph"><p>Percent encoding common characters such as letters and numbers that have no
special meaning in HTTP is suspicious. It’s legal but why would you do it
unless you have something to hide? http_inspect will alert whenever an
upper-case or lower-case letter, a digit, period, underscore, tilde, or
minus is percent-encoded. But if a legitimate application in your
environment encodes some of these characters for some reason this allows
you to create exemptions for those characters.</p></div>
<div class="paragraph"><p>In the example, the lower-case letters a, b, and c and the digits 1, 2, and
3 are exempted. These may be percent-encoded without generating an alert.</p></div>
<div class="literalblock">
<div class="content">
<pre><code>simplify_path = true
backslash_to_slash = true</code></pre>
</div></div>
<div class="paragraph"><p>HTTP inspector simplifies directory paths in URIs by eliminating extra
traversals using ., .., and /.</p></div>
<div class="paragraph"><p>For example I can take a simple URI such as</p></div>
<div class="literalblock">
<div class="content">
<pre><code>/very/easy/example</code></pre>
</div></div>
<div class="paragraph"><p>and complicate it like this:</p></div>
<div class="literalblock">
<div class="content">
<pre><code>/very/../very/././././easy//////detour/to/nowhere/../.././../example</code></pre>
</div></div>
<div class="paragraph"><p>which may be very difficult to match with a detection rule. simplify_path
is on by default and you should not turn it off unless you have no interest
in URI paths.</p></div>
<div class="paragraph"><p>backslash_to_slash is a tweak to path simplification for servers that allow
directories to be separated by backslashes:</p></div>
<div class="literalblock">
<div class="content">
<pre><code>/this/is/the/normal/way/to/write/a/path</code></pre>
</div></div>
<div class="literalblock">
<div class="content">
<pre><code>\this\is\the\other\way\to\write\a\path</code></pre>
</div></div>
<div class="paragraph"><p>backslash_to_slash is turned on by default. It replaces all the backslashes
with slashes during normalization.</p></div>
</div>
</div>
<div class="sect3">
<h4 id="_connect_processing">CONNECT processing</h4>
<div class="paragraph"><p>The HTTP CONNECT method is used by a client to establish a tunnel to a destination via an HTTP proxy
server. If the connection is successful the server will send a 2XX success response to the client,
then proceed to blindly forward traffic between the client and destination. That traffic belongs to
a new session between the client and destination and may be of any protocol, so clearly the HTTP
inspector will be unable to continue processing traffic following the CONNECT message as if it were
just a continuation of the original HTTP/1.1 session.</p></div>
<div class="paragraph"><p>Therefore upon receiving a success response to a CONNECT request, the HTTP inspector will stop
inspecting the session. The next packet will return to the wizard, which will determine the
appropriate inspector to continue processing the flow. If the tunneled protocol happens to be
HTTP/1.1, the HTTP inspector will again start inspecting the flow, but as an entirely new session.</p></div>
<div class="paragraph"><p>There is one scenario where the cutover to the wizard will not occur despite a 2XX success response
to a CONNECT request. HTTP allows for pipelining, or sending multiple requests without waiting for a
response. If the HTTP inspector sees any further traffic from the client after a CONNECT request
before it has seen the CONNECT response, it is unclear whether this traffic should be interpreted as
a pipelined HTTP request or tunnel traffic sent in anticipation of a success response from the
server. Due to this potential evasion tactic, the HTTP inspector will not cut over to the wizard if
it sees any early client-to-server traffic, but will continue normal HTTP processing of the flow
regardless of the eventual server response.</p></div>
</div>
<div class="sect3">
<h4 id="_detection_rules">Detection rules</h4>
<div class="paragraph"><p>http_inspect parses HTTP messages into their components and makes them
available to the detection engine through rule options. Let’s start with an
example:</p></div>
<div class="literalblock">
<div class="content">
<pre><code>alert tcp any any -&gt; any any (
    msg:"URI example";
    flow:established, to_server;
    http_uri; content:"chocolate";
    sid:1; rev:1; )</code></pre>
</div></div>
<div class="paragraph"><p>This rule looks for chocolate in the URI portion of the request message.
Specifically, the http_uri rule option is the normalized URI with all the
percent encodings removed. It will find chocolate in both:</p></div>
<div class="literalblock">
<div class="content">
<pre><code>GET /chocolate/cake HTTP/1.1</code></pre>
</div></div>
<div class="paragraph"><p>and</p></div>
<div class="literalblock">
<div class="content">
<pre><code>GET /%63%68$6F%63%6F%6C%61%74%65/%63%61%6B%65 HTTP/1.1</code></pre>
</div></div>
<div class="paragraph"><p>It is also possible to search the unnormalized URI</p></div>
<div class="literalblock">
<div class="content">
<pre><code>alert tcp any any -&gt; any any (
    msg:"Raw URI example";
    flow:established, to_server;
    http_raw_uri; content:"chocolate";
    sid:2; rev:1; )</code></pre>
</div></div>
<div class="paragraph"><p>will match the first message but not the second. If you want to detect
someone who is trying to hide his request for chocolate then</p></div>
<div class="literalblock">
<div class="content">
<pre><code>alert tcp any any -&gt; any any (
    msg:"Raw URI example";
    flow:established, to_server;
    http_raw_uri; content:"%63%68$6F%63%6F%6C%61%74%65";
    sid:3; rev:1; )</code></pre>
</div></div>
<div class="paragraph"><p>will do the trick.</p></div>
<div class="paragraph"><p>Let’s look at possible ways of writing a rule to match HTTP response
messages with the Content-Language header set to "da" (Danish). You could
write:</p></div>
<div class="literalblock">
<div class="content">
<pre><code>alert tcp any any -&gt; any any (
    msg:"whole header search";
    flow:established, to_client;
    http_header; content:"Content-Language: da", nocase;
    sid:4; rev:1; )</code></pre>
</div></div>
<div class="paragraph"><p>This rule leaves much to be desired. Modern headers are often thousands of
bytes and seem to get longer every year. Searching all of the headers
consumes a lot of resources. Furthermore this rule is easily evaded:</p></div>
<div class="literalblock">
<div class="content">
<pre><code>HTTP/1.1 ... Content-Language:  da ...</code></pre>
</div></div>
<div class="paragraph"><p>the extra space before the "da" throws the rule off. Or how about:</p></div>
<div class="literalblock">
<div class="content">
<pre><code>HTTP/1.1 ... Content-Language: xx,da ...</code></pre>
</div></div>
<div class="paragraph"><p>By adding a made up second language the attacker has once again thwarted
the match.</p></div>
<div class="paragraph"><p>A better way to write this rule is:</p></div>
<div class="literalblock">
<div class="content">
<pre><code>alert tcp any any -&gt; any any (
    msg:"individual header search";
    flow:established, to_client;
    http_header: field content-language; content:"da", nocase;
    sid:4; rev:2; )</code></pre>
</div></div>
<div class="paragraph"><p>The field option improves performance by narrowing the search to the
Content-Language field of the header. Because it uses the header parsing
abilities of http_inspect to find the field of interest it will not be
thrown off by extra spaces or other languages in the list.</p></div>
<div class="paragraph"><p>In addition to the headers there are rule options for virtually every part
of the HTTP message.</p></div>
<div class="paragraph"><p>Occasionally one needs a rule that looks for the count of some variable. For
example, to alert when a message has more than 100 headers use this rule:</p></div>
<div class="literalblock">
<div class="content">
<pre><code>alert tcp any any -&gt; any any ( msg:"more that 100 headers";
http_num_headers: &gt; 100; sid:25; rev:1; )</code></pre>
</div></div>
<div class="paragraph"><p>This is a range-based rule. It is matching when the expression in the rule
option is true. The general format is "option operator value". To compare for
equality, use operator "=". This is the default operator and may be omitted.
Both rules below will alert when the message has 100 headers:</p></div>
<div class="literalblock">
<div class="content">
<pre><code>alert tcp any any -&gt; any any ( msg:"100 headers";
http_num_headers: = 100; sid:26; rev:1; )</code></pre>
</div></div>
<div class="literalblock">
<div class="content">
<pre><code>alert tcp any any -&gt; any any ( msg:"100 headers";
http_num_headers: 100; sid:27; rev:1; )</code></pre>
</div></div>
<div class="paragraph"><p>Compare for non-equality using operator "!" or "!=", compare for less than
using operator "&lt;", compare for greater than using operator "&gt;", compare for
less or equal using operator "⇐", and compare for greater or equal using
operator "&gt;=".</p></div>
<div class="paragraph"><p>To alert when a message has strictly more than 100 headers and strictly less
than 200 headers use this rule:</p></div>
<div class="literalblock">
<div class="content">
<pre><code>alert tcp any any -&gt; any any ( msg:"between (100,200) headers";
http_num_headers: 100&lt;&gt;200; sid:28; rev:1; )</code></pre>
</div></div>
<div class="paragraph"><p>This is a range-based rule with an interval. The general format is
"option value1 operator value2". Use operator "&lt;&gt;" to match if the option
is in the interval excluding the endpoints, or operator "&lt;⇒" to
include the endpoints. This rule will alert when a message has 100 headers
or more and 200 headers or less:</p></div>
<div class="literalblock">
<div class="content">
<pre><code>alert tcp any any -&gt; any any ( msg:"between [100,200] headers";
http_num_headers: 100&lt;=&gt;200; sid:95; rev:1; )</code></pre>
</div></div>
<div class="sect4">
<h5 id="_http_uri_and_http_raw_uri">http_uri and http_raw_uri</h5>
<div class="paragraph"><p>These provide the URI of the request message. The raw form is exactly as it
appeared in the message and the normalized form is determined by the URI
normalization options you selected. In addition to searching the entire URI
there are six components that can be searched individually:</p></div>
<div class="literalblock">
<div class="content">
<pre><code>alert tcp any any -&gt; any any (
    msg:"URI path";
    flow:established, to_server;
    http_uri: path; content:"chocolate";
    sid:1; rev:2; )</code></pre>
</div></div>
<div class="paragraph"><p>By specifying "path" the search is limited to the path portion of the URI.
Informally this is the part consisting of the directory path and file name.
Thus it will match:</p></div>
<div class="literalblock">
<div class="content">
<pre><code>GET /chocolate/cake HTTP/1.1</code></pre>
</div></div>
<div class="paragraph"><p>but not:</p></div>
<div class="literalblock">
<div class="content">
<pre><code>GET /book/recipes?chocolate+cake HTTP/1.1</code></pre>
</div></div>
<div class="paragraph"><p>The question mark ends the path and begins the query portion of the URI.
Informally the query is where parameter values are set and often contains a
search to be performed.</p></div>
<div class="paragraph"><p>The six components are:</p></div>
<div class="olist arabic"><ol class="arabic">
<li>
<p>
path: directory and file
</p>
</li>
<li>
<p>
query: user parameters
</p>
</li>
<li>
<p>
fragment: part of the file requested, normally found only inside a
   browser and not transmitted over the network
</p>
</li>
<li>
<p>
host: domain name of the server being addressed
</p>
</li>
<li>
<p>
port: TCP port number being addressed
</p>
</li>
<li>
<p>
scheme: normally "http" or "https" but others are possible such as "ftp"
</p>
</li>
</ol></div>
<div class="paragraph"><p>Here is an example with all six:</p></div>
<div class="literalblock">
<div class="content">
<pre><code>GET https://www.samplehost.com:287/basic/example/of/path?with-query
#and-fragment HTTP/1.1\r\n</code></pre>
</div></div>
<div class="paragraph"><p>The URI is everything between the first space and the last space. "https"
is the scheme, "www.samplehost.com" is the host, "287" is the port,
"/basic/example/of/path" is the path, "with-query" is the query, and
"and-fragment" is the fragment.</p></div>
<div class="paragraph"><p>http_uri represents the normalized uri, normalization of components depends
on uri type. If the uri is of type absolute (contains all six components) or
absolute path (contains path, query and fragment) then the path and query
components are normalized. In these cases, http_uri represents the normalized
path, query, and fragment (/path?query#fragment). If the uri is of type
authority (host and port), the host is normalized and http_uri represents the
normalized host with the port number. In all other cases http_uri is the same
as http_raw_uri.</p></div>
<div class="paragraph"><p>Note: this section uses informal language to explain some things. Nothing
here is intended to conflict with the technical language of the HTTP RFCs
and the implementation follows the RFCs.</p></div>
</div>
<div class="sect4">
<h5 id="_http_header_and_http_raw_header">http_header and http_raw_header</h5>
<div class="paragraph"><p>These cover all the header lines except the first one. You may specify an
individual header by name using the field option as shown in this earlier
example:</p></div>
<div class="literalblock">
<div class="content">
<pre><code>alert tcp any any -&gt; any any (
    msg:"individual header search";
    flow:established, to_client;
    http_header: field content-language; content:"da", nocase;
    sid:4; rev:2; )</code></pre>
</div></div>
<div class="paragraph"><p>This rule searches the value of the Content-Language header. Header names
are not case sensitive and may be written in the rule in any mixture of
upper and lower case.</p></div>
<div class="paragraph"><p>With http_header the individual header value is normalized in a way that is
appropriate for that header.</p></div>
<div class="paragraph"><p>If you don’t specify a header you get all of the headers. http_raw_header
includes the unmodified header names and values as they appeared in the
original message. http_header is the same except percent encodings and cookies
are removed and paths are simplified exactly as if the headers were a URI.</p></div>
<div class="paragraph"><p>In most cases specifying individual headers creates a more efficient and
accurate rule. It is recommended that new rules be written using individual
headers whenever possible.</p></div>
</div>
<div class="sect4">
<h5 id="_http_trailer_and_http_raw_trailer">http_trailer and http_raw_trailer</h5>
<div class="paragraph"><p>HTTP permits header lines to appear after a chunked body ends. Typically
they contain information about the message content that was not available
when the headers were created. For convenience we call them trailers.</p></div>
<div class="paragraph"><p>http_trailer and http_raw_trailer are identical to their header
counterparts except they apply to these end headers. If you want a rule to
inspect both kinds of headers you need to write two rules, one using header
and one using trailer.</p></div>
</div>
<div class="sect4">
<h5 id="_http_cookie_and_http_raw_cookie">http_cookie and http_raw_cookie</h5>
<div class="paragraph"><p>These provide the value of the Cookie header for a request message and the
Set-Cookie for a response message. If multiple cookies are present they
will be concatenated into a comma-separated list.</p></div>
<div class="paragraph"><p>Normalization for http_cookie is the same URI-style normalization applied
to http_header when no specific header is specified.</p></div>
</div>
<div class="sect4">
<h5 id="_http_true_ip">http_true_ip</h5>
<div class="paragraph"><p>This provides the original IP address of the client sending the request as
it was stored by a proxy in the request message headers. Specifically it
is the last IP address listed in the X-Forwarded-For, True-Client-IP or
any other custom x-forwarded-for type header. If multiple headers are present the
preference defined in xff_headers configuration is considered.</p></div>
</div>
<div class="sect4">
<h5 id="_http_client_body">http_client_body</h5>
<div class="paragraph"><p>This is the body of a request message such as POST or PUT. Normalization
for http_client_body is the same URI-like normalization applied to
http_header when no specific header is specified.</p></div>
</div>
<div class="sect4">
<h5 id="_http_raw_body">http_raw_body</h5>
<div class="paragraph"><p>This is the body of a request or response message. It will be dechunked
and unzipped if applicable but will not be normalized in any other way.</p></div>
</div>
<div class="sect4">
<h5 id="_http_method">http_method</h5>
<div class="paragraph"><p>The method field of a request message. Common values are "GET", "POST",
"OPTIONS", "HEAD", "DELETE", "PUT", "TRACE", and "CONNECT".</p></div>
</div>
<div class="sect4">
<h5 id="_http_stat_code">http_stat_code</h5>
<div class="paragraph"><p>The status code field of a response message. This is normally a 3-digit
number between 100 and 599. In this example it is 200.</p></div>
<div class="literalblock">
<div class="content">
<pre><code>HTTP/1.1 200 OK</code></pre>
</div></div>
</div>
<div class="sect4">
<h5 id="_http_stat_msg">http_stat_msg</h5>
<div class="paragraph"><p>The reason phrase field of a response message. This is the human-readable
text following the status code. "OK" in the previous example.</p></div>
</div>
<div class="sect4">
<h5 id="_http_version">http_version</h5>
<div class="paragraph"><p>The protocol version information that appears on the first line of an HTTP
message. This is usually "HTTP/1.0" or "HTTP/1.1".</p></div>
</div>
<div class="sect4">
<h5 id="_http_raw_request_and_http_raw_status">http_raw_request and http_raw_status</h5>
<div class="paragraph"><p>These are the unmodified first header line of the HTTP request and response
messages respectively. These rule options are a safety valve in case you
need to do something you cannot otherwise do. In most cases it is better to
use a rule option for a specific part of the first header line. For a
request message those are http_method, http_raw_uri, and http_version. For
a response message those are http_version, http_stat_code, and
http_stat_msg.</p></div>
</div>
<div class="sect4">
<h5 id="_file_data">file_data</h5>
<div class="paragraph"><p>The file_data contains the normalized message body. This is the normalization
described above under gzip, normalize_utf, decompress_pdf, decompress_swf, and
normalize_javascript.</p></div>
</div>
<div class="sect4">
<h5 id="_js_data">js_data</h5>
<div class="paragraph"><p>The js_data contains normalized JavaScript text collected from the whole PDU
(inline or external scripts). It requires the Enhanced Normalizer enabled:
js_norm = { },
Despite what js_data has, file_data still contains the whole HTTP body
with an original JavaScript in it.</p></div>
</div>
<div class="sect4">
<h5 id="_vba_data">vba_data</h5>
<div class="paragraph"><p>The vba_data will contain the decompressed Visual Basic for Applications
(vba) macro data embedded in MS office files. It requires decompress_zip
and decompress_vba options enabled.</p></div>
</div>
<div class="sect4">
<h5 id="_http_num_headers_and_http_num_trailers">http_num_headers and http_num_trailers</h5>
<div class="paragraph"><p>These are range-based rule options used to check the number of headers and
trailers, respectively.</p></div>
</div>
<div class="sect4">
<h5 id="_http_max_header_line_and_http_max_trailer_line">http_max_header_line and http_max_trailer_line</h5>
<div class="paragraph"><p>These are range-based rule options used to check the longest line in
request and response headers and trailers, respectively.</p></div>
</div>
<div class="sect4">
<h5 id="_http_num_cookies">http_num_cookies</h5>
<div class="paragraph"><p>This is a range-based rule option that checks the number of cookies. In a
request all the individual cookies found in Cookie header are counted. For
example, in this request there are 2 cookies:</p></div>
<div class="literalblock">
<div class="content">
<pre><code>GET /send/in/some/cookies HTTP/1.1
Host: www.cookie-store.com
Cookie: SID=31d4d96e407aad42; lang=en-US</code></pre>
</div></div>
<div class="paragraph"><p>In a response Set-Cookie headers are counted. For example, in this response
there are 2 cookies:</p></div>
<div class="literalblock">
<div class="content">
<pre><code>HTTP/1.0 540 Too much sugar
Content-Length: 5
Set-Cookie: lang=en-US; Path=/; Domain=example.com
Set-Cookie: id=a3fWa; Expires=Thu, 21 Oct 2021 07:28:00 GMT; Secure; HttpOnly</code></pre>
</div></div>
</div>
<div class="sect4">
<h5 id="_http_version_match">http_version_match</h5>
<div class="paragraph"><p>Rule option that matches HTTP version to one of the listed version values.
Possible match values: 1.0, 1.1, 2.0, 0.9, other, and malformed.
When receiving a request line or status line, if the version is present
it will be used for comparison. If the version doesn’t have a format of
[0-9].[0-9] it is considered malformed. A [0-9].[0-9] that is not 1.0 or 1.1
is considered other. 0.9 refers to the original HTTP protocol version that
uses simple GET requests without headers and includes no version number. 2.0
refers to the actual HTTP/2 protocol with framed data. Messages that follow
the general HTTP/1 format but contain version fields falsely claiming to be
HTTP/2.0 or HTTP/0.9 will match "other" as described above. The http_version
rule option is available to examine the actual bytes in the version field.</p></div>
</div>
<div class="sect4">
<h5 id="_http_header_test_and_http_trailer_test">http_header_test and http_trailer_test</h5>
<div class="paragraph"><p>Rule options that perform various tests against a specific header and
trailer field, respectively. It can perform a range test, check whether the
value is numeric or whether it is absent. Negative values are considered
non-numeric. Values with more than 18 digits are considered non-numeric.</p></div>
</div>
</div>
<div class="sect3">
<h4 id="_timing_issues_and_combining_rule_options">Timing issues and combining rule options</h4>
<div class="paragraph"><p>HTTP inspector is stateful. That means it is aware of a bigger picture than
the packet in front of it. It knows what all the pieces of a message are,
the dividing lines between one message and the next, which request message
triggered which response message, pipelines, and how many messages have
been sent over the current connection.</p></div>
<div class="paragraph"><p>It is possible to write rules that examine both the client request and
the server response to it.</p></div>
<div class="literalblock">
<div class="content">
<pre><code>alert tcp any any -&gt; any any (
    msg:"request and response example";
    flow:established, to_client;
    http_uri; content:"chocolate";
    file_data; content:"white chocolate";
    sid:7; rev:1; )</code></pre>
</div></div>
<div class="paragraph"><p>This rule looks for white chocolate in a response message body where the
URI of the request contained chocolate. Note that this is a "to_client"
rule that will alert on and potentially block a server response containing
white chocolate, but only if the client URI requested chocolate. If the
rule were rewritten "to_server" it would be nonsense and not work. Snort
cannot block a client request based on what the server response will be
because that has not happened yet.</p></div>
<div class="paragraph"><p>Response messages do not have a URI so there was only one thing http_uri
could have meant in the previous rule. It had to be referring to the
request message. Sometimes that is not so clear.</p></div>
<div class="literalblock">
<div class="content">
<pre><code>alert tcp any any -&gt; any any (
    msg:"header ambiguity example 1";
    flow:established, to_client;
    http_header; content:"chocolate";
    file_data; content:"white chocolate";
    sid:8; rev:1; )</code></pre>
</div></div>
<div class="literalblock">
<div class="content">
<pre><code>alert tcp any any -&gt; any any (
    msg:"header ambiguity example 2";
    flow:established, to_client;
    http_header: request; content:"chocolate";
    file_data; content:"white chocolate";
    sid:8; rev:2; )</code></pre>
</div></div>
<div class="paragraph"><p>Our search for chocolate has moved from the URI to the message headers.
Both the request and response messages have headers—which one are we
asking about? Ambiguity is always resolved in favor of looking in the
current message which is the response. The first rule is looking for a
server response containing chocolate in the headers and white chocolate in
the body.</p></div>
<div class="paragraph"><p>The second rule uses the "request" option to explicitly say that the
http_header to be searched is the request header.</p></div>
<div class="paragraph"><p>Fast patterns are always searched in the current message. Rule options using
"request" option can’t be used as fast patterns.</p></div>
<div class="paragraph"><p>Message body sections can only go through detection at the time they are
received. Headers may be combined with later items but the body cannot.</p></div>
<div class="paragraph"><p>The sub-options "with_header", "with_body" and "with_trailer" are deprecated,
and no longer required when mixing the different sections.</p></div>
</div>
</div>
<div class="sect2">
<h3 id="_http_2_inspector">HTTP/2 Inspector</h3>
<div class="paragraph"><p>New in Snort 3, the HTTP/2 inspector enables Snort to process HTTP/2 traffic.</p></div>
<div class="sect3">
<h4 id="_overview_6">Overview</h4>
<div class="paragraph"><p>Despite the name, it is better to think of HTTP/2 not as a newer version of HTTP/1.1, but rather a
separate protocol layer that runs under HTTP/1.1 and on top of TLS or TCP. It supports several new
features with the goal of improving the performance of HTTP requests, notably the ability to
multiplex many requests over a single TCP connection, HTTP header compression, and server push.</p></div>
<div class="paragraph"><p>HTTP/2 is a perfect fit for the new Snort 3 PDU-based inspection architecture. The HTTP/2 inspector
parses and strips the HTTP/2 protocol framing and outputs HTTP/1.1 messages, exactly what
http_inspect wants to input. The HTTP/2 traffic then undergoes the same processing as regular
HTTP/1.1 traffic discussed above. So if you haven’t already, take a look at the HTTP Inspector
section; those features also apply to HTTP/2 traffic.</p></div>
</div>
<div class="sect3">
<h4 id="_configuration_5">Configuration</h4>
<div class="paragraph"><p>You can configure the HTTP/2 inspector with the default configuration by adding:</p></div>
<div class="literalblock">
<div class="content">
<pre><code>http2_inspect = {}</code></pre>
</div></div>
<div class="paragraph"><p>to your snort.lua configuration file. Since processing HTTP/2 traffic relies on the HTTP inspector,
http_inspect must also be configured. Keep in mind that the http_inspect configuration will also
impact HTTP/2 traffic.</p></div>
<div class="sect4">
<h5 id="_concurrent_streams_limit">concurrent_streams_limit</h5>
<div class="paragraph"><p>This limits the maximum number of HTTP/2 streams Snort will process concurrently in a single HTTP/2
flow. The default and minimum configurable value is 100. It can be configured up to a maximum of
1000.</p></div>
</div>
</div>
<div class="sect3">
<h4 id="_detection_rules_2">Detection rules</h4>
<div class="paragraph"><p>Since HTTP/2 traffic is processed through the HTTP inspector, all of the rule options discussed
above are also available for HTTP/2 traffic. To smooth the transition to inspecting HTTP/2, rules
that specify service:http will be treated as if they also specify service:http2.
Thus:</p></div>
<div class="literalblock">
<div class="content">
<pre><code>alert tcp any any -&gt; any any (flow:established, to_server;
http_uri; content:"/foo";
service: http; sid:10; rev:1;)</code></pre>
</div></div>
<div class="paragraph"><p>is understood to mean:</p></div>
<div class="literalblock">
<div class="content">
<pre><code>alert tcp any any -&gt; any any (flow:established, to_server;
http_uri; content:"/foo";
service: http,http2; sid:10; rev:1;)</code></pre>
</div></div>
<div class="paragraph"><p>Thus it will alert on "/foo" in the URI for both HTTP/1 and HTTP/2 traffic.</p></div>
<div class="paragraph"><p>The reverse is not true. "service: http2" without http will match on HTTP/2
flows but not HTTP/1 flows.</p></div>
<div class="paragraph"><p>This feature makes it easy to add HTTP/2 inspection without modifying
large numbers of existing rules. New rules should explicitly specify
"service http,http2;" if that is the desired behavior. Eventually
support for http implies http2 may be deprecated and removed.</p></div>
</div>
</div>
<div class="sect2">
<h3 id="_iec104_inspector">IEC104 Inspector</h3>
<div class="paragraph"><p>iec104 inspector is a service inspector for the IEC 60870-5-104 protocol.</p></div>
<div class="sect3">
<h4 id="_overview_7">Overview</h4>
<div class="paragraph"><p>IEC 60870-5-104 (iec104) is a protocol distributed by the International
Electrotechnical Commission (IEC) that provides a standardized method of
sending telecontrol messages between central stations and outstations,
typically running on TCP port 2404.</p></div>
<div class="paragraph"><p>It is used in combination with the companion specifications in the
IEC 60870-5 family, most notably IEC 60870-5-101, to provide reliable
transport via TCP/IP.</p></div>
<div class="paragraph"><p>An iec104 Application Protocol Data Unit (APDU) consists of one of three
Application Protocol Control Information (APCI) structures, each beginning
with the start byte 0x68. In the case of an Information Transfer APCI, an
Application Service Data Unit (ASDU) follows the APCI.</p></div>
<div class="paragraph"><p>The iec104 inspector decodes the iec104 protocol and provides rule options
to access certain protocol fields and data content. This allows the user to
write rules for iec104 packets without decoding the protocol.</p></div>
</div>
<div class="sect3">
<h4 id="_configuration_6">Configuration</h4>
<div class="paragraph"><p>iec104 messages can be normalized to either combine a message spread across
multiple frames, or to split apart multiple messages within one frame. No
manual configuration is necessary to leverage this functionality.</p></div>
</div>
<div class="sect3">
<h4 id="_quick_guide_3">Quick Guide</h4>
<div class="paragraph"><p>A typical iec104 configuration looks like this:</p></div>
<div class="literalblock">
<div class="content">
<pre><code>binder =
{
    {
        when =
        {
            proto = 'tcp',
            ports = '2404'
        },
        use =
        {
            type = 'iec104'
        },
    },
}</code></pre>
</div></div>
<div class="literalblock">
<div class="content">
<pre><code>iec104 = { }</code></pre>
</div></div>
<div class="paragraph"><p>In this example, the tcp inspector is defined based on port. All
configurations are default.</p></div>
<div class="paragraph"><p>Debug logging can be enabled with the following additional configuration:</p></div>
<div class="literalblock">
<div class="content">
<pre><code>trace =
{
    modules =
    {
        iec104 =
        {
            all = 1
        }
    }
}</code></pre>
</div></div>
</div>
<div class="sect3">
<h4 id="_rule_options_2">Rule Options</h4>
<div class="paragraph"><p>New rule options are supported by enabling the iec104 inspector:</p></div>
<div class="ulist"><ul>
<li>
<p>
iec104_apci_type
</p>
</li>
<li>
<p>
iec104_asdu_func
</p>
</li>
</ul></div>
<div class="sect4">
<h5 id="_iec104_apci_type">iec104_apci_type</h5>
<div class="paragraph"><p>Determining the APCI type of an iec104 message involves checking the state
of one to two bits in the message’s first control field octet. This can
be completed with a <code>byte_test</code> in a plaintext rule, however it adds unnecessary
complexity to the rule. Since most rules inspecting iec104 traffic will target
APCI Type I messages, this option was created to alleviate the need to manually
check the type and subsequently reduce the complexity of the rule.</p></div>
<div class="paragraph"><p>This option takes one argument with three acceptable configurations.</p></div>
<div class="paragraph"><p>Examples:</p></div>
<div class="literalblock">
<div class="content">
<pre><code>iec104_apci_type:unnumbered_control_function;
iec104_apci_type:S;
iec104_apci_type:i;</code></pre>
</div></div>
<div class="paragraph"><p>This option is used to verify that the message being processed is of the
specified type. The argument passed to this rule option can be specified
in one of three ways: the full type name, the lowercase type abbreviation,
or the uppercase type abbreviation.</p></div>
</div>
<div class="sect4">
<h5 id="_iec104_asdu_func">iec104_asdu_func</h5>
<div class="paragraph"><p>Determining the ASDU function of an iec104 message can be completed with a
plaintext rule that checks a single byte in the message, however it also
requires verifying that the message’s APCI is of Type I. Since a rule writer
may not necessarily know that this additional check must be made, this
option was created to simplify the process of verifying the function type
and subsequently reduce the complexity of the rule.</p></div>
<div class="paragraph"><p>This option takes one argument with two acceptable configurations.</p></div>
<div class="paragraph"><p>Examples:</p></div>
<div class="literalblock">
<div class="content">
<pre><code>iec104_asdu_func:M_SP_NA_1;
iec104_asdu_func:m_ps_na_1;</code></pre>
</div></div>
<div class="paragraph"><p>This option is used to verify that the message being processed is using
the specified ASDU function. The argument passed to this rule option can
be specified in one of two ways: the uppercase function name, or the
lowercase function name.</p></div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_javascript_normalization">JavaScript Normalization</h3>
<div class="paragraph"><p>One of the improvements in Snort 3 is Enhanced JavaScript Normalizer which has its
own module and can be used with any service inspectors where JavaScript code might occur.
Currently it is supported for the following inspectors: HTTP, SMTP, IMAP, POP.</p></div>
<div class="sect3">
<h4 id="_overview_8">Overview</h4>
<div class="paragraph"><p>You can configure it by adding:</p></div>
<div class="literalblock">
<div class="content">
<pre><code>js_norm = {}</code></pre>
</div></div>
<div class="paragraph"><p>to your snort.lua configuration file. Or you can read about it in the
source code under src/js_norm.</p></div>
<div class="paragraph"><p>Having <em>js_norm</em> module configured and ips option <em>js_data</em> in the rules automatically
enables Enhanced Normalizer.</p></div>
<div class="paragraph"><p>The Enhanced Normalizer can normalize JavaScript embedded in HTML (inline scripts),
in separate .js files (external scripts), and JavaScript embedded in PDF files sent over HTTP/1,
HTTP/2, SMTP, IMAP and POP3 protocols. It supports scripts over multiple PDUs. It is a stateful
JavaScript whitespace and identifiers normalizer. Normalizer concatenates string literals whenever
it’s possible to do. This also works with any other normalizations that result in string literals.
All JavaScript identifier names, except those from the ignore lists, will be substituted with unified
names in the following format: var_0000 → var_ffff. The Normalizer tries to expand escaped text, so
it will appear in a readable form in the output. When such text is a parameter of an unescape function,
the entire function call will be replaced by the unescaped string. Moreover, Normalizer validates the
syntax concerning ECMA-262 Standard, including scope tracking and restrictions for script elements.
JavaScript, embedded in PDF files, has to be decompressed before normalization. For that,
decompress_pdf = true option has to be set in configuration of appropriate service inspectors.</p></div>
<div class="paragraph"><p>Check with the following options for more configurations: bytes_depth, identifier_depth,
max_tmpl_nest, max_bracket_depth, max_scope_depth, ident_ignore, prop_ignore.</p></div>
<div class="paragraph"><p>Enhanced normalizer is the preferred option for writing new JavaScript related rules, though
legacy normalizer (part of http_inspect) is still available to support old rules.</p></div>
</div>
<div class="sect3">
<h4 id="_configuration_7">Configuration</h4>
<div class="paragraph"><p>Configuration can be as simple as adding:</p></div>
<div class="literalblock">
<div class="content">
<pre><code>js_norm = {}</code></pre>
</div></div>
<div class="paragraph"><p>to your snort.lua file. The default configuration provides a thorough
normalization and may be all that you need, but there are some options that
provide extra features, tweak how things are done, or conserve resources by
doing less.</p></div>
<div class="paragraph"><p>Also, there are default lists of ignored identifiers and object properties provided.
To get a complete default configuration, use <em>default_js_norm</em> from $SNORT_LUA_PATH/snort_defaults.lua
by adding:</p></div>
<div class="literalblock">
<div class="content">
<pre><code>js_norm = default_js_norm</code></pre>
</div></div>
<div class="paragraph"><p>to your snort.lua file.</p></div>
<div class="paragraph"><p>Enhanced JavaScript Normalizer implements JIT approach. Actual normalization takes place
only when js_data option is evaluated. This option is also used as a buffer selector for
normalized JavaScript data.</p></div>
<div class="sect4">
<h5 id="_bytes_depth">bytes_depth</h5>
<div class="paragraph"><p>bytes_depth = N {-1 : max53} will set a number of input JavaScript
bytes to normalize. When the depth is reached, normalization will be stopped.
It’s implemented per-script. By default bytes_depth = -1, will set
unlimited depth.</p></div>
</div>
<div class="sect4">
<h5 id="_identifier_depth">identifier_depth</h5>
<div class="paragraph"><p>identifier_depth = N {0 : 65536} will set a number of unique
JavaScript identifiers to normalize. When the depth is reached, a built-in
alert is generated. Every response has its own identifier substitution context,
which means that identifier will retain same normal form in multiple scripts,
if they are a part of the same response, and that this limit is set for a single
response and not a single script. By default, the value is set to 65536, which
is the max allowed number of unique identifiers. The generated names are in
the range from var_0000 to var_ffff.</p></div>
</div>
<div class="sect4">
<h5 id="_max_tmpl_nest">max_tmpl_nest</h5>
<div class="paragraph"><p>max_tmpl_nest = N {0 : 255} (default 32) is an option of the enhanced
JavaScript normalizer that determines the deepest level of nested template literals
to be processed. Introduced in ES6, template literals provide syntax to define
a literal multiline string, which can have arbitrary JavaScript substitutions,
that will be evaluated and inserted into the string. Such substitutions can be
nested, and require keeping track of every layer for proper normalization. This option
is present to limit the amount of memory dedicated to template nesting tracking.</p></div>
</div>
<div class="sect4">
<h5 id="_max_bracket_depth">max_bracket_depth</h5>
<div class="paragraph"><p>max_bracket_depth = N {1 : 65535} (default 256) is an option of the enhanced
JavaScript normalizer that determines the maximum depth of nesting brackets, i.e. parentheses,
braces and square brackets, nested within a matching pair, in any combination. This option
is present to limit the amount of memory dedicated to bracket tracking.</p></div>
</div>
<div class="sect4">
<h5 id="_max_scope_depth">max_scope_depth</h5>
<div class="paragraph"><p>max_scope_depth = N {1 : 65535} (default 256) is an option of the enhanced
JavaScript normalizer that determines the deepest level of nested variable scope,
i.e. functions, code blocks, etc. including the global scope.
This option is present to limit the amount of memory dedicated to scope tracking.</p></div>
</div>
<div class="sect4">
<h5 id="_ident_ignore">ident_ignore</h5>
<div class="paragraph"><p>ident_ignore = {&lt;list of ignored identifiers&gt;} is an option of the enhanced
JavaScript normalizer that defines a list of identifiers to keep intact.</p></div>
<div class="paragraph"><p>Identifiers in this list will not be put into normal form (var_0000). Subsequent accessors,
after dot, in square brackets or after function call, will not be normalized as well.</p></div>
<div class="paragraph"><p>For example:</p></div>
<div class="literalblock">
<div class="content">
<pre><code>console.log("bar")
document.getElementById("id").text
eval("script")
console["log"]</code></pre>
</div></div>
<div class="paragraph"><p>Every entry has to be a simple identifier, i.e. not include dots, brackets, etc.
For example:</p></div>
<div class="literalblock">
<div class="content">
<pre><code>js_norm.ident_ignore = { 'console', 'document', 'eval', 'foo' }</code></pre>
</div></div>
<div class="paragraph"><p>When a variable assignment that <em>aliases</em> an identifier from the list is found,
the assignment will be tracked, and subsequent occurrences of the variable will be
replaced with the stored value. This substitution will follow JavaScript variable scope
limits.</p></div>
<div class="paragraph"><p>For example:</p></div>
<div class="literalblock">
<div class="content">
<pre><code>var a = console.log
a("hello") // will be substituted to 'console.log("hello")'</code></pre>
</div></div>
<div class="paragraph"><p>For class names and constructors in the list, when the class is used with the
keyword <em>new</em>, created object will be tracked, and its properties will be kept intact.
Identifier of the object itself, however, will be brought to unified form.</p></div>
<div class="paragraph"><p>For example:</p></div>
<div class="literalblock">
<div class="content">
<pre><code>var o = new Array() // normalized to 'var var_0000=new Array()'
o.push(10) // normalized to 'var_0000.push(10)'</code></pre>
</div></div>
<div class="paragraph"><p>The default list of ignore-identifiers is present in "snort_defaults.lua".</p></div>
<div class="paragraph"><p>Unescape function names should remain intact in the output. They ought to be
included in the ignore list. If for some reason the user wants to disable unescape
related features, then removing function’s name from the ignore list does the trick.</p></div>
</div>
<div class="sect4">
<h5 id="_prop_ignore">prop_ignore</h5>
<div class="paragraph"><p>prop_ignore = {&lt;list of ignored properties&gt;} is an option of the enhanced
JavaScript normalizer that defines a list of object properties and methods that
will be kept intact during normalization of identifiers. This list should include
methods and properties of objects that will not be tracked by assignment substitution
functionality, for example, those that can be created implicitly.</p></div>
<div class="paragraph"><p>Subsequent accessors, after dot, in square brackets or after function call, will not be
normalized as well.</p></div>
<div class="paragraph"><p>For example:</p></div>
<div class="literalblock">
<div class="content">
<pre><code>js_norm.prop_ignore = { 'split' }</code></pre>
</div></div>
<div class="literalblock">
<div class="content">
<pre><code>in: "string".toUpperCase().split("").reverse().join("");
out: "string".var_0000().split("").reverse().join("");</code></pre>
</div></div>
<div class="paragraph"><p>The default list of ignored properties is present in "snort_defaults.lua".</p></div>
</div>
</div>
<div class="sect3">
<h4 id="_detection_rules_3">Detection rules</h4>
<div class="paragraph"><p>Enhanced JavaScript Normalizer follows JIT approach, which requires rules with
<em>js_data</em> IPS option to be executed. This can lead to missed data when js_data
option is not evaluated for some packets, e.g. if there is a non-js_data fast
pattern. In this case, when fast pattern doesn’t match, JavaScript normalization
is skipped for the current PDU. If later js_data IPS rule matches again,
a missed normalization context is detected and 154:8 built-in alert is raised.
Further normalization is not possible for the script.
For example:</p></div>
<div class="literalblock">
<div class="content">
<pre><code>alert http (msg:"JS in HTTP"; js_data; content:"var var_0000"; sid:1;)
alert smtp (msg:"JS in SMTP"; js_data; content:"var var_0000"; sid:2;)</code></pre>
</div></div>
<div class="sect4">
<h5 id="_js_data_2">js_data</h5>
<div class="paragraph"><p>The js_data IPS contains normalized JavaScript text collected from the whole PDU.
It requires the Enhanced JavaScript Normalizer configured.</p></div>
</div>
</div>
<div class="sect3">
<h4 id="_trace_messages">Trace messages</h4>
<div class="paragraph"><p>When a user needs help to sort out things going on inside Enhanced JavaScript Normalizer,
Trace module becomes handy.</p></div>
<div class="literalblock">
<div class="content">
<pre><code>$ snort --help-module trace | grep js_norm</code></pre>
</div></div>
<div class="paragraph"><p>Messages for the enhanced JavaScript Normalizer follow
(more verbosity available in debug build):</p></div>
<div class="sect4">
<h5 id="_trace_module_js_norm_proc">trace.module.js_norm.proc</h5>
<div class="paragraph"><p>Messages from script processing flow and their verbosity levels:</p></div>
<div class="olist arabic"><ol class="arabic">
<li>
<p>
Script opening tag location.
</p>
</li>
<li>
<p>
Attributes of the detected script.
</p>
</li>
<li>
<p>
Return codes from Normalizer.
</p>
</li>
</ol></div>
</div>
<div class="sect4">
<h5 id="_trace_module_js_norm_dump">trace.module.js_norm.dump</h5>
<div class="paragraph"><p>JavaScript data dump and verbosity levels:</p></div>
<div class="olist arabic"><ol class="arabic">
<li>
<p>
js_data buffer as it is passed to detection.
</p>
</li>
<li>
<p>
(no messages available currently)
</p>
</li>
<li>
<p>
Current script as it is passed to Normalizer.
</p>
</li>
</ol></div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_mms_inspector">MMS Inspector</h3>
<div class="paragraph"><p>MMS inspector is a service inspector for the MMS protocol within the
IEC 61850 specification.</p></div>
<div class="sect3">
<h4 id="_overview_9">Overview</h4>
<div class="paragraph"><p>IEC 61850 is a family of protocols, including MMS, distributed by the
International Electrotechnical Commission (IEC) that provide a standardized
method of sending service messages between various manufacturing and process
control devices, typically running on TCP port 102.</p></div>
<div class="paragraph"><p>It is used in combination with various parts of the OSI model, most notably
the TPKT, COTP, Session, Presentation, and ACSE layers, to provide reliable
transport via TCP/IP.</p></div>
<div class="paragraph"><p>The MMS inspector decodes the OSI layers encapsulating the MMS protocol and
provides rule writers access to certain protocol fields and data content
through rule options. This allows the user to write rules for MMS messages
without decoding the protocol.</p></div>
</div>
<div class="sect3">
<h4 id="_configuration_8">Configuration</h4>
<div class="paragraph"><p>MMS messages can be sent in a variety of ways including multiple PDUs within
one TCP packet, one PDU split across multiple TCP packets, or a combination
of the two. It is the aim of the MMS service inspector to normalize the
traffic such that only complete MMS messages are presented to the user. No
manual configuration other than enabling the MMS service inspector is
necessary to leverage this functionality.</p></div>
</div>
<div class="sect3">
<h4 id="_quick_guide_4">Quick Guide</h4>
<div class="paragraph"><p>A typical MMS configuration looks like this:</p></div>
<div class="literalblock">
<div class="content">
<pre><code>wizard = { curses = {'mms'}, }
mms = { }</code></pre>
</div></div>
<div class="literalblock">
<div class="content">
<pre><code>binder =
{
    { when = { service = 'mms' }, use = { type = 'mms' } },
    { use = { type = 'wizard' } }
}</code></pre>
</div></div>
<div class="paragraph"><p>In this example, the mms inspector is defined based on patterns known to be
consistent with MMS messages.</p></div>
</div>
<div class="sect3">
<h4 id="_rule_options_3">Rule Options</h4>
<div class="paragraph"><p>New rule options are supported by enabling the MMS inspector:</p></div>
<div class="ulist"><ul>
<li>
<p>
mms_data
</p>
</li>
<li>
<p>
mms_func
</p>
</li>
</ul></div>
<div class="sect4">
<h5 id="_mms_data">mms_data</h5>
<div class="paragraph"><p>mms_data moves the cursor to the start of the MMS message, bypassing
all of the OSI encapsulation layers and allowing subsequent rule options
to start processing from the MMS PDU field.</p></div>
<div class="paragraph"><p>This option takes no arguments.</p></div>
<div class="paragraph"><p>In the following example, the rule is using the <code>mms_data</code> rule option
to set the cursor position to the beginning of the MMS PDU, and then
checking the byte at that position for the value indicative of an
<code>Initiate-Request</code> message.</p></div>
<div class="literalblock">
<div class="content">
<pre><code>alert tcp ( \
  msg: "PROTOCOL-SCADA MMS Initiate-Request"; \
  flow: to_server, established; \
  mms_data; \
  content:"|A8|", depth 1; \
  sid:1000000; \
)</code></pre>
</div></div>
</div>
<div class="sect4">
<h5 id="_mms_func">mms_func</h5>
<div class="paragraph"><p>mms_func takes the supplied function name or number and compares it with
the Confirmed Service Request/Response in the message being analyzed.</p></div>
<div class="paragraph"><p>This option takes one argument.</p></div>
<div class="paragraph"><p>In the following example the rule is using the <code>mms_func</code> rule option
with a string argument containing the <code>Confirmed Service Request</code> service
name on which to alert. This is combined with a content match for a
<code>Confirmed Service Request</code> message (0xA0) to allow for use of the fast
pattern matcher.</p></div>
<div class="literalblock">
<div class="content">
<pre><code>alert tcp ( \
  msg: "PROTOCOL-SCADA MMS svc get_name_list"; \
  flow: to_server, established; \
  content:"|A0|"; \
  mms_func: get_name_list; \
  sid:1000000; \
)</code></pre>
</div></div>
<div class="paragraph"><p>The following example also uses the <code>mms_func</code> rule option to alert on
a <code>GetNameList</code> message, but this time an integer argument containing the
function number is used.</p></div>
<div class="literalblock">
<div class="content">
<pre><code>alert tcp ( \
  msg: "PROTOCOL-SCADA MMS svc get_name_list"; \
  flow: to_server, established; \
  content:"|A0|"; \
  mms_func:1; \
  sid:1000001; \
)</code></pre>
</div></div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_performance_monitor">Performance Monitor</h3>
<div class="paragraph"><p>The new and improved performance monitor! Is your sensor being bogged down by
too many flows? perf_monitor! Why are certain TCP segments being dropped without
hitting a rule? perf_monitor! Why is a sensor leaking water? Not perf_monitor, check
with stream…</p></div>
<div class="sect3">
<h4 id="_overview_10">Overview</h4>
<div class="paragraph"><p>The Snort performance monitor is the built-in utility for monitoring system
and traffic statistics. All statistics are separated by processing thread.
perf_monitor supports several trackers for monitoring such data:</p></div>
</div>
<div class="sect3">
<h4 id="_base_tracker">Base Tracker</h4>
<div class="paragraph"><p>The base tracker is used to gather running statistics about Snort and its
running modules. All Snort modules gather, at the very least, counters for the
number of packets reaching it. Most supplement these counts with those for
domain specific functions, such as http_inspect’s number of GET requests seen.</p></div>
<div class="paragraph"><p>Statistics are gathered live and can be reported at regular intervals. The stats
reported correspond only to the interval in question and are reset at the
beginning of each interval.</p></div>
<div class="paragraph"><p>These are the same counts displayed when Snort shuts down, only sorted amongst
the discrete intervals in which they occurred.</p></div>
<div class="paragraph"><p>Base differs from prior implementations in Snort in that all stats gathered are
only raw counts, allowing the data to be evaluated as needed. Additionally,
base is entirely pluggable. Data from new Snort plugins can be added to the
existing stats either automatically or, if specified, by name and function.</p></div>
<div class="paragraph"><p>All plugins and counters can be enabled or disabled individually, allowing for
only the data that is actually desired instead of overly verbose performance
logs.</p></div>
<div class="paragraph"><p>To enable everything:</p></div>
<div class="literalblock">
<div class="content">
<pre><code>perf_monitor = { modules = {} }</code></pre>
</div></div>
<div class="paragraph"><p>To enable everything within a module:</p></div>
<div class="literalblock">
<div class="content">
<pre><code>perf_monitor =
{
    modules =
    {
        {
            name = 'stream_tcp',
            pegs = [[ ]]
        },
    }
}</code></pre>
</div></div>
<div class="paragraph"><p>To enable specific counts within modules:</p></div>
<div class="literalblock">
<div class="content">
<pre><code>perf_monitor =
{
    modules =
    {
        {
            name = 'stream_tcp',
            pegs = [[ overlaps gaps ]]
        },
    }</code></pre>
</div></div>
<div class="paragraph"><p>Note: Event stats from prior Snorts are now located within base statistics.</p></div>
</div>
<div class="sect3">
<h4 id="_flow_tracker">Flow Tracker</h4>
<div class="paragraph"><p>Flow tracks statistics regarding traffic and L3/L4 protocol distributions. This
data can be used to build a profile of traffic for inspector tuning and for
identifying where Snort may be stressed.</p></div>
<div class="paragraph"><p>To enable:</p></div>
<div class="literalblock">
<div class="content">
<pre><code>perf_monitor = { flow = true }</code></pre>
</div></div>
</div>
<div class="sect3">
<h4 id="_flowip_tracker">FlowIP Tracker</h4>
<div class="paragraph"><p>FlowIP provides statistics for individual hosts within a network. This data can
be used for identifying communication habits, such as generating large or small
amounts of data, opening a small or large number of sessions, and tendency to
send smaller or larger IP packets.</p></div>
<div class="paragraph"><p>To enable:</p></div>
<div class="literalblock">
<div class="content">
<pre><code>perf_monitor = { flow_ip = true }</code></pre>
</div></div>
</div>
<div class="sect3">
<h4 id="_cpu_tracker">CPU Tracker</h4>
<div class="paragraph"><p>This tracker monitors the CPU and wall time spent by a given processing thread.</p></div>
<div class="paragraph"><p>To enable:</p></div>
<div class="literalblock">
<div class="content">
<pre><code>perf_monitor = { cpu = true }</code></pre>
</div></div>
</div>
<div class="sect3">
<h4 id="_formatters">Formatters</h4>
<div class="paragraph"><p>Performance monitor allows statistics to be output in a few formats. Along with human readable text
(as seen at shutdown) and csv formats, a JSON format format is also available.</p></div>
</div>
</div>
<div class="sect2">
<h3 id="_pop_and_imap">POP and IMAP</h3>
<div class="paragraph"><p>POP inspector is a service inspector for POP3 protocol and IMAP inspector
is for IMAP4 protocol.</p></div>
<div class="sect3">
<h4 id="_overview_11">Overview</h4>
<div class="paragraph"><p>POP and IMAP inspectors examine data traffic and find POP and IMAP
commands and responses. The inspectors also identify the command, header,
body sections and extract the MIME attachments and decode it
appropriately. The pop and imap also identify and whitelist the pop and
imap traffic.</p></div>
</div>
<div class="sect3">
<h4 id="_configuration_9">Configuration</h4>
<div class="paragraph"><p>POP inspector and IMAP inspector offer same set of configuration options
for MIME decoding depth. These depths range from 0 to 65535 bytes. Setting
the value to 0 ("do none") turns the feature off. Alternatively the value
-1 means an unlimited amount of data should be decoded. If you do not
specify the default value is -1 (unlimited).</p></div>
<div class="paragraph"><p>The depth limits apply per attachment. They are:</p></div>
<div class="sect4">
<h5 id="_b64_decode_depth">b64_decode_depth</h5>
<div class="paragraph"><p>Set the base64 decoding depth used to decode the base64-encoded MIME
attachments.</p></div>
</div>
<div class="sect4">
<h5 id="_qp_decode_depth">qp_decode_depth</h5>
<div class="paragraph"><p>Set the Quoted-Printable (QP) decoding depth used to decode QP-encoded
MIME attachments.</p></div>
</div>
<div class="sect4">
<h5 id="_bitenc_decode_depth">bitenc_decode_depth</h5>
<div class="paragraph"><p>Set the non-encoded MIME extraction depth used for non-encoded MIME
attachments.</p></div>
</div>
<div class="sect4">
<h5 id="_uu_decode_depth">uu_decode_depth</h5>
<div class="paragraph"><p>Set the Unix-to-Unix (UU) decoding depth used to decode UU-encoded
attachments.</p></div>
</div>
<div class="sect4">
<h5 id="_examples_5">Examples</h5>
<div class="literalblock">
<div class="content">
<pre><code>stream = { }</code></pre>
</div></div>
<div class="literalblock">
<div class="content">
<pre><code>stream_tcp = { }</code></pre>
</div></div>
<div class="literalblock">
<div class="content">
<pre><code>stream_ip = { }</code></pre>
</div></div>
<div class="literalblock">
<div class="content">
<pre><code>binder =
{
    {
        {
            when = { proto = 'tcp', ports = '110', },
            use = { type = 'pop', },
        },
        {
            when = { proto = 'tcp', ports = '143', },
            use =  { type = 'imap', },
        },
    },
}</code></pre>
</div></div>
<div class="literalblock">
<div class="content">
<pre><code>imap =
{
    qp_decode_depth = 500,
}</code></pre>
</div></div>
<div class="literalblock">
<div class="content">
<pre><code>pop =
{
    qp_decode_depth = -1,
    b64_decode_depth = 3000,
}</code></pre>
</div></div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_port_scan">Port Scan</h3>
<div class="paragraph"><p>A module to detect port scanning</p></div>
<div class="sect3">
<h4 id="_overview_12">Overview</h4>
<div class="paragraph"><p>This module is designed to detect the first phase in a network attack:
Reconnaissance. In the Reconnaissance phase, an attacker determines
what types of network protocols or services a host supports. This is
the traditional place where a portscan takes place. This phase assumes
the attacking host has no prior knowledge of what protocols or
services are supported by the target, otherwise this phase would not
be necessary.</p></div>
<div class="paragraph"><p>As the attacker has no beforehand knowledge of its intended target,
most queries sent by the attacker will be negative (meaning that the
services are closed). In the nature of legitimate network
communications, negative responses from hosts are rare, and rarer
still are multiple negative responses within a given amount of time.
Our primary objective in detecting portscans is to detect and track
these negative responses.</p></div>
<div class="paragraph"><p>One of the most common portscanning tools in use today is Nmap. Nmap
encompasses many, if not all, of the current portscanning techniques.
Portscan was designed to be able to detect the different types of
scans Nmap can produce.</p></div>
<div class="paragraph"><p>The following are a list of the types of Nmap scans Portscan
will currently alert for.</p></div>
<div class="ulist"><ul>
<li>
<p>
TCP Portscan
</p>
</li>
<li>
<p>
UDP Portscan
</p>
</li>
<li>
<p>
IP Portscan
</p>
</li>
</ul></div>
<div class="paragraph"><p>These alerts are for one to one portscans, which are the traditional
types of scans; one host scans multiple ports on another host. Most of
the port queries will be negative, since most hosts have relatively
few services available.</p></div>
<div class="ulist"><ul>
<li>
<p>
TCP Decoy Portscan
</p>
</li>
<li>
<p>
UDP Decoy Portscan
</p>
</li>
<li>
<p>
IP Decoy Portscan
</p>
</li>
</ul></div>
<div class="paragraph"><p>Decoy portscans are much like regular, only the attacker has spoofed
source address inter-mixed with the real scanning address. This tactic
helps hide the true identity of the attacker.</p></div>
<div class="ulist"><ul>
<li>
<p>
TCP Distributed Portscan
</p>
</li>
<li>
<p>
UDP Distributed Portscan
</p>
</li>
<li>
<p>
IP Distributed Portscan
</p>
</li>
</ul></div>
<div class="paragraph"><p>These are many to one portscans. Distributed portscans occur when
multiple hosts query one host for open services. This is used to evade
an IDS and obfuscate command and control hosts.</p></div>
<div class="admonitionblock">
<table><tbody><tr>
<td class="icon">
<img src="./Snort 3 User Manual_files/note.png" alt="Note">
</td>
<td class="content">Negative queries will be distributed among scanning hosts, so
we track this type of scan through the scanned host.</td>
</tr></tbody></table>
</div>
<div class="ulist"><ul>
<li>
<p>
TCP Portsweep
</p>
</li>
<li>
<p>
UDP Portsweep
</p>
</li>
<li>
<p>
IP Portsweep
</p>
</li>
<li>
<p>
ICMP Portsweep
</p>
</li>
</ul></div>
<div class="paragraph"><p>These alerts are for one to many portsweeps. One host scans a single
port on multiple hosts. This usually occurs when a new exploit comes out
and the attacker is looking for a specific service.</p></div>
<div class="admonitionblock">
<table><tbody><tr>
<td class="icon">
<img src="./Snort 3 User Manual_files/note.png" alt="Note">
</td>
<td class="content">The characteristics of a portsweep scan may not result in many
negative responses. For example, if an attacker portsweeps a web farm
for port 80, we will most likely not see many negative responses.</td>
</tr></tbody></table>
</div>
<div class="ulist"><ul>
<li>
<p>
TCP Filtered Portscan
</p>
</li>
<li>
<p>
UDP Filtered Portscan
</p>
</li>
<li>
<p>
IP Filtered Portscan
</p>
</li>
<li>
<p>
TCP Filtered Decoy Portscan
</p>
</li>
<li>
<p>
UDP Filtered Decoy Portscan
</p>
</li>
<li>
<p>
IP Filtered Decoy Portscan
</p>
</li>
<li>
<p>
TCP Filtered Portsweep
</p>
</li>
<li>
<p>
UDP Filtered Portsweep
</p>
</li>
<li>
<p>
IP Filtered Portsweep
</p>
</li>
<li>
<p>
ICMP Filtered Portsweep
</p>
</li>
<li>
<p>
TCP Filtered Distributed Portscan
</p>
</li>
<li>
<p>
UDP Filtered Distributed Portscan
</p>
</li>
<li>
<p>
IP Filtered Distributed Portscan
</p>
</li>
</ul></div>
<div class="paragraph"><p>"Filtered" alerts indicate that there were no network errors (ICMP
unreachables or TCP RSTs) or responses on closed ports have been
suppressed. It’s also a good indicator on whether the alert is just a
very active legitimate host. Active hosts, such as NATs, can trigger
these alerts because they can send out many connection attempts within
a very small amount of time. A filtered alert may go off before
responses from the remote hosts are received.</p></div>
<div class="paragraph"><p>Portscan only generates one alert for each host pair in question
during the time window. On TCP scan alerts, Portscan
will also display any open ports that were scanned. On TCP sweep alerts
however, Portscan will only track open ports after the alert has been
triggered. Open port events are not individual alerts, but tags based
off the original scan alert.</p></div>
</div>
<div class="sect3">
<h4 id="_scan_levels">Scan levels</h4>
<div class="paragraph"><p>There are 3 default scan levels that can be set.</p></div>
<div class="literalblock">
<div class="content">
<pre><code>1) default_hi_port_scan
2) default_med_port_scan
3) default_low_port_scan</code></pre>
</div></div>
<div class="paragraph"><p>Each of these default levels have separate options that can be edited
to alter the scan sensitivity levels (scans, rejects, nets or ports)</p></div>
<div class="paragraph"><p>Example:</p></div>
<div class="literalblock">
<div class="content">
<pre><code>port_scan = default_low_port_scan

port_scan.tcp_decoy.ports = 1
port_scan.tcp_decoy.scans = 1
port_scan.tcp_decoy.rejects = 1
port_scan.tcp_ports.nets = 1</code></pre>
</div></div>
<div class="paragraph"><p>The example above would change each of the individual settings to 1.</p></div>
<div class="paragraph"><p>NOTE:The default levels for scans, rejects, nets and ports can be
seen in the snort_defaults.lua file.</p></div>
<div class="paragraph"><p>The counts can be seen in the alert outputs (-Acmg shown below):</p></div>
<div class="literalblock">
<div class="content">
<pre><code>50 72 69 6F 72 69 74 79  20 43 6F 75 6E 74 3A 20  Priority  Count:
30 0A 43 6F 6E 6E 65 63  74 69 6F 6E 20 43 6F 75  0.Connec tion Cou
6E 74 3A 20 34 35 0A 49  50 20 43 6F 75 6E 74 3A  nt: 45.I P Count:
20 31 0A 53 63 61 6E 6E  65 72 20 49 50 20 52 61  1.Scann er IP Ra
6E 67 65 3A 20 31 2E 32  2E 33 2E 34 3A 31 2E 32  nge: 1.2 .3.4:1.2
2E 33 2E 34 0A 50 6F 72  74 2F 50 72 6F 74 6F 20  .3.4.Por t/Proto
43 6F 75 6E 74 3A 20 33  37 0A 50 6F 72 74 2F 50  Count: 3 7.Port/P
72 6F 74 6F 20 52 61 6E  67 65 3A 20 31 3A 39 0A  roto Ran ge: 1:9.</code></pre>
</div></div>
<div class="paragraph"><p>"Low" alerts are only generated on error packets sent from the
target host, and because of the nature of error responses, this
setting should see very few false positives. However, this setting
will never trigger a Filtered Scan alert because of a lack of error
responses. This setting is based on a static time window of 60
seconds, after which this window is reset.</p></div>
<div class="paragraph"><p>"Medium" alerts track Connection Counts, and so will generate
Filtered Scan alerts. This setting may false positive on active
hosts (NATs, proxies, DNS caches, etc), so the user may need to
deploy the use of Ignore directives to properly tune this directive.</p></div>
<div class="paragraph"><p>"High" alerts continuously track hosts on a network using a time
window to evaluate portscan statistics for that host. A "High"
setting will catch some slow scans because of the continuous
monitoring, but is very sensitive to active hosts. This most
definitely will require the user to tune Portscan.</p></div>
</div>
<div class="sect3">
<h4 id="_tuning_portscan">Tuning Portscan</h4>
<div class="paragraph"><p>The most important aspect in detecting portscans is tuning the detection
engine for your network(s).  Here are some tuning tips:</p></div>
<div class="paragraph"><p>Use the watch_ip, ignore_scanners, and ignore_scanned options.
It’s important to correctly set these options.  The watch_ip option
is easy to understand.  The analyst should set this option to the
list of CIDR blocks and IPs that they want to watch.  If no
watch_ip is defined, Portscan will watch all network traffic.
The ignore_scanners and ignore_scanned options come into play in
weeding out legitimate hosts that are very active on your network.
Some of the most common examples are NAT IPs, DNS cache servers,
syslog servers, and nfs servers.  Portscan may not generate false
positives for these types of hosts, but be aware when first tuning
Portscan for these IPs. Depending on the type of alert that the
host generates, the analyst will know which to ignore it as.  If
the host is generating portsweep events, then add it to the
ignore_scanners option.  If the host is generating portscan alerts
(and is the host that is being scanned), add it to the
ignore_scanned option.</p></div>
<div class="paragraph"><p>Filtered scan alerts are much more prone to false positives.
When determining false positives, the alert type is very important.
Most of the false positives that Portscan may generate are of the
filtered scan alert type.  So be much more suspicious of filtered
portscans.  Many times this just indicates that a host was very
active during the time period in question.  If the host continually
generates these types of alerts, add it to the ignore_scanners list
or use a lower sensitivity level.</p></div>
<div class="paragraph"><p>Make use of the Priority Count, Connection Count, IP Count,
Port Count, IP range, and Port range to determine false positives.
The portscan alert details are vital in determining the scope of a
portscan and also the confidence of the portscan.  In the future,
we hope to automate much of this analysis in assigning a scope
level and confidence level, but for now the user must manually do
this.  The easiest way to determine false positives is through
simple ratio estimations. The following is a list of ratios to
estimate and the associated values that indicate a legitimate scan
and not a false positive.</p></div>
<div class="paragraph"><p>Connection Count / IP Count:  This ratio indicates an estimated
average of connections per IP.  For portscans, this ratio should be
high, the higher the better.  For portsweeps, this ratio should be
low.</p></div>
<div class="paragraph"><p>Port Count / IP Count:  This ratio indicates an estimated average
of ports connected to per IP.  For portscans, this ratio should be
high and indicates that the scanned host’s ports were connected to
by fewer IPs. For portsweeps, this ratio should be low, indicating
that the scanning host connected to few ports but on many hosts.</p></div>
<div class="paragraph"><p>Connection Count / Port Count:  This ratio indicates an estimated
average of connections per port.  For portscans, this ratio should
be low. This indicates that each connection was to a different
port.  For portsweeps, this ratio should be high. This indicates
that there were many connections to the same port.</p></div>
<div class="paragraph"><p>The reason that Priority Count is not included, is because the
priority count is included in the connection count and the above
comparisons take that into consideration.  The Priority Count play
an important role in tuning because the higher the priority count
the more likely it is a real portscan or portsweep (unless the host
is firewalled).</p></div>
<div class="paragraph"><p>If all else fails, lower the sensitivity level.
If none of these other tuning techniques work or the analyst
doesn’t have the time for tuning, lower the sensitivity level. You
get the best protection the higher the sensitivity level, but it’s
also important that the portscan detection engine generates alerts
that the analyst will find informative. The low sensitivity level
only generates alerts based on error responses. These responses
indicate a portscan and the alerts generated by the low sensitivity
level are highly accurate and require the least tuning. The low
sensitivity level does not catch filtered scans, since these are
more prone to false positives.</p></div>
</div>
</div>
<div class="sect2">
<h3 id="_sensitive_data_filtering">Sensitive Data Filtering</h3>
<div class="paragraph"><p>The <code>sd_pattern</code> IPS option provides detection and filtering of Personally
Identifiable Information (PII). This information includes credit card
numbers, U.S. Social Security numbers, phone numbers, and email addresses.
A rich regular expression syntax is available for defining your own PII.</p></div>
<div class="sect3">
<h4 id="_hyperscan">Hyperscan</h4>
<div class="paragraph"><p>The <code>sd_pattern</code> rule option is powered by the open source Hyperscan
library from Intel. It provides a regex grammar which is mostly PCRE
compatible. To learn more about Hyperscan see
<a href="https://intel.github.io/hyperscan/dev-reference/">https://intel.github.io/hyperscan/dev-reference/</a></p></div>
</div>
<div class="sect3">
<h4 id="_syntax">Syntax</h4>
<div class="paragraph"><p>Snort provides <code>sd_pattern</code> as IPS rule option with no additional inspector
overhead. The Rule option takes the following syntax.</p></div>
<div class="literalblock">
<div class="content">
<pre><code>sd_pattern: "&lt;pattern&gt;"[, threshold &lt;count&gt;];</code></pre>
</div></div>
<div class="sect4">
<h5 id="_pattern">Pattern</h5>
<div class="paragraph"><p>Pattern is the most important and is the only required parameter to
<code>sd_pattern</code>. It supports 5 built-in patterns which are configured by name:
"credit_card", "us_social", "us_social_nodashes", "email", and "us_phone" as
well as user defined regular expressions of the Hyperscan dialect (see
<a href="https://intel.github.io/hyperscan/dev-reference/compilation.html#pattern-support">https://intel.github.io/hyperscan/dev-reference/compilation.html#pattern-support</a>).</p></div>
<div class="literalblock">
<div class="content">
<pre><code>sd_pattern:"credit_card";</code></pre>
</div></div>
<div class="paragraph"><p>When configured, Snort will replace the pattern <em>credit_card</em> with the built-in
pattern. In addition to pattern matching, Snort will validate that the matched
digits will pass the Luhn-check algorithm.</p></div>
<div class="literalblock">
<div class="content">
<pre><code>sd_pattern:"us_social";
sd_pattern:"us_social_nodashes";</code></pre>
</div></div>
<div class="paragraph"><p>These special patterns will also be replaced with a built-in pattern.
Naturally, "us_social" is a pattern of 9 digits separated by <code>-</code>'s in the
canonical form. For this pattern, some validation of compliance with the
Social Security Numbers randomization rules is also performed.</p></div>
<div class="literalblock">
<div class="content">
<pre><code>sd_pattern:"email";</code></pre>
</div></div>
<div class="paragraph"><p>This pattern will be replaced with a built-in pattern created to match email.
The regex implements the “preferred” syntax from RFC 1035 which is one of the
recommendations in RFC 5322.</p></div>
<div class="literalblock">
<div class="content">
<pre><code>sd_pattern:"us_phone";</code></pre>
</div></div>
<div class="paragraph"><p>This pattern will match U.S. phone numbers in different formats with or without
country code.</p></div>
<div class="literalblock">
<div class="content">
<pre><code>sd_pattern:"\b\w+@ourdomain\.com\b"</code></pre>
</div></div>
<div class="paragraph"><p>This is a user defined pattern which matches what is most likely email
addresses for the site "ourdomain.com". The pattern is a PCRE compatible
regex, <em>\b</em> matches a word boundary (whitespace, end of line, non-word
characters)  and <em>\w+</em> matches one or more word characters. <em>\.</em> matches
a literal <em>.</em>.</p></div>
<div class="paragraph"><p>The above pattern would match "a@ourdomain.com", "aa@ourdomain.com" but would
not match <code>1@ourdomain.com</code> <code>ab12@ourdomain.com</code> or <code>@ourdomain.com</code>.</p></div>
<div class="paragraph"><p>Note: This is just an example, this pattern is not suitable to detect many
correctly formatted emails.</p></div>
</div>
<div class="sect4">
<h5 id="_threshold">Threshold</h5>
<div class="paragraph"><p>Threshold is an optional parameter allowing you to change built-in default
value (default value is <em>1</em>). The following two instances are identical.
The first will assume the default value of <em>1</em> the second declaration
explicitly sets the threshold to <em>1</em>.</p></div>
<div class="literalblock">
<div class="content">
<pre><code>sd_pattern:"This rule requires 1 match";
sd_pattern:"This rule requires 1 match", threshold 1;</code></pre>
</div></div>
<div class="paragraph"><p>That’s pretty easy, but here is one more example anyway.</p></div>
<div class="literalblock">
<div class="content">
<pre><code>sd_pattern:"This is a string literal", threshold 300;</code></pre>
</div></div>
<div class="paragraph"><p>This example requires 300 matches of the pattern "This is a string literal"
to qualify as a positive match. That is, if the string only occurred 299 times
in a packet, you will not see an event.</p></div>
</div>
<div class="sect4">
<h5 id="_obfuscating_built_in_patterns">Obfuscating built-in patterns</h5>
<div class="paragraph"><p>Snort provides discreet logging for the built-in patterns "credit_card",
"us_social", "us_social_nodashes", "us_phone", and "email". Enabling
<code>ips.obfuscate_pii</code> makes Snort obfuscate the suspect packet payload which
was matched by the patterns. This configuration is enabled by default.</p></div>
<div class="literalblock">
<div class="content">
<pre><code>ips =
{
    obfuscate_pii = true
}</code></pre>
</div></div>
</div>
</div>
<div class="sect3">
<h4 id="_examples_6">Examples</h4>
<div class="paragraph"><p>Complete Snort IPS rules with built-in sensitive data patterns.</p></div>
<div class="literalblock">
<div class="content">
<pre><code>alert tcp ( sid:1; msg:"Credit Card"; sd_pattern:"credit_card"; )
alert tcp ( sid:2; msg:"US Social Number"; sd_pattern:"us_social"; )
alert tcp ( sid:3; msg:"US Social Number No Dashes"; sd_pattern:"us_social_nodashes"; )
alert tcp ( sid:4; msg:"US Phone Number"; sd_pattern:"us_phone"; )
alert tcp ( sid:5; msg:"Email"; sd_pattern:"email"; )</code></pre>
</div></div>
<div class="paragraph"><p>Let’s try them on the next traffic.</p></div>
<div class="literalblock">
<div class="content">
<pre><code>33 34 38 30 31 32 37 34 33 35  37 34 35 38 30 20 20 20 20 20  348012743574580
34 30 34 2D 35 30 2D 32 31 38  33 20 20 20 20 20 20 20 20 20  404-50-2183
34 30 34 35 30 32 31 38 33 20  20 20 20 20 20 20 20 20 20 20  404502183
31 2D 39 31 39 2D 36 36 33 2D  32 35 32 34 20 20 20 20 20 20  1-919-663-2524
74 75 72 2E 63 61 6C 6C 69 65  40 67 6D 61 69 6C 2E 63 6F 6D  tur.callie@gmail.com</code></pre>
</div></div>
<div class="paragraph"><p>Printout of alert_cmg logger for this would be obfuscated.</p></div>
<div class="literalblock">
<div class="content">
<pre><code>snort.raw[100]:
- - - - - - - - - - - - - - -  - - - - - - - - - - - - - - -  - - - - -  - - - - -
58 58 58 58 58 58 58 58 58 58  58 34 35 38 30 20 20 20 20 20  XXXXXXXXXXX4580
58 58 58 58 58 58 58 32 31 38  33 20 20 20 20 20 20 20 20 20  XXXXXXX2183
58 58 58 58 58 32 31 38 33 20  20 20 20 20 20 20 20 20 20 20  XXXXX2183
58 58 58 58 58 58 58 58 58 58  32 35 32 34 20 20 20 20 20 20  XXXXXXXXXX2524
58 58 58 58 58 58 58 58 58 58  58 58 58 58 58 58 2E 63 6F 6D  XXXXXXXXXXXXXXXX.com
- - - - - - - - - - - - - - -  - - - - - - - - - - - - - - -  - - - - -  - - - - -</code></pre>
</div></div>
<div class="paragraph"><p>But obfuscation doesn’t work for custom patterns.</p></div>
<div class="paragraph"><p>Example of a rule with a custom pattern.</p></div>
<div class="literalblock">
<div class="content">
<pre><code>alert tcp (sid: 6; sd_pattern:"\b\w+@ourdomain\.com\b"; msg: "Custom email")</code></pre>
</div></div>
<div class="paragraph"><p>Traffic.</p></div>
<div class="literalblock">
<div class="content">
<pre><code>61 40 6F 75 72 64 6F 6D 61 69  6E 2E 63 6F 6D 20 20 20 20 20  a@ourdomain.com
61 61 40 6F 75 72 64 6F 6D 61  69 6E 2E 63 6F 6D              aa@ourdomain.com</code></pre>
</div></div>
<div class="paragraph"><p>Printout of alert_cmg logger for this would not be obfuscated.</p></div>
<div class="literalblock">
<div class="content">
<pre><code>01/01-02:00:00.000004 [**] [1:6:0] "Custom email" [**] [Priority: 0] {TCP} 10.1.2.3:48620 -&gt; 10.9.8.7:80
02:01:02:03:04:05 -&gt; 02:09:08:07:06:05 type:0x800 len:0x5A
10.1.2.3:48620 -&gt; 10.9.8.7:80 TCP TTL:64 TOS:0x0 ID:3 IpLen:20 DgmLen:76
******** Seq: 0x2  Ack: 0x0  Win: 0x2000  TcpLen: 20</code></pre>
</div></div>
<div class="literalblock">
<div class="content">
<pre><code>snort.raw[36]:
- - - - - - - - - - - - - - -  - - - - - - - - - - - - - - -  - - - - -  - - - - -
61 40 6F 75 72 64 6F 6D 61 69  6E 2E 63 6F 6D 20 20 20 20 20  a@ourdomain.com
61 61 40 6F 75 72 64 6F 6D 61  69 6E 2E 63 6F 6D              aa@ourdomain.com
- - - - - - - - - - - - - - -  - - - - - - - - - - - - - - -  - - - - -  - - - - -</code></pre>
</div></div>
<div class="paragraph"><p>Threshold values are applied per packet.</p></div>
<div class="paragraph"><p>So, traffic like this.</p></div>
<div class="literalblock">
<div class="content">
<pre><code>Packet 1 payload:"a@ourdomain.com"
Packet 2 payload:"aa@ourdomain.com"</code></pre>
</div></div>
<div class="paragraph"><p>Doesn’t match a rule like this.</p></div>
<div class="literalblock">
<div class="content">
<pre><code>alert tcp (sid: 7; sd_pattern:"\b\w+@ourdomain\.com\b", threshold 2; msg: "Custom email")</code></pre>
</div></div>
</div>
<div class="sect3">
<h4 id="_caveats">Caveats</h4>
<div class="olist arabic"><ol class="arabic">
<li>
<p>
sd_pattern implementation relies on Hyperscan, regardless of the search engine specified
in the config. So, Snort must be built and run with Hyperscan to have sd_pattern
IPS option available.
</p>
</li>
<li>
<p>
Log obfuscation is only applicable to the buffer that the pattern was found in.
</p>
</li>
<li>
<p>
Log obfuscation is only applicable to CMG and Unified2 logging formats.
Unified2 logger only supports obfuscation of http extra data.
</p>
</li>
<li>
<p>
Log obfuscation doesn’t support user defined PII patterns. It is
currently only supported for the built-in patterns for Credit Cards and U.S.
Social Security numbers, emails and U.S. phone numbers.
</p>
</li>
</ol></div>
</div>
</div>
<div class="sect2">
<h3 id="_smtp">SMTP</h3>
<div class="paragraph"><p>SMTP inspector is a service inspector for SMTP protocol.</p></div>
<div class="sect3">
<h4 id="_overview_13">Overview</h4>
<div class="paragraph"><p>The SMTP inspector examines SMTP connections looking for commands and
responses. It also identifies the command, header and body sections, TLS
data and extracts the MIME attachments. This inspector also identifies and
whitelists the SMTP traffic.</p></div>
<div class="paragraph"><p>SMTP inspector logs the filename, email addresses, attachment names when
configured.</p></div>
</div>
<div class="sect3">
<h4 id="_configuration_10">Configuration</h4>
<div class="paragraph"><p>SMTP command lines can be normalized to remove extraneous spaces.
TLS-encrypted traffic can be ignored, which improves performance.  In
addition, plain-text mail data can be ignored for an additional
performance boost.</p></div>
<div class="paragraph"><p>The configuration options are described below:</p></div>
<div class="sect4">
<h5 id="_normalize_and_normalize_cmds">normalize and normalize_cmds</h5>
<div class="paragraph"><p>Normalization checks for more than one space character after a command.
Space characters are defined as space (ASCII 0x20) or tab (ASCII 0x09).
"normalize" provides options all|none|cmds, <em>all</em> checks all commands,
<em>none</em> turns off normalization for all commands. <em>cmds</em> just checks
commands listed with the "normalize_cmds" parameter.
For example:</p></div>
<div class="literalblock">
<div class="content">
<pre><code>smtp = { normalize = 'cmds', normalize_cmds = 'RCPT VRFY EXPN' }</code></pre>
</div></div>
</div>
<div class="sect4">
<h5 id="_ignore_data">ignore_data</h5>
<div class="paragraph"><p>Set it to true to ignore data section of mail (except for mail headers)
when processing rules.</p></div>
</div>
<div class="sect4">
<h5 id="_ignore_tls_data">ignore_tls_data</h5>
<div class="paragraph"><p>Set it to true to ignore TLS-encrypted data when processing rules.</p></div>
</div>
<div class="sect4">
<h5 id="_max_command_line_len">max_command_line_len</h5>
<div class="paragraph"><p>Alert if an SMTP command line is longer than this value.  Absence of this
option or a "0" means never alert on command line length. RFC 2821
recommends 512 as a maximum command line length.</p></div>
</div>
<div class="sect4">
<h5 id="_max_header_line_len">max_header_line_len</h5>
<div class="paragraph"><p>Alert if an SMTP DATA header line is longer than this value.  Absence of
this option or a "0" means never alert on data header line length. RFC
2821 recommends 1024 as a maximum data header line length.</p></div>
</div>
<div class="sect4">
<h5 id="_max_response_line_len">max_response_line_len</h5>
<div class="paragraph"><p>Alert if an SMTP response line is longer than this value.  Absence of this
option or a "0" means never alert on response line length. RFC 2821
recommends 512 as a maximum response line length.</p></div>
</div>
<div class="sect4">
<h5 id="_alt_max_command_line_len">alt_max_command_line_len</h5>
<div class="paragraph"><p>Overrides max_command_line_len for specific commands
For example:</p></div>
<div class="literalblock">
<div class="content">
<pre><code>alt_max_command_line_len =
{
    {
        command = 'MAIL',
        length = 260,
    },
    {
        command = 'RCPT',
        length = 300,
    },
}</code></pre>
</div></div>
</div>
<div class="sect4">
<h5 id="_invalid_cmds">invalid_cmds</h5>
<div class="paragraph"><p>Alert if this command is sent from client side.</p></div>
</div>
<div class="sect4">
<h5 id="_valid_cmds">valid_cmds</h5>
<div class="paragraph"><p>List of valid commands.  We do not alert on commands in this list.</p></div>
<div class="paragraph"><p>DEFAULT empty list, but SMTP inspector has this list hard-coded:
[[ ATRN AUTH BDAT DATA DEBUG EHLO EMAL ESAM ESND ESOM ETRN EVFY EXPN
 HELO HELP IDENT MAIL NOOP ONEX QUEU QUIT RCPT RSET SAML SEND SIZE
 STARTTLS SOML TICK TIME TURN TURNME VERB VRFY X-EXPS X-LINK2STATE
 XADR XAUTH XCIR XEXCH50 XGEN XLICENSE XQUE XSTA XTRN XUSR ]]</p></div>
</div>
<div class="sect4">
<h5 id="_data_cmds">data_cmds</h5>
<div class="paragraph"><p>List of commands that initiate sending of data with an end of data
delimiter the same as that of the DATA command per RFC 5321 -
"&lt;CRLF&gt;.&lt;CRLF&gt;".</p></div>
</div>
<div class="sect4">
<h5 id="_binary_data_cmds">binary_data_cmds</h5>
<div class="paragraph"><p>List of commands that initiate sending of data and use a length value
after the command to indicate the amount of data to be sent, similar to
that of the BDAT command per RFC 3030.</p></div>
</div>
<div class="sect4">
<h5 id="_auth_cmds">auth_cmds</h5>
<div class="paragraph"><p>List of commands that initiate an authentication exchange between client
and server.</p></div>
</div>
<div class="sect4">
<h5 id="_xlink2state">xlink2state</h5>
<div class="paragraph"><p>Enable/disable xlink2state alert, options are {disable | alert | drop}.
See CVE-2005-0560 for a description of the vulnerability.</p></div>
</div>
<div class="sect4">
<h5 id="_mime_processing_depth_parameters">MIME processing depth parameters</h5>
<div class="paragraph"><p>These four MIME processing depth parameters are identical to their POP and
IMAP counterparts. See that section for further details.</p></div>
<div class="paragraph"><p>b64_decode_depth
qp_decode_depth
bitenc_decode_depth
uu_decode_depth</p></div>
</div>
<div class="sect4">
<h5 id="_log_options">Log Options</h5>
<div class="paragraph"><p>Following log options allow SMTP inspector to log email addresses and
filenames.
Please note, this is logged only with the unified2 output and is not
logged with the console output (-A cmg). u2spewfoo can be used to read
this data from the unified2.</p></div>
<div class="paragraph"><p><em>log_mailfrom</em></p></div>
<div class="paragraph"><p>This option enables SMTP inspector to parse and log the sender’s email
address extracted from the "MAIL FROM" command along with all the
generated events for that session. The maximum number of bytes logged for
this option is 1024.</p></div>
<div class="paragraph"><p><em>log_rcptto</em></p></div>
<div class="paragraph"><p>This option enables SMTP inspector to parse and log the recipient email
addresses extracted from the "RCPT TO" command along with all the
generated events for that session. Multiple recipients are appended with
commas. The maximum number of bytes logged for this option is 1024.</p></div>
<div class="paragraph"><p><em>log_filename</em></p></div>
<div class="paragraph"><p>This option enables SMTP inspector to parse and log the MIME attachment
filenames extracted from the Content-Disposition header within the MIME
body along with all the generated events for that session. Multiple
filenames are appended with commas. The maximum number of bytes logged for
this option is 1024.</p></div>
<div class="paragraph"><p><em>log_email_hdrs</em></p></div>
<div class="paragraph"><p>This option enables SMTP inspector to parse and log the SMTP email headers
extracted from SMTP data along with all generated events for that session.
The number of bytes extracted and logged depends upon the
email_hdrs_log_depth.</p></div>
<div class="paragraph"><p><em>email_hdrs_log_depth</em></p></div>
<div class="paragraph"><p>This option specifies the depth for logging email headers. The allowed
range for this option is 0 - 20480. A value of 0 will disable email
headers logging. The default value for this option is 1464.</p></div>
</div>
</div>
<div class="sect3">
<h4 id="_example">Example</h4>
<div class="literalblock">
<div class="content">
<pre><code>smtp =
{
    normalize = 'cmds',
    normalize_cmds = 'EXPN VRFY RCPT',
    b64_decode_depth = 0,
    qp_decode_depth = 0,
    bitenc_decode_depth = 0,
    uu_decode_depth = 0,
    log_mailfrom = true,
    log_rcptto = true,
    log_filename = true,
    log_email_hdrs = true,
    max_command_line_len = 512,
    max_header_line_len = 1000,
    max_response_line_len = 512,
    max_auth_command_line_len = 50,
    xlink2state = 'alert',
    alt_max_command_line_len =
    {
        {
            command = 'MAIL',
            length = 260,
        },
        {
            command = 'RCPT',
            length = 300,
        },
        {
            command = 'HELP',
            length = 500,
        },
        {
            command = 'HELO',
            length = 500,
        },
        {
            command = 'ETRN',
            length = 500,
        },
        {
            command = 'EXPN',
            length = 255,
        },
        {
            command = 'VRFY',
            length = 255,
        },
    },
}</code></pre>
</div></div>
</div>
</div>
<div class="sect2">
<h3 id="_telnet">Telnet</h3>
<div class="paragraph"><p>Given a telnet data buffer, Telnet will normalize the buffer with
respect to telnet commands and option negotiation, eliminating telnet
command sequences per RFC 854.  It will also determine when a
telnet connection is encrypted, per the use of the telnet encryption
option per RFC 2946.</p></div>
<div class="sect3">
<h4 id="_configuring_the_inspector_to_block_exploits_and_attacks_2">Configuring the inspector to block exploits and attacks</h4>
<div class="paragraph"><p>ayt_attack_thresh number</p></div>
<div class="paragraph"><p>Detect and alert on consecutive are you there [AYT] commands beyond the
threshold number specified.  This addresses a few specific vulnerabilities
relating to bsd-based implementations of telnet.</p></div>
</div>
</div>
<div class="sect2">
<h3 id="_trace">Trace</h3>
<div class="paragraph"><p>Snort 3 retired the different flavors of debug macros that used to be set
through the SNORT_DEBUG environment variable. It was replaced by per-module
trace functionality. Trace is turned on by setting the specific trace module
configuration in snort.lua. As before, to enable debug tracing, Snort must be
configured at build time with --enable-debug-msgs. However, a growing number
of modules (such as wizard and snort.inspector_manager) are providing non-debug
trace messages in normal production builds.</p></div>
<div class="sect3">
<h4 id="_trace_module">Trace module</h4>
<div class="paragraph"><p>The trace module is responsible for configuring traces and supports the
following parameters:</p></div>
<div class="literalblock">
<div class="content">
<pre><code>output - configure the output method for trace messages
modules - trace configuration for specific modules
constraints - filter traces by the packet constraints
ntuple - on/off packet n-tuple info logging
timestamp - on/off message timestamps logging</code></pre>
</div></div>
<div class="paragraph"><p>The following lines, added in snort.lua, will enable trace messages for
detection and codec modules. The messages will be printed to syslog if
the packet filtering constraints match. Messages will be in extended format,
including timestamp and n-tuple packet info at the beginning of each trace message.</p></div>
<div class="literalblock">
<div class="content">
<pre><code>trace =
{
    output = "syslog",
    modules =
    {
        detection = { detect_engine = 1 },
        decode = { all = 1 }
    },
    constraints =
    {
        ip_proto = 17,
        dst_ip = "10.1.1.2",
        src_port = 100,
        dst_port = 200
    },
    ntuple = true,
    timestamp = true
}</code></pre>
</div></div>
<div class="paragraph"><p>The trace module supports config reloading. Also, it’s possible to set or clear
modules traces and packet filter constraints via the control channel command.</p></div>
</div>
<div class="sect3">
<h4 id="_trace_module_configuring_traces">Trace module - configuring traces</h4>
<div class="paragraph"><p>The trace module has the <strong>modules</strong> option - a table with trace configuration
for specific modules. The following lines placed in snort.lua will enable trace
messages for detection, codec and wizard modules:</p></div>
<div class="literalblock">
<div class="content">
<pre><code>trace =
{
    modules =
    {
        detection = { all = 1 },
        decode = { all = 1 },
        wizard = { all = 1 }
    }
}</code></pre>
</div></div>
<div class="paragraph"><p>The detection and snort modules are currently the only modules to support
multiple trace options. Others have only the default <strong>all</strong> option, which will
enable or disable all traces in a given module. It’s available for multi-option
modules also and works as a global switcher:</p></div>
<div class="literalblock">
<div class="content">
<pre><code>trace =
{
    modules =
    {
        detection = { all = 1 }  -- set each detection option to level 1
    }
}</code></pre>
</div></div>
<div class="literalblock">
<div class="content">
<pre><code>trace =
{
    modules =
    {
        detection = { all = 1, tag = 2 }  -- set each detection option to level 1 but the 'tag' to level 2
    }
}</code></pre>
</div></div>
<div class="paragraph"><p>Also, it’s possible to enable or disable traces for all modules with a
top-level <strong>all</strong> option.</p></div>
<div class="paragraph"><p>The following configuration states that:</p></div>
<div class="ulist"><ul>
<li>
<p>
all traces are enabled with verbosity level 5
</p>
</li>
<li>
<p>
traces for the decode module are enabled with level 3
</p>
</li>
<li>
<p>
rule_eval traces for the detection module are enabled with level 1
</p>
<div class="literalblock">
<div class="content">
<pre><code>trace =
{
    modules =
    {
        all = 5,
        decode = { all = 3 },
        detection = { rule_eval = 1 }
    }
}</code></pre>
</div></div>
</li>
</ul></div>
<div class="paragraph"><p>The full list of available trace parameters is placed into
the "Basic Modules.trace" chapter.</p></div>
<div class="paragraph"><p>Each option must be assigned an integer value between 0 and 255 to specify
a level of verbosity for that option:</p></div>
<div class="literalblock">
<div class="content">
<pre><code>0 - turn off trace messages printing for the option
1 - print most significant trace messages for the option
255 - print all available trace messages for the option</code></pre>
</div></div>
<div class="paragraph"><p>Tracing is disabled by default (verbosity level equals 0). The verbosity level
is treated as a threshold, so specifying a higher value will result in all
messages with a lower level being printed as well. For example:</p></div>
<div class="literalblock">
<div class="content">
<pre><code>trace =
{
    modules =
    {
        decode = { all = 3 }  -- messages with levels 1, 2, and 3 will be printed
    }
}</code></pre>
</div></div>
</div>
<div class="sect3">
<h4 id="_trace_module_configuring_packet_filter_constraints_for_packet_related_trace_messages">Trace module - configuring packet filter constraints for packet related trace messages</h4>
<div class="paragraph"><p>There is a capability to filter traces by the packet constraints. The trace
module has the <strong>constraints</strong> option - a table with filtering configuration that
will be applied to all trace messages that include a packet. Filtering is done
on a flow that packet is related. By default filtering is disabled.</p></div>
<div class="paragraph"><p>Available constraints options:</p></div>
<div class="literalblock">
<div class="content">
<pre><code>ip_proto - numerical IP protocol ID
src_ip - match all packets with a flow that has this client IP address (passed as a string)
src_port - match all packets with a flow that has this source port
dst_ip - match all packets with a flow that has this server IP address (passed as a string)
dst_port - match all packets with a flow that has this destination port
match - boolean flag to enable/disable whether constraints will ever match (enabled by default)</code></pre>
</div></div>
<div class="paragraph"><p>The following lines placed in snort.lua will enable all trace messages for
detection filtered by ip_proto, dst_ip, src_port and dst_port:</p></div>
<div class="literalblock">
<div class="content">
<pre><code>trace =
{
    modules =
    {
        detection = { all = 1 }
    },
    constraints =
    {
        ip_proto = 6, -- tcp
        dst_ip = "10.1.1.10",
        src_port = 150,
        dst_port = 250
    }
}</code></pre>
</div></div>
<div class="paragraph"><p>To create constraints that will never successfully match, set the <strong>match</strong>
parameter to <em>false</em>. This is useful for situations where one is relying on
external packet filtering from the DAQ module, or for preventing all trace
messages in the context of a packet. The following is an example of such
configuration:</p></div>
<div class="literalblock">
<div class="content">
<pre><code>trace =
{
    modules =
    {
        snort = { all = 1 }
    },
    constraints =
    {
        match = false
    }
}</code></pre>
</div></div>
</div>
<div class="sect3">
<h4 id="_trace_module_configuring_trace_output_method">Trace module - configuring trace output method</h4>
<div class="paragraph"><p>There is a capability to configure the output method for trace messages.
The trace module has the <strong>output</strong> option with two acceptable values:</p></div>
<div class="literalblock">
<div class="content">
<pre><code>"stdout" - printing to stdout
"syslog" - printing to syslog</code></pre>
</div></div>
<div class="paragraph"><p>By default, the output method will be set based on the Snort run mode. Normally
it will use stdout, but if -D (daemon mode) and/or -M (alert-syslog mode)
are set, it will instead use syslog.</p></div>
<div class="paragraph"><p>Example - set output method as syslog:</p></div>
<div class="paragraph"><p>In snort.lua, the following lines were added:</p></div>
<div class="literalblock">
<div class="content">
<pre><code>trace =
{
    output = "syslog",
    modules =
    {
        detection = { all = 1 }
    }
}</code></pre>
</div></div>
<div class="paragraph"><p>As a result, each trace message will be printed into syslog
(the Snort run-mode will be ignored).</p></div>
</div>
<div class="sect3">
<h4 id="_configuring_traces_via_control_channel_command">Configuring traces via control channel command</h4>
<div class="paragraph"><p>There is a capability to configure module trace options and packet constraints
via the control channel command by using a Snort shell. In order to enable
shell, Snort has to be configured and built with --enable-shell.</p></div>
<div class="paragraph"><p>The trace control channel command is a way how to configure module trace
options and/or packet filter constraints directly during Snort run and
without reloading the entire config.</p></div>
<div class="paragraph"><p>Control channel also allow adjusting trace output format by setting ntuple
and timestamp switchers.</p></div>
<div class="paragraph"><p>After entering the Snort shell, there are two commands available for
the trace module:</p></div>
<div class="literalblock">
<div class="content">
<pre><code>trace.set({ modules = {...}, constraints = {...} }) - set modules traces and constraints (should pass a valid Lua-entry)</code></pre>
</div></div>
<div class="literalblock">
<div class="content">
<pre><code>trace.set({ modules = { all = N } }) - enable traces for all modules with verbosity level N</code></pre>
</div></div>
<div class="literalblock">
<div class="content">
<pre><code>trace.set({ ntuple = true/false }) - on/off packet n-tuple info logging</code></pre>
</div></div>
<div class="literalblock">
<div class="content">
<pre><code>trace.set({ timestamp = true/false }) - on/off timestamp logging</code></pre>
</div></div>
<div class="literalblock">
<div class="content">
<pre><code>trace.clear() - clear modules traces and constraints</code></pre>
</div></div>
<div class="paragraph"><p>Also, it’s possible to omit tables in the trace.set() command:</p></div>
<div class="literalblock">
<div class="content">
<pre><code>trace.set({constraints = {...}}) - set only filtering configuration keeping old modules traces</code></pre>
</div></div>
<div class="literalblock">
<div class="content">
<pre><code>trace.set({modules = {...}}) - set only module trace options keeping old filtering constraints</code></pre>
</div></div>
<div class="literalblock">
<div class="content">
<pre><code>trace.set({}) - disable traces and constraints (set to empty)</code></pre>
</div></div>
</div>
<div class="sect3">
<h4 id="_trace_messages_format">Trace messages format</h4>
<div class="paragraph"><p>Each tracing message has a standard format:</p></div>
<div class="literalblock">
<div class="content">
<pre><code>&lt;module_name&gt;:&lt;option_name&gt;:&lt;message_log_level&gt;: &lt;particular_message&gt;</code></pre>
</div></div>
<div class="paragraph"><p>The stdout logger also prints thread type and thread instance ID at the beginning
of each trace message in a colon-separated manner.</p></div>
<div class="paragraph"><p>The capital letter at the beginning of the trace message indicates the thread type.</p></div>
<div class="paragraph"><p>Possible thread types:
C – main (control) thread
P – packet thread
O – other thread</p></div>
<div class="paragraph"><p>Setting the option - <strong>ntuple</strong> allows you to change the trace message format,
expanding it with information about the processed packet.</p></div>
<div class="paragraph"><p>It will be added at the beginning, right after the thread type and instance ID,
in the following format:</p></div>
<div class="literalblock">
<div class="content">
<pre><code>src_ip src_port -&gt; dst_ip dst_port ip_proto AS=address_space</code></pre>
</div></div>
<div class="paragraph"><p>Where:</p></div>
<div class="literalblock">
<div class="content">
<pre><code>src_ip - source IP address
src_port - source port
dst_ip - destination IP address
dst_port - destination port
ip_proto - IP protocol ID
address_space - unique ID of the address space</code></pre>
</div></div>
<div class="paragraph"><p>Those info can be displayed only for IP packets.
Port defaults to zero if a packet doesn’t have it.</p></div>
<div class="paragraph"><p>The <strong>timestamp</strong> option extends output format
by logging the message time in the next format:</p></div>
<div class="literalblock">
<div class="content">
<pre><code>MM/DD-hh:mm:ss.SSSSSS</code></pre>
</div></div>
<div class="paragraph"><p>Where:</p></div>
<div class="literalblock">
<div class="content">
<pre><code>M – month
D – day
h – hours
m – minutes
s – seconds
S – milliseconds</code></pre>
</div></div>
</div>
<div class="sect3">
<h4 id="_example_debugging_rules_using_detection_trace">Example - Debugging rules using detection trace</h4>
<div class="paragraph"><p>The detection engine is responsible for rule evaluation. Turning on the
trace for it can help with debugging new rules.</p></div>
<div class="paragraph"><p>The relevant options for detection are as follow:</p></div>
<div class="literalblock">
<div class="content">
<pre><code>rule_eval - follow rule evaluation
buffer - print evaluated buffer if it changed (level 1) or at every step (level 5)
rule_vars - print value of ips rule options vars
fp_search - print information on fast pattern search</code></pre>
</div></div>
<div class="paragraph"><p>Buffer print is useful, but in case the buffer is very big can be too verbose.
Choose between verbosity levels 1, 5, or no buffer trace accordingly.</p></div>
<div class="paragraph"><p>rule_vars is useful when the rule is using ips rule options vars.</p></div>
<div class="paragraph"><p>In snort.lua, the following lines were added:</p></div>
<div class="literalblock">
<div class="content">
<pre><code>trace =
{
    modules =
    {
        detection =
        {
            rule_eval = 1,
            buffer = 1,
            rule_vars = 1,
            fp_search = 1
        }
    }
}</code></pre>
</div></div>
<div class="paragraph"><p>The pcap has a single packet with payload:</p></div>
<div class="literalblock">
<div class="content">
<pre><code>10.AAAAAAAfoobar</code></pre>
</div></div>
<div class="paragraph"><p>Evaluated on rules:</p></div>
<div class="literalblock">
<div class="content">
<pre><code># byte_math + oper with byte extract and content
# VAL = 1, byte_math = 0 + 10
alert tcp ( byte_extract: 1, 0, VAL, string, dec;
byte_math:bytes 1,offset VAL,oper +, rvalue 10, result var1, string dec;
content:"foo", offset var1; sid:3)</code></pre>
</div></div>
<div class="literalblock">
<div class="content">
<pre><code>#This rule should not trigger
alert tcp (content:"AAAAA"; byte_jump:2,0,relative;
content:"foo", within 3; sid:2)</code></pre>
</div></div>
<div class="paragraph"><p>The output:</p></div>
<div class="literalblock">
<div class="content">
<pre><code>detection:rule_eval:1: packet 1 C2S 127.0.0.1:1234 127.0.0.1:5678 (fast-patterns)
detection:rule_eval:1: Fast pattern search
detection:fp_search:1: 1 fp packet[16]</code></pre>
</div></div>
<div class="literalblock">
<div class="content">
<pre><code>snort.raw[16]:
- - - - - - - - - - - - - - -  - - - - - - - - - - - - - - -  - - - - -  - - - - -
31 30 00 41 41 41 41 41 41 41  66 6F 6F 62 61 72              10.AAAAAAAfoobar
- - - - - - - - - - - - - - -  - - - - - - - - - - - - - - -  - - - - -  - - - - -
detection:rule_eval:1: Processing pattern match #1
detection:rule_eval:1: Fast pattern packet[5] = 'AAAAA' |41 41 41 41 41 | ( )
detection:rule_eval:1: Starting tree eval
detection:rule_eval:1: Evaluating option content, cursor name pkt_data, cursor position 0</code></pre>
</div></div>
<div class="literalblock">
<div class="content">
<pre><code>snort.raw[16]:
- - - - - - - - - - - - - - -  - - - - - - - - - - - - - - -  - - - - -  - - - - -
31 30 00 41 41 41 41 41 41 41  66 6F 6F 62 61 72              10.AAAAAAAfoobar
- - - - - - - - - - - - - - -  - - - - - - - - - - - - - - -  - - - - -  - - - - -
detection:rule_vars:1: Rule options variables: var[0]=0 var[1]=0 var[2]=0
detection:rule_eval:1: Evaluating option byte_jump, cursor name pkt_data, cursor position 8</code></pre>
</div></div>
<div class="literalblock">
<div class="content">
<pre><code>snort.raw[8]:
- - - - - - - - - - - - - - -  - - - - - - - - - - - - - - -  - - - - -  - - - - -
41 41 66 6F 6F 62 61 72                                       AAfoobar
- - - - - - - - - - - - - - -  - - - - - - - - - - - - - - -  - - - - -  - - - - -
detection:rule_eval:1: no match
detection:rule_vars:1: Rule options variables: var[0]=0 var[1]=0 var[2]=0
detection:rule_eval:1: Evaluating option byte_jump, cursor name pkt_data, cursor position 9</code></pre>
</div></div>
<div class="literalblock">
<div class="content">
<pre><code>snort.raw[7]:
- - - - - - - - - - - - - - -  - - - - - - - - - - - - - - -  - - - - -  - - - - -
41 66 6F 6F 62 61 72                                          Afoobar
- - - - - - - - - - - - - - -  - - - - - - - - - - - - - - -  - - - - -  - - - - -
detection:rule_eval:1: no match
detection:rule_vars:1: Rule options variables: var[0]=0 var[1]=0 var[2]=0
detection:rule_eval:1: Evaluating option byte_jump, cursor name pkt_data, cursor position 10</code></pre>
</div></div>
<div class="literalblock">
<div class="content">
<pre><code>snort.raw[6]:
- - - - - - - - - - - - - - -  - - - - - - - - - - - - - - -  - - - - -  - - - - -
66 6F 6F 62 61 72                                             foobar
- - - - - - - - - - - - - - -  - - - - - - - - - - - - - - -  - - - - -  - - - - -
detection:rule_eval:1: no match
detection:rule_eval:1: no match
detection:rule_eval:1: Processing pattern match #2
detection:rule_eval:1: Fast pattern packet[3] = 'foo' |66 6F 6F | ( )
detection:rule_eval:1: Starting tree eval
detection:rule_eval:1: Evaluating option byte_extract, cursor name pkt_data, cursor position 0</code></pre>
</div></div>
<div class="literalblock">
<div class="content">
<pre><code>snort.raw[16]:
- - - - - - - - - - - - - - -  - - - - - - - - - - - - - - -  - - - - -  - - - - -
31 30 00 41 41 41 41 41 41 41  66 6F 6F 62 61 72              10.AAAAAAAfoobar
- - - - - - - - - - - - - - -  - - - - - - - - - - - - - - -  - - - - -  - - - - -
detection:rule_vars:1: Rule options variables: var[0]=1 var[1]=0 var[2]=0
detection:rule_eval:1: Evaluating option byte_math, cursor name pkt_data, cursor position 1</code></pre>
</div></div>
<div class="literalblock">
<div class="content">
<pre><code>snort.raw[15]:
- - - - - - - - - - - - - - -  - - - - - - - - - - - - - - -  - - - - -  - - - - -
30 00 41 41 41 41 41 41 41 66  6F 6F 62 61 72                 0.AAAAAAAfoobar
- - - - - - - - - - - - - - -  - - - - - - - - - - - - - - -  - - - - -  - - - - -
detection:rule_vars:1: Rule options variables: var[0]=1 var[1]=10 var[2]=0
detection:rule_eval:1: Evaluating option content, cursor name pkt_data, cursor position 2</code></pre>
</div></div>
<div class="literalblock">
<div class="content">
<pre><code>snort.raw[14]:
- - - - - - - - - - - - - - -  - - - - - - - - - - - - - - -  - - - - -  - - - - -
00 41 41 41 41 41 41 41 66 6F  6F 62 61 72                    .AAAAAAAfoobar
- - - - - - - - - - - - - - -  - - - - - - - - - - - - - - -  - - - - -  - - - - -
detection:rule_vars:1: Rule options variables: var[0]=1 var[1]=10 var[2]=0
detection:rule_eval:1: Reached leaf, cursor name pkt_data, cursor position 13</code></pre>
</div></div>
<div class="literalblock">
<div class="content">
<pre><code>snort.raw[3]:
- - - - - - - - - - - - - - -  - - - - - - - - - - - - - - -  - - - - -  - - - - -
62 61 72                                                      bar
- - - - - - - - - - - - - - -  - - - - - - - - - - - - - - -  - - - - -  - - - - -
detection:rule_eval:1: Matched rule gid:sid:rev 1:3:0
detection:rule_vars:1: Rule options variables: var[0]=1 var[1]=10 var[2]=0
04/22-20:21:40.905630, 1, TCP, raw, 56, C2S, 127.0.0.1:1234, 127.0.0.1:5678, 1:3:0, allow</code></pre>
</div></div>
</div>
<div class="sect3">
<h4 id="_example_protocols_decoding_trace">Example - Protocols decoding trace</h4>
<div class="paragraph"><p>Turning on decode trace will print out information about the packets decoded
protocols. Can be useful in case of tunneling.</p></div>
<div class="paragraph"><p>Example for a icmpv4-in-ipv6 packet:</p></div>
<div class="paragraph"><p>In snort.lua, the following line was added:</p></div>
<div class="literalblock">
<div class="content">
<pre><code>trace =
{
    modules =
    {
        decode = { all = 1 }
    }
}</code></pre>
</div></div>
<div class="paragraph"><p>The output:</p></div>
<div class="literalblock">
<div class="content">
<pre><code>decode:all:1: Codec eth (protocol_id: 34525) ip header starts at: 0x7f70800110f0, length is 14
decode:all:1: Codec ipv6 (protocol_id: 1) ip header starts at: 0x7f70800110f0, length is 40
decode:all:1: Codec icmp4 (protocol_id: 256) ip header starts at: 0x7f70800110f0, length is 8
decode:all:1: Codec unknown (protocol_id: 256) ip header starts at: 0x7f70800110f0, length is 0</code></pre>
</div></div>
</div>
<div class="sect3">
<h4 id="_example_track_the_time_packet_spends_in_each_inspector">Example - Track the time packet spends in each inspector</h4>
<div class="paragraph"><p>There is a capability to track which inspectors evaluate a packet, and how much
time the inspector consumes doing so. These trace messages could be enabled by
the Snort module trace options:</p></div>
<div class="literalblock">
<div class="content">
<pre><code>main - command execution traces (main trace logging)
inspector_manager - inspectors execution and time tracking traces</code></pre>
</div></div>
<div class="paragraph"><p>Example for a single packet with payload:</p></div>
<div class="literalblock">
<div class="content">
<pre><code>10.AAAAAAAfoobar</code></pre>
</div></div>
<div class="paragraph"><p>In snort.lua, the following lines were added:</p></div>
<div class="literalblock">
<div class="content">
<pre><code>trace =
{
    modules =
    {
        snort =
        {
            -- could be replaced by 'all = 1'
            main = 1,
            inspector_manager = 1
        }
    }
}</code></pre>
</div></div>
<div class="paragraph"><p>The output:</p></div>
<div class="literalblock">
<div class="content">
<pre><code>snort:main:1: [0] Queuing command START for execution (refcount 1)
snort:main:1: [0] Queuing command RUN for execution (refcount 1)
snort:main:1: [0] Destroying completed command START
snort:inspector_manager:1: start inspection, raw, packet 1, context 1
snort:inspector_manager:1: enter stream
snort:inspector_manager:1: exit stream, elapsed time: 2 usec
snort:inspector_manager:1: stop inspection, raw, packet 1, context 1, total time: 14 usec
snort:inspector_manager:1: post detection inspection, raw, packet 1, context 1
snort:inspector_manager:1: end inspection, raw, packet 1, context 1, total time: 0 usec
snort:main:1: [0] Destroying completed command RUN</code></pre>
</div></div>
</div>
<div class="sect3">
<h4 id="_example_trace_filtering_by_packet_constraints">Example - trace filtering by packet constraints:</h4>
<div class="paragraph"><p>In snort.lua, the following lines were added:</p></div>
<div class="literalblock">
<div class="content">
<pre><code>ips =
{
    rules =
    [[
        alert tcp any any -&gt; any any ( msg: "ALERT_TCP"; gid: 1001; sid: 1001 )
        alert udp any any -&gt; any any ( msg: "ALERT_UDP"; gid: 1002; sid: 1002 )
    ]]
}</code></pre>
</div></div>
<div class="literalblock">
<div class="content">
<pre><code>trace =
{
    modules =
    {
        detection = { rule_eval = 1 }
    },
    constraints =
    {
        ip_proto = 17, -- udp
        dst_ip = "10.1.1.2",
        src_port = 100,
        dst_port = 200
    }
}</code></pre>
</div></div>
<div class="paragraph"><p>The processed traffic was next:</p></div>
<div class="literalblock">
<div class="content">
<pre><code>d ( stack="eth:ip4:udp" )</code></pre>
</div></div>
<div class="literalblock">
<div class="content">
<pre><code>c ( ip4:a="10.1.1.1", ip4:b="10.1.1.2", udp:a=100, udp:b=200 )
a ( pay="pass" )
b ( pay="pass" )</code></pre>
</div></div>
<div class="literalblock">
<div class="content">
<pre><code>c ( ip4:a="10.2.1.1" )
a ( pay="pass" )
b ( pay="pass" )</code></pre>
</div></div>
<div class="literalblock">
<div class="content">
<pre><code>c ( udp:a=101 )
a ( pay="block" )
b ( pay="block" )</code></pre>
</div></div>
<div class="paragraph"><p>The output:</p></div>
<div class="literalblock">
<div class="content">
<pre><code>detection:rule_eval:1: packet 1 UNK 10.1.1.1:100 10.1.1.2:200 (fast-patterns)
detection:rule_eval:1: Fast pattern processing - no matches found
detection:rule_eval:1: packet 1 UNK 10.1.1.1:100 10.1.1.2:200 (non-fast-patterns)
detection:rule_eval:1: packet 2 UNK 10.1.1.2:200 10.1.1.1:100 (fast-patterns)
detection:rule_eval:1: Fast pattern processing - no matches found
detection:rule_eval:1: packet 2 UNK 10.1.1.2:200 10.1.1.1:100 (non-fast-patterns)
detection:rule_eval:1: packet 3 UNK 10.2.1.1:100 10.1.1.2:200 (fast-patterns)
detection:rule_eval:1: Fast pattern processing - no matches found
detection:rule_eval:1: packet 3 UNK 10.2.1.1:100 10.1.1.2:200 (non-fast-patterns)
detection:rule_eval:1: packet 4 UNK 10.1.1.2:200 10.2.1.1:100 (fast-patterns)
detection:rule_eval:1: Fast pattern processing - no matches found
detection:rule_eval:1: packet 4 UNK 10.1.1.2:200 10.2.1.1:100 (non-fast-patterns)</code></pre>
</div></div>
<div class="paragraph"><p>The trace messages for two last packets (numbers 5 and 6) weren’t printed.</p></div>
</div>
<div class="sect3">
<h4 id="_example_configuring_traces_via_trace_set_command">Example - configuring traces via trace.set() command</h4>
<div class="paragraph"><p>In snort.lua, the following lines were added:</p></div>
<div class="literalblock">
<div class="content">
<pre><code>ips =
{
    rules =
    [[
        alert tcp any any -&gt; any any ( msg: "ALERT_TCP"; gid: 1001; sid: 1001 )
        alert udp any any -&gt; any any ( msg: "ALERT_UDP"; gid: 1002; sid: 1002 )
    ]]
}</code></pre>
</div></div>
<div class="literalblock">
<div class="content">
<pre><code>trace =
{
    constraints =
    {
        ip_proto = 17, -- udp
        dst_ip = "10.1.1.2",
        src_port = 100,
        dst_port = 200
    },
    modules =
    {
        detection = { rule_eval = 1 }
    }
}</code></pre>
</div></div>
<div class="paragraph"><p>The processed traffic was next:</p></div>
<div class="literalblock">
<div class="content">
<pre><code># Flow 1
d ( stack="eth:ip4:udp" )
c ( ip4:a="10.1.1.1", ip4:b="10.1.1.2", udp:a=100, udp:b=200 )
a ( data="udp packet 1" )
a ( data="udp packet 2" )</code></pre>
</div></div>
<div class="literalblock">
<div class="content">
<pre><code># Flow 2
d ( stack="eth:ip4:tcp" )
c ( ip4:a="10.1.1.3", ip4:b="10.1.1.4", tcp:a=5000, tcp:b=6000 )
a ( syn )
b ( syn, ack )
a ( ack )
a ( ack, data="tcp packet 1" )
a ( ack, data="tcp packet 2" )
a ( fin, ack )
b ( fin, ack )</code></pre>
</div></div>
<div class="paragraph"><p>After 1 packet, entering shell and pass the trace.set() command as follows:</p></div>
<div class="literalblock">
<div class="content">
<pre><code>trace.set({ constraints = { ip_proto = 6, dst_ip = "10.1.1.4", src_port = 5000, dst_port = 6000 }, modules = { decode = { all = 1 }, detection = { rule_eval = 1 } } })</code></pre>
</div></div>
<div class="paragraph"><p>The output (not full, only descriptive lines):</p></div>
<div class="literalblock">
<div class="content">
<pre><code>detection:rule_eval:1: packet 1 UNK 10.1.1.1:100 10.1.1.2:200 (fast-patterns)
detection:rule_eval:1: packet 1 UNK 10.1.1.1:100 10.1.1.2:200 (non-fast-patterns)
decode:all:1: Codec udp (protocol_id: 256) ip header starts length is 8
decode:all:1: Codec tcp (protocol_id: 256) ip header starts length is 20
detection:rule_eval:1: packet 3 UNK 10.1.1.3:5000 10.1.1.4:6000 (fast-patterns)
detection:rule_eval:1: packet 3 UNK 10.1.1.3:5000 10.1.1.4:6000 (non-fast-patterns)
decode:all:1: Codec tcp (protocol_id: 256) ip header starts length is 20
detection:rule_eval:1: packet 4 UNK 10.1.1.4:6000 10.1.1.3:5000 (fast-patterns)
detection:rule_eval:1: packet 4 UNK 10.1.1.4:6000 10.1.1.3:5000 (non-fast-patterns)
decode:all:1: Codec tcp (protocol_id: 256) ip header starts length is 20
detection:rule_eval:1: packet 5 UNK 10.1.1.3:5000 10.1.1.4:6000 (fast-patterns)
detection:rule_eval:1: packet 5 UNK 10.1.1.3:5000 10.1.1.4:6000 (non-fast-patterns)
decode:all:1: Codec tcp (protocol_id: 256) ip header starts length is 20
detection:rule_eval:1: packet 6 UNK 10.1.1.3:5000 10.1.1.4:6000 (fast-patterns)
detection:rule_eval:1: packet 6 UNK 10.1.1.3:5000 10.1.1.4:6000 (non-fast-patterns)
decode:all:1: Codec tcp (protocol_id: 256) ip header starts length is 20
detection:rule_eval:1: packet 7 UNK 10.1.1.3:5000 10.1.1.4:6000 (fast-patterns)
detection:rule_eval:1: packet 7 UNK 10.1.1.3:5000 10.1.1.4:6000 (non-fast-patterns)
decode:all:1: Codec tcp (protocol_id: 256) ip header starts length is 20
detection:rule_eval:1: packet 8 UNK 10.1.1.3:5000 10.1.1.4:6000 (fast-patterns)
detection:rule_eval:1: packet 8 UNK 10.1.1.3:5000 10.1.1.4:6000 (non-fast-patterns)
decode:all:1: Codec tcp (protocol_id: 256) ip header starts length is 20
detection:rule_eval:1: packet 9 UNK 10.1.1.4:6000 10.1.1.3:5000 (fast-patterns)
detection:rule_eval:1: packet 9 UNK 10.1.1.4:6000 10.1.1.3:5000 (non-fast-patterns)</code></pre>
</div></div>
<div class="paragraph"><p>The new configuration was applied. <strong>decode:all:1</strong> messages aren’t filtered
because they don’t include a packet (a packet isn’t well-formed at the point
when the message is printing).</p></div>
</div>
<div class="sect3">
<h4 id="_other_available_traces">Other available traces</h4>
<div class="paragraph"><p>There are more trace options supported by detection:</p></div>
<div class="literalblock">
<div class="content">
<pre><code>detect_engine - prints statistics about the engine
pkt_detect - prints a message when disabling content detect for packet
opt_tree - prints option tree data structure
tag - prints a message when a new tag is added</code></pre>
</div></div>
<div class="paragraph"><p>The rest support only 1 option, and can be turned on by adding all = 1 to
their table in trace lua config.</p></div>
<div class="ulist"><ul>
<li>
<p>
stream module trace:
</p>
</li>
</ul></div>
<div class="paragraph"><p>When turned on prints a message in case inspection is stopped on a flow.
Example for output:</p></div>
<div class="literalblock">
<div class="content">
<pre><code>stream:all:1: stop inspection on flow, dir BOTH</code></pre>
</div></div>
<div class="ulist"><ul>
<li>
<p>
stream_ip, stream_user: trace will output general processing messages
</p>
</li>
</ul></div>
<div class="paragraph"><p>Other modules that support trace have messages as seemed fit to the developer.
Some are for corner cases, others for complex data structures.</p></div>
</div>
</div>
<div class="sect2">
<h3 id="_wizard">Wizard</h3>
<div class="paragraph"><p>Using the wizard enables port-independent configuration and the detection of
malware command and control channels.  If the wizard is bound to a session, it
peeks at the initial payload to determine the service.  For example, <em>GET</em>
would indicate HTTP and <em>HELO</em> would indicate SMTP.  Upon finding a match, the
service bindings are reevaluated so the session can be handed off to the
appropriate inspector.  The wizard is still under development; if you find you
need to tweak the defaults please let us know.</p></div>
<div class="sect3">
<h4 id="_wizard_patterns">Wizard patterns</h4>
<div class="paragraph"><p>Wizard supports 3 kinds of patterns:</p></div>
<div class="olist arabic"><ol class="arabic">
<li>
<p>
Hexes
</p>
</li>
<li>
<p>
Spells
</p>
</li>
<li>
<p>
Curses
</p>
</li>
</ol></div>
<div class="paragraph"><p>Each kind of pattern has its own purpose and features.
It should be noted that the types of patterns are evaluated
exactly in the order in which they are described above.
Thus, if some data matches a hex, it will not be
processed by spells and curses.</p></div>
<div class="paragraph"><p>The depth of search for a pattern in the data can be configured using
the <code>max_search_depth</code> option</p></div>
<div class="paragraph"><p><em>TCP</em> packets form a flow, so wizard checks all data
in the flow for a match. If no pattern matches
and <em>max_search_depth</em> is reached, the flow is abandoned by wizard.</p></div>
<div class="paragraph"><p><em>UDP</em> packets form a "meta-flow" based on the addresses and ports of the packets.
However, unlike TCP processing, for UDP wizard only looks at the first arriving
packet from the meta-flow. If no pattern matches that packet or wizard’s <em>max_search_depth</em>
is reached, the meta-flow is abandoned by wizard.</p></div>
</div>
<div class="sect3">
<h4 id="_wizard_patterns_spells">Wizard patterns - Spells</h4>
<div class="paragraph"><p>Spell is a text based pattern. The best area of usage - text protocols: http, smtp, sip, etc.
Spells are:</p></div>
<div class="ulist"><ul>
<li>
<p>
Case insensitive
</p>
</li>
<li>
<p>
Whitespace sensitive
</p>
</li>
<li>
<p>
Able to match by a wildcard symbol
</p>
</li>
</ul></div>
<div class="paragraph"><p>In order to match any sequence of characters in pattern, you should use
"<code>*</code>" (glob) symbol in pattern.</p></div>
<div class="literalblock">
<div class="content">
<pre><code>Example:
  Pattern: '220-*FTP'
  Traffic that would match: '220- Hello world! It's a new FTP server'</code></pre>
</div></div>
<div class="paragraph"><p>To escape "<code>*</code>" symbol, put "<code>**</code>" in the pattern.</p></div>
<div class="paragraph"><p>Spells are configured as a Lua array, each element of which can
contain following options:</p></div>
<div class="ulist"><ul>
<li>
<p>
<em>service</em> - name of the service that would be assigned
</p>
</li>
<li>
<p>
<em>proto</em> - protocol to scan
</p>
</li>
<li>
<p>
<em>to_server</em> - list of text patterns to search in the data sent to the client
</p>
</li>
<li>
<p>
<em>to_client</em> - list of text patterns to search in the data sent to the server
</p>
<div class="literalblock">
<div class="content">
<pre><code>Example of a spell definition in Lua:
  {
    service = 'smtp',
    proto = 'tcp',
    to_server = { 'HELO', 'EHLO' },
    to_client = { '220*SMTP', '220*MAIL' }
  }</code></pre>
</div></div>
</li>
</ul></div>
</div>
<div class="sect3">
<h4 id="_wizard_patterns_hexes">Wizard patterns - Hexes</h4>
<div class="paragraph"><p>Hexes can be used to match binary protocols: dnp3, http2, ssl, etc.
Hexes use hexadecimal representation of the data for pattern matching.</p></div>
<div class="paragraph"><p>Wildcard in hex pattern is a placeholder for exactly one occurrence
of any hexadecimal digit and denoted by the symbol "<code>?</code>".</p></div>
<div class="literalblock">
<div class="content">
<pre><code>Example:
  Pattern: '|05 ?4|'
  Traffic that would match: '|05 84|'</code></pre>
</div></div>
<div class="paragraph"><p>Hexes are configured in the same way as spells and have an identical set of options.</p></div>
<div class="literalblock">
<div class="content">
<pre><code>Example of a hex definition in Lua:
  {
    service = 'dnp3',
    proto = 'tcp',
    to_server = { '|05 64|' },
    to_client = { '|05 64|' }
  }</code></pre>
</div></div>
</div>
<div class="sect3">
<h4 id="_wizard_patterns_curses">Wizard patterns - Curses</h4>
<div class="paragraph"><p>Curses are internal algorithms of service identification.
They are implemented as state machines in C++ code
and can have their own unique state information stored on the flow.</p></div>
<div class="paragraph"><p>A list of available services can be obtained using <code>snort --help-config wizard | grep curses</code>.</p></div>
<div class="literalblock">
<div class="content">
<pre><code>A configuration which enables some curses:
  curses = {'dce_udp', 'dce_tcp', 'dce_smb', 'sslv2'}</code></pre>
</div></div>
</div>
<div class="sect3">
<h4 id="_additional_details">Additional Details:</h4>
<div class="ulist"><ul>
<li>
<p>
Note that usually more specific patterns have higher precedence.
</p>
<div class="literalblock">
<div class="content">
<pre><code>For example:
  The following spells against 'foobar' payload. The 3rd spell matches.
    { service = 'first',  to_server = { 'foo' } },
    { service = 'second',  to_server = { 'bar' } }
    { service = 'third',  to_server = { 'foobar' } }</code></pre>
</div></div>
</li>
<li>
<p>
If the wizard and one or more service inspectors are configured w/o
  explicitly configuring the binder, default bindings will be generated which
  should work for most common cases.
</p>
</li>
<li>
<p>
Also note that while Snort 2 bindings can only be configured in the
  default policy, each Snort 3 policy can contain a binder leading to an
  arbitrary hierarchy.
</p>
</li>
<li>
<p>
The entire configuration can be reloaded and hot-swapped during run-time
  via signal or command in both Snort 2 and Snort 3.  Ultimately, Snort 3
  will support commands to update the binder on the fly, thus enabling
  incremental reloads of individual inspectors.
</p>
</li>
<li>
<p>
Both Snort 2 and Snort 3 support server specific configurations via a hosts
  table (XML in Snort 2 and Lua in Snort 3).  The table allows you to
  map network, protocol, and port to a service and policy.  This table can
  be reloaded and hot-swapped separately from the config file.
</p>
</li>
<li>
<p>
You can find the specifics on the binder, wizard, and hosts tables in the
  manual or command line like this:  snort --help-module binder, etc.
</p>
</li>
</ul></div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_daq_configuration_and_modules">DAQ Configuration and Modules</h2>
<div class="sectionbody">
<div class="paragraph"><p>The Data AcQuisition library (DAQ), provides pluggable packet I/O.  LibDAQ
replaces direct calls to libraries like libpcap with an abstraction layer
that facilitates operation on a variety of hardware and software interfaces
without requiring changes to Snort.  It is possible to select the DAQ module
and mode when invoking Snort to perform pcap readback or inline operation,
etc.  The DAQ library may be useful for other packet processing
applications and the modular nature allows you to build new modules for
other platforms.</p></div>
<div class="paragraph"><p>The DAQ library exists as a separate repository on the official Snort 3 GitHub
project (<a href="https://github.com/snort3/libdaq">https://github.com/snort3/libdaq</a>) and contains a number of bundled DAQ
modules including AFPacket, Divert, NFQ, PCAP, and Netmap implementations.
Snort 3 itself contains a few new DAQ modules mostly used for testing as
described below.  Additionally, DAQ modules developed by third parties to
facilitate the usage of their own hardware and software platforms exist.</p></div>
<div class="sect2">
<h3 id="_building_the_daq_library_and_its_bundled_daq_modules">Building the DAQ Library and Its Bundled DAQ Modules</h3>
<div class="paragraph"><p>Refer to the READMEs in the LibDAQ source tarball for instructions on how to
build the library and modules as well as details on configuring and using the
bundled DAQ modules.</p></div>
</div>
<div class="sect2">
<h3 id="_configuration_11">Configuration</h3>
<div class="paragraph"><p>As with a number of features in Snort 3, the LibDAQ and DAQ module
configuration may be controlled using either the command line options or by
configuring the <em>daq</em> Snort module in the Lua configuration (command line
option has higher precedence).</p></div>
<div class="paragraph"><p>DAQ modules may be statically built into Snort, but the more common case is to
use DAQ modules that have been built as dynamically loadable objects.  Because
of this, the first thing to take care of is informing Snort of any locations it
should search for dynamic DAQ modules.  From the command line, this can be done
with one or more invocations of the --daq-dir option, which takes a
colon-separated set of paths to search as its argument.  All arguments will be
collected into a list of locations to be searched. In the Lua configuration, the
<em>daq.module_dirs[]</em> property is a list of paths for the same purpose.</p></div>
<div class="paragraph"><p>Next, one must select which DAQ modules they wish to use by name.  At least one
base module and zero or more wrapper modules may be selected.  This is done
using the --daq options from the command line or the <em>daq.modules[]</em> list-type
property.  To get a list of the available modules, run Snort with the --daq-list
option making sure to specify any DAQ module search directories beforehand.  If
no DAQ module is specified, Snort will default to attempting to find and use a
DAQ module named <em>pcap</em>.</p></div>
<div class="paragraph"><p>Some DAQ modules can be further directly configured using DAQ module variables.
All DAQ module variables come in the form of either just a key or a key and a
value separated by an equals sign.  For example, <em>debug</em> or <em>fanout_type=hash</em>.
The command line option for specifying these is --daq-var and the configuration
file equivalent is the <em>daq.modules[].variables[]</em> property.  The available
variables for each module will be shown when listing the available DAQ modules
with --daq-list.</p></div>
<div class="paragraph"><p>The LibDAQ concept of operational mode (passive, inline, or file readback) is
automatically configured based on inferring the mode from other Snort
configuration.  The presence of -r or --pcap-* options implies <em>read-file</em>, -i
without -Q implies <em>passive</em>, and -i with -Q implies <em>inline</em>.  The mode can be
overridden on a per-DAQ module basis with the --daq-mode option on the command
line or the <em>daq.modules[].mode</em> property.</p></div>
<div class="paragraph"><p>The DAQ module receive timeout is always configured to 1 second.  The packet
capture length (snaplen) defaults to 1518 bytes and can be overridden by the -s
command line option or <em>daq.snaplen</em> property.</p></div>
<div class="paragraph"><p>Finally, and most importantly, is the input specification for the DAQ module.
In readback mode, this is simply the file to be read back and analyzed.  For
live traffic processing, this is the name of the interface or other necessary
input specification as required by the DAQ module to understand what to operate
upon.  From the command line, the -r option is used to specify a file to be
read back and the -i option is used to indicate a live interface input
specification.  Both are covered by the <em>daq.inputs[]</em> property.</p></div>
<div class="paragraph"><p>For advanced use cases, one additional LibDAQ configuration exists: the number
of DAQ messages to request per receive call.  In Snort, this is referred to as
the DAQ "batch size" and defaults to 64.  The default can be overridden with
the --daq-batch-size command line option or <em>daq.batch_size</em> property.  The
message pool size requested from the DAQ module will be four times this batch
size.</p></div>
<div class="sect3">
<h4 id="_command_line_example">Command Line Example</h4>
<div class="literalblock">
<div class="content">
<pre><code>    snort --daq-dir /usr/local/lib/daq --daq-dir /opt/lib/daq --daq afpacket
--daq-var debug --daq-var fanout_type=hash -i eth1:eth2 -Q</code></pre>
</div></div>
</div>
<div class="sect3">
<h4 id="_configuration_file_example">Configuration File Example</h4>
<div class="paragraph"><p>The following is the equivalent of the above command line DAQ configuration in
Lua form:</p></div>
<div class="literalblock">
<div class="content">
<pre><code>daq =
{
    module_dirs =
    {
        '/usr/local/lib/daq',
        '/opt/lib/daq'
    },
    modules =
    {
        {
            name = 'afpacket',
            mode = 'inline',
            variables =
            {
                'debug',
                'fanout_type=hash'
            }
        }
    },
    inputs =
    {
        'eth1:eth2',
    },
    snaplen = 1518
}</code></pre>
</div></div>
<div class="paragraph"><p>The <em>daq.snaplen</em> property was included for completeness and may be omitted if
the default value is acceptable.</p></div>
</div>
<div class="sect3">
<h4 id="_daq_module_configuration_stacks">DAQ Module Configuration Stacks</h4>
<div class="paragraph"><p>Like briefly mentioned above, a DAQ configuration consists of a base DAQ module
and zero or more wrapper DAQ modules.  DAQ wrapper modules provide additional
functionality layered on top of the base module in a decorator pattern.  For
example, the Dump DAQ module will capture all passed or injected packets and
save them to a PCAP savefile.  This can be layered on top of something like the
PCAP DAQ module to assess which packets are making it through Snort without
being dropped and what actions Snort has taken that involved sending new or
modified packets out onto the network (e.g., TCP reset packets and TCP
normalizations).</p></div>
<div class="paragraph"><p>To configure a DAQ module stack from the command line, the --daq option must
be given multiple times with the base module specified first followed by the
wrapper modules in the desired order (building up the stack).  Each --daq
option changes which module is being configured by subsequent --daq-var and
--daq mode options.</p></div>
<div class="paragraph"><p>When configuring the same sort of stack in Lua, everything lives in the
<em>daq.modules[]</em> property.  <em>daq.modules[]</em> is an array of module configurations
pushed onto the stack from top to bottom.  Each module configuration <strong>must</strong>
contain the name of the DAQ module.  Additionally, it may contain an array of
variables (<em>daq.modules[].variables[]</em>) and/or an operational mode
(<em>daq.modules[].mode</em>).</p></div>
<div class="paragraph"><p>If only wrapper modules were specified, Snort will default to implicitly
configuring a base module with the name <em>pcap</em> in <em>read-file</em> mode.  This is a
convenience to mimic the previous behavior when selecting something like the
old Dump DAQ module that may be removed in the future.</p></div>
<div class="paragraph"><p>For any particularly complicated setup, it is recommended that one configure
via a Lua configuration file rather than using the command line options.</p></div>
</div>
</div>
<div class="sect2">
<h3 id="_interaction_with_multiple_packet_threads">Interaction With Multiple Packet Threads</h3>
<div class="paragraph"><p>All packet threads will receive the same DAQ instance configuration with the
potential exception of the input specification.</p></div>
<div class="paragraph"><p>If Snort is in file readback mode, a full set of files will be constructed from
the -r/--pcap-file/--pcap-list/--pcap-dir/--pcap-filter options.  A number of
packet threads will be started up to the configured maximum (-z) to process
these files one at a time.  As a packet thread completes processing of a file,
it will be stopped and then started again with a different file input to
process.  If the number of packet threads configured exceeds the number of
files to process, or as the number of remaining input files dwindles below that
number, Snort will stop spawning new packet threads when it runs out of
unhandled input files.</p></div>
<div class="paragraph"><p>When Snort is operating on live interfaces (-i), all packet threads up to the
configured maximum will always be started.  By default, if only one input
specification is given, all packet threads will receive the same input in their
configuration.  If multiple inputs are given, each thread will be given the
matching input (ordinally), falling back to the first if the number of packet
threads exceeds the number of inputs.</p></div>
</div>
<div class="sect2">
<h3 id="_daq_modules_included_with_snort_3">DAQ Modules Included With Snort 3</h3>
<div class="sect3">
<h4 id="_socket_module">Socket Module</h4>
<div class="paragraph"><p>The socket module provides provides a stream socket server that will accept
up to 2 simultaneous connections and bridge them together while also
passing data to Snort for inspection.  The first connection accepted is
considered the client and the second connection accepted is considered the
server.  If there is only one connection, stream data can’t be forwarded
but it is still inspected.</p></div>
<div class="paragraph"><p>Each read from a socket of up to snaplen bytes is passed as a packet to
Snort along with the ability to retrieve a DAQ_UsrHdr_t structure via ioctl.
DAQ_UsrHdr_t conveys IP4 address, ports, protocol, and direction.  Socket
packets can be configured to be TCP or UDP.  The socket DAQ can be operated
in inline mode and is able to block packets.</p></div>
<div class="paragraph"><p>Packets from the socket DAQ module are handled by Snort’s stream_user module,
which must be configured in the Snort configuration.</p></div>
<div class="paragraph"><p>To use the socket DAQ, start Snort like this:</p></div>
<div class="literalblock">
<div class="content">
<pre><code>./snort --daq-dir /path/to/lib/snort_extra/daq \
    --daq socket [--daq-var port=&lt;port&gt;] [--daq-var proto=&lt;proto&gt;] [-Q]</code></pre>
</div></div>
<div class="literalblock">
<div class="content">
<pre><code>&lt;port&gt; ::= 1..65535; default is 8000
&lt;proto&gt; ::= tcp | udp</code></pre>
</div></div>
<div class="ulist"><ul>
<li>
<p>
This module only supports ip4 traffic.
</p>
</li>
<li>
<p>
This module is only supported by Snort 3.  It is not compatible with
  Snort 2.
</p>
</li>
<li>
<p>
This module is primarily for development and test.
</p>
</li>
</ul></div>
</div>
<div class="sect3">
<h4 id="_file_module">File Module</h4>
<div class="paragraph"><p>The file module provides the ability to process files directly without having
to extract them from pcaps.  Use the file module with Snort’s stream_file to
get file type identification and signature services.  The usual IPS detection
and logging, etc. is also available.</p></div>
<div class="paragraph"><p>You can process all the files in a directory recursively using 8 threads
with these Snort options:</p></div>
<div class="literalblock">
<div class="content">
<pre><code>--pcap-dir path -z 8</code></pre>
</div></div>
<div class="ulist"><ul>
<li>
<p>
This module is only supported by Snort 3.  It is not compatible with
  Snort 2.
</p>
</li>
<li>
<p>
This module is primarily for development and test.
</p>
</li>
</ul></div>
</div>
<div class="sect3">
<h4 id="_hext_module">Hext Module</h4>
<div class="paragraph"><p>The hext module generates packets suitable for processing by Snort from
hex/plain text.  Raw packets include full headers and are processed
normally.  Otherwise the packets contain only payload and are accompanied
with flow information (4-tuple) suitable for processing by stream_user.</p></div>
<div class="paragraph"><p>The first character of the line determines it’s purpose:</p></div>
<div class="literalblock">
<div class="content">
<pre><code>'$' command
'#' comment
'"' quoted string packet data
'x' hex packet data
' ' empty line separates packets</code></pre>
</div></div>
<div class="paragraph"><p>The available commands are:</p></div>
<div class="literalblock">
<div class="content">
<pre><code>$client &lt;ip4&gt; &lt;port&gt;
$server &lt;ip4&gt; &lt;port&gt;</code></pre>
</div></div>
<div class="literalblock">
<div class="content">
<pre><code>$packet -&gt; client
$packet -&gt; server</code></pre>
</div></div>
<div class="literalblock">
<div class="content">
<pre><code>$packet &lt;addr&gt; &lt;port&gt; -&gt; &lt;addr&gt; &lt;port&gt;</code></pre>
</div></div>
<div class="literalblock">
<div class="content">
<pre><code>$sof &lt;i32:ingressZone&gt; &lt;i32:egressZone&gt; &lt;i32:ingressIntf&gt; &lt;i32:egressIntf&gt; &lt;s:srcIp&gt; &lt;i16:srcPort&gt; &lt;s:destIp&gt; &lt;i16:dstPort&gt; &lt;u32:opaque&gt; &lt;u64:initiatorPkts&gt; &lt;u64:responderPkts&gt; &lt;u64:initiatorPktsDropped&gt; &lt;u64:responderPktsDropped&gt; &lt;u64:initiatorBytesDropped&gt; &lt;u64:responderBytesDropped&gt; &lt;u8:isQosAppliedOnSrcIntf&gt; &lt;timeval:sof_timestamp&gt; &lt;timeval:eof_timestamp&gt; &lt;u32:address_space_id&gt; &lt;u32:tenant_id&gt; &lt;u16:vlan&gt; &lt;u8:protocol&gt; &lt;u8:flags&gt;
$eof &lt;i32:ingressZone&gt; &lt;i32:egressZone&gt; &lt;i32:ingressIntf&gt; &lt;i32:egressIntf&gt; &lt;s:srcIp&gt; &lt;i16:srcPort&gt; &lt;s:destIp&gt; &lt;i16:dstPort&gt; &lt;u32:opaque&gt; &lt;u64:initiatorPkts&gt; &lt;u64:responderPkts&gt; &lt;u64:initiatorPktsDropped&gt; &lt;u64:responderPktsDropped&gt; &lt;u64:initiatorBytesDropped&gt; &lt;u64:responderBytesDropped&gt; &lt;u8:isQosAppliedOnSrcIntf&gt; &lt;timeval:sof_timestamp&gt; &lt;timeval:eof_timestamp&gt; &lt;u32:address_space_id&gt; &lt;u32:tenant_id&gt; &lt;u16:vlan&gt; &lt;u8:protocol&gt; &lt;u8:flags&gt;</code></pre>
</div></div>
<div class="paragraph"><p>Client and server are determined as follows.  $packet → client indicates
to the client (from server) and $packet → server indicates a packet to the
server (from client).  $packet followed by a 4-tuple uses the heuristic
that the client is the side with the greater port number.</p></div>
<div class="paragraph"><p>The default client and server are 192.168.1.1 12345 and 10.1.2.3 80
respectively.  $packet commands with a 4-tuple do not change client and
server set with the other $packet commands.</p></div>
<div class="paragraph"><p>$packet commands should be followed by packet data, which may contain any
combination of hex and strings.  Data for a packet ends with the next
command or a blank line.  Data after a blank line will start another packet
with the same tuple as the prior one.</p></div>
<div class="paragraph"><p>$sof and $eof commands generate Start of Flow and End of Flow metapackets
respectively. They are followed by a definition of a DAQ_FlowStats_t data
structure which will be fed into Snort via the metadata callback.</p></div>
<div class="paragraph"><p>Strings may contain the following escape sequences:</p></div>
<div class="literalblock">
<div class="content">
<pre><code>\r = 0x0D = carriage return
\n = 0x0A = new line
\t = 0x09 = tab
\\ = 0x5C = \</code></pre>
</div></div>
<div class="paragraph"><p>Format your input carefully; there is minimal error checking and little
tolerance for arbitrary whitespace.  You can use Snort’s -L hext option to
generate hext input from a pcap.</p></div>
<div class="ulist"><ul>
<li>
<p>
This module only supports ip4 traffic.
</p>
</li>
<li>
<p>
This module is only supported by Snort 3.  It is not compatible with
  Snort 2.
</p>
</li>
<li>
<p>
This module is primarily for development and test.
</p>
</li>
</ul></div>
<div class="paragraph"><p>The hext DAQ also supports a raw mode which is activated by setting the
data link type.  For example, you can input full ethernet packets with
--daq-var dlt=1 (Data link types are defined in the DAQ include
sfbpf_dlt.h.)  Combine that with the hext logger in raw mode for a quick
(and dirty) way to edit pcaps.  With --lua "log_hext = { raw = true }", the
hext logger will dump the full packet in a way that can be read by the hext
DAQ in raw mode.  Here is an example:</p></div>
<div class="literalblock">
<div class="content">
<pre><code># 3 [96]</code></pre>
</div></div>
<div class="literalblock">
<div class="content">
<pre><code>x02 09 08 07 06 05 02 01 02 03 04 05 08 00 45 00 00 52 00 03  # ..............E..R..
x00 00 40 06 5C 90 0A 01 02 03 0A 09 08 07 BD EC 00 50 00 00  # ..@.\............P..
x00 02 00 00 00 02 50 10 20 00 8A E1 00 00 47 45 54 20 2F 74  # ......P.  .....GET /t
x72 69 67 67 65 72 2F 31 20 48 54 54 50 2F 31 2E 31 0D 0A 48  # rigger/1 HTTP/1.1..H
x6F 73 74 3A 20 6C 6F 63 61 6C 68 6F 73 74 0D 0A              # ost: localhost..</code></pre>
</div></div>
<div class="paragraph"><p>A comment indicating packet number and size precedes each packet dump.
Note that the commands are not applicable in raw mode and have no effect.</p></div>
</div>
</div>
</div>
</div>
</div>

<div id="footer">
<div id="footer-text">
Version 3.1.78.0<br>
Last updated
 2024-01-16 01:23:40 EST
</div>
</div>


</body></html>